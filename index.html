<!-- Author: Honglie Zhang -->
<!DOCTYPE html>
<html lang="zh-CN"> <!-- 更准确的中文语言代码 -->

<head>
  <!-- Meta Tags (最优先加载) -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="宏基因组报告分析系统">
  <meta name="author" content="Honglie Zhang"> <!-- 建议添加作者信息 -->

  <title>宏基因组报告</title>

  <!-- Critical CSS (如果有) -->
  <style>
    /* 关键渲染路径的CSS */
  </style>

  <!-- 预加载关键资源 -->
  <link
    rel="preload"
    href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@500;700;800&display=swap"
    as="style"
    crossorigin="anonymous"
  >

  <!-- 第三方CSS -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    crossorigin="anonymous"
  >

  <!-- 字体资源 -->
  <!-- 优化字体加载 -->
  <link
    href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@500;700;800&display=swap"
    rel="stylesheet"
    media="print"
    onload="this.media='all'"
    crossorigin="anonymous"
  >

  <!-- 自定义CSS -->
  <link rel="stylesheet" href="./css/style.css">

  <!-- 全局配置（在框架之前） -->
  <script>
    window.DATA_PATHS = {
      DATA: './data/bacteria_data.json'
    };
  </script>

  <!-- 框架/库（使用 defer 确保不阻塞） -->
  <script src="https://cdn.tailwindcss.com" defer></script>

  <!-- 无JS时的降级方案 -->
  <noscript>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@500;700;800&display=swap"
      rel="stylesheet"
      crossorigin="anonymous"
    >
  </noscript>
</head>

<!-- 页面主体 -->
<body class="bg-white p-6">

  <!-- 阅读指南和免责声明 -->

  <h1 class="custom-title-second-level">报告阅读指南</h1>

  <div
    class="bg-white rounded-lg p-5 mb-5 mx-auto"
    style="width: 100%;">

    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            <i class="fas fa-info-circle icon"></i>
            本宏基因组报告旨在为您提供肠道微生物群落的全面分析与深入理解。以下内容涵盖了宏基因组的基本概念、技术解析和注意事项。
          </p>
        </div>
      </div>
    </div>

    <!-- 问答信息框 -->
    <div class="qa-box">
      <div class="flex items-start ml-2">
        <p class="text-lg font-bold text-lightpurple">
          <i class="fas fa-question-circle icon icon-purple"></i>
          什么是肠道菌群的宏基因组？和16S有什么区别？
        </p>
      </div>
      <div class="flex items-start ml-2 mt-2">
        <p class="answer-text">
          <i class="fas fa-comments icon icon-orange"></i>
          肠道菌群的宏基因组是指从肠道微生物群体中提取的所有微生物（包括细菌、古菌、真菌和病毒等）的遗传物质（DNA）进行分析与研究的领域。宏基因组分析提供了更为详尽和全面的微生物谱系信息，能够揭示真菌和病毒的存在，并识别毒理和耐药基因。而16S rRNA则在样本积累和数据库支持方面更为丰富，主要集中于分类学信息的分析。
        </p>
      </div>
    </div>

    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            <i class="fas fa-exclamation-triangle" style="color: orange;"></i>
            <strong>特别注意：</strong>本报告采用高通量测序技术对肠道菌群进行宏基因组检测，并利用大数据和人工智能技术对各项指标进行评估。以下是您阅读报告前需注意的事项：
          </p>
          <ul class="list-disc ml-5">
            <li>
              <strong>结果的解读并非绝对</strong>：
              <ul class="list-disc ml-5">
                <li>报告中的数据和分析结果只是对您肠道菌群的一个快照，它们可能会受到多种因素的影响，如饮食、生活方式、地理环境等。因此，请保持对结果的审慎态度，不要将其视为绝对的健康指标。</li>
              </ul>
            </li>

<!--            <li>-->
<!--              <strong>个体差异</strong>：-->
<!--              <ul class="list-disc ml-5">-->
<!--                <li>肠道菌群的构成因人而异，个体差异可能会导致相同的微生物组成在不同人群中的健康影响不同。</li>-->
<!--              </ul>-->
<!--            </li>-->

            <li>
              <strong>技术和方法的限制</strong>：
              <ul class="list-disc ml-5">
                <li>尽管高通量测序和人工智能技术能提供强大的分析能力，但这些技术也有局限性。</li>
              </ul>
            </li>

            <li>
              <strong>临床相关性并不确定</strong>：
              <ul class="list-disc ml-5">
                <li>报告可能会提到与某些健康状况的相关性，但关联并不等于因果关系。个别结果需结合您的整体健康状况和其他临床因素进行判断，而不是单一指标决定健康状况。</li>
              </ul>
            </li>

            <li>
              <strong>避免过度解读</strong>：
              <ul class="list-disc ml-5">
                <li>有些微小的变化可能并不具有临床意义。</li>
              </ul>
            </li>

            <li>
              <strong>跟踪研究的重要性</strong>：
              <ul class="list-disc ml-5">
                <li>肠道菌群是动态的，定期监测和跟踪会提供更好的健康状态评估。单次测试结果的意义有限，尤其是在没有长期数据对比的情况下。</li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </div>

  </div>

  <!-- 宏基因组检测报告总结页 -->

  <!-- h1标题：使用自定义样式类custom-title-first-level来定制"宏基因组检测报告"的样式 -->
  <h1 class="custom-title-first-level page-break">宏基因组检测报告</h1>

<!--  <div class="bg-white rounded-lg p-5 mb-5 mx-auto" style="width: 100%;">-->

<!--    &lt;!&ndash; 基本信息行 &ndash;&gt;-->
<!--    <div class="grid grid-cols-2 gap-4 mb-2">-->
<!--      &lt;!&ndash; 左边三个 summary-info-card &ndash;&gt;-->
<!--      <div class="flex gap-2">-->
<!--        <div class="summary-info-card" style="flex: 75;">-->
<!--          <div class="summary-title font-bold">姓名</div>-->
<!--          <div class="font-bold text-gray-500">张三</div>-->
<!--        </div>-->
<!--        <div class="summary-info-card" style="flex: 75;">-->
<!--          <div class="summary-title font-bold">性别</div>-->
<!--          <div class="font-bold text-gray-500">男性</div>-->
<!--        </div>-->
<!--        <div class="summary-info-card" style="flex: 100;">-->
<!--          <div class="summary-title font-bold">年龄</div>-->
<!--          <div class="font-bold text-gray-500">3岁0月</div>-->
<!--        </div>-->
<!--      </div>-->

<!--      &lt;!&ndash; 右边两个 summary-info-card &ndash;&gt;-->
<!--      <div class="flex gap-2">-->
<!--        <div class="summary-info-card flex-1">-->
<!--          <div class="summary-title font-bold">样本编号</div>-->
<!--          <div class="font-bold text-gray-500">681364179</div>-->
<!--        </div>-->
<!--        <div class="summary-info-card flex-1">-->
<!--          <div class="summary-title font-bold">报告日期</div>-->
<!--          <div class="font-bold text-gray-500">2025-02-11</div>-->
<!--        </div>-->
<!--      </div>-->
<!--    </div>-->

<!--    &lt;!&ndash; 健康总分和右侧三个框并排显示 &ndash;&gt;-->
<!--    <div class="grid grid-cols-2 gap-4 mb-2">-->
<!--      &lt;!&ndash; 左侧健康总分 &ndash;&gt;-->
<!--      <div class="summary-info-card">-->
<!--        <div class="summary-title mb-7"><b>健康总分</b></div>-->
<!--        <div class="flex flex-col items-center">-->
<!--          <div class="w-40 h-40 mb-5">-->
<!--            <svg viewBox="0 0 100 100">-->
<!--              <circle class="summary-circle-bg" cx="50" cy="50" r="45"/>-->
<!--              <circle class="summary-circle" cx="50" cy="50" r="45"-->
<!--                      stroke-dasharray="282.7"-->
<!--                      stroke-dashoffset="101.772"/>-->
<!--              <text x="50" y="45"-->
<!--                    class="summary-score-text"-->
<!--                    text-anchor="middle"-->
<!--                    dominant-baseline="middle"-->
<!--                    font-size="30"-->
<!--                    font-weight="bold"-->
<!--                    fill="#FF5733">64</text>-->
<!--              <text x="50" y="68"-->
<!--                    class="summary-score-text"-->
<!--                    text-anchor="middle"-->
<!--                    font-size="10"-->
<!--                    fill="#2DA6A8">总分: 100</text>-->
<!--            </svg>-->
<!--          </div>-->
<!--          <div class="summary-description text-center">-->
<!--            处于亚健康及营养饮食不合理状态，表明目前健康状况处于中等偏下水平，主要原因是饮食营养不均衡，需要通过调整饮食结构和生活习惯来改善健康状况。-->
<!--          </div>-->
<!--        </div>-->
<!--      </div>-->

<!--      &lt;!&ndash; 右侧三个框堆叠 &ndash;&gt;-->
<!--      <div class="flex flex-col gap-2 h-full">-->
<!--        &lt;!&ndash; 菌群健康 &ndash;&gt;-->
<!--        <div class="flex-1 summary-info-card p-4">-->
<!--          <div class="summary-title font-bold mb-3">菌群健康</div>-->
<!--          <div class="flex w-full items-center">-->
<!--            <div class="flex-1 bg-gray-200 rounded-full h-3 mr-3">-->
<!--              <div class="bg-[#FFD700] h-3 rounded-full" style="width: 73%"></div>-->
<!--            </div>-->
<!--            <div class="text-[#2DA6A8] font-bold w-16 text-right">-->
<!--              <span class="text-[#FFD700]">73</span>/100-->
<!--            </div>-->
<!--          </div>-->
<!--          <div class="text-sm text-gray-600 mt-2">-->
<!--            肠道菌群多样性良好-->
<!--          </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; 慢病控制 &ndash;&gt;-->
<!--        <div class="flex-1 summary-info-card p-4">-->
<!--          <div class="summary-title font-bold mb-3">慢病控制</div>-->
<!--          <div class="flex w-full items-center">-->
<!--            <div class="flex-1 bg-gray-200 rounded-full h-3 mr-3">-->
<!--              <div class="bg-[#9ACD32] h-3 rounded-full" style="width: 81%"></div>-->
<!--            </div>-->
<!--            <div class="text-[#2DA6A8] font-bold w-16 text-right">-->
<!--              <span class="text-[#9ACD32]">81</span>/100-->
<!--            </div>-->
<!--          </div>-->
<!--          <div class="text-sm text-gray-600 mt-2">-->
<!--            慢性疾病风险较低-->
<!--          </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; 营养均衡 &ndash;&gt;-->
<!--        <div class="flex-1 summary-info-card p-4">-->
<!--          <div class="summary-title font-bold mb-3">营养均衡</div>-->
<!--          <div class="flex w-full items-center">-->
<!--            <div class="flex-1 bg-gray-200 rounded-full h-3 mr-3">-->
<!--              <div class="bg-[#9ACD32] h-3 rounded-full" style="width: 80%"></div>-->
<!--            </div>-->
<!--            <div class="text-[#2DA6A8] font-bold w-16 text-right">-->
<!--              <span class="text-[#9ACD32]">80</span>/100-->
<!--            </div>-->
<!--          </div>-->
<!--          <div class="text-sm text-gray-600 mt-2">-->
<!--            营养摄入基本均衡-->
<!--          </div>-->
<!--        </div>-->
<!--      </div>-->
<!--    </div>-->

<!--    <div class="flex gap-4">-->
<!--      &lt;!&ndash; 肠道年龄容器 (占7份) &ndash;&gt;-->
<!--      <div class="summary-info-card flex-[7]">-->
<!--        <div class="summary-title mb-10"><b>肠道年龄</b></div>-->
<!--        <div class="flex flex-col">-->
<!--          <div class="relative w-full">-->
<!--            &lt;!&ndash; 真实年龄部分 &ndash;&gt;-->
<!--            <div class="mb-9">-->
<!--              <div class="flex items-center">-->
<!--                <div class="text-gray-600 mr-4 w-20">实际年龄</div>-->
<!--                <div class="flex-1 relative">-->
<!--                  <div class="absolute -top-6 left-[30%] transform -translate-x-1/2 text-gray-500 font-bold text-lg">30岁</div>-->
<!--                  <div class="summary-age-bar bg-gray-200">-->
<!--                    <div class="summary-age-bar bg-blue-200" style="width: 30%"></div>-->
<!--                  </div>-->
<!--                </div>-->
<!--              </div>-->
<!--            </div>-->
<!--            &lt;!&ndash; 肠道年龄部分 &ndash;&gt;-->
<!--            <div>-->
<!--              <div class="flex items-center">-->
<!--                <div class="text-gray-600 mr-4 w-20">肠道年龄</div>-->
<!--                <div class="flex-1 relative">-->
<!--                  <div class="absolute -top-6 left-[54.7%] transform -translate-x-1/2 text-gray-500 font-bold text-lg">54.7岁</div>-->
<!--                  <div class="summary-age-bar bg-gray-200">-->
<!--                    <div class="summary-age-bar" style="width: 54.7%; background-color: rgb(45, 166, 168)"></div>-->
<!--                  </div>-->
<!--                </div>-->
<!--              </div>-->
<!--            </div>-->
<!--          </div>-->
<!--          <div class="summary-description mt-5">-->
<!--            当肠道菌群反映的年龄大幅偏离真实年龄时道常代表您的肠道菌群出现了紊乱，存在疾病风险或发育滞后-->
<!--          </div>-->
<!--        </div>-->
<!--      </div>-->

<!--      &lt;!&ndash; 肠型容器 (占3份) &ndash;&gt;-->
<!--      <div class="summary-info-card flex-[3]">-->
<!--        <div class="summary-title mb-3"><b>肠型</b></div>-->

<!--        <div class="flex flex-col gap-2">-->

<!--          &lt;!&ndash; 拟杆菌型 &ndash;&gt;-->
<!--          <div class="rounded-xl bg-white p-3">-->
<!--            <div class="flex justify-between items-start">-->
<!--              <div>-->
<!--                <span class="text-[10px] font-medium text-gray-400 block mb-0.5">类型 A</span>-->
<!--                <h2 class="text-base font-bold text-gray-500">拟杆菌型</h2>-->
<!--              </div>-->
<!--              <div class="w-6 h-6 rounded-lg bg-gray-100 flex items-center justify-center">-->
<!--                <svg class="w-3 h-3 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">-->
<!--                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>-->
<!--                </svg>-->
<!--              </div>-->
<!--            </div>-->
<!--          </div>-->

<!--          &lt;!&ndash; 普雷沃氏菌型（当前用户类型） &ndash;&gt;-->
<!--          <div class="rounded-xl p-3" style="background: #D0E7FF">-->
<!--            <div class="flex justify-between items-start">-->
<!--              <div>-->
<!--                <span class="text-[10px] font-medium text-blue-600 block mb-0.5">类型 B（您的类型）</span>-->
<!--                <h2 class="text-base font-bold text-gray-500">普雷沃氏菌型</h2>-->
<!--              </div>-->
<!--              <div class="w-6 h-6 rounded-lg bg-blue-600 bg-opacity-30 flex items-center justify-center">-->
<!--                <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">-->
<!--                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>-->
<!--                </svg>-->
<!--              </div>-->
<!--            </div>-->
<!--          </div>-->

<!--          &lt;!&ndash; 厚壁菌型 &ndash;&gt;-->
<!--          <div class="rounded-xl bg-white p-3">-->
<!--            <div class="flex justify-between items-start">-->
<!--              <div>-->
<!--                <span class="text-[10px] font-medium text-gray-400 block mb-0.5">类型 C</span>-->
<!--                <h2 class="text-base font-bold text-gray-500">厚壁菌型</h2>-->
<!--              </div>-->
<!--              <div class="w-6 h-6 rounded-lg bg-gray-100 flex items-center justify-center">-->
<!--                <svg class="w-3 h-3 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">-->
<!--                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13 10V3L4 14h7v7l9-11h-7z"></path>-->
<!--                </svg>-->
<!--              </div>-->
<!--            </div>-->
<!--          </div>-->
<!--        </div>-->

<!--      </div>-->
<!--    </div>-->

    <div id="container" class="bg-white rounded-lg p-5 mb-5 mx-auto" style="width: 100%;">
      <!-- 内容将通过JavaScript动态加载 -->
    </div>

    <script>
      // 根据健康总分动态改变颜色
      function getScoreColor(score) {
        const numScore = parseInt(score);
        if (numScore >= 85) {
          return {
            circle: '#7CB342', // 柔和的绿色
            text: '#558B2F'    // 深橄榄绿
          };
        } else if (numScore >= 75) {
          return {
            circle: '#9CCC65', // 淡青绿色
            text: '#689F38'    // 中青绿色
          };
        } else if (numScore >= 60) {
          return {
            circle: '#FFB74D', // 温和的橙色
            text: '#F57C00'    // 中橙色
          };
        } else if (numScore >= 40) {
          return {
            circle: '#FF8A65', // 柔和的珊瑚色
            text: '#E64A19'    // 深珊瑚色
          };
        } else {
          return {
            circle: '#EF5350', // 柔和的红色
            text: '#D32F2F'    // 深红色
          };
        }
      }

      function calculateAgeBarMetrics(actualAge, gutAge) {
        // 基础配置
        const minAge = 0;
        const maxAge = 120;
        const minWidth = 5; // 最小显示宽度百分比
        const youngAge = 7; // 年轻年龄的分界点
        const youngAgeScale = 0.3; // 0-7岁占总宽度的比例
        const remainingScale = 1 - youngAgeScale; // 剩余年龄占总宽度的比例

        // 计算函数
        function calculatePosition(age) {
          if (age <= youngAge) {
            // 0-7岁范围内的计算
            return (age / youngAge) * (youngAgeScale * 100);
          } else {
            // 7岁以上范围的计算
            const remainingAge = age - youngAge;
            const remainingMaxAge = maxAge - youngAge;
            return (youngAgeScale * 100) + ((remainingAge / remainingMaxAge) * (remainingScale * 100));
          }
        }

        // 计算实际年龄和肠道年龄的位置
        const actualAgePercent = calculatePosition(actualAge);
        const gutAgePercent = calculatePosition(gutAge);

        return {
          actualAge: {
            width: Math.max(minWidth, Math.min(actualAgePercent, 100)),
            position: Math.min(actualAgePercent, 100)
          },
          gutAge: {
            width: Math.max(minWidth, Math.min(gutAgePercent, 100)),
            position: Math.min(gutAgePercent, 100)
          }
        };
      }

      // 生成肠型卡片的辅助函数
      function generateGutTypeCards(currentType) {
        const gutTypes = [
          {
            type: "A",
            name: "拟杆菌型",
            icon: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>'
          },
          {
            type: "B",
            name: "普雷沃氏菌型",
            icon: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>'
          },
          {
            type: "C",
            name: "厚壁菌型",
            icon: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13 10V3L4 14h7v7l9-11h-7z"></path>'
          }
        ];

        return gutTypes.map(gutType => {
          const isActive = gutType.name === currentType;
          return `
                    <div class="rounded-xl ${isActive ? 'bg-[#D0E7FF]' : 'bg-white'} p-3">
                        <div class="flex justify-between items-start">
                            <div>
                                <span class="text-[10px] font-medium ${isActive ? 'text-blue-600' : 'text-gray-400'} block mb-0.5">
                                    类型 ${gutType.type}${isActive ? '（您的类型）' : ''}
                                </span>
                                <h2 class="text-base font-bold text-gray-500">${gutType.name}</h2>
                            </div>
                            <div class="w-6 h-6 rounded-lg ${isActive ? 'bg-blue-600 bg-opacity-30' : 'bg-gray-100'} flex items-center justify-center">
                                <svg class="w-3 h-3 ${isActive ? 'text-white' : 'text-gray-500'}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    ${gutType.icon}
                                </svg>
                            </div>
                        </div>
                    </div>
                `;
        }).join('');
      }

      function renderSummary(data) {
        const container = document.getElementById('container');

        // 安全地获取健康总分
        const healthScore = data["整体评估"][0]["分值"];
        const scoreColors = getScoreColor(healthScore);

        // 安全地获取肠道年龄和肠型
        const gutAge = data["整体评估"][1]["分值"];
        const gutType = data["整体评估"][2]["分值"];

        container.innerHTML = `
    <!-- 基本信息行 -->
    <div class="grid grid-cols-2 gap-4 mb-2">
        <!-- 左边三个 summary-info-card -->
        <div class="flex gap-2">
            ${data["sampleinfo"]["sampleusername"] ? `
            <div class="summary-info-card" style="flex: 75;">
                <div class="summary-title font-bold">姓名</div>
                <div class="font-bold text-gray-500">${data["sampleinfo"]["sampleusername"]}</div>
            </div>
            ` : ''}
            ${data["sampleinfo"]["sex"] ? `
            <div class="summary-info-card" style="flex: 75;">
                <div class="summary-title font-bold">性别</div>
                <div class="font-bold text-gray-500">${data["sampleinfo"]["sex"] === "0" ? "女性" : "男性"}</div>
            </div>
            ` : ''}
            ${data["sampleinfo"]["age"] ? `
            <div class="summary-info-card" style="flex: 100;">
                <div class="summary-title font-bold">年龄</div>
                <div class="font-bold text-gray-500">${data["sampleinfo"]["age"]}</div>
            </div>
            ` : ''}
        </div>

        <!-- 右边两个 summary-info-card -->
        <div class="flex gap-2">
            ${data["sampleinfo"]["sampleid"] ? `
            <div class="summary-info-card flex-1">
                <div class="summary-title font-bold">样本编号</div>
                <div class="font-bold text-gray-500">${data["sampleinfo"]["sampleid"]}</div>
            </div>
            ` : ''}
            ${data["sampleinfo"]["reportdate"] ? `
            <div class="summary-info-card flex-1">
                <div class="summary-title font-bold">报告日期</div>
                <div class="font-bold text-gray-500">${data["sampleinfo"]["reportdate"]}</div>
            </div>
            ` : ''}
        </div>
    </div>

    <!-- 健康总分和指标框 -->
    <div class="grid grid-cols-2 gap-4 mb-2">
        ${healthScore ? `
        <div class="summary-info-card">
            <div class="summary-title mb-7"><b>健康总分</b></div>
            <div class="flex flex-col items-center">
                <div class="w-40 h-40 mb-5">
                    <svg viewBox="0 0 100 100">
                        <circle class="summary-circle-bg" cx="50" cy="50" r="45"/>
                        <circle class="summary-circle"
                                cx="50"
                                cy="50"
                                r="45"
                                stroke="${scoreColors.circle}"
                                stroke-dasharray="282.7"
                                stroke-dashoffset="${282.7 - (282.7 * parseInt(healthScore) / 100)}"/>
                        <text x="50"
                              y="45"
                              class="summary-score-text"
                              text-anchor="middle"
                              dominant-baseline="middle"
                              font-size="30"
                              font-weight="bold"
                              fill="${scoreColors.text}">${healthScore}</text>
                        <text x="50"
                              y="68"
                              class="summary-score-text"
                              text-anchor="middle"
                              font-size="10"
                              fill="#2DA6A8">总分: 100</text>
                    </svg>
                </div>
                ${data["整体评估"][0]["说明"] ? `
                <div class="summary-description text-center">
                    ${data["整体评估"][0]["说明"]}
                </div>
                ` : ''}
            </div>
        </div>
        ` : ''}

        <!-- 右侧指标栏 -->
        <div class="flex flex-col gap-2 h-full">
            <!-- 其他指标保持不变 -->
        </div>
    </div>

    <!-- 肠道年龄和肠型 -->
    <div class="flex gap-4">
        ${gutAge ? `
        <div class="summary-info-card flex-[7]">
            <div class="summary-title mb-10"><b>肠道年龄</b></div>
            <div class="flex flex-col">
                <div class="relative w-full">
                    ${(() => {
          const ageMetrics = calculateAgeBarMetrics(
            parseInt(data["sampleinfo"]["age"]),
            parseInt(gutAge)
          );
          return `
                        <!-- 肠道年龄渲染逻辑保持不变 -->
                        ${renderAgeBar(data["sampleinfo"]["age"], gutAge, ageMetrics)}
                        `;
        })()}
                </div>
                ${data["整体评估"][1]["说明"] ? `
                <div class="summary-description mt-5">
                    ${data["整体评估"][1]["说明"]}
                </div>
                ` : ''}
            </div>
        </div>
        ` : ''}

        ${gutType ? `
        <div class="summary-info-card flex-[3]">
            <div class="summary-title mb-3"><b>肠型</b></div>
            <div class="flex flex-col gap-2">
                ${generateGutTypeCards(gutType)}
            </div>
        </div>
        ` : ''}
    </div>
    `;
      }

      // 辅助渲染年龄条的函数
      function renderAgeBar(actualAge, gutAge, ageMetrics) {
        return `
    <div class="mb-9">
        <div class="flex items-center">
            <div class="text-gray-600 mr-4 w-20">实际年龄</div>
            <div class="flex-1 relative">
                <div class="absolute -top-6 left-[${ageMetrics.actualAge.position}%]">
                    <div class="text-gray-500 font-bold text-lg whitespace-nowrap"
                         style="
                            ${ageMetrics.actualAge.position >= 95 ? 'transform: translateX(-100%);' :
          ageMetrics.actualAge.position <= 5 ? 'transform: translateX(0);' :
            'transform: translateX(-50%);'}
                         ">
                        ${actualAge}
                    </div>
                </div>
                <div class="summary-age-bar bg-gray-200">
                    <div class="summary-age-bar bg-blue-200"
                         style="width: ${ageMetrics.actualAge.width}%"></div>
                </div>
            </div>
        </div>
    </div>
    <div>
        <div class="flex items-center">
            <div class="text-gray-600 mr-4 w-20">肠道年龄</div>
            <div class="flex-1 relative">
                <div class="absolute -top-6 left-[${ageMetrics.gutAge.position}%]">
                    <div class="transform -translate-x-1/2 text-gray-500 font-bold text-lg whitespace-nowrap"
                         style="
                            ${ageMetrics.gutAge.position >= 95 ? 'transform: translateX(-100%);' :
          ageMetrics.gutAge.position <= 5 ? 'transform: translateX(0);' :
            'transform: translateX(-50%);'}
                         ">
                        ${gutAge}
                    </div>
                </div>
                <div class="summary-age-bar bg-gray-200">
                    <div class="summary-age-bar"
                         style="width: ${ageMetrics.gutAge.width}%; background-color: rgb(45, 166, 168)"></div>
                </div>
            </div>
        </div>
    </div>
    `;
      }

      // 加载数据的异步函数
      async function loadData() {
        try {
          const response = await fetch(DATA_PATHS.DATA);
          const data = await response.json();
          renderSummary(data);
        } catch (error) {
          console.error('Error loading data:', error);
          document.getElementById('container').innerHTML = `
                    <div class="text-red-500 text-center p-4">
                        加载数据时发生错误，请稍后重试
                    </div>
                `;
        }
      }

      // 页面加载完成后自动加载数据
      document.addEventListener('DOMContentLoaded', () => {
        loadData();
      });

      // 错误处理函数
      function handleError(error) {
        console.error('Error:', error);
        document.getElementById('container').innerHTML = `
                <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative" role="alert">
                    <strong class="font-bold">错误！</strong>
                    <span class="block sm:inline">加载数据时发生错误，请刷新页面重试。</span>
                </div>
            `;
      }

      // 数据格式化辅助函数
      function formatValue(value, type) {
        if (!value) return '';

        switch(type) {
          case 'percentage':
            return `${Math.round(value)}%`;
          case 'age':
            return `${value}岁`;
          case 'date':
            return new Date(value).toLocaleDateString('zh-CN');
          default:
            return value;
        }
      }

      // 防抖函数，用于优化窗口调整时的重新渲染
      function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
          const later = () => {
            clearTimeout(timeout);
            func(...args);
          };
          clearTimeout(timeout);
          timeout = setTimeout(later, wait);
        };
      }

      // 窗口调整时重新渲染的处理函数
      const handleResize = debounce(() => {
        loadData();
      }, 250);

      // 添加窗口调整事件监听
      window.addEventListener('resize', handleResize);
    </script>

<!--    <div class="summary-info-card">-->
<!--      <div class="summary-title"><b>肠型</b></div>-->
<!--      <div class="flex gap-4 mt-4">-->
<!--        &lt;!&ndash; 拟杆菌型 &ndash;&gt;-->
<!--        <div class="w-1/3 rounded-2xl bg-white overflow-hidden">-->
<!--          <div class="p-3">-->
<!--            <div class="flex justify-between items-start mb-2">-->
<!--              <div>-->
<!--                <span class="text-[10px] font-medium text-gray-400 block mb-0.5">类型 A</span>-->
<!--                <h2 class="text-base font-bold text-gray-900">拟杆菌型</h2>-->
<!--              </div>-->
<!--              <div class="w-6 h-6 rounded-lg bg-gray-100 flex items-center justify-center">-->
<!--                <svg class="w-3 h-3 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">-->
<!--                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>-->
<!--                </svg>-->
<!--              </div>-->
<!--            </div>-->
<!--            <div class="space-y-2">-->
<!--              <p class="text-gray-600 text-xs leading-relaxed">擅长分解复杂的植物纤维，与植物性饮食密切相关。</p>-->
<!--              <div class="space-y-1.5">-->
<!--                <div class="flex items-center gap-2 p-1.5 rounded-lg bg-gray-50">-->
<!--                  <span class="text-gray-700 text-[11px]">善于消化膳食纤维</span>-->
<!--                </div>-->
<!--                <div class="flex items-center gap-2 p-1.5 rounded-lg bg-gray-50">-->
<!--                  <span class="text-gray-700 text-[11px]">有益于肠道健康</span>-->
<!--                </div>-->
<!--              </div>-->
<!--            </div>-->
<!--          </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; 普雷沃氏菌型（当前用户类型） &ndash;&gt;-->
<!--        <div class="w-1/3 rounded-2xl overflow-hidden" style="background: #D0E7FF"> &lt;!&ndash; 浅蓝色背景 &ndash;&gt;-->
<!--          <div class="p-3">-->
<!--            <div class="flex justify-between items-start mb-2">-->
<!--              <div>-->
<!--                <span class="text-[10px] font-medium text-blue-600 block mb-0.5">类型 B（您的类型）</span> &lt;!&ndash; 浅蓝色 &ndash;&gt;-->
<!--                <h2 class="text-base font-bold text-gray-800">普雷沃氏菌型</h2> &lt;!&ndash; 深灰色 &ndash;&gt;-->
<!--              </div>-->
<!--              <div class="w-6 h-6 rounded-lg bg-blue-600 bg-opacity-30 flex items-center justify-center">-->
<!--                <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">-->
<!--                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>-->
<!--                </svg>-->
<!--              </div>-->
<!--            </div>-->
<!--            <div class="space-y-2">-->
<!--              <p class="text-blue-600 text-xs leading-relaxed"> &lt;!&ndash; 浅蓝色 &ndash;&gt;-->
<!--                以普雷沃氏菌为主导菌群，与高碳水化合物、高纤维的饮食方式相关。常见于偏好植物性食物的人群。-->
<!--              </p>-->
<!--              <div class="space-y-1.5">-->
<!--                <div class="flex items-center gap-2 p-1.5 rounded-lg bg-blue-600 bg-opacity-30">-->
<!--                  <span class="text-white text-[11px]">高碳水化合物代谢能力</span>-->
<!--                </div>-->
<!--                <div class="flex items-center gap-2 p-1.5 rounded-lg bg-blue-600 bg-opacity-30">-->
<!--                  <span class="text-white text-[11px]">适合植物性饮食</span>-->
<!--                </div>-->
<!--              </div>-->
<!--            </div>-->
<!--          </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; 厚壁菌型 &ndash;&gt;-->
<!--        <div class="w-1/3 rounded-2xl bg-white overflow-hidden">-->
<!--          <div class="p-3">-->
<!--            <div class="flex justify-between items-start mb-2">-->
<!--              <div>-->
<!--                <span class="text-[10px] font-medium text-gray-400 block mb-0.5">类型 C</span>-->
<!--                <h2 class="text-base font-bold text-gray-900">厚壁菌型</h2>-->
<!--              </div>-->
<!--              <div class="w-6 h-6 rounded-lg bg-gray-100 flex items-center justify-center">-->
<!--                <svg class="w-3 h-3 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">-->
<!--                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13 10V3L4 14h7v7l9-11h-7z"></path>-->
<!--                </svg>-->
<!--              </div>-->
<!--            </div>-->
<!--            <div class="space-y-2">-->
<!--              <p class="text-gray-600 text-xs leading-relaxed">以厚壁菌为主要菌群，对脂肪和蛋白质的代谢能力较强，常见于高蛋白饮食。</p>-->
<!--              <div class="space-y-1.5">-->
<!--                <div class="flex items-center gap-2 p-1.5 rounded-lg bg-gray-50">-->
<!--                  <span class="text-gray-700 text-[11px]">脂肪代谢能力强</span>-->
<!--                </div>-->
<!--                <div class="flex items-center gap-2 p-1.5 rounded-lg bg-gray-50">-->
<!--                  <span class="text-gray-700 text-[11px]">促进肠道健康</span>-->
<!--                </div>-->
<!--              </div>-->
<!--            </div>-->
<!--          </div>-->
<!--        </div>-->
<!--      </div>-->
<!--    </div>-->

  <!-- 健康总分解读页 -->
  <h2 class="custom-title-second-level page-break">健康总分解读</h2>

  <div class="bg-white rounded-lg p-5 mb-5 mx-auto" style="width: 100%;">
    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            <i class="fas fa-info-circle icon"></i>
            健康总分的满分为100分。在评估健康总分时，综合了三个部分：肠道菌群健康状况、疾病风险情况和营养均衡饮食情况综合评估计算，并采用扣分制，具体包括因疾病风险、营养不均衡和菌群失衡等因素而导致的相应减分。
          </p>
          <ul class="list-disc ml-5">
            <li><strong>常见的健康分数范围：</strong>20分-90分</li>
            <li><strong>人群平均健康得分：</strong>75分</li>
            <li><strong>数据库中最高健康得分：</strong>93分</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="health-total-score-container">
      <div class="health-total-score-left">
        <div class="health-total-score-label">您的健康总分</div>
      </div>
      <div class="health-total-score-right">
        <div class="health-total-score-number">
          <span id="health-total-score-value">-</span><span class="health-total-score-denominator">/100</span>
        </div>
      </div>
    </div>

    <!-- 三项分值的标准 -->
    <div class="health-score-scale-container">
      <div class="health-score-scale-title">三项分值的标准</div>

      <div class="health-score-scale">
        <div class="health-score-range excellent">优秀</div>
        <div class="health-score-range good">良好</div>
        <div class="health-score-range average">一般</div>
        <div class="health-score-range pass">及格</div>
        <div class="health-score-range fail">不及格</div>
      </div>

      <div class="health-score-scale-labels">
        <div class="health-score-scale-label">
          <div class="health-score-scale-dot excellent-dot"></div>
          <div class="health-score-scale-text">85以上</div>
        </div>
        <div class="health-score-scale-label">
          <div class="health-score-scale-dot good-dot"></div>
          <div class="health-score-scale-text">75~85</div>
        </div>
        <div class="health-score-scale-label">
          <div class="health-score-scale-dot average-dot"></div>
          <div class="health-score-scale-text">60~75</div>
        </div>
        <div class="health-score-scale-label">
          <div class="health-score-scale-dot pass-dot"></div>
          <div class="health-score-scale-text">40~59</div>
        </div>
        <div class="health-score-scale-label">
          <div class="health-score-scale-dot fail-dot"></div>
          <div class="health-score-scale-text">0~40</div>
        </div>
      </div>
    </div>

    <!-- 分数卡片容器 -->
    <div class="health-score-cards-container">
      <!-- 90-95分卡片 -->
      <div class="health-score-card card-90-95">
        <div class="health-score-card-left">
          <div class="health-score-card-icon">
            <i class="fas fa-medal"></i>
          </div>
          <div class="health-score-card-score">90-95分</div>
        </div>
        <div class="health-score-card-content">
          表明极好的健康状况，菌群和营养都非常均衡。
        </div>
      </div>

      <!-- 80-90分卡片 -->
      <div class="health-score-card card-80-90">
        <div class="health-score-card-left">
          <div class="health-score-card-icon">
            <i class="fas fa-star"></i>
          </div>
          <div class="health-score-card-score">80~90分</div>
        </div>
        <div class="health-score-card-content">
          表明很健康，适当针对性改善营养饮食即可。
        </div>
      </div>

      <!-- 70-80分卡片 -->
      <div class="health-score-card card-70-80">
        <div class="health-score-card-left">
          <div class="health-score-card-icon">
            <i class="fas fa-smile"></i>
          </div>
          <div class="health-score-card-score">70~80分</div>
        </div>
        <div class="health-score-card-content">
          属于健康状态，但是需要注意调整不良的生活方式和注意营养饮食均衡。
        </div>
      </div>

      <!-- 60-70分卡片 -->
      <div class="health-score-card card-60-70">
        <div class="health-score-card-left">
          <div class="health-score-card-icon">
            <i class="fas fa-meh"></i>
          </div>
          <div class="health-score-card-score">60~70分</div>
        </div>
        <div class="health-score-card-content">
          属于亚健康，可能有疾病风险需要注意，营养和生活方式也存在不合理。
        </div>
      </div>

      <!-- 50-60分卡片 -->
      <div class="health-score-card card-50-60">
        <div class="health-score-card-left">
          <div class="health-score-card-icon">
            <i class="fas fa-frown"></i>
          </div>
          <div class="health-score-card-score">50~60分</div>
        </div>
        <div class="health-score-card-content">
          表明存在个别疾病高风险或较多疾病提示注意，已有慢性疾病状态，需要针对性检查和治疗，此外生活方式也可能存在不良状态。
        </div>
      </div>

      <!-- 40-50分卡片 -->
      <div class="health-score-card card-40-50">
        <div class="health-score-card-left">
          <div class="health-score-card-icon">
            <i class="fas fa-tired"></i>
          </div>
          <div class="health-score-card-score">40~50分</div>
        </div>
        <div class="health-score-card-content">
          表明至少有一项疾病处于高风险状况，整体健康状况不佳，请进行医疗检查并马上纠正生活方式。
        </div>
      </div>

      <!-- 低于40分卡片 -->
      <div class="health-score-card card-below-40">
        <div class="health-score-card-left">
          <div class="health-score-card-icon">
            <i class="fas fa-exclamation-triangle"></i>
          </div>
          <div class="health-score-card-score">低于40分</div>
        </div>
        <div class="health-score-card-content">
          表明有多项疾病风险或某种疾病程度较为严重，强烈建议进行复查或进行治疗。
        </div>
      </div>
    </div>

    <script>
      // 健康总分加载器
      const HealthScoreLoader = {
        // 加载数据
        async loadData() {
          try {
            const response = await fetch(DATA_PATHS.DATA);
            if (!response.ok) {
              throw new Error(`Network response error: ${response.status}`);
            }
            const data = await response.json();

            // 从整体评估中获取健康总分数据
            const healthScoreData = data["整体评估"].find(item => item["检测项目"] === "健康总分");

            if (healthScoreData) {
              this.updateHealthScoreDisplay(healthScoreData);
            } else {
              console.error("健康总分数据未找到");
              this.setErrorState();
            }
          } catch (error) {
            console.error('Error loading health score data:', error);
            this.setErrorState();
          }
        },

        updateHealthScoreDisplay(healthScoreData) {
          const scoreValue = healthScoreData["分值"];

          // 更新分数
          const scoreElement = document.getElementById('health-total-score-value');

          scoreElement.textContent = scoreValue;

          // 移除之前的颜色类
          const colorClasses = [
            'text-green-600', 'text-blue-600', 'text-yellow-600',
            'text-orange-600', 'text-red-600'
          ];

          scoreElement.classList.remove(...colorClasses);

          // 根据分数设置颜色
          if (scoreValue >= 85) {
            scoreElement.style.color = '#4CAF50'; // 优秀绿色
          } else if (scoreValue >= 75) {
            scoreElement.style.color = '#4F7FFF'; // 良好蓝色
          } else if (scoreValue >= 60) {
            scoreElement.style.color = '#E6A23C'; // 一般黄色
          } else if (scoreValue >= 40) {
            scoreElement.style.color = '#EB7A3C'; // 及格橙色
          } else {
            scoreElement.style.color = '#E74C3C'; // 不及格红色
          }

          // 添加其他样式类
          scoreElement.classList.add('font-bold', 'text-2xl');
        },

        // 设置错误状态
        setErrorState() {
          const scoreElement = document.getElementById('health-total-score-value');

          const colorClasses = [
            'text-green-600', 'text-blue-600', 'text-yellow-600', 'text-orange-600', 'text-red-600',
            'bg-green-100', 'bg-blue-100', 'bg-yellow-100', 'bg-orange-100', 'bg-red-100'
          ];

          scoreElement.classList.remove(...colorClasses);

          scoreElement.textContent = '-';
          scoreElement.classList.add('text-gray-500', 'bg-transparent');
        },

        // 初始化
        init() {
          document.addEventListener('DOMContentLoaded', () => this.loadData());
        }
      };

      // 初始化健康总分加载器
      HealthScoreLoader.init();
    </script>
  </div>

  <!-- 肠道年龄解读页 -->
  <h2
    class="custom-title-second-level page-break">
    肠道年龄解读
  </h2>

  <div
    class="bg-white rounded-lg p-5 mb-5 mx-auto"
    style="width: 100%;">

    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            <i class="fas fa-info-circle icon"></i>
            肠道预测年龄是基于超过 6 万人群队列的深度学习模型构建的，通过识别每个年龄段的核心和标志性菌群特
            征进行分析预测。伴随年龄的变化肠道菌群也会相应的改变，当肠道菌群反映的年龄大幅偏离真实年龄时通常代
            表您的肠道菌群出现了紊乱、存在疾病风险或发育滞后。例如：
          </p>
          <ul class="list-disc">
            <li>肠道年龄远<strong>小于</strong>生理年龄：可能意味着菌群发育滞后。</li>
            <li>肠道年龄远<strong>大于</strong>生理年龄：可能意味着菌群多样性下降或致病菌增多。</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="gut-age-container">

      <!-- 肠道年龄展示 -->
      <div class="gut-age-display">
        <div class="gut-age-content">
          <div class="gut-age-title">肠道年龄</div>
          <div class="gut-age-value">
            <span id="gut-age-value-number">加载中...</span><span class="gut-age-unit">岁</span>
          </div>
        </div>
      </div>

      <!-- 正常偏差范围标题 -->
      <h3 class="deviation-title">不同年龄段的正常偏差范围</h3>

      <!-- 年龄段解读卡片 -->
      <div class="age-ranges">

        <!-- 0-2岁 -->
        <div class="age-range-card infant">
          <div class="age-range-header">
            <div class="age-range-icon infant"><i class="fas fa-baby"></i></div>
            <div class="age-range-title">0-2岁儿童</div>
            <div class="age-range-badge infant">偏差小于3个月</div>
          </div>
          <div class="age-range-desc">这个阶段是肠道菌群发育的初始阶段，菌群组成随着婴儿的成长和饮食变化而迅速变化。</div>
        </div>

        <!-- 3-5岁 -->
        <div class="age-range-card toddler">
          <div class="age-range-header">
            <div class="age-range-icon toddler"><i class="fas fa-child"></i></div>
            <div class="age-range-title">3-5岁儿童</div>
            <div class="age-range-badge toddler">偏差在6个月以内</div>
          </div>
          <div class="age-range-desc">幼儿期肠道菌群逐渐稳定，但仍然受饮食和环境因素影响较大，比婴儿期更稳定。</div>
        </div>

        <!-- 6-15岁 -->
        <div class="age-range-card kid">
          <div class="age-range-header">
            <div class="age-range-icon kid"><i class="fas fa-running"></i></div>
            <div class="age-range-title">6-15岁儿童</div>
            <div class="age-range-badge kid">偏差在1岁左右</div>
          </div>
          <div class="age-range-desc">学龄期和青春期前的儿童肠道菌群结构更加稳定，但仍在不断发育完善。</div>
        </div>

        <!-- 16-50岁 -->
        <div class="age-range-card adult">
          <div class="age-range-header">
            <div class="age-range-icon adult"><i class="fas fa-user"></i></div>
            <div class="age-range-title">16-50岁人群</div>
            <div class="age-range-badge adult">正常偏差在3岁以内</div>
          </div>
          <div class="age-range-desc">成年期肠道菌群相对稳定，但工作压力、生活方式和饮食习惯的变化仍会影响菌群结构。</div>
        </div>

        <!-- 50岁以上 -->
        <div class="age-range-card senior">
          <div class="age-range-header">
            <div class="age-range-icon senior"><i class="fas fa-user-tie"></i></div>
            <div class="age-range-title">50岁以上</div>
            <div class="age-range-badge senior">正常偏差在5岁以内</div>
          </div>
          <div class="age-range-desc">在正常偏差内年轻差异可以理解为年轻或衰老，超出正常偏差的年龄无论超过或低于都可能是菌群异常或健康状况不佳。</div>
        </div>

        <!-- 80岁以上 -->
        <div class="age-range-card elder">
          <div class="age-range-header">
            <div class="age-range-icon elder"><i class="fas fa-user-friends"></i></div>
            <div class="age-range-title">80岁以上</div>
            <div class="age-range-badge elder">特殊情况</div>
          </div>
          <div class="age-range-desc">高龄期肠道菌群特征独特，参考数据主要来自长寿人群的样本。肠道年龄通常不宜味着衰老，因为高龄队列主要来自长寿老人的样本。</div>
        </div>
      </div>

    </div>

    <script>
      // 加载肠道年龄数据
      const GutAgeLoader = {
        // 加载数据
        async loadData() {
          try {
            const response = await fetch(DATA_PATHS.DATA);
            if (!response.ok) {
              throw new Error(`Network response error: ${response.status}`);
            }
            const data = await response.json();

            // 从整体评估中获取肠道年龄数据
            const gutAgeData = data["整体评估"].find(item => item["检测项目"] === "肠道年龄");

            if (gutAgeData) {
              this.updateGutAgeDisplay(gutAgeData);
            } else {
              console.error("肠道年龄数据未找到");
              document.getElementById('gut-age-value-number').textContent = "数据缺失";
            }
          } catch (error) {
            console.error('Error loading gut age data:', error);
            document.getElementById('gut-age-value-number').textContent = "加载失败";
          }
        },

        // 更新肠道年龄显示
        updateGutAgeDisplay(gutAgeData) {
          const ageValueElement = document.getElementById('gut-age-value-number');
          if (!ageValueElement) {
            console.error('找不到肠道年龄元素');
            return;
          }

          let ageValue = gutAgeData["分值"];

          // 处理分值，去除末尾的"岁"字（如果有）
          if (typeof ageValue === 'string' && ageValue.endsWith('岁')) {
            ageValue = ageValue.replace('岁', '');
          }

          // 更新年龄值
          ageValueElement.textContent = ageValue;

          // 高亮对应的年龄范围卡片
          this.highlightAgeRangeCard(parseFloat(ageValue));
        },

        // 高亮对应的年龄范围卡片
        highlightAgeRangeCard(age) {
          // 移除所有卡片的高亮
          document.querySelectorAll('.age-range-card').forEach(card => {
            card.classList.remove('active');
          });

          // 根据年龄值确定应该高亮哪个卡片
          let targetCard = null;
          let cardType = '';

          if (age >= 0 && age <= 2) {
            cardType = 'infant';
          } else if (age > 2 && age <= 5) {
            cardType = 'toddler';
          } else if (age > 5 && age <= 15) {
            cardType = 'kid';
          } else if (age > 15 && age <= 50) {
            cardType = 'adult';
          } else if (age > 50 && age < 80) {
            cardType = 'senior';
          } else if (age >= 80) {
            cardType = 'elder';
          }

          targetCard = document.querySelector(`.age-range-card.${cardType}`);

          // 添加高亮类和卡片类型属性
          if (targetCard) {
            targetCard.classList.add('active');
            targetCard.setAttribute('data-active-type', cardType);
          }
        },

        // 初始化
        init() {
          document.addEventListener('DOMContentLoaded', () => this.loadData());
        }
      };

      // 初始化肠道年龄加载器
      GutAgeLoader.init();
    </script>
  </div>


  <!-- 宏基因组报告阅读指南 -->

  <!-- 肠道整体评估板块 -->
  <h2 class="custom-title-second-level page-break">肠道整体评估</h2>

  <div
    class="bg-white rounded-lg p-5 mb-5 mx-auto"
    style="width: 100%;">

    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            <i class="fas fa-info-circle icon"></i>
            <span>
              本部分总结了您本次肠道菌群检测的整体关键指标，主要涵盖以下两个核心维度：
            </span>
          </p>
          <ul class="list-disc ml-5">
            <li><strong style="color: #00B2B4;">肠道基础功能：</strong> 评估肠道的基本生理功能，包括：
              <ul class="list-disc ml-5">
                <li>
                  蛋白质发酵能力：测定肠道中细菌对蛋白质的发酵和利用能力，反映肠道微生物的代谢功能。
                </li>
                <li>
                  消化吸收效率：评估肠道对营养物质的消化与吸收能力，影响整体营养状态。
                </li>
                <li>
                  肠道产气情况：监测肠道气体的生成量，过量气体可能提示消化不良或肠道菌群失衡。
                </li>
                <li>
                  肠道屏障完整性：评估肠道粘膜的健康状况，影响体内物质的吸收和免疫反应。
                </li>
                <li>
                  肠道炎症状态：评估肠道内的炎症反应，可能与各种消化系统疾病关联。
                </li>
              </ul>
            </li>
          </ul>
          <ul class="list-disc ml-5">
            <li><strong style="color: #00B2B4;">肠道菌群整体：</strong> 评估肠道菌群的整体功能状态，包括：
              <ul class="list-disc ml-5">
                <li>
                  菌种数量：反映肠道中微生物菌种的多样性，多样性越高，通常代表健康的肠道环境。
                </li>
                <li>
                  菌群多样性：评估不同类型菌群的存在比例，有助于判断肠道生态平衡。
                </li>
                <li>
                  肠道菌群平衡：分析有益菌与有害菌的比例，维持平衡对健康至关重要。
                </li>
                <li>
                  菌群恢复力：衡量菌群在遭受外部干扰后恢复到正常状态的能力，表示肠道的抗压能力。
                </li>
                <li>
                  有益菌和有害菌的比例：评估有益菌（如乳酸菌）与有害菌（如病原菌）的相对数量，直接影响健康。
                </li>
                <li>
                  革兰氏阴性菌和好氧菌的分布：分析不同类别细菌的比例，帮助了解肠道生态及其对健康的影响。
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <div class="qa-box">
      <div class="flex items-start ml-2">
        <p class="text-lg font-bold text-lightpurple">
          <i class="fas fa-question-circle icon icon-purple"></i>
          理想且健康的肠道状态是怎样的？
        </p>
      </div>
      <div class="flex items-start ml-2 mt-2">
        <p class="answer-text">
          <i class="fas fa-comments icon icon-orange"></i>
          理想而健康的肠道不仅依赖于合理、丰富且平衡的菌群构成，还需要具备完善的基础功能。这些功能和菌群状态相辅相成，共同维系肠道的健康与稳定。
        </p>
      </div>
    </div>

  </div>


  <!-- 肠道整体评估 : 肠道基础功能评估 -->
  <h3 class="custom-title-third-level page-break">肠道基础功能评估</h3>

  <div
    class="bg-white rounded-lg p-5 mb-5 mx-auto"
    style="width: 100%;">

    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            <i class="fas fa-info-circle icon"></i>
            下列各项评估了您的肠道的基础⽣理功能。
          </p>
        </div>
      </div>
    </div>

    <!-- 肠道基础功能表格 -->
    <div class="rounded-table">
      <table class="min-w-full">
        <thead>
        <tr style="background-color: #00B2B4; color: white;">
          <th class="py-2 px-4 text-left basic-function-of-gut-first-column"
              style="font-size: 13px;">
            肠道基础功能项目
          </th>
          <th class="py-2 px-4 text-center basic-function-of-gut-second-column"
              style="font-size: 13px; padding: 5px 5px;">
            参考范围
          </th>
          <th class="py-2 px-4 text-center basic-function-of-gut-third-column"
              style="font-size: 13px; padding: 5px 5px;">
            评估数值
          </th>
          <th class="py-2 px-4 text-center basic-function-of-gut-fourth-column"
              style="font-size: 13px; padding: 5px 5px;">
            结果评价
          </th>
        </tr>
        </thead>
      </table>

      <div id="basic-functions-of-gut-data-table-body">
        <!-- 数据将通过 JavaScript 动态插入 -->
      </div>
    </div>

    <script>
      // 肠道基础功能评估模块
      const GutBasicFunctions = {
        // 常量定义
        CONSTANTS: {
          COLORS: {
            RED: '#ff4d4f',
            GREEN: '#52c41a',
            GRAY: '#808080',
            PRIMARY: '#00B2B4'
          },
          // 定义我们需要显示的基础功能项目列表及其英文名称
          FUNCTION_ITEMS: [
            { name: "蛋白发酵", englishName: "Protein fermentation" },
            { name: "消化效率", englishName: "Digestive Efficiency" },
            { name: "肠道产气", englishName: "Intestinal Gas Production" },
            { name: "肠道屏障", englishName: "Intestinal Barrier" },
            { name: "肠道炎症", englishName: "Intestinal Inflammation" },
            { name: "代谢健康", englishName: "Metabolic health" },
            { name: "草酸盐代谢", englishName: "Oxalate metabolism" }
          ]
        },

        // 格式化数字
        formatNumber(value) {
          if (typeof value === "string" && value === "ND") {
            return value;
          }
          const num = Number(value);
          return isNaN(num) ? value : num;
        },

        // 解析范围字符串
        parseRange(rangeStr) {
          if (!rangeStr || typeof rangeStr !== 'string') {
            return { min: 0, max: 0 };
          }
          const parts = rangeStr.split('-');
          return {
            min: parseFloat(parts[0] || 0),
            max: parseFloat(parts[1] || 0)
          };
        },

        // 获取状态信息
        getStatus(value, rangeStr) {
          const { min, max } = this.parseRange(rangeStr);
          const numValue = parseFloat(value);

          let status = {
            color: this.CONSTANTS.COLORS.GREEN,
            text: '正常',
            icon: '',
            isNormal: true,
            valueColor: this.CONSTANTS.COLORS.GREEN // 正常时评估值显示绿色
          };

          if (numValue < min) {
            status.color = this.CONSTANTS.COLORS.RED;
            status.text = '异常';
            status.icon = '<i class="fas fa-arrow-down ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>';
            status.isNormal = false;
            status.valueColor = this.CONSTANTS.COLORS.RED; // 异常时评估值也显示红色
          }
          else if (numValue > max) {
            status.color = this.CONSTANTS.COLORS.RED;
            status.text = '异常';
            status.icon = '<i class="fas fa-arrow-up ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>';
            status.isNormal = false;
            status.valueColor = this.CONSTANTS.COLORS.RED; // 异常时评估值也显示红色
          }

          return status;
        },

        // 计算进度条百分比
        calculateProgress(value, rangeStr) {
          const { max } = this.parseRange(rangeStr);
          if (!value || max === 0) return 0;

          const num = Number(value);
          // 使进度条以max值为基准计算百分比，但限制在5%-100%范围内
          const percentage = (num / max) * 100;
          return Math.min(100, Math.max(5, percentage));
        },

        // 创建描述行
        createDescriptionRow(item) {
          if (!item || !item["说明"]) {
            return '';
          }

          return `
          <tr class="basic-function-desc-row">
            <td colspan="4" class="py-2 px-4 text-left">
              <div class="description-container text-gray-600" style="font-size: 11px;">
                <div class="flex items-start mb-0">
                  <div class="ml-1">
                    <p>
                      <i
                        class="fas fa-info-circle"
                        style="color: ${this.CONSTANTS.COLORS.PRIMARY};">
                      </i>
                      ${item["说明"]}
                    </p>
                  </div>
                </div>
              </div>
            </td>
          </tr>
        `;
        },

        // 渲染表格
        renderTable(functionData) {
          const container = document.getElementById('basic-functions-of-gut-data-table-body');
          if (!container) {
            console.error('Cannot find container element');
            return;
          }

          container.innerHTML = '';

          if (!functionData || !Array.isArray(functionData) || functionData.length === 0) {
            container.innerHTML = '<div class="no-data-message">暂无数据</div>';
            return;
          }

          const fragment = document.createDocumentFragment();

          // 遍历我们定义的基础功能项目列表
          this.CONSTANTS.FUNCTION_ITEMS.forEach(functionItem => {
            // 从数据中查找匹配的项目
            const matchedItem = functionData.find(item =>
              item.检测项目 === functionItem.name ||
              item.检测项目.includes(functionItem.name)
            );

            if (!matchedItem) {
              // 如果没有找到匹配项，可以选择跳过或显示空值
              return;
            }

            const value = matchedItem["评估值"];
            const rangeStr = matchedItem["参考范围"];
            const evaluation = matchedItem["结果评价"];

            // 根据评估值和参考范围判断状态
            const status = this.getStatus(value, rangeStr);

            // 如果数据中已有结果评价，更新状态文本
            if (evaluation) {
              status.text = evaluation;
              // 根据评价结果更新颜色
              if (evaluation !== "正常") {
                status.isNormal = false;
                status.color = this.CONSTANTS.COLORS.RED;
                status.valueColor = this.CONSTANTS.COLORS.RED;
              }
            }

            const progressPercentage = this.calculateProgress(value, rangeStr);

            const itemContainer = document.createElement('div');
            itemContainer.className = 'basic-function-info-container';

            const table = document.createElement('table');
            table.className = 'basic-function-table min-w-full';

            const dataRow = `
              <tr>
                <td class="py-2 px-4 text-left basic-function-of-gut-first-column">
                  <div class="basic-function-of-gut-chinese-text">
                    <strong>${functionItem.name}</strong>
                  </div>
                  <div class="basic-function-of-gut-english-text">
                    ${functionItem.englishName}
                  </div>
                </td>
                <td class="py-2 px-4 text-center basic-function-of-gut-column-text basic-function-of-gut-second-column">
                  ${rangeStr}
                </td>
                <td class="py-2 px-4 text-center basic-function-of-gut-column-text basic-function-of-gut-third-column">
                  <div class="flex items-center justify-center">
                    <span style="color: ${status.valueColor}">
                      <strong>${value}${status.icon}</strong>
                    </span>
                  </div>
                  <div class="progress-bar w-full mt-2" style="background-color: #e9ecef; height: 8px; border-radius: 4px; overflow: hidden;">
                    <div class="progress"
                         style="width: ${progressPercentage}%;
                                height: 100%;
                                background-color: ${status.isNormal ? this.CONSTANTS.COLORS.GREEN : this.CONSTANTS.COLORS.RED};
                                transition: width 0.3s ease;">
                    </div>
                  </div>
                </td>
                <td class="py-2 px-4 text-center basic-function-of-gut-column-text basic-function-of-gut-fourth-column">
                  <span style="color: ${status.color}">
                    <strong>${status.text}</strong>
                  </span>
                </td>
              </tr>
            `;

            const descRow = this.createDescriptionRow(matchedItem);

            table.innerHTML = `<tbody>${dataRow}${descRow}</tbody>`;
            itemContainer.appendChild(table);
            fragment.appendChild(itemContainer);
          });

          container.appendChild(fragment);
        },

        // 加载数据
        async loadData() {
          try {
            const response = await fetch(DATA_PATHS.DATA);
            if (!response.ok) {
              throw new Error(`Network response error: ${response.status}`);
            }
            const data = await response.json();
            // 使用菌群整体评估数据
            this.renderTable(data["菌群整体评估"] || []);
          } catch (error) {
            console.error('Error loading basic function data:', error);
            document.getElementById('basic-functions-of-gut-data-table-body').innerHTML =
              '<div class="no-data-message">暂无数据</div>';
          }
        },

        // 初始化
        init() {
          document.addEventListener('DOMContentLoaded', () => this.loadData());
        }
      };

      // 初始化肠道基础功能评估模块
      GutBasicFunctions.init();
    </script>
  </div>

  <!-- 肠道整体评估 : 肠道菌群整体评估 -->
  <h3 class="custom-title-third-level page-break">肠道菌群整体评估</h3>

  <div class="bg-white rounded-lg p-5 mb-5 mx-auto" style="width: 100%;">

    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            <i class="fas fa-info-circle icon"></i>
            下列各项对您的肠道菌群进行了整体性评估。
          </p>
        </div>
      </div>
    </div>

    <!-- 肠道菌群整体评估表格 -->
    <div class="rounded-table">
      <table class="min-w-full">
        <thead>
        <tr style="background-color: #00B2B4; color: white;">
          <th class="py-2 px-4 text-left overall-evaluation-of-gut-first-column" style="font-size: 13px;">
            肠道菌群整体项目
          </th>
          <th class="py-2 px-4 text-center overall-evaluation-of-gut-second-column" style="font-size: 13px; padding: 5px 5px;">
            参考范围
          </th>
          <th class="py-2 px-4 text-center overall-evaluation-of-gut-third-column" style="font-size: 13px; padding: 5px 5px;">
            评估数值
          </th>
          <th class="py-2 px-4 text-center overall-evaluation-of-gut-fourth-column" style="font-size: 13px; padding: 5px 5px;">
            结果评价
          </th>
        </tr>
        </thead>
      </table>

      <div id="overall-evaluation-of-gut-microbiome-data-table-body">
        <!-- 数据将通过 JavaScript 动态插入 -->
      </div>
    </div>

    <script>
      // 肠道菌群整体评估模块
      const GutMicrobiomeEvaluation = {
        // 常量定义
        CONSTANTS: {
          COLORS: {
            RED: '#ff4d4f',
            GREEN: '#52c41a',
            GRAY: '#808080',
            PRIMARY: '#00B2B4'
          },
          // 定义我们需要显示的菌群整体评估项目列表
          EVALUATION_ITEMS: [
            { name: "菌种数量", englishName: "Gut microbial count" },
            { name: "菌种多样性", englishName: "Gut microbial diversity" },
            { name: "菌群平衡", englishName: "Gut microbiota balance" },
            { name: "菌群恢复力", englishName: "Gut microbial resilience" },
            { name: "生物膜形成", englishName: "Biofilm Formation" },
            { name: "有益菌", englishName: "Beneficial bacteria" },
            { name: "有害菌", englishName: "Pathogenic bacteria" },
            { name: "革兰氏阴性菌", englishName: "Gram-negative bacteria" },
            { name: "好氧菌", englishName: "Aerobic bacteria" }
          ]
        },

        // 解析范围字符串
        parseRange(rangeStr) {
          if (!rangeStr || typeof rangeStr !== 'string') {
            return { min: 0, max: 0 };
          }
          const parts = rangeStr.split('-');
          return {
            min: parseFloat(parts[0] || 0),
            max: parseFloat(parts[1] || 0)
          };
        },

        // 获取状态信息
        getStatus(value, rangeStr) {
          const { min, max } = this.parseRange(rangeStr);
          const numValue = parseFloat(value);

          let status = {
            color: this.CONSTANTS.COLORS.GREEN,
            text: '正常',
            icon: '',
            isNormal: true,
            valueColor: this.CONSTANTS.COLORS.GREEN // 正常时评估值显示绿色
          };

          if (numValue < min) {
            status.color = this.CONSTANTS.COLORS.RED;
            status.text = '异常';
            status.icon = '<i class="fas fa-arrow-down ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>';
            status.isNormal = false;
            status.valueColor = this.CONSTANTS.COLORS.RED;
          }
          else if (numValue > max) {
            status.color = this.CONSTANTS.COLORS.RED;
            status.text = '异常';
            status.icon = '<i class="fas fa-arrow-up ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>';
            status.isNormal = false;
            status.valueColor = this.CONSTANTS.COLORS.RED;
          }

          return status;
        },

        // 计算进度条百分比
        calculateProgress(value, rangeStr) {
          const { max } = this.parseRange(rangeStr);
          if (!value || max === 0) return 0;

          const num = Number(value);
          // 使进度条以max值为基准计算百分比，但限制在5%-100%范围内
          const percentage = (num / max) * 100;
          return Math.min(100, Math.max(5, percentage));
        },

        // 创建描述行
        createDescriptionRow(item) {
          if (!item || !item.说明) {
            return '';
          }

          return `
          <tr class="microbiome-desc-row">
            <td colspan="4" class="py-2 px-4 text-left">
              <div class="description-container text-gray-600" style="font-size: 11px;">
                <div class="flex items-start mb-0">
                  <div class="ml-1">
                    <p>
                      <i class="fas fa-info-circle" style="color: ${this.CONSTANTS.COLORS.PRIMARY};"></i>
                      ${item.说明}
                    </p>
                  </div>
                </div>
              </div>
            </td>
          </tr>
        `;
        },

        // 渲染表格
        renderTable(microbiomeData) {
          const container = document.getElementById('overall-evaluation-of-gut-microbiome-data-table-body');
          if (!container) {
            console.error('Container element not found');
            return;
          }
          container.innerHTML = '';

          if (!microbiomeData || !Array.isArray(microbiomeData) || microbiomeData.length === 0) {
            container.innerHTML = '<div class="no-data-message">暂无数据</div>';
            return;
          }

          const fragment = document.createDocumentFragment();

          // 遍历我们定义的评估项目列表
          this.CONSTANTS.EVALUATION_ITEMS.forEach(evaluationItem => {
            // 从数据中查找匹配的项目
            const matchedItem = microbiomeData.find(item =>
              item.检测项目 === evaluationItem.name ||
              item.检测项目.includes(evaluationItem.name)
            );

            if (!matchedItem) {
              // 如果没有找到匹配项，可以选择跳过或显示空值
              return;
            }

            const value = matchedItem.评估值;
            const rangeStr = matchedItem.参考范围;
            const evaluation = matchedItem.结果评价;

            // 获取状态信息
            const status = this.getStatus(value, rangeStr);

            // 如果数据中已有结果评价，更新状态文本
            if (evaluation) {
              status.text = evaluation;
              // 根据评价结果更新颜色
              if (evaluation !== "正常") {
                status.isNormal = false;
                status.color = this.CONSTANTS.COLORS.RED;
                status.valueColor = this.CONSTANTS.COLORS.RED;
              }
            }

            const progressPercentage = this.calculateProgress(value, rangeStr);

            const itemContainer = document.createElement('div');
            itemContainer.className = 'microbiome-info-container';

            const table = document.createElement('table');
            table.className = 'microbiome-table min-w-full';

            const dataRow = `
            <tr>
              <td class="py-2 px-4 text-left overall-evaluation-of-gut-first-column">
                <div class="overall-evaluation-of-gut-chinese-text"><strong>${evaluationItem.name}</strong></div>
                <div class="overall-evaluation-of-gut-english-text">${evaluationItem.englishName}</div>
              </td>
              <td class="py-2 px-4 text-center basic-function-of-gut-column-text overall-evaluation-of-gut-second-column">
                ${rangeStr}
              </td>
              <td class="py-2 px-4 text-center basic-function-of-gut-column-text overall-evaluation-of-gut-third-column">
                <div class="flex items-center justify-center">
                  <span style="color: ${status.valueColor}">
                    <strong>${value}${status.icon}</strong>
                  </span>
                </div>
                <div class="progress-bar w-full mt-2" style="background-color: #e9ecef; height: 8px; border-radius: 4px; overflow: hidden;">
                  <div class="progress"
                       style="width: ${progressPercentage}%;
                              height: 100%;
                              background-color: ${status.isNormal ? this.CONSTANTS.COLORS.GREEN : this.CONSTANTS.COLORS.RED};
                              transition: width 0.3s ease;">
                  </div>
                </div>
              </td>
              <td class="py-2 px-4 text-center basic-function-of-gut-column-text overall-evaluation-of-gut-fourth-column">
                <span style="color: ${status.color}">
                  <strong>${status.text}</strong>
                </span>
              </td>
            </tr>
          `;

            const descRow = this.createDescriptionRow(matchedItem);

            table.innerHTML = `<tbody>${dataRow}${descRow}</tbody>`;
            itemContainer.appendChild(table);
            fragment.appendChild(itemContainer);
          });

          container.appendChild(fragment);
        },

        // 加载数据
        async loadData() {
          try {
            const response = await fetch(DATA_PATHS.DATA);
            if (!response.ok) {
              throw new Error(`Network response error: ${response.status}`);
            }
            const data = await response.json();
            // 使用"菌群整体评估"数据
            this.renderTable(data["菌群整体评估"] || []);
          } catch (error) {
            console.error('Error loading overall evaluation of gut microbiome data:', error);
            document.getElementById('overall-evaluation-of-gut-microbiome-data-table-body').innerHTML =
              '<div class="no-data-message">暂无数据</div>';
          }
        },

        // 初始化
        init() {
          document.addEventListener('DOMContentLoaded', () => this.loadData());
        }
      };

      // 初始化肠道菌群整体评估模块
      GutMicrobiomeEvaluation.init();
    </script>
  </div>

<!--  &lt;!&ndash; 肠道菌群检测模块 &ndash;&gt;-->
<!--  <h1 class="custom-title-first-level page-break">肠道菌群检测</h1>-->

<!--  <div class="bg-white rounded-lg p-5 mb-5 mx-auto" style="width: 100%;">-->

<!--    &lt;!&ndash; 信息框 &ndash;&gt;-->
<!--    <div class="info-box">-->
<!--      <div class="flex items-start">-->
<!--        <div class="ml-1.5">-->
<!--          <p class="text-lg text-custom-teal">-->
<!--            <i class="fas fa-info-circle icon"></i>-->
<!--            肠道菌群可以大分类成细菌，病毒，真菌，原生生物和寄生虫 5 个类别，下列是各项组成部分的介绍及他们在您肠道中的分布比例图。-->
<!--          </p>-->
<!--        </div>-->
<!--      </div>-->
<!--    </div>-->

<!--    &lt;!&ndash; 肠道菌群组成比例信息图   &ndash;&gt;-->
<!--    <div class="container mx-auto space-y-2">-->
<!--      &lt;!&ndash; 细菌 &ndash;&gt;-->
<!--      <div class="flex gap-3">-->
<!--        &lt;!&ndash; 左侧标题 &ndash;&gt;-->
<!--        <div class="w-2/6 flex items-center justify-center bg-blue-100 rounded-md">-->
<!--          <span class="text-blue-500 text-2xl font-bold">细菌</span>-->
<!--        </div>-->
<!--        &lt;!&ndash; 右侧内容 &ndash;&gt;-->
<!--        <div class="w-4/6">-->
<!--          <div class="flex items-center gap-4 mb-3">-->
<!--            <div class="flex-1 overall-progress-container">-->
<!--              <div class="overall-progress-bar bg-blue-500" style="width: 90%"></div>-->
<!--            </div>-->
<!--            <div class="w-20 flex justify-center">-->
<!--              <span class="text-blue-500 text-3xl font-bold">90%</span>-->
<!--            </div>-->
<!--          </div>-->
<!--          <div class="bg-blue-50 rounded-md p-4">-->
<!--            <p class="text-gray-600 text-sm">肠道细菌是肠道菌群中最主要的组成部分，在消化、代谢、合成维生素和调节免疫系统方面发挥着重要作用。健康的肠道菌群通常表现出良好的多样性，包含厚壁菌门、拟杆菌门等细菌。</p>-->
<!--          </div>-->
<!--        </div>-->
<!--      </div>-->

<!--      &lt;!&ndash; 病毒 &ndash;&gt;-->
<!--      <div class="flex gap-6">-->
<!--        <div class="w-2/6 flex items-center justify-center bg-green-100 rounded-md">-->
<!--          <span class="text-green-500 text-2xl font-bold">病毒</span>-->
<!--        </div>-->
<!--        <div class="w-4/6">-->
<!--          <div class="flex items-center gap-4 mb-3">-->
<!--            <div class="flex-1 overall-progress-container">-->
<!--              <div class="overall-progress-bar bg-green-500" style="width: 5%"></div>-->
<!--            </div>-->
<!--            <div class="w-20 flex justify-center">-->
<!--              <span class="text-green-500 text-3xl font-bold">5%</span>-->
<!--            </div>-->
<!--          </div>-->
<!--          <div class="bg-green-50 rounded-md p-4">-->
<!--            <p class="text-gray-600 text-sm">病毒，尤其是噬菌体，在调节细菌的种类和数量方面扮演重要角色。它们既可以抑制有害细菌的生长，也可以推动微生物群落的多样性。</p>-->
<!--          </div>-->
<!--        </div>-->
<!--      </div>-->

<!--      &lt;!&ndash; 真菌 &ndash;&gt;-->
<!--      <div class="flex gap-6">-->
<!--        <div class="w-2/6 flex items-center justify-center bg-purple-100 rounded-md">-->
<!--          <span class="text-purple-500 text-2xl font-bold">真菌</span>-->
<!--        </div>-->
<!--        <div class="w-4/6">-->
<!--          <div class="flex items-center gap-4 mb-3">-->
<!--            <div class="flex-1 overall-progress-container">-->
<!--              <div class="overall-progress-bar bg-purple-500" style="width: 3%"></div>-->
<!--            </div>-->
<!--            <div class="w-20 flex justify-center">-->
<!--              <span class="text-purple-500 text-3xl font-bold">3%</span>-->
<!--            </div>-->
<!--          </div>-->
<!--          <div class="bg-purple-50 rounded-md p-4">-->
<!--            <p class="text-gray-600 text-sm">主要包括酵母菌（如白色念珠菌），在数量较少时是正常的一部分，但当免疫系统受损时，可能会因其快速繁殖而导致感染或其它问题。</p>-->
<!--          </div>-->
<!--        </div>-->
<!--      </div>-->

<!--      &lt;!&ndash; 原生生物 &ndash;&gt;-->
<!--      <div class="flex gap-6">-->
<!--        <div class="w-2/6 flex items-center justify-center bg-amber-100 rounded-md">-->
<!--          <span class="text-amber-500 text-2xl font-bold">真核生物</span>-->
<!--        </div>-->
<!--        <div class="w-4/6">-->
<!--          <div class="flex items-center gap-4 mb-3">-->
<!--            <div class="flex-1 overall-progress-container">-->
<!--              <div class="overall-progress-bar bg-amber-500" style="width: 1%"></div>-->
<!--            </div>-->
<!--            <div class="w-20 flex justify-center">-->
<!--              <span class="text-amber-500 text-3xl font-bold">1%</span>-->
<!--            </div>-->
<!--          </div>-->
<!--          <div class="bg-amber-50 rounded-md p-4">-->
<!--            <p class="text-gray-600 text-sm">数量较少，但原生生物如变形虫和细胞虫有时会影响肠道环境，参与营养循环和分解。</p>-->
<!--          </div>-->
<!--        </div>-->
<!--      </div>-->

<!--      &lt;!&ndash; 寄生虫 &ndash;&gt;-->
<!--      <div class="flex gap-6">-->
<!--        <div class="w-2/6 flex items-center justify-center bg-red-100 rounded-md">-->
<!--          <span class="text-red-500 text-2xl font-bold">寄生虫</span>-->
<!--        </div>-->
<!--        <div class="w-4/6">-->
<!--          <div class="flex items-center gap-4 mb-3">-->
<!--            <div class="flex-1 overall-progress-container">-->
<!--              <div class="overall-progress-bar bg-red-500" style="width: 1%"></div>-->
<!--            </div>-->
<!--            <div class="w-20 flex justify-center">-->
<!--              <span class="text-red-500 text-3xl font-bold">1%</span>-->
<!--            </div>-->
<!--          </div>-->
<!--          <div class="bg-red-50 rounded-md p-4">-->
<!--            <p class="text-gray-600 text-sm">常见的肠道寄生虫如蛔虫和鞭虫，虽然数量较少，但在某些情况下可能导致消化不良和腹痛等健康问题。</p>-->
<!--          </div>-->
<!--        </div>-->
<!--      </div>-->
<!--    </div>-->
<!--  </div>-->

  <!-- 肠道细菌板块 -->
  <h2 class="custom-title-second-level page-break">肠道细菌</h2>
  <div class="bg-white rounded-lg p-5 mb-5 mx-auto" style="width: 100%;"></div>

    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <div class="ml-1.5">
          <p class="text-lg text-custom-teal">
            <i class="fas fa-info-circle icon"></i>
            肠道微生物主要由肠道细菌组成，人体肠道中存在数千种细菌，总数量可达数十万亿个。健康成年人的肠道细菌主要分为厚壁菌门（Firmicutes）、拟杆菌门（Bacteroidetes）、放线菌门（Actinobacteria）和变形菌门（Proteobacteria），其中厚壁菌门和拟杆菌门占据了90%以上的比例。评估肠道菌群时，我们可以从丰度和菌群特性两个维度入手，这两者的结合有助于深入理解不同菌属在肠道微生态中的重要性和分布特征。
          </p>
        </div>
      </div>
    </div>

    <!-- 肠道细菌分类信息图总容器-->
    <div class="gut-bacteria-container">
      <div class="gut-bacteria-title">肠道菌群细菌分类体系</div>
      <div class="gut-bacteria-content">
        <!-- 左侧分类卡片 -->
        <div class="left">
          <div class="gut-bacteria-sub-title">按菌群丰度</div>

          <div class="gut-bacteria-card core">
            <div style="color: #4690e3;"><strong>核心菌属</strong></div>
            <p style="color: #555555;">在绝大多数健康人群肠道中普遍存在的优势菌属，包括厚壁菌属、拟杆菌属等，占据总菌群的主要组成部分。</p>
          </div>

          <div class="gut-bacteria-card non-core">
            <div class="card-title" style="color: #864797;"><strong>非核心重要菌属</strong></div>
            <p style="color: #555555;">虽然丰度相对较低，但对维持肠道健康具有重要作用的菌属，如乳酸菌属、双歧杆菌属等。</p>
          </div>

        </div>
        <!-- 右侧分类卡片 -->
        <div class="right">
          <div class="gut-bacteria-sub-title">按菌群特性</div>
          <div class="gut-bacteria-card beneficial">
            <div class="card-title" style="color: #569257;"><strong>有益菌</strong></div>
            <p style="color: #555555;">对人体健康有益的菌群，如双歧杆菌、乳酸菌等。它们参与营养物质的消化吸收，产生维生素，增强免疫力。</p>
          </div>
          <div class="gut-bacteria-card harmful">
            <div class="card-title" style="color: #e74f5a;"><strong>有害菌</strong></div>
            <p style="color: #555555;">有害菌通常是指那些在肠道中可能对宿主产生负面影响的细菌，这些细菌可能会干扰肠道平衡，导致消化问题，或促进肠道炎症。</p>
          </div>
          <div class="gut-bacteria-card opportunistic">
            <div class="card-title" style="color: #ffa41a;"><strong>机会致病菌</strong></div>
            <p style="color: #555555;">通常情况下与人体和平共处，但在特定条件下（如免疫力下降时）可能导致疾病的菌群。</p>
          </div>
          <div class="gut-bacteria-card pathogenic">
            <div class="card-title" style="color: #d02828;"><strong>致病菌</strong></div>
            <p style="color: #555555;">能够直接导致疾病的有害菌群，它们会破坏肠道环境，引起感染和炎症等症状。</p>
          </div>
        </div>

      </div>
    </div>

  <!-- 核心菌属板块 -->
  <h3 class="custom-title-third-level page-break">核心菌属</h3>

  <div class="bg-white rounded-lg p-5 mb-5 mx-auto" style="width: 100%;">

    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            <i class="fas fa-info-circle icon"></i>
            <strong>核心菌属</strong>是指在肠道菌群中相对丰度较高、对生理功能具有重要作用的优势菌群。它们在维持肠道健康、参与营养物质代谢和调节免疫系统等方面发挥着主导作用，构成了肠道微生态系统的基石。主要的核心菌属包括拟杆菌属（Bacteroides）、普雷沃氏菌属（Prevotella）和瘤胃球菌属（Ruminococcus）等。在正常情况下，这些菌群能帮助消化纤维、产生短链脂肪酸，维持肠道屏障功能。
            此外，核心肠道菌属还在合成维生素、促进矿物质吸收和抑制病原菌生长中发挥重要作用。它们通过与肠道内的免疫系统相互作用，增强机体的免疫反应，抵御外界的病原体侵袭。因此，保持核心菌属的平衡与多样性是维护肠道健康的关键。对于饮食和生活方式的调整，能够有效影响这些核心菌属的构成，从而促进整体健康。
          </p>
          <ul class="list-disc ml-5">
            <li class="font-bold text-[rgb(0,178,180)]">在本报告中，核心菌属指的是在90%人群中可被检测出，且人群平均丰度在1%以上的菌属。</li>
            <li>核心菌属及有益菌累加占总肠道菌群比例低于60%的可能出现肠道菌群紊乱。</li>
            <li>在本报告中，菌群的检测为ND意味着该菌群未检出，或该菌群的丰度低于检测的最低限度。</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- 核心菌属表格 -->
    <div class="rounded-table">
      <!-- 主表格只包含标题 -->
      <table class="min-w-full">
        <thead>
        <tr style="background-color: #00B2B4; color: white;">
          <th
            class="py-2 px-4 text-left core-gut-bacteria-first-column"
            style="font-size: 13px;">
            核心菌名称
          </th>
          <th
            class="py-2 px-4 text-center core-gut-bacteria-second-column"
            style="font-size: 13px; padding: 5px 5px;">
            检测丰度%
          </th>
          <th
            class="py-2 px-4 text-center core-gut-bacteria-third-column"
            style="font-size: 13px; padding: 5px 5px;">
            参考范围%
          </th>
          <th
            class="py-2 px-4 text-center core-gut-bacteria-fourth-column"
            style="font-size: 13px; padding: 5px 5px;">
            有%的正常人检出
          </th>
        </tr>
        </thead>
      </table>

      <!-- 数据表格容器 -->
      <div id="core-gut-bacteria-table-body">
        <!-- 数据将通过 JavaScript 动态插入 -->
      </div>

    </div>

    <!-- Javascript code -->
    <script>
      // 常量定义
      const CORE_BACTERIA_CONSTANTS = {
        COLORS: {
          RED: '#ff4d4f',
          GREEN: '#389e0d',
          GRAY: '#808080',
          PRIMARY: '#00B2B4',
          WARNING: '#FFA500',
          BLACK: '#000000'
        }
      };

      // 读取数据
      async function loadCoreBacteriaData() {
        try {
          const response = await fetch(DATA_PATHS.DATA);
          if (!response.ok) {
            throw new Error(`Network response error: ${response.status}`);
          }
          const data = await response.json();
          renderCoreBacteriaTable(data["核心菌属"] || []);
        } catch (error) {
          console.error('Error loading core bacteria data:', error);
          document.getElementById('core-gut-bacteria-table-body').innerHTML =
            '<div class="error-message">数据加载失败，请稍后再试</div>';
        }
      }

      // 格式化数字 - 保留2位有效数字
      function formatCoreBacteriaNumber(value) {
        // 处理特殊值"ND"
        if (typeof value === "string" && value === "ND") return value;

        // 确保转换为数字类型
        const num = Number(value);

        // 保留2位有效数字
        return num.toPrecision(2);
      }

      // 从名称中提取中文名和拉丁名
      function extractNameParts(fullName) {
        if (!fullName) return { chinese: '', latin: '' };

        const parts = fullName.split(' ');

        // 单个词的情况
        if (parts.length === 1) {
          const singlePart = parts[0];
          // 检查是否为拉丁文/英文（非中文）
          if (!/[\u4e00-\u9fa5]/.test(singlePart)) {
            return { chinese: singlePart, latin: singlePart };
          } else {
            return { chinese: singlePart, latin: '' };
          }
        }

        // 多个词的情况
        if (/[\u4e00-\u9fa5]/.test(parts[0])) {
          return {
            chinese: parts[0],
            latin: parts.slice(1).join(' ')
          };
        } else {
          return {
            chinese: parts[0],
            latin: parts[0]
          };
        }
      }

      // 解析正常范围
      function parseNormalRange(rangeStr) {
        if (!rangeStr || typeof rangeStr !== 'string') {
          return { min: 0, max: 0 };
        }

        const parts = rangeStr.split('-');
        return {
          min: parseFloat(parts[0] || 0),
          max: parseFloat(parts[1] || 0)
        };
      }

      // 获取状态信息
      function getCoreBacteriaStatus(detected, normalRange) {
        const { min, max } = normalRange;

        // 默认为正常状态
        let status = {
          color: CORE_BACTERIA_CONSTANTS.COLORS.BLACK, // 正常为黑色文字
          text: '正常',
          icon: '',
          isNormal: true
        };

        // 未检出的情况
        if (detected === "ND") {
          if (min > 0) {
            // 未检出但参考范围最小值大于0，视为偏低
            status.color = CORE_BACTERIA_CONSTANTS.COLORS.RED;
            status.text = '偏低';
            status.icon = '<i class="fas fa-arrow-down ml-1" style="color: ' + CORE_BACTERIA_CONSTANTS.COLORS.RED + ';"></i>';
            status.isNormal = false;
          }
          return status;
        }

        // 数值型检测值
        const detectedNum = parseFloat(detected);

        // 低于参考范围
        if (detectedNum < min) {
          status.color = CORE_BACTERIA_CONSTANTS.COLORS.RED;
          status.text = '偏低';
          status.icon = '<i class="fas fa-arrow-down ml-1" style="color: ' + CORE_BACTERIA_CONSTANTS.COLORS.RED + ';"></i>';
          status.isNormal = false;
        }
        // 高于参考范围
        else if (detectedNum > max) {
          status.color = CORE_BACTERIA_CONSTANTS.COLORS.RED;
          status.text = '超标';
          status.icon = '<i class="fas fa-arrow-up ml-1" style="color: ' + CORE_BACTERIA_CONSTANTS.COLORS.RED + ';"></i>';
          status.isNormal = false;
        }
        // 正常范围内，默认状态，无需修改

        return status;
      }

      // 创建描述行
      function createCoreBacteriaDescriptionRow(bacteria, status) {
        let descriptionContent = '';

        // 首先添加常规简介
        if (bacteria["说明"] && bacteria["说明"].trim()) {
          descriptionContent += `
          <div class="flex items-start mb-0">
            <div class="ml-1">
              <p>
                <i class="fas fa-info-circle" style="color: ${CORE_BACTERIA_CONSTANTS.COLORS.PRIMARY};"></i>
                ${bacteria["说明"]}
              </p>
            </div>
          </div>
        `;
        }

        // 如果状态不是正常，根据状态添加相应的改善建议
        if (!status.isNormal && bacteria["改善方式"] && bacteria["改善方式"].trim()) {
          descriptionContent += `
          <div class="flex items-start mt-0">
            <div class="ml-1">
              <p>
                <i class="fas fa-bell" style="color: ${CORE_BACTERIA_CONSTANTS.COLORS.WARNING};"></i>
                <strong>改善建议：</strong> ${bacteria["改善方式"]}
              </p>
            </div>
          </div>
        `;
        }

        // 如果有内容需要显示，返回完整的行
        if (descriptionContent.trim()) {
          return `
          <tr class="virus-desc-row">
            <td colspan="5" class="py-2 px-4 text-left">
              <div class="description-container text-gray-600" style="font-size: 11px;">
                ${descriptionContent}
              </div>
            </td>
          </tr>
        `;
        }

        // 如果没有描述内容，返回空字符串
        return '';
      }

      // 计算进度条百分比
      function calculateProgressPercentage(value) {
        if (value === "ND" || value === 0) {
          return 0;
        }

        const num = Number(value);

        // 使用与非核心菌属相同的进度条计算方式
        return Math.min(100, Math.max(5,
          num <= 1 ? num * 30 :
            num <= 10 ? 30 + (num - 1) * 5 :
              75 + (Math.min(num, 100) - 10) * 0.25
        ));
      }

      function renderCoreBacteriaTable(bacteriaData) {
        const container = document.getElementById('core-gut-bacteria-table-body');
        if (!container) {
          console.error('Cannot find container element');
          return;
        }

        container.innerHTML = '';

        // 如果没有数据
        if (!bacteriaData || !Array.isArray(bacteriaData) || bacteriaData.length === 0) {
          container.innerHTML = '<div class="no-data-message">暂无数据</div>';
          return;
        }

        // 使用DocumentFragment批量处理DOM操作
        const fragment = document.createDocumentFragment();

        bacteriaData.forEach(bacteria => {
          if (!bacteria) return;

          // 解析数据
          const detected = bacteria["丰度%"];
          const normalRange = parseNormalRange(bacteria["正常范围"]);
          const detectionRate = bacteria["%正常人有检出"] || "0%";
          const excessMultiple = bacteria["超标倍数"] || "0";

          // 解析名称
          const { chinese, latin } = extractNameParts(bacteria["名称"]);

          // 格式化数据
          const formattedDetectedValue = detected === "ND" ? detected : formatCoreBacteriaNumber(detected);
          const formattedMinRange = formatCoreBacteriaNumber(normalRange.min);
          const formattedMaxRange = formatCoreBacteriaNumber(normalRange.max);

          // 获取状态
          const status = getCoreBacteriaStatus(detected, normalRange);

          // 计算进度条百分比
          const progressPercentage = calculateProgressPercentage(detected === "ND" ? 0 : detected);

          // 创建菌属容器
          const bacteriaContainer = document.createElement('div');
          bacteriaContainer.className = 'bacteria-info-container';

          const table = document.createElement('table');
          table.className = 'bacteria-table min-w-full';

          // 生成数据行
          const dataRow = `
            <tr>
              <td class="py-2 pl-4 pr-2 text-left core-gut-bacteria-first-column">
                <div class="core-gut-bacteria-chinese-text">
                    <strong>${chinese}</strong>
                </div>
                <div class="core-gut-bacteria-latin-text">
                  ${latin}
                </div>
              </td>
              <td class="py-2 px-4 text-center core-gut-bacteria-column-text core-gut-bacteria-second-column">
                <div class="flex items-center justify-center">
                  <span style="color: ${status.color}">
                    <strong>${detected === "ND" ? "ND" : detected}${status.icon}</strong>
                  </span>
                </div>
                <div
                  class="progress-bar w-full mt-2"
                  style="background-color: #e9ecef; height: 8px; border-radius: 4px; overflow: hidden;">
                  <div class="progress"
                       style="width: ${progressPercentage}%;
                              height: 100%;
                              background-color: ${status.isNormal ? CORE_BACTERIA_CONSTANTS.COLORS.PRIMARY : CORE_BACTERIA_CONSTANTS.COLORS.RED};
                              transition: width 0.3s ease;">
                  </div>
                </div>
              </td>
              <td class="py-2 px-4 text-center core-gut-bacteria-column-text core-gut-bacteria-third-column">
                ${normalRange.min}-${normalRange.max}
              </td>
              <td class="py-2 px-4 text-center core-gut-bacteria-column-text core-gut-bacteria-fourth-column">
                ${detectionRate}
              </td>
            </tr>
          `;

          // 生成描述行
          const descRow = createCoreBacteriaDescriptionRow(bacteria, status);

          table.innerHTML = `<tbody>${dataRow}${descRow}</tbody>`;
          bacteriaContainer.appendChild(table);
          fragment.appendChild(bacteriaContainer);
        });

        // 一次性添加所有元素到DOM
        container.appendChild(fragment);
      }

      // 页面加载时调用
      document.addEventListener('DOMContentLoaded', loadCoreBacteriaData);
    </script>
  </div>

  <!-- 其他非核心菌属板块 -->
  <h3 class="custom-title-third-level page-break">其他非核心重要菌属</h3>

  <div
    class="bg-white rounded-lg p-5 mb-5 mx-auto"
    style="width: 100%;">

    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            <i class="fas fa-info-circle icon"></i>
            其他非核心重要菌属指的是在人群中丰度不高，但对肠道健康有重要影响的菌属。
          </p>
        </div>
      </div>
    </div>

    <!-- 其他重要菌属表格 -->
    <div class="rounded-table">
      <!-- 主表格只包含标题 -->
      <table class="min-w-full">
        <thead>
        <tr style="background-color: #00B2B4; color: white;">
          <th
            class="py-2 px-4 text-left beneficial-gut-bacteria-first-column"
            style="font-size: 13px;">
            其他非核心重要菌属名称
          </th>
          <th
            class="py-2 px-4 text-center beneficial-gut-bacteria-second-column"
            style="font-size: 13px; padding: 5px 5px;">
            检测丰度%
          </th>
          <th
            class="py-2 px-4 text-center beneficial-gut-bacteria-third-column"
            style="font-size: 13px; padding: 5px 5px;">
            参考范围%
          </th>
          <th
            class="py-2 px-4 text-center beneficial-gut-bacteria-fourth-column"
            style="font-size: 13px; padding: 5px 5px;">
            %正常人有检出
          </th>
        </tr>
        </thead>
      </table>

      <!-- 数据表格容器 -->
      <div id="other-important-bacteria-table-body">
        <!-- 数据将通过 JavaScript 动态插入 -->
      </div>
    </div>

    <script>
      // 常量定义
      const OTHER_IMPORTANT_CONSTANTS = {
        COLORS: {
          RED: '#ff4d4f',
          GREEN: '#389e0d',
          GRAY: '#808080',
          PRIMARY: '#00B2B4',  // rgb(0, 178, 180) 的十六进制表示
          WARNING: '#FF0000',  // rgb(255, 0, 0) 的十六进制表示
          BLACK: '#000000'
        }
      };

      // 加载数据
      async function loadOtherImportantBacteriaData() {
        try {
          const response = await fetch(DATA_PATHS.DATA);
          if (!response.ok) {
            throw new Error(`Network response error: ${response.status}`);
          }
          const data = await response.json();
          renderOtherImportantBacteriaTable(data["其他重要菌属"] || []);
        } catch (error) {
          console.error('Error loading other important bacteria data:', error);
          document.getElementById('other-important-bacteria-table-body').innerHTML =
            '<div class="error-message">数据加载失败，请稍后再试</div>';
        }
      }

      // 格式化数字 - 保留2位有效数字
      function formatOtherImportantNumber(value) {
        // 处理特殊值"ND"
        if (value === "ND") return value;

        // 确保转换为数字类型
        const num = Number(value);

        // 保留2位有效数字
        return num.toPrecision(2);
      }

      // 获取状态信息
      function getOtherImportantBacteriaStatus(detected, minRange, maxRange) {
        // 默认为正常状态
        let status = {
          color: OTHER_IMPORTANT_CONSTANTS.COLORS.BLACK, // 正常为黑色文字
          text: '正常',
          icon: '',
          isNormal: true
        };

        // 未检出的情况
        if (detected === "ND") {
          if (minRange > 0) {
            // 未检出但参考范围最小值大于0，视为偏低
            status.color = OTHER_IMPORTANT_CONSTANTS.COLORS.RED;
            status.text = '偏低';
            status.icon = '<i class="fas fa-arrow-down ml-1" style="color: ' + OTHER_IMPORTANT_CONSTANTS.COLORS.RED + ';"></i>';
            status.isNormal = false;
          }
          return status;
        }

        // 低于参考范围
        if (detected < minRange) {
          status.color = OTHER_IMPORTANT_CONSTANTS.COLORS.RED;
          status.text = '偏低';
          status.icon = '<i class="fas fa-arrow-down ml-1" style="color: ' + OTHER_IMPORTANT_CONSTANTS.COLORS.RED + ';"></i>';
          status.isNormal = false;
        }
        // 高于参考范围
        else if (detected > maxRange) {
          status.color = OTHER_IMPORTANT_CONSTANTS.COLORS.RED;
          status.text = '超标';
          status.icon = '<i class="fas fa-arrow-up ml-1" style="color: ' + OTHER_IMPORTANT_CONSTANTS.COLORS.RED + ';"></i>';
          status.isNormal = false;
        }
        // 正常范围内，默认状态，无需修改

        return status;
      }

      // 创建描述行
      function createOtherImportantDescriptionRow(bacteria, status) {
        let descriptionContent = '';

        // 首先添加常规简介
        if (bacteria["说明"] && bacteria["说明"].trim()) {
          descriptionContent += `
        <div class="flex items-start mb-0">
          <div class="ml-1">
            <p>
              <i class="fas fa-info-circle" style="color: ${OTHER_IMPORTANT_CONSTANTS.COLORS.PRIMARY};"></i>
              ${bacteria["说明"]}
            </p>
          </div>
        </div>
      `;
        }

        // 如果状态不是正常，根据状态添加相应的改善建议
        if (!status.isNormal) {
          if (status.text === '超标' && bacteria["改善方式"] && bacteria["改善方式"].trim()) {
            descriptionContent += `
          <div class="flex items-start mt-0">
            <div class="ml-1">
              <p>
                <i class="fas fa-bell" style="color: #FFA500;"></i>
                <strong>改善建议：</strong> ${bacteria["改善方式"]}
              </p>
            </div>
          </div>
        `;
          } else if (status.text === '偏低' && bacteria["改善方式"] && bacteria["改善方式"].trim()) {
            descriptionContent += `
          <div class="flex items-start mt-0">
            <div class="ml-1">
              <p>
                <i class="fas fa-bell" style="color: #FFA500;"></i>
                <strong>改善建议：</strong> ${bacteria["改善方式"]}
              </p>
            </div>
          </div>
        `;
          }
        }

        // 如果有内容需要显示，返回完整的行
        if (descriptionContent.trim()) {
          return `
        <tr class="virus-desc-row">
          <td colspan="4" class="py-2 px-4 text-left">
            <div class="description-container text-gray-600" style="font-size: 11px;">
              ${descriptionContent}
            </div>
          </td>
        </tr>
      `;
        }

        // 如果没有描述内容，返回空字符串
        return '';
      }

      // 创建表格行
      function createOtherImportantBacteriaRow(bacteria) {
        // 解析数据，添加安全检查
        const detected = bacteria["丰度%"] === "ND" ? "ND" : parseFloat(bacteria["丰度%"]) || 0;

        // 安全解析范围值
        let minRange = 0, maxRange = 0;
        if (bacteria["正常范围"] && typeof bacteria["正常范围"] === 'string') {
          const rangeParts = bacteria["正常范围"].split("-");
          minRange = parseFloat(rangeParts[0] || 0);
          maxRange = parseFloat(rangeParts[1] || 0);
        }

        // 格式化数据 - 保留2位有效数字
        const formattedDetectedValue = formatOtherImportantNumber(detected);
        const formattedMinRange = formatOtherImportantNumber(minRange);
        const formattedMaxRange = formatOtherImportantNumber(maxRange);

        // 获取状态
        const status = getOtherImportantBacteriaStatus(detected, minRange, maxRange);

        // 创建行元素
        const bacteriaContainer = document.createElement('div');
        bacteriaContainer.className = 'bacteria-info-container';

        const table = document.createElement('table');
        table.className = 'bacteria-table min-w-full';

        // 计算进度条百分比 - 对数缩放
        const progressPercentage = detected === "ND" ? 0 :
          Math.min(100, Math.max(5,
            detected <= 1 ? detected * 30 :
              detected <= 10 ? 30 + (detected - 1) * 5 :
                75 + (Math.min(detected, 100) - 10) * 0.25
          ));

        // 生成显示值的行
        const dataRow = `
      <tr>
        <td class="py-2 pl-4 pr-2 text-left beneficial-gut-bacteria-first-column">
          <div class="beneficial-gut-bacteria-chinese-text"><strong>${bacteria["名称"].split(" ")[0] || ''}</strong></div>
          <div class="beneficial-gut-bacteria-latin-text">${/^[a-zA-Z]+$/.test(bacteria["名称"].split(" ")[0]) ? bacteria["名称"].split(" ")[0] : (bacteria["名称"].split(" ")[1] || '')}</div>
        </td>
        <td class="py-2 px-4 text-center beneficial-gut-bacteria-column-text beneficial-gut-bacteria-second-column">
          <div class="flex items-center justify-center">
            <span style="color: ${status.color}">
              <strong>${detected === "ND" ? "ND" : detected}${status.icon}</strong>
            </span>
          </div>
          <div
            class="progress-bar w-full mt-2"
            style="background-color: #e9ecef; height: 8px; border-radius: 4px; overflow: hidden;">
            <div class="progress"
                 style="width: ${progressPercentage}%;
                        height: 100%;
                        background-color: ${status.isNormal ? OTHER_IMPORTANT_CONSTANTS.COLORS.PRIMARY : OTHER_IMPORTANT_CONSTANTS.COLORS.RED};
                        transition: width 0.3s ease;">
            </div>
          </div>
        </td>
        <td class="py-2 px-4 text-center beneficial-gut-bacteria-column-text beneficial-gut-bacteria-third-column">
          ${bacteria["正常范围"]}
        </td>
        <td class="py-2 px-4 text-center
          beneficial-gut-bacteria-column-text
          beneficial-gut-bacteria-fourth-column">
            ${bacteria["%正常人有检出"]}
        </td>
      </tr>
    `;

        // 生成描述行
        const descRow = createOtherImportantDescriptionRow(bacteria, status);

        table.innerHTML = `<tbody>${dataRow}${descRow}</tbody>`;
        bacteriaContainer.appendChild(table);

        return bacteriaContainer;
      }

      // 主渲染函数
      function renderOtherImportantBacteriaTable(bacteriaData) {
        const container = document.getElementById('other-important-bacteria-table-body');
        if (!container) {
          console.error('Cannot find container element');
          return;
        }

        container.innerHTML = '';

        // 如果没有数据
        if (!bacteriaData || !Array.isArray(bacteriaData) || bacteriaData.length === 0) {
          container.innerHTML = '<div class="no-data-message">暂无数据</div>';
          return;
        }

        // 使用DocumentFragment批量处理DOM操作
        const fragment = document.createDocumentFragment();

        bacteriaData.forEach(bacteria => {
          if (bacteria) {  // 确保bacteria存在
            const bacteriaElement = createOtherImportantBacteriaRow(bacteria);
            fragment.appendChild(bacteriaElement);
          }
        });

        // 一次性添加所有元素到DOM
        container.appendChild(fragment);
      }

      // 页面加载时调用
      document.addEventListener('DOMContentLoaded', loadOtherImportantBacteriaData);
    </script>

  </div>

  <!-- 常见有益菌版块 -->
  <h3 class="custom-title-1 page-break">常见有益菌</h3>

  <div
    class="bg-white rounded-lg p-5 mb-5 mx-auto"
    style="width: 100%;">

    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            <i class="fas fa-info-circle icon"></i>
            有益菌是指对宿主健康有积极影响的微生物，特别是在肠道内，有助于维持菌群平衡、促进消化和增强免疫力。下列是常见有益菌在您肠道中的检测情况。（中文名称后的符号表示： # 为益生菌； * 为食品可添加菌；未标注特殊符号为对人体有益微生物；）
          </p>
        </div>
      </div>
    </div>

    <!-- 问答信息框 -->
    <div class="qa-box">
      <div class="flex items-start ml-2">
        <p class="text-lg font-bold text-lightpurple">
          <i class="fas fa-question-circle icon icon-purple"></i>
          肠道有益菌是越多越好吗？
        </p>
      </div>
      <div class="flex items-start ml-2 mt-2">
        <p class="answer-text">
          <i class="fas fa-comments icon icon-orange"></i>
          肠道有益菌并不是越多越好，关键在于微生物的多样性与平衡：
          多样性: 健康的肠道微生物群依赖于多样性，不同菌种间的相互作用有助于维持肠道功能和免疫系统。
          过度生长: 虽然有益菌有助于消化和防病，但过多可能导致代谢问题或肠道不适。
          个体差异: 每个人的肠道微生物群组成不同，适宜的有益菌数量因人而异。
          总之，保持有益菌的多样性和适宜数量是促进肠道健康的关键。
        </p>
      </div>
    </div>

    <!-- 常见益生菌表格 -->
    <div class="rounded-table">
      <!-- 主表格只包含标题 -->
      <table class="min-w-full">
        <thead>
        <tr style="background-color: #00B2B4; color: white;">
          <th
            class="py-2 px-4 text-left beneficial-gut-bacteria-first-column"
            style="font-size: 13px;">
            有益菌名称
          </th>
          <th
            class="py-2 px-4 text-center beneficial-gut-bacteria-second-column"
            style="font-size: 13px; padding: 5px 5px;">
            检测丰度%
          </th>
          <th
            class="py-2 px-4 text-center beneficial-gut-bacteria-third-column"
            style="font-size: 13px; padding: 5px 5px;">
            参考范围%
          </th>
        </tr>
        </thead>
      </table>

      <!-- 数据表格容器 -->
      <div id="beneficial-bacteria-table-body">
        <!-- 数据将通过 JavaScript 动态插入 -->
      </div>
    </div>

    <script>
      // 常量定义
      const CONSTANTS = {
        COLORS: {
          RED: '#ff4d4f',
          GREEN: '#389e0d',
          GRAY: '#808080',
          PRIMARY: '#00B2B4',  // rgb(0, 178, 180) 的十六进制表示
          WARNING: '#FF0000',  // rgb(255, 0, 0) 的十六进制表示
          BLACK: '#000000'
        }
      };

      // 加载数据
      async function loadBeneficialBacteriaData() {
        try {
          const response = await fetch(DATA_PATHS.DATA);
          if (!response.ok) {
            throw new Error(`Network response error: ${response.status}`);
          }
          const data = await response.json();
          renderBeneficialBacteriaTable(data["有益菌"] || []);
        } catch (error) {
          console.error('Error loading beneficial bacteria data:', error);
          document.getElementById('beneficial-bacteria-table-body').innerHTML =
            '<div class="error-message">数据加载失败，请稍后再试</div>';
        }
      }

      // 格式化数字 - 保留2位有效数字
      function formatNumber(value) {
        // 处理特殊值"ND"
        if (value === "ND") return value;

        // 确保转换为数字类型
        const num = Number(value);

        // 保留2位有效数字
        return num.toPrecision(2);
      }

      // 获取状态信息
      function getBacteriaStatus(detected, minRange, maxRange) {
        // 默认为正常状态
        let status = {
          color: CONSTANTS.COLORS.BLACK, // 正常为黑色文字
          text: '正常',
          icon: '',
          isNormal: true
        };

        // 未检出的情况
        if (detected === "ND") {
          if (minRange > 0) {
            // 未检出但参考范围最小值大于0，视为偏低
            status.color = CONSTANTS.COLORS.RED;
            status.text = '偏低';
            status.icon = '<i class="fas fa-arrow-down ml-1" style="color: ' + CONSTANTS.COLORS.RED + ';"></i>';
            status.isNormal = false;
          }
          return status;
        }

        // 低于参考范围
        if (detected < minRange) {
          status.color = CONSTANTS.COLORS.RED;
          status.text = '偏低';
          status.icon = '<i class="fas fa-arrow-down ml-1" style="color: ' + CONSTANTS.COLORS.RED + ';"></i>';
          status.isNormal = false;
        }
        // 高于参考范围
        else if (detected > maxRange) {
          status.color = CONSTANTS.COLORS.RED;
          status.text = '超标';
          status.icon = '<i class="fas fa-arrow-up ml-1" style="color: ' + CONSTANTS.COLORS.RED + ';"></i>';
          status.isNormal = false;
        }
        // 正常范围内，默认状态，无需修改

        return status;
      }

      // 创建描述行 - 更新为新的数据结构和逻辑
      function createDescriptionRow(bacteria, status) {
        let descriptionContent = '';

        // 首先添加常规简介
        if (bacteria["简介"] && bacteria["简介"].trim()) {
          descriptionContent += `
      <div class="flex items-start mb-0">
        <div class="ml-1">
          <p>
            <i class="fas fa-info-circle" style="color: ${CONSTANTS.COLORS.PRIMARY};"></i>
            ${bacteria["简介"]}
          </p>
        </div>
      </div>
    `;
        }

        // 如果状态不是正常，根据状态添加相应的改善建议
        if (!status.isNormal) {
          if (status.text === '超标' && bacteria["超标改善"] && bacteria["超标改善"].trim()) {
            descriptionContent += `
        <div class="flex items-start mt-0">
          <div class="ml-1">
            <p>
              <i class="fas fa-bell" style="color: #FFA500;"></i>
              <strong>改善建议：</strong> ${bacteria["超标改善"]}
            </p>
          </div>
        </div>
      `;
          } else if (status.text === '偏低' && bacteria["偏低改善"] && bacteria["偏低改善"].trim()) {
            descriptionContent += `
        <div class="flex items-start mt-0">
          <div class="ml-1">
            <p>
              <i class="fas fa-bell" style="color: #FFA500;"></i>
              <strong>改善建议：</strong> ${bacteria["偏低改善"]}
            </p>
          </div>
        </div>
      `;
          }
        }

        // 如果有内容需要显示，返回完整的行
        if (descriptionContent.trim()) {
          return `
      <tr class="virus-desc-row">
        <td colspan="6" class="py-2 px-4 text-left">
          <div class="description-container text-gray-600" style="font-size: 11px;">
            ${descriptionContent}
          </div>
        </td>
      </tr>
    `;
        }

        // 如果没有描述内容，返回空字符串
        return '';
      }

      // 创建表格行
      function createBacteriaRow(bacteria) {
        // 解析数据，添加安全检查
        const detected = bacteria["丰度%"] === "ND" ? "ND" : parseFloat(bacteria["丰度%"] || 0);

        // 安全解析范围值
        let minRange = 0, maxRange = 0;
        if (bacteria["正常范围"] && typeof bacteria["正常范围"] === 'string') {
          const rangeParts = bacteria["正常范围"].split("-");
          minRange = parseFloat(rangeParts[0] || 0);
          maxRange = parseFloat(rangeParts[1] || 0);
        }

        // 格式化数据 - 保留2位有效数字
        const formattedDetectedValue = formatNumber(detected);
        const formattedMinRange = formatNumber(minRange);
        const formattedMaxRange = formatNumber(maxRange);

        // 获取状态
        const status = getBacteriaStatus(detected, minRange, maxRange);

        // 创建行元素
        const bacteriaContainer = document.createElement('div');
        bacteriaContainer.className = 'bacteria-info-container';

        const table = document.createElement('table');
        table.className = 'bacteria-table min-w-full';

        // 生成显示值的行
        const dataRow = `
    <tr>
      <td class="py-2 pl-4 pr-2 text-left beneficial-gut-bacteria-first-column">
        <div class="beneficial-gut-bacteria-chinese-text"><strong>${bacteria["中文名"] || ''}</strong></div>
        <div class="beneficial-gut-bacteria-latin-text">${bacteria["名称"] || ''}</div>
      </td>
      <td class="py-2 px-4 text-center beneficial-gut-bacteria-column-text beneficial-gut-bacteria-second-column">
        <div class="flex items-center justify-center">
          <span style="color: ${status.color}">
            <strong>${detected === "ND" ? "ND" : detected}${status.icon}</strong>
          </span>
        </div>
        <!-- 使用直接内联的进度条宽度逻辑 -->
        <div
          class="progress-bar w-full mt-2"
          style="background-color: #e9ecef; height: 8px; border-radius: 4px; overflow: hidden;">
          <div class="progress"
               style="width: ${bacteria["丰度%"] === "ND" ? 0 : parseFloat(bacteria["丰度%"])}%;
                      height: 100%;
                      background-color: ${status.isNormal ? CORE_BACTERIA_CONSTANTS.COLORS.PRIMARY : CORE_BACTERIA_CONSTANTS.COLORS.RED};
                      transition: width 0.3s ease;">
          </div>
        </div>
      </td>
      <td class="py-2 px-4 text-center
          beneficial-gut-bacteria-column-text
          beneficial-gut-bacteria-third-column">
        ${bacteria["正常范围"]}
      </td>
    </tr>
  `;

        // 生成描述行 - 传递整个bacteria对象和status
        const descRow = createDescriptionRow(bacteria, status);

        table.innerHTML = `<tbody>${dataRow}${descRow}</tbody>`;
        bacteriaContainer.appendChild(table);

        return bacteriaContainer;
      }

      // 主渲染函数
      function renderBeneficialBacteriaTable(bacteriaData) {
        const container = document.getElementById('beneficial-bacteria-table-body');
        if (!container) {
          console.error('Cannot find container element');
          return;
        }

        container.innerHTML = '';

        // 如果没有数据
        if (!bacteriaData || !Array.isArray(bacteriaData) || bacteriaData.length === 0) {
          container.innerHTML = '<div class="no-data-message">暂无数据</div>';
          return;
        }

        // 使用DocumentFragment批量处理DOM操作
        const fragment = document.createDocumentFragment();

        bacteriaData.forEach(bacteria => {
          if (bacteria) {  // 确保bacteria存在
            const bacteriaElement = createBacteriaRow(bacteria);
            fragment.appendChild(bacteriaElement);
          }
        });

        // 一次性添加所有元素到DOM
        container.appendChild(fragment);
      }

      // 页面加载时调用
      document.addEventListener('DOMContentLoaded', loadBeneficialBacteriaData);
    </script>

  </div>

  <!-- 常见有害菌版块 -->
  <h3 class="custom-title-1 page-break">常见有害菌</h3>

  <div
    class="bg-white rounded-lg p-5 mb-5 mx-auto"
    style="width: 100%;">

    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            <i class="fas fa-info-circle icon"></i>
            肠道有害菌能够破坏肠道内生态平衡，引起肠道功能紊乱等，损害人体健康。下列是17种常见肠道有害菌在您的肠道中的检测情况。（可以优先关注异常菌和其对应的改善方法）
          </p>
        </div>
      </div>
    </div>

<!--    &lt;!&ndash; 有害菌检测情况总结圆环 &ndash;&gt;-->
<!--    <div class="harmful-gut-bacteria-container mt-10 mb-5">-->
<!--      <div class="harmful-gut-bacteria-donut-chart-container">-->
<!--        <div class="harmful-gut-bacteria-donut-chart"></div>-->
<!--        <div class="harmful-gut-bacteria-center-hole">-->
<!--          <div class="harmful-gut-bacteria-center-value">3/17</div>-->
<!--          <div class="harmful-gut-bacteria-center-label">异常</div>-->
<!--          <div class="harmful-gut-bacteria-center-sublabel">常见有害菌检测结果</div>-->
<!--        </div>-->
<!--      </div>-->

<!--      <div class="harmful-gut-bacteria-legend">-->
<!--        <div class="harmful-gut-bacteria-legend-item">-->
<!--          <div class="harmful-gut-bacteria-legend-color harmful-gut-bacteria-exceeded"></div>-->
<!--          <span>异常 (3项)</span>-->
<!--        </div>-->
<!--        <div class="harmful-gut-bacteria-legend-item">-->
<!--          <div class="harmful-gut-bacteria-legend-color harmful-gut-bacteria-normal"></div>-->
<!--          <span>参考范围内 (8项)</span>-->
<!--        </div>-->
<!--        <div class="harmful-gut-bacteria-legend-item">-->
<!--          <div class="harmful-gut-bacteria-legend-color harmful-gut-bacteria-not-detected"></div>-->
<!--          <span>未检出 (6项)</span>-->
<!--        </div>-->
<!--      </div>-->
<!--    </div>-->

    <!-- 问答信息框 -->
    <div class="qa-box">
      <div class="flex items-start ml-2">
        <p class="text-lg font-bold text-lightpurple">
          <i class="fas fa-question-circle icon icon-purple"></i>
          肠道有害菌是越少越好吗？
        </p>
      </div>
      <div class="flex items-start ml-2 mt-2">
        <p class="answer-text">
          <i class="fas fa-comments icon icon-orange"></i>
          肠道有害菌并不是越少越好。关键在于维持肠道微生物的平衡：
          适度存在: 有害菌在一定数量下可以与有益菌竞争，并促进微生物生态的平衡。
          过度抑制风险: 过度抑制有害菌可能会导致有益菌失衡，破坏微生物群落。
          健康维持: 健康饮食和生活方式有助于控制有害菌的数量，保持整体肠道健康。
          总之，重要的是保持有益菌占主导，有害菌在可控范围内。
        </p>
      </div>
    </div>

    <!-- 常见有害菌表格 -->
    <div class="rounded-table">
      <!-- 主表格只包含标题 -->
      <table class="min-w-full">
        <thead>
        <tr style="background-color: #00B2B4; color: white;">
          <th
            class="py-2 px-4 text-left harmful-gut-bacteria-first-column"
            style="font-size: 13px;">
            有害菌名称
          </th>
          <th
            class="py-2 px-4 text-center harmful-gut-bacteria-second-column"
            style="font-size: 13px; padding: 5px 5px;">
            检测丰度%
          </th>
          <th
            class="py-2 px-4 text-center harmful-gut-bacteria-third-column"
            style="font-size: 13px; padding: 5px 5px;">
            参考范围%
          </th>
          <th
            class="py-2 px-4 text-center harmful-gut-bacteria-fourth-column"
            style="font-size: 13px; padding: 5px 5px;">
            %正常人有检出
          </th>
        </tr>
        </thead>
      </table>

      <!-- 数据表格容器 -->
      <div id="harmful-bacteria-table-body">
        <!-- 数据将通过 JavaScript 动态插入 -->
      </div>
    </div>

    <script>
      // 常量定义
      const HARMFUL_CONSTANTS = {
        COLORS: {
          RED: '#ff4d4f',
          GREEN: '#389e0d',
          GRAY: '#808080',
          PRIMARY: '#00B2B4',
          WARNING: '#FFA500',
          BLACK: '#000000'
        }
      };

      // 加载数据
      async function loadHarmfulBacteriaData() {
        try {
          const response = await fetch(DATA_PATHS.DATA);
          if (!response.ok) {
            throw new Error(`Network response error: ${response.status}`);
          }
          const data = await response.json();
          renderHarmfulBacteriaTable(data["有害菌属"] || []);
        } catch (error) {
          console.error('Error loading harmful bacteria data:', error);
          document.getElementById('harmful-bacteria-table-body').innerHTML =
            '<div class="error-message">数据加载失败，请稍后再试</div>';
        }
      }

      // 格式化数字
      function formatHarmfulNumber(value) {
        // 处理特殊值"ND"
        if (value === "ND") return value;

        // 确保转换为数字类型
        const num = Number(value);

        // 保留2位有效数字
        return num.toPrecision(2);
      }

      // 获取状态信息
      function getHarmfulBacteriaStatus(detected, minRange, maxRange) {
        // 默认为正常状态
        let status = {
          color: HARMFUL_CONSTANTS.COLORS.BLACK,
          text: '正常',
          icon: '',
          isNormal: true
        };

        // 未检出的情况
        if (detected === "ND") {
          if (minRange > 0) {
            status.color = HARMFUL_CONSTANTS.COLORS.RED;
            status.text = '偏低';
            status.icon = '<i class="fas fa-arrow-down ml-1" style="color: ' + HARMFUL_CONSTANTS.COLORS.RED + ';"></i>';
            status.isNormal = false;
          }
          return status;
        }

        // 低于参考范围
        if (detected < minRange) {
          status.color = HARMFUL_CONSTANTS.COLORS.RED;
          status.text = '偏低';
          status.icon = '<i class="fas fa-arrow-down ml-1" style="color: ' + HARMFUL_CONSTANTS.COLORS.RED + ';"></i>';
          status.isNormal = false;
        }
        // 高于参考范围
        else if (detected > maxRange) {
          status.color = HARMFUL_CONSTANTS.COLORS.RED;
          status.text = '超标';
          status.icon = '<i class="fas fa-arrow-up ml-1" style="color: ' + HARMFUL_CONSTANTS.COLORS.RED + ';"></i>';
          status.isNormal = false;
        }

        return status;
      }

      // 检查字符串是否为空
      function isEmptyString(str) {
        return !str || typeof str !== 'string' || str.trim() === '';
      }

      // 计算进度条百分比
      function calculateProgressPercentage(value) {
        if (value === "ND" || value === 0) {
          return 0;
        }

        const num = Number(value);
        const logValue = Math.log10(num);
        const minLog = -1; // log10(0.0001)
        const maxLog = 3;  // log10(100)

        const percentage = ((logValue - minLog) / (maxLog - minLog)) * 45 + 5;
        return Math.max(5, Math.min(50, percentage));
      }

      // 创建描述行 - 修复处理"说明"字段的逻辑
      function createHarmfulDescriptionRow(bacteria, status) {
        // 确保"说明"字段存在且不为空
        if (isEmptyString(bacteria["说明"])) {
          return ''; // 如果没有描述，返回空字符串
        }

        let descriptionContent = `
          <div class="flex items-start mb-0">
            <div class="ml-1">
              <p>
                <i class="fas fa-info-circle" style="color: ${HARMFUL_CONSTANTS.COLORS.PRIMARY};"></i>
                ${bacteria["说明"]}
              </p>
            </div>
          </div>
        `;

        // 如果状态不正常且有改善方式，显示改善建议
        // 明确检查改善方式是否为空字符串
        const hasImprovement = !isEmptyString(bacteria["改善方式"]);
        if (!status.isNormal && hasImprovement) {
          descriptionContent += `
            <div class="flex items-start mt-0">
              <div class="ml-1">
                <p>
                  <i class="fas fa-bell" style="color: ${HARMFUL_CONSTANTS.COLORS.WARNING};"></i>
                  <strong>改善建议：</strong> ${bacteria["改善方式"]}
                </p>
              </div>
            </div>
          `;
        }

        return `
          <tr class="virus-desc-row">
            <td colspan="4" class="py-2 px-4 text-left">
              <div class="description-container text-gray-600" style="font-size: 11px;">
                ${descriptionContent}
              </div>
            </td>
          </tr>
        `;
      }

      // 创建表格行
      function createHarmfulBacteriaRow(bacteria) {
        // 解析数据
        const detected = bacteria["丰度%"] === "ND" ? "ND" : parseFloat(bacteria["丰度%"] || 0);

        // 解析范围（格式为"0-3.83"）
        let minRange = 0, maxRange = 0;
        if (bacteria["正常范围"] && typeof bacteria["正常范围"] === 'string') {
          const rangeParts = bacteria["正常范围"].split("-");
          minRange = parseFloat(rangeParts[0] || 0);
          maxRange = parseFloat(rangeParts[1] || 0);
        }

        // 格式化数据
        const formattedDetectedValue = formatHarmfulNumber(detected);
        const formattedMinRange = formatHarmfulNumber(minRange);
        const formattedMaxRange = formatHarmfulNumber(maxRange);

        // 获取状态
        const status = getHarmfulBacteriaStatus(detected, minRange, maxRange);

        // 创建行元素
        const bacteriaContainer = document.createElement('div');
        bacteriaContainer.className = 'bacteria-info-container';

        const table = document.createElement('table');
        table.className = 'bacteria-table min-w-full';

        // 从名称中提取中文名和拉丁文名（假设格式为"中文名 拉丁名"）
        const nameParts = bacteria["名称"].split(" ");
        const chineseName = nameParts[0] || '';
        const latinName = nameParts.slice(1).join(" ") || ''; // 防止拉丁名有空格

        // 计算进度条百分比
        const progressPercentage = calculateProgressPercentage(detected);

        // 生成显示值的行
        const dataRow = `
        <tr>
          <td class="py-2 pl-4 pr-2 text-left harmful-gut-bacteria-first-column">
            <div class="harmful-gut-bacteria-chinese-text"><strong>${chineseName}</strong></div>
            <div class="harmful-gut-bacteria-latin-text">${latinName}</div>
          </td>
          <td class="py-2 px-4 text-center harmful-gut-bacteria-column-text harmful-gut-bacteria-second-column">
            <div class="flex items-center justify-center">
              <span style="color: ${status.color}">
                <strong>${detected === "ND" ? "ND" : detected}${status.icon}</strong>
              </span>
            </div>
            <!-- 进度条 -->
            <div
              class="progress-bar w-full mt-2"
              style="background-color: #e9ecef; height: 8px; border-radius: 4px; overflow: hidden;">
              <div class="progress"
                   style="width: ${progressPercentage}%;
                          height: 100%;
                          background-color: ${status.isNormal ? CORE_BACTERIA_CONSTANTS.COLORS.PRIMARY : CORE_BACTERIA_CONSTANTS.COLORS.RED};
                          transition: width 0.3s ease;">
              </div>
            </div>
          </td>
          <td class="py-2 px-4 text-center harmful-gut-bacteria-column-text harmful-gut-bacteria-third-column">
            ${bacteria["正常范围"]}
          </td>
          <td class="py-2 px-4 text-center harmful-gut-bacteria-column-text harmful-gut-bacteria-fourth-column">
            ${bacteria["%正常人有检出"] || "0%"}
          </td>
        </tr>
      `;

        // 生成描述行
        const descRow = createHarmfulDescriptionRow(bacteria, status);

        table.innerHTML = `<tbody>${dataRow}${descRow}</tbody>`;
        bacteriaContainer.appendChild(table);

        return bacteriaContainer;
      }

      // 主渲染函数
      function renderHarmfulBacteriaTable(bacteriaData) {
        const container = document.getElementById('harmful-bacteria-table-body');
        if (!container) {
          console.error('Cannot find container element: harmful-bacteria-table-body');
          return;
        }

        container.innerHTML = '';

        // 如果没有数据
        if (!bacteriaData || !Array.isArray(bacteriaData) || bacteriaData.length === 0) {
          container.innerHTML = '<div class="no-data-message">暂无数据</div>';
          return;
        }

        // 使用DocumentFragment批量处理DOM操作
        const fragment = document.createDocumentFragment();

        bacteriaData.forEach(bacteria => {
          if (bacteria) {  // 确保bacteria存在
            try {
              const bacteriaElement = createHarmfulBacteriaRow(bacteria);
              fragment.appendChild(bacteriaElement);
            } catch (error) {
              console.error('Error creating row for bacteria:', bacteria, error);
            }
          }
        });

        // 一次性添加所有元素到DOM
        container.appendChild(fragment);
      }

      // 页面加载时调用
      document.addEventListener('DOMContentLoaded', loadHarmfulBacteriaData);
    </script>

  </div>

  <!-- 常见机会致病菌版块 -->
  <h3 class="custom-title-1 page-break">常见机会致病菌</h3>

  <div
    class="bg-white rounded-lg p-5 mb-5 mx-auto"
    style="width: 100%;">

    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            <i class="fas fa-info-circle icon"></i>
            常见的机会致病菌是那些通常不致病，但在特定条件下（例如宿主免疫力降低、伤口感染等）可以引起疾病的微生物。以下是一些常见的机会致病菌：
          </p>
        </div>
      </div>
    </div>

    <!-- 常见机会致病菌表格 -->
    <div class="rounded-table">
      <!-- 主表格只包含标题 -->
      <table class="min-w-full">
        <thead>
        <tr style="background-color: #00B2B4; color: white;">
          <th
            class="py-2 px-4 text-left opportunistic-pathogen-first-column"
            style="font-size: 13px;">
            机会致病菌名称
          </th>
          <th
            class="py-2 px-4 text-center opportunistic-pathogen-second-column"
            style="font-size: 13px; padding: 5px 5px;">
            检测丰度%
          </th>
          <th
            class="py-2 px-4 text-center opportunistic-pathogen-third-column"
            style="font-size: 13px; padding: 5px 5px;">
            参考范围%
          </th>
        </tr>
        </thead>
      </table>

      <!-- 数据表格容器 -->
      <div id="opportunistic-pathogen-table-body">
        <!-- 数据将通过 JavaScript 动态插入 -->
      </div>
    </div>

    <script>
      // 使用命名空间封装机会致病菌相关代码
      const OpportunisticPathogen = {
        // 常量定义
        CONSTANTS: {
          COLORS: {
            RED: '#ff4d4f',
            GREEN: '#389e0d',
            GRAY: '#808080',
            PRIMARY: '#00B2B4',
            WARNING: '#FFA500',
            BLACK: '#000000'
          }
        },

        // 格式化数字
        formatNumber(value) {
          if (typeof value === "string" && value === "ND") return value;
          const num = Number(value);
          return num.toPrecision(2);
        },

        // 解析正常范围
        parseRange(rangeStr) {
          if (!rangeStr || typeof rangeStr !== 'string') {
            return { min: 0, max: 0 };
          }
          const parts = rangeStr.split('-');
          return {
            min: parseFloat(parts[0] || 0),
            max: parseFloat(parts[1] || 0)
          };
        },

        // 获取状态信息
        getStatus(detected, normalRange) {
          const { min, max } = normalRange;

          let status = {
            color: this.CONSTANTS.COLORS.BLACK,
            text: '正常',
            icon: '',
            isNormal: true
          };

          if (detected === "ND") {
            if (min > 0) {
              status.color = this.CONSTANTS.COLORS.RED;
              status.text = '偏低';
              status.icon = '<i class="fas fa-arrow-down ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>';
              status.isNormal = false;
            }
            return status;
          }

          const detectedNum = parseFloat(detected);

          if (detectedNum < min) {
            status.color = this.CONSTANTS.COLORS.RED;
            status.text = '偏低';
            status.icon = '<i class="fas fa-arrow-down ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>';
            status.isNormal = false;
          }
          else if (detectedNum > max) {
            status.color = this.CONSTANTS.COLORS.RED;
            status.text = '超标';
            status.icon = '<i class="fas fa-arrow-up ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>';
            status.isNormal = false;
          }

          return status;
        },

        // 创建描述行
        createDescriptionRow(bacteria, status) {
          let descriptionContent = '';

          if (bacteria["说明"] && bacteria["说明"].trim()) {
            descriptionContent += `
            <div class="flex items-start mb-0">
              <div class="ml-1">
                <p>
                  <i class="fas fa-info-circle" style="color: ${this.CONSTANTS.COLORS.PRIMARY};"></i>
                  ${bacteria["说明"]}
                </p>
              </div>
            </div>
          `;
          }

          if (descriptionContent.trim()) {
            return `
            <tr class="virus-desc-row">
              <td colspan="5" class="py-2 px-4 text-left">
                <div class="description-container text-gray-600" style="font-size: 11px;">
                  ${descriptionContent}
                </div>
              </td>
            </tr>
          `;
          }

          return '';
        },

        // 计算进度条百分比
        calculateProgress(value) {
          if (value === "ND" || value === 0) {
            return 0;
          }

          const num = Number(value);
          return Math.min(100, Math.max(5,
            num <= 1 ? num * 30 :
              num <= 10 ? 30 + (num - 1) * 5 :
                75 + (Math.min(num, 100) - 10) * 0.25
          ));
        },

        // 渲染表格
        renderTable(bacteriaData) {
          const container = document.getElementById('opportunistic-pathogen-table-body');
          if (!container) {
            console.error('Cannot find container element');
            return;
          }

          container.innerHTML = '';

          if (!bacteriaData || !Array.isArray(bacteriaData) || bacteriaData.length === 0) {
            container.innerHTML = '<div class="no-data-message">暂无数据</div>';
            return;
          }

          const fragment = document.createDocumentFragment();

          bacteriaData.forEach(bacteria => {
            if (!bacteria) return;

            const detected = bacteria["丰度%"];
            const normalRange = this.parseRange(bacteria["正常范围"]);
            const latinName = bacteria["名称"] || "";
            const chineseName = bacteria["中文名"] || "";

            const formattedDetectedValue = detected === "ND" ? detected : this.formatNumber(detected);
            const formattedMinRange = this.formatNumber(normalRange.min);
            const formattedMaxRange = this.formatNumber(normalRange.max);

            const status = this.getStatus(detected, normalRange);
            const progressPercentage = this.calculateProgress(detected === "ND" ? 0 : detected);

            const bacteriaContainer = document.createElement('div');
            bacteriaContainer.className = 'bacteria-info-container';

            const table = document.createElement('table');
            table.className = 'bacteria-table min-w-full';

            const dataRow = `
            <tr>
              <td class="py-2 pl-4 pr-2 text-left opportunistic-pathogen-first-column">
                <div class="opportunistic-pathogen-chinese-text">
                  <strong>${chineseName}</strong>
                </div>
                <div class="opportunistic-pathogen-latin-text">
                  ${latinName}
                </div>
              </td>
              <td class="py-2 px-4 text-center opportunistic-pathogen-column-text opportunistic-pathogen-second-column">
                <div class="flex items-center justify-center">
                  <span style="color: ${status.color}">
                    <strong>${detected === "ND" ? "ND" : detected}${status.icon}</strong>
                  </span>
                </div>
                <div
                    class="progress-bar w-full mt-2"
                    style="background-color: #e9ecef; height: 8px; border-radius: 4px; overflow: hidden;">
                  <div class="progress"
                       style="width: ${progressPercentage}%;
                              height: 100%;
                              background-color: ${status.isNormal ? this.CONSTANTS.COLORS.PRIMARY : this.CONSTANTS.COLORS.RED};
                              transition: width 0.3s ease;">
                  </div>
                </div>
              </td>
              <td class="py-2 px-4 text-center opportunistic-pathogen-column-text opportunistic-pathogen-third-column">
                ${bacteria["正常范围"]}
              </td>
            </tr>
          `;

            const descRow = this.createDescriptionRow(bacteria, status);

            table.innerHTML = `<tbody>${dataRow}${descRow}</tbody>`;
            bacteriaContainer.appendChild(table);
            fragment.appendChild(bacteriaContainer);
          });

          container.appendChild(fragment);
        },

        // 加载数据
        async loadData() {
          try {
            const response = await fetch(DATA_PATHS.DATA);
            if (!response.ok) {
              throw new Error(`Network response error: ${response.status}`);
            }
            const data = await response.json();
            this.renderTable(data["机会致病菌"] || []);
          } catch (error) {
            console.error('Error loading opportunistic pathogen data:', error);
            document.getElementById('opportunistic-pathogen-table-body').innerHTML =
              '<div class="no-data-message">暂无数据</div>';
          }
        },

        // 初始化
        init() {
          document.addEventListener('DOMContentLoaded', () => this.loadData());
        }
      };

      // 初始化机会致病菌模块
      OpportunisticPathogen.init();
    </script>
  </div>

  <!-- 常见致病菌版块 -->
  <h3 class="custom-title-1 page-break">常见致病菌</h3>

  <div
    class="bg-white rounded-lg p-5 mb-5 mx-auto"
    style="width: 100%;">

    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            <i class="fas fa-info-circle icon"></i>
            肠道致病菌是指能直接引起疾病的肠道病原微生物，它们具有明确的致病性，一旦在肠道中检出就可能对健康造成威胁。这类细菌通常具有特定的致病机制，如产生毒素、侵犯宿主细胞、触发炎症反应等。
          </p>
        </div>
      </div>
    </div>

    <!-- 常见致病菌表格 -->
    <div class="rounded-table">
      <table class="min-w-full">
        <thead>
        <tr style="background-color: #00B2B4; color: white;">
          <th
            class="py-2 px-4 text-left pathogenic-bacteria-first-column"
            style="font-size: 13px;">
            致病菌名称
          </th>
          <th
            class="py-2 px-4 text-center pathogenic-bacteria-second-column"
            style="font-size: 13px; padding: 5px 5px;">
            检测丰度%
          </th>
          <th
            class="py-2 px-4 text-center pathogenic-bacteria-third-column"
            style="font-size: 13px; padding: 5px 5px;">
            参考范围%
          </th>
        </tr>
        </thead>
      </table>

      <div id="gut-pathogenic-data-table-body">
        <!-- 数据将通过 JavaScript 动态插入 -->
      </div>
    </div>

    <script>
        // 致病菌数据展示模块
        const GutPathogenic = {
        // 常量定义
        CONSTANTS: {
        COLORS: {
        RED: '#ff4d4f',
        GREEN: '#389e0d',
        GRAY: '#808080',
        PRIMARY: '#00B2B4',
        BLACK: '#000000'
      }
      },

        // 格式化数字
        formatNumber(value) {
        if (typeof value === "string" && (value === "未检出" || value === "ND")) {
        return "未检出";
      }

        const num = Number(value);
        if (isNaN(num)) return value;
        return num.toPrecision(2);
      },

        // 解析正常范围
        parseRange(rangeStr) {
        if (!rangeStr || typeof rangeStr !== 'string') {
        return { min: 0, max: 0 };
      }
        const parts = rangeStr.split('-');
        return {
        min: parseFloat(parts[0] || 0),
        max: parseFloat(parts[1] || 0)
      };
      },

        // 获取状态信息
        getStatus(detected, normalRange) {
        const { min, max } = this.parseRange(normalRange);

        let status = {
        color: '#000000',
        text: '正常',
        icon: '',
        isNormal: true
      };

        if (detected === "ND" || detected === "未检出") {
        if (min > 0) {
        status.color = this.CONSTANTS.COLORS.RED;
        status.text = '偏低';
        status.icon = '<i class="fas fa-arrow-down ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>';
        status.isNormal = false;
      }
        return status;
      }

        const detectedNum = parseFloat(detected);

        if (detectedNum < min) {
        status.color = this.CONSTANTS.COLORS.RED;
        status.text = '偏低';
        status.icon = '<i class="fas fa-arrow-down ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>';
        status.isNormal = false;
      }
        else if (detectedNum > max) {
        status.color = this.CONSTANTS.COLORS.RED;
        status.text = '超标';
        status.icon = '<i class="fas fa-arrow-up ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>';
        status.isNormal = false;
      }

        return status;
      },

        // 创建描述行
        createDescriptionRow(bacteria) {
        let descriptionContent = '';

        if (bacteria["说明"] && bacteria["说明"].trim()) {
        descriptionContent += `
        <div class="flex items-start mb-0">
          <div class="ml-1">
            <p>
              <i class="fas fa-info-circle" style="color: ${this.CONSTANTS.COLORS.PRIMARY};"></i>
              ${bacteria["说明"]}
            </p>
          </div>
        </div>
      `;
      }

        if (descriptionContent.trim()) {
        return `
        <tr class="pathogenic-desc-row" style="page-break-before: avoid; break-before: avoid;">
          <td colspan="3" class="py-2 px-4 text-left">
            <div class="description-container text-gray-600" style="font-size: 11px;">
              ${descriptionContent}
            </div>
          </td>
        </tr>
      `;
      }

        return '';
      },

        // 计算进度条百分比
        calculateProgress(value) {
        if (value === "ND" || value === "未检出" || value === 0) {
        return 0;
      }

        const num = Number(value);
        return Math.min(100, Math.max(5,
        num <= 1 ? num * 30 :
        num <= 10 ? 30 + (num - 1) * 5 :
        75 + (Math.min(num, 100) - 10) * 0.25
        ));
      },

        // 渲染表格
        renderTable(pathogenicData) {
        const container = document.getElementById('gut-pathogenic-data-table-body');
        if (!container) {
        console.error('Cannot find container element');
        return;
      }

        container.innerHTML = '';

        if (!pathogenicData || !Array.isArray(pathogenicData) || pathogenicData.length === 0) {
        container.innerHTML = '<div class="no-data-message">暂无数据</div>';
        return;
      }

        const fragment = document.createDocumentFragment();

        pathogenicData.forEach(bacteria => {
        const detected = bacteria["丰度%"];
        const normalRange = bacteria["正常范围"];
        const latinName = bacteria["名称"];
        const chineseName = bacteria["中文名"];

        const status = this.getStatus(detected, normalRange);
        const progressPercentage = this.calculateProgress(detected === "ND" || detected === "未检出" ? 0 : detected);

        // 创建一个单独的容器来包裹每个菌种及其描述，防止分页断开
        const bacteriaContainer = document.createElement('div');
        bacteriaContainer.className = 'pathogenic-info-container';
        // 添加防止元素内部分页的CSS
        bacteriaContainer.style.pageBreakInside = 'avoid';
        bacteriaContainer.style.breakInside = 'avoid';

        const table = document.createElement('table');
        table.className = 'pathogenic-table min-w-full';
        // 也给表格添加防分页CSS
        table.style.pageBreakInside = 'avoid';
        table.style.breakInside = 'avoid';

        // 数据行添加防分页属性
        const dataRow = `
        <tr style="page-break-inside: avoid; break-inside: avoid;">
          <td class="py-2 px-4 text-left pathogenic-bacteria-first-column">
            <div class="pathogenic-bacteria-chinese-text">
              <strong>${chineseName}</strong>
            </div>
            <div class="pathogenic-bacteria-latin-text">
              ${latinName}
            </div>
          </td>
          <td class="py-2 px-4 text-center pathogenic-bacteria-column-text pathogenic-bacteria-second-column">
            <div class="flex items-center justify-center">
              <span style="color: ${status.color}">
                <strong>${detected === "ND" || detected === "未检出" ? "ND" : detected}${status.icon}</strong>
              </span>
            </div>
            <div
              class="progress-bar w-full mt-2"
              style="background-color: #e9ecef; height: 8px; border-radius: 4px; overflow: hidden;">
              <div class="progress"
                   style="width: ${progressPercentage}%;
                          height: 100%;
                          background-color: ${status.isNormal ? this.CONSTANTS.COLORS.PRIMARY : this.CONSTANTS.COLORS.RED};
                          transition: width 0.3s ease;">
              </div>
            </div>
          </td>
          <td class="py-2 px-4 text-center pathogenic-bacteria-column-text pathogenic-bacteria-third-column">
            ${normalRange}
          </td>
        </tr>
      `;

        const descRow = this.createDescriptionRow(bacteria);

        table.innerHTML = `<tbody style="page-break-inside: avoid; break-inside: avoid;">${dataRow}${descRow}</tbody>`;
        bacteriaContainer.appendChild(table);
        fragment.appendChild(bacteriaContainer);
      });

        container.appendChild(fragment);
      },

        // 加载数据
        async loadData() {
        try {
        const response = await fetch(DATA_PATHS.DATA);
        if (!response.ok) {
        throw new Error(`Network response error: ${response.status}`);
      }
        const data = await response.json();

        // 获取致病菌数据
        const pathogenicData = data["致病菌"] || [];
        this.renderTable(pathogenicData);
      } catch (error) {
        console.error('Error loading pathogenic bacteria data:', error);
        document.getElementById('gut-pathogenic-data-table-body').innerHTML =
        '<div class="no-data-message">暂无数据</div>';
      }
      },

        // 初始化
        init() {
        // 添加全局CSS规则防止分页问题
        const style = document.createElement('style');
        style.textContent = `
        /* 全局防止表格内分页 */
        .pathogenic-info-container {
          page-break-inside: avoid !important;
          break-inside: avoid !important;
        }

        /* 确保表格行不分离 */
        .pathogenic-table tbody tr {
          page-break-inside: avoid !important;
          break-inside: avoid !important;
        }

        /* 确保菌种描述与数据行不分离 */
        .pathogenic-desc-row {
          page-break-before: avoid !important;
          break-before: avoid !important;
        }

        /* 确保表格与其描述不分离 */
        .pathogenic-table tbody {
          page-break-inside: avoid !important;
          break-inside: avoid !important;
        }
      `;
        document.head.appendChild(style);

        document.addEventListener('DOMContentLoaded', () => this.loadData());
      }
      };

        // 初始化致病菌模块
        GutPathogenic.init();
    </script>
  </div>

  <!-- 常见真菌版块 -->
  <h3 class="custom-title-1 page-break">常见真菌</h3>

  <div
    class="bg-white rounded-lg p-5 mb-5 mx-auto"
    style="width: 100%;">

    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            <i class="fas fa-info-circle icon"></i>
            真菌检测对于评估免疫状态和潜在感染风险非常重要。尽管一些真菌在正常情况下不会引起健康问题，但对于免疫系统较弱的人群来说，持续监测是预防真菌感染的关键。下列是一些常见肠道真菌在您肠道中的检测情况。
          </p>
        </div>
      </div>
    </div>

    <!-- 常见真菌表格 -->
    <div class="rounded-table">
      <table class="min-w-full">
        <thead>
        <tr style="background-color: #00B2B4; color: white;">
          <th
            class="py-2 px-4 text-left fungi-first-column"
            style="font-size: 13px;">
            真菌名称
          </th>
          <th
            class="py-2 px-4 text-center fungi-second-column"
            style="font-size: 13px; padding: 5px 5px;">
            检测丰度%
          </th>
          <th
            class="py-2 px-4 text-center fungi-third-column"
            style="font-size: 13px; padding: 5px 5px;">
            参考范围%
          </th>
        </tr>
        </thead>
      </table>

      <div id="gut-fungi-data-table-body">
        <!-- 数据将通过 JavaScript 动态插入 -->
      </div>
    </div>

    <script>
      // 真菌数据展示模块
      const GutFungi = {
        // 常量定义
        CONSTANTS: {
          COLORS: {
            RED: '#ff4d4f',
            GREEN: '#389e0d',
            GRAY: '#808080',
            PRIMARY: '#00B2B4',
            BLACK: '#000000'
          }
        },

        // 格式化数字
        formatNumber(value) {
          if (typeof value === "string" && value === "ND") {
            return value;
          }

          const num = Number(value);
          return num.toPrecision(2);
        },

        // 解析正常范围
        parseRange(rangeStr) {
          if (!rangeStr || typeof rangeStr !== 'string') {
            return { min: 0, max: 0 };
          }
          const parts = rangeStr.split('-');
          return {
            min: parseFloat(parts[0] || 0),
            max: parseFloat(parts[1] || 0)
          };
        },

        // 获取状态信息
        getStatus(detected, normalRange) {
          const { min, max } = this.parseRange(normalRange);

          let status = {
            color: '#000000',
            text: '正常',
            icon: '',
            isNormal: true
          };

          if (detected === "ND") {
            if (min > 0) {
              status.color = this.CONSTANTS.COLORS.RED;
              status.text = '偏低';
              status.icon = '<i class="fas fa-arrow-down ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>';
              status.isNormal = false;
            }
            return status;
          }

          const detectedNum = parseFloat(detected);

          if (detectedNum < min) {
            status.color = this.CONSTANTS.COLORS.RED;
            status.text = '偏低';
            status.icon = '<i class="fas fa-arrow-down ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>';
            status.isNormal = false;
          }
          else if (detectedNum > max) {
            status.color = this.CONSTANTS.COLORS.RED;
            status.text = '超标';
            status.icon = '<i class="fas fa-arrow-up ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>';
            status.isNormal = false;
          }

          return status;
        },

        // 创建描述行
        createDescriptionRow(fungi, status) {
          let descriptionContent = '';

          if (fungi["说明"] && fungi["说明"].trim()) {
            descriptionContent += `
            <div class="flex items-start mb-0">
              <div class="ml-1">
                <p>
                  <i class="fas fa-info-circle" style="color: ${this.CONSTANTS.COLORS.PRIMARY};"></i>
                  ${fungi["说明"]}
                </p>
              </div>
            </div>
          `;
          }

          if (descriptionContent.trim()) {
            return `
            <tr class="fungi-desc-row">
              <td colspan="3" class="py-2 px-4 text-left">
                <div class="description-container text-gray-600" style="font-size: 11px;">
                  ${descriptionContent}
                </div>
              </td>
            </tr>
          `;
          }

          return '';
        },

        // 计算进度条百分比
        calculateProgress(value) {
          if (value === "ND" || value === 0) {
            return 0;
          }

          const num = Number(value);
          return Math.min(100, Math.max(5,
            num <= 1 ? num * 30 :
              num <= 10 ? 30 + (num - 1) * 5 :
                75 + (Math.min(num, 100) - 10) * 0.25
          ));
        },

        // 渲染表格
        renderTable(fungiData) {
          const container = document.getElementById('gut-fungi-data-table-body');
          if (!container) {
            console.error('Cannot find container element');
            return;
          }

          container.innerHTML = '';

          if (!fungiData || !Array.isArray(fungiData) || fungiData.length === 0) {
            container.innerHTML = '<div class="no-data-message">暂无数据</div>';
            return;
          }

          const fragment = document.createDocumentFragment();

          fungiData.forEach(fungi => {
            const detected = fungi["丰度%"];
            const normalRange = fungi["正常范围"];
            const latinName = fungi["名称"];
            const chineseName = fungi["中文名"];
            const evaluation = fungi["结果评价"];
            const exceededTimes = fungi["超标倍数"];

            const status = this.getStatus(detected, normalRange);
            const progressPercentage = this.calculateProgress(detected === "ND" ? 0 : detected);

            const fungiContainer = document.createElement('div');
            fungiContainer.className = 'fungi-info-container';

            const table = document.createElement('table');
            table.className = 'fungi-table min-w-full';

            const dataRow = `
              <tr>
                <td class="py-2 px-4 text-left fungi-first-column">
                  <div class="fungi-chinese-text">
                    <strong>${chineseName}</strong>
                  </div>
                  <div class="fungi-latin-text">
                    ${latinName}
                  </div>
                </td>
                <td class="py-2 px-4 text-center fungi-column-text fungi-second-column">
                  <div class="flex items-center justify-center">
                    <span style="color: ${status.color}">
                      <strong>${detected === "ND" ? "ND" : detected}${status.icon}</strong>
                    </span>
                  </div>
                  <div
                    class="progress-bar w-full mt-2"
                    style="background-color: #e9ecef; height: 8px; border-radius: 4px; overflow: hidden;">
                    <div class="progress"
                         style="width: ${progressPercentage}%;
                                height: 100%;
                                background-color: ${status.isNormal ? this.CONSTANTS.COLORS.PRIMARY : this.CONSTANTS.COLORS.RED};
                                transition: width 0.3s ease;">
                    </div>
                  </div>
                </td>
                <td class="py-2 px-4 text-center fungi-column-text fungi-third-column">
                  ${normalRange}
                </td>
              </tr>
            `;

            const descRow = this.createDescriptionRow(fungi, status);

            table.innerHTML = `<tbody>${dataRow}${descRow}</tbody>`;
            fungiContainer.appendChild(table);
            fragment.appendChild(fungiContainer);
          });

          container.appendChild(fragment);
        },

        // 加载数据
        async loadData() {
          try {
            const response = await fetch(DATA_PATHS.DATA);
            if (!response.ok) {
              throw new Error(`Network response error: ${response.status}`);
            }
            const data = await response.json();
            this.renderTable(data["真菌"] || []);
          } catch (error) {
            console.error('Error loading fungi data:', error);
            document.getElementById('gut-fungi-data-table-body').innerHTML =
              '<div class="no-data-message">暂无数据</div>';
          }
        },

        // 初始化
        init() {
          document.addEventListener('DOMContentLoaded', () => this.loadData());
        }
      };

      // 初始化真菌模块
      GutFungi.init();
    </script>
  </div>

  <!-- 肠道菌群检测 : 常见肠道寄生虫版块 -->
  <h3 class="custom-title-1 page-break">常见肠道寄生虫</h3>

  <div
    class="bg-white rounded-lg p-5 mb-5 mx-auto"
    style="width: 100%;">

    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            <i class="fas fa-info-circle icon"></i>
            肠道常见寄生虫检测对于评估肠道健康和潜在感染风险具有重要意义。虽然部分寄生虫在低水平时可能不会造成明显症状，但持续监测对预防寄生虫相关疾病至关重要。
          </p>
        </div>
      </div>
    </div>

    <!-- 常见肠道寄生虫表格 -->
    <div class="rounded-table">
      <table class="min-w-full">
        <thead>
        <tr style="background-color: #00B2B4; color: white;">
          <th
            class="py-2 px-4 text-left parasite-first-column"
            style="font-size: 13px;">
            寄生虫名称
          </th>
          <th
            class="py-2 px-4 text-center parasite-second-column"
            style="font-size: 13px; padding: 5px 5px;">
            检测丰度%
          </th>
          <th
            class="py-2 px-4 text-center parasite-third-column"
            style="font-size: 13px; padding: 5px 5px;">
            参考范围%
          </th>
        </tr>
        </thead>
      </table>

      <div id="gut-parasites-data-table-body">
        <!-- 数据将通过 JavaScript 动态插入 -->
      </div>
    </div>

    <script>
      // 寄生虫数据展示模块
      const GutParasites = {
        // 常量定义
        CONSTANTS: {
          COLORS: {
            RED: '#ff4d4f',
            GREEN: '#389e0d',
            GRAY: '#808080',
            PRIMARY: '#00B2B4'
          }
        },

        // 格式化数字
        formatNumber(value) {
          if (typeof value === "string" && value === "ND") {
            return value;
          }

          const num = Number(value);
          return num.toPrecision(2);
        },

        // 解析正常范围
        parseRange(rangeStr) {
          if (!rangeStr || typeof rangeStr !== 'string') {
            return { min: 0, max: 0 };
          }
          const parts = rangeStr.split('-');
          return {
            min: parseFloat(parts[0] || 0),
            max: parseFloat(parts[1] || 0)
          };
        },

        // 获取状态信息
        getStatus(detected, normalRange) {
          const { min, max } = this.parseRange(normalRange);

          let status = {
            color: '#000000',
            text: '正常',
            icon: '',
            isNormal: true
          };

          if (detected === "ND") {
            if (min > 0) {
              status.color = this.CONSTANTS.COLORS.RED;
              status.text = '偏低';
              status.icon = '<i class="fas fa-arrow-down ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>';
              status.isNormal = false;
            }
            return status;
          }

          const detectedNum = parseFloat(detected);

          if (detectedNum < min) {
            status.color = this.CONSTANTS.COLORS.RED;
            status.text = '偏低';
            status.icon = '<i class="fas fa-arrow-down ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>';
            status.isNormal = false;
          }
          else if (detectedNum > max) {
            status.color = this.CONSTANTS.COLORS.RED;
            status.text = '超标';
            status.icon = '<i class="fas fa-arrow-up ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>';
            status.isNormal = false;
          }

          return status;
        },

        // 创建描述行
        createDescriptionRow(parasite, status) {
          let descriptionContent = '';

          // 添加"说明"字段
          if (parasite["说明"] && parasite["说明"].trim()) {
            descriptionContent += `
            <div class="flex items-start mb-0">
              <div class="ml-1">
                <p>
                  <i class="fas fa-info-circle" style="color: ${this.CONSTANTS.COLORS.PRIMARY};"></i>
                  ${parasite["说明"]}
                </p>
              </div>
            </div>
          `;
          }

          // 添加超标倍数信息
          if (parasite["超标倍数"] && parasite["超标倍数"].trim() && !status.isNormal) {
            descriptionContent += `
            <div class="flex items-start mb-0">
              <div class="ml-1">
                <p>
                  <i class="fas fa-exclamation-triangle" style="color: ${this.CONSTANTS.COLORS.RED};"></i>
                  超标${parasite["超标倍数"]}倍
                </p>
              </div>
            </div>
          `;
          }

          if (descriptionContent.trim()) {
            return `
            <tr class="parasite-desc-row">
              <td colspan="4" class="py-2 px-4 text-left">
                <div class="description-container text-gray-600" style="font-size: 11px;">
                  ${descriptionContent}
                </div>
              </td>
            </tr>
          `;
          }

          return '';
        },

        // 计算进度条百分比
        calculateProgress(value) {
          if (value === "ND" || value === 0) {
            return 0;
          }

          const num = Number(value);
          return Math.min(100, Math.max(5,
            num <= 1 ? num * 30 :
              num <= 10 ? 30 + (num - 1) * 5 :
                75 + (Math.min(num, 100) - 10) * 0.25
          ));
        },

        // 渲染表格
        renderTable(parasitesData) {
          const container = document.getElementById('gut-parasites-data-table-body');
          if (!container) {
            console.error('Cannot find container element');
            return;
          }

          container.innerHTML = '';

          if (!parasitesData || !Array.isArray(parasitesData) || parasitesData.length === 0) {
            container.innerHTML = '<div class="no-data-message">暂无数据</div>';
            return;
          }

          const fragment = document.createDocumentFragment();

          parasitesData.forEach(parasite => {
            const detected = parasite["丰度%"];
            const normalRange = parasite["正常范围"];
            const latinName = parasite["名称"];
            const chineseName = parasite["中文名"];
            const evaluation = parasite["结果评价"];
            const exceededTimes = parasite["超标倍数"];

            const status = this.getStatus(detected, normalRange);
            const progressPercentage = this.calculateProgress(detected === "ND" ? 0 : detected);

            const parasiteContainer = document.createElement('div');
            parasiteContainer.className = 'parasite-info-container';

            const table = document.createElement('table');
            table.className = 'parasite-table min-w-full';

            const dataRow = `
              <tr>
                <td class="py-2 px-4 text-left parasite-first-column">
                  <div class="parasite-chinese-text">
                    <strong>${chineseName}</strong>
                  </div>
                  <div class="parasite-latin-text">
                    ${latinName}
                  </div>
                </td>
                <td class="py-2 px-4 text-center parasite-column-text parasite-second-column">
                  <div class="flex items-center justify-center">
                    <span style="color: ${status.color}">
                      <strong>${detected === "ND" ? "ND" : detected}${status.icon}</strong>
                    </span>
                  </div>
                  <div
                    class="progress-bar w-full mt-2"
                    style="background-color: #e9ecef; height: 8px; border-radius: 4px; overflow: hidden;">
                    <div class="progress"
                         style="width: ${progressPercentage}%;
                                height: 100%;
                                background-color: ${status.isNormal ? this.CONSTANTS.COLORS.PRIMARY : this.CONSTANTS.COLORS.RED};
                                transition: width 0.3s ease;">
                    </div>
                  </div>
                </td>
                <td class="py-2 px-4 text-center parasite-column-text parasite-third-column">
                  ${normalRange}
                </td>
              </tr>
            `;

            const descRow = this.createDescriptionRow(parasite, status);

            table.innerHTML = `<tbody>${dataRow}${descRow}</tbody>`;
            parasiteContainer.appendChild(table);
            fragment.appendChild(parasiteContainer);
          });

          container.appendChild(fragment);
        },

        // 加载数据
        async loadData() {
          try {
            const response = await fetch(DATA_PATHS.DATA);
            if (!response.ok) {
              throw new Error(`Network response error: ${response.status}`);
            }
            const data = await response.json();
            this.renderTable(data["寄生虫"] || []);
          } catch (error) {
            console.error('Error loading parasites data:', error);
            document.getElementById('gut-parasites-data-table-body').innerHTML =
              '<div class="no-data-message">暂无数据</div>';
          }
        },

        // 初始化
        init() {
          document.addEventListener('DOMContentLoaded', () => this.loadData());
        }
      };

      // 初始化寄生虫模块
      GutParasites.init();
    </script>
  </div>

  <!-- 肠道菌群检测 : 病毒版块 -->
  <h3 class="custom-title-1 page-break">肠道病毒</h3>

  <div class="bg-white rounded-lg p-5 mb-5 mx-auto" style="width: 100%;">

    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            <i class="fas fa-info-circle icon"></i>
            肠道微生物除了细菌外，还包含大量病毒。研究表明，健康人的肠道中约有数万种病毒，其中超过 90% 是噬菌体。下表展示了在您肠道中检测到的病毒，按病毒的检出丰度从高到低排列了前15位（如无检出将没有显示）。
          </p>
        </div>
      </div>
    </div>

    <!-- 病毒表格 -->
    <div class="rounded-table">
      <table class="min-w-full">
        <thead>
        <tr style="background-color: #00B2B4; color: white;">
          <th class="py-2 px-4 text-left gut-virus-first-column"
              style="font-size: 13px;">
            病毒名称
          </th>
          <th class="py-2 px-4 text-center gut-virus-second-column"
              style="font-size: 13px; padding: 5px 5px;">
            参考范围%
          </th>
          <th class="py-2 px-4 text-center gut-virus-third-column"
              style="font-size: 13px; padding: 5px 5px;">
            检测丰度%
          </th>
        </tr>
        </thead>
      </table>

      <div id="gut-virus-data-table-body">
        <!-- 数据将通过 JavaScript 动态插入 -->
      </div>
    </div>

    <script>
      // 肠道病毒数据展示模块
      const GutVirus = {
        // 常量定义
        CONSTANTS: {
          COLORS: {
            RED: '#ff4d4f',
            GREEN: '#389e0d',
            GRAY: '#808080',
            PRIMARY: '#00B2B4'
          }
        },

        // 格式化数字
        formatNumber(value) {
          if (value === undefined || value === null) return '';
          if (typeof value === "string" && value === "ND") return value;

          const num = Number(value);
          if (isNaN(num)) return value;

          if (num >= 1) {
            const integerDigits = Math.floor(Math.log10(num)) + 1;
            const decimalPlaces = Math.max(0, 4 - integerDigits);
            return num.toFixed(decimalPlaces);
          } else {
            const str = num.toPrecision(4);
            return str.replace(/\.?0+$/, '');
          }
        },

        // 解析正常范围
        parseRange(rangeStr) {
          if (!rangeStr || typeof rangeStr !== 'string') {
            return { min: 0, max: 0 };
          }
          const parts = rangeStr.split('-');
          return {
            min: parseFloat(parts[0] || 0),
            max: parseFloat(parts[1] || 0)
          };
        },

        // 计算进度条百分比
        calculateProgressPercentage(value) {
          if (value === "ND" || value === 0) {
            return 0;
          }

          const num = Number(value);
          const logValue = Math.log10(num);
          const minLog = -3; // log10(0.001)
          const maxLog = 2;  // log10(100)

          const percentage = ((logValue - minLog) / (maxLog - minLog)) * 45 + 5;
          return Math.max(5, Math.min(50, percentage));
        },

        // 获取状态信息
        getStatus(detected, normalRange) {
          const { min, max } = this.parseRange(normalRange);

          let status = {
            color: this.CONSTANTS.COLORS.GREEN,
            text: '正常',
            icon: '',
            isNormal: true
          };

          if (detected === "ND") {
            if (min > 0) {
              status.color = this.CONSTANTS.COLORS.RED;
              status.text = '偏低';
              status.icon = '<i class="fas fa-arrow-down ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>';
              status.isNormal = false;
            }
            return status;
          }

          const detectedNum = parseFloat(detected);

          if (detectedNum < min) {
            status.color = this.CONSTANTS.COLORS.RED;
            status.text = '偏低';
            status.icon = '<i class="fas fa-arrow-down ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>';
            status.isNormal = false;
          }
          else if (detectedNum > max) {
            status.color = this.CONSTANTS.COLORS.RED;
            status.text = '超标';
            status.icon = '<i class="fas fa-arrow-up ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>';
            status.isNormal = false;
          }

          return status;
        },

        // 创建描述行
        createDescriptionRow(virus, status) {
          let descriptionContent = '';

          // 添加"说明"字段
          if (virus["说明"] && virus["说明"].trim()) {
            descriptionContent += `
              <div class="flex items-start mb-0">
                <div class="ml-1">
                  <p>
                    <i class="fas fa-info-circle" style="color: ${this.CONSTANTS.COLORS.PRIMARY};"></i>
                    ${virus["说明"]}
                  </p>
                </div>
              </div>
            `;
          }

          // 添加超标信息
          if (!status.isNormal && virus["超标倍数"] && virus["超标倍数"].trim()) {
            descriptionContent += `
              <div class="flex items-start mb-0">
                <div class="ml-1">
                  <p>
                    <i class="fas fa-exclamation-triangle" style="color: ${this.CONSTANTS.COLORS.RED};"></i>
                    超标${virus["超标倍数"]}倍
                  </p>
                </div>
              </div>
            `;
          }

          if (descriptionContent.trim()) {
            return `
              <tr class="virus-desc-row">
                <td colspan="4" class="py-2 px-4 text-left">
                  <div class="description-container text-gray-600" style="font-size: 11px;">
                    ${descriptionContent}
                  </div>
                </td>
              </tr>
            `;
          }

          return '';
        },

        // 渲染表格
        renderTable(virusData) {
          const container = document.getElementById('gut-virus-data-table-body');
          if (!container) {
            console.error('Cannot find container element');
            return;
          }

          container.innerHTML = '';

          if (!virusData || !Array.isArray(virusData) || virusData.length === 0) {
            container.innerHTML = '<div class="no-data-message">暂无数据</div>';
            return;
          }

          const fragment = document.createDocumentFragment();

          virusData.forEach(virus => {
            const detected = virus["丰度%"];
            const normalRange = virus["正常范围"];
            const latinName = virus["名称"];
            const chineseName = virus["中文名"] && virus["中文名"].trim() ? virus["中文名"] : latinName;

            const status = this.getStatus(detected, normalRange);
            const formattedDetectedValue = this.formatNumber(detected);
            const { min, max } = this.parseRange(normalRange);
            const formattedMinRange = this.formatNumber(min);
            const formattedMaxRange = this.formatNumber(max);
            const progressPercentage = this.calculateProgressPercentage(detected === "ND" ? 0 : detected);

            const virusContainer = document.createElement('div');
            virusContainer.className = 'virus-info-container';

            const table = document.createElement('table');
            table.className = 'virus-table min-w-full';

            const dataRow = `
              <tr>
                <td class="py-2 px-4 text-left gut-virus-first-column">
                  <div class="gut-virus-chinese-text"><strong>${chineseName}</strong></div>
                  ${chineseName !== '' ? `<div class="gut-virus-latin-text">${latinName}</div>` : ''}
                </td>
                <td class="py-2 px-4 text-center gut-virus-column-text gut-virus-second-column">
                  <div class="flex items-center justify-center">
                    <span style="color: ${status.isNormal ? '#000000' : status.color}">
                      <strong>${detected === "ND" ? "ND" : detected}${status.icon}</strong>
                    </span>
                  </div>
                  <div class="progress-bar w-full mt-2"
                       style="background-color: #e9ecef; height: 8px; border-radius: 4px; overflow: hidden;">
                    <div class="progress"
                         style="width: ${progressPercentage}%;
                                height: 100%;
                                background-color: ${status.isNormal ? this.CONSTANTS.COLORS.PRIMARY : status.color};
                                transition: width 0.3s ease;">
                    </div>
                  </div>
                </td>
                 <td class="py-2 px-4 text-center gut-virus-column-text gut-virus-third-column">
                  ${formattedMinRange}-${formattedMaxRange}
                </td>
              </tr>
            `;

            const descRow = this.createDescriptionRow(virus, status);

            table.innerHTML = `<tbody>${dataRow}${descRow}</tbody>`;
            virusContainer.appendChild(table);
            fragment.appendChild(virusContainer);
          });

          container.appendChild(fragment);
        },

        // 加载数据
        async loadData() {
          try {
            const response = await fetch(DATA_PATHS.DATA);
            if (!response.ok) {
              throw new Error(`Network response error: ${response.status}`);
            }

            const data = await response.json();

            // 首先查找嵌套的结构: "检出菌" -> "Viruses"
            if (data["检出菌"] && data["检出菌"]["Viruses"] && Array.isArray(data["检出菌"]["Viruses"])) {
              this.renderTable(data["检出菌"]["Viruses"]);
              return;
            }

            // 备选1: 直接查找 "Viruses"
            if (data["Viruses"] && Array.isArray(data["Viruses"])) {
              this.renderTable(data["Viruses"]);
              return;
            }

            // 备选2: 查找中文键名 "病毒"
            if (data["病毒"] && Array.isArray(data["病毒"])) {
              this.renderTable(data["病毒"]);
              return;
            }

            // 备选3: 查找可能的嵌套结构 "detected_microbes" -> "Viruses"
            if (data["detected_microbes"] && data["detected_microbes"]["Viruses"] &&
              Array.isArray(data["detected_microbes"]["Viruses"])) {
              this.renderTable(data["detected_microbes"]["Viruses"]);
              return;
            }

            // 备选4: 旧格式
            if (data.gut_virus_data && Array.isArray(data.gut_virus_data)) {
              // 转换旧格式到新格式
              const convertedData = data.gut_virus_data.map(item => ({
                "名称": item.latin_name || "",
                "中文名": item.chinese_name || "",
                "丰度%": item.detected_abundance || "0",
                "正常范围": `${item.normal_range?.normal_range_min || 0}-${item.normal_range?.normal_range_max || 0}`,
                "超标倍数": item.exceed_times || "",
                "说明": item.description || ""
              }));
              this.renderTable(convertedData);
              return;
            }

            // 没有找到数据
            document.getElementById('gut-virus-data-table-body').innerHTML =
              '<div class="no-data-message">暂无数据</div>';

          } catch (error) {
            console.error('Error loading virus data:', error);
            document.getElementById('gut-virus-data-table-body').innerHTML =
              '<div class="no-data-message">暂无数据</div>';
          }
        },

        // 初始化
        init() {
          if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => this.loadData());
          } else {
            this.loadData();
          }
        }
      };

      // 初始化肠道病毒模块
      GutVirus.init();
    </script>
  </div>


<!--  &lt;!&ndash; 肠道菌群抗性和基因分布板块 &ndash;&gt;-->

  <!-- 耐药基因板块 -->
  <h3 class="custom-title-third-level page-break">耐药基因分布</h3>

  <div class="bg-white rounded-lg p-5 mb-5 mx-auto" style="width: 100%;">
    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            <i class="fas fa-info-circle icon"></i>
            耐药基因是指能够使微生物对抗生素产生抵抗力的基因序列，这些基因可以通过编码特定蛋白质，使微生物具备各种耐药机制，如药物降解、药物外排、靶点改变等。耐药基因的存在使得抗生素治疗变得困难，增加了感染治疗的挑战。
          </p>
          <p>下列是您肠道中检出的耐药基因，按照相关耐药基因片段reads数量递减排列。</p>
        </div>
      </div>
    </div>

    <!-- 耐药基因表格 -->
    <div class="rounded-table">
      <table class="min-w-full">
        <thead>
        <tr style="background-color: #00B2B4; color: white;">
          <th class="py-2 px-4 text-left ar-col-source" style="font-size: 11px;">
            来源菌株
          </th>
          <th class="py-2 px-4 text-center ar-col-gene" style="font-size: 11px;">
            耐药基因
          </th>
          <th class="py-2 px-2 text-center ar-col-reads" style="font-size: 11px; padding: 5px 2px;">
            reads数量
          </th>
          <!-- 减小分类列的左右内边距 -->
          <th class="py-2 text-center ar-col-type" style="font-size: 11px; padding: 5px 2px;">
            分类
          </th>
          <!-- 修改药物分类列表头的右内边距 -->
          <th class="py-2 text-right ar-col-drug-type" style="font-size: 11px; padding: 5px 4px 5px 1px;">
            药物分类
          </th>
          <th class="py-2 px-4 text-right ar-col-drugs" style="font-size: 11px;">
            耐药药物
          </th>
        </tr>
        </thead>
      </table>

      <div id="resist-genes-data-table-body">
        <!-- 数据将通过 JavaScript 动态插入 -->
      </div>
    </div>

    <script>
      async function loadResistanceData() {
        try {
          const response = await fetch(DATA_PATHS.DATA);
          const data = await response.json();

          // 按reads数量降序排序，确保将reads数量转换为数字
          const sortedData = [...data["耐药基因"]].sort((a, b) =>
            parseInt(b["reads数量"] || "0") - parseInt(a["reads数量"] || "0")
          );

          renderResistanceTable(sortedData);
        } catch (error) {
          console.error('Error loading resistance data:', error);
        }
      }

      function renderResistanceTable(resistanceData) {
        const container = document.getElementById('resist-genes-data-table-body');
        if (!container) {
          console.error('Resistance table body not found');
          return;
        }

        container.innerHTML = '';

        // 过滤和处理数据
        const filteredData = resistanceData.filter(item =>
          item["来源菌"] !== "" && item["耐药基因"] !== ""
        ).map(item => ({
          ...item,
          // 如果 reads数量 为空字符串，设置为 0
          "reads数量": item["reads数量"] === "" ? "0" : item["reads数量"]
        }));

        filteredData.forEach((item, index) => {
          const resistanceContainer = document.createElement('div');
          resistanceContainer.className = 'ar-resistance-info-container';

          const table = document.createElement('table');
          table.className = 'ar-resistance-table min-w-full';

          // 拆分药物分类和药物名称以进行堆叠显示
          const drugTypes = item["药物分类"] ? item["药物分类"].split('/') : [];
          const drugs = item["药物"] ? item["药物"].split('/') : [];

          // 创建表格行
          const dataRow = `
    <tr class="ar-resistance-row ${index % 2 === 1 ? 'ar-row-alternate' : ''}">
      <td class="py-2 px-4 text-left ar-col-source">
        <div class="ar-chinese-text">${item["来源菌"] || ''}</div>
      </td>
      <td class="py-2 px-4 text-center ar-col-gene">
        <div class="ar-gene-name">${item["耐药基因"] || ''}</div>
      </td>
      <td class="py-2 px-4 text-center ar-col-reads">
        <div class="ar-reads-count">${item["reads数量"]}</div>
      </td>
      <!-- 减小分类列的左右内边距 -->
      <td class="py-2 px-2 text-center ar-col-type">
        <div class="ar-resistance-type">${item["分类"] || ''}</div>
      </td>
      <td class="py-2 px-4 text-right ar-col-drug-type">
        <div class="ar-stack-container-right">
          ${drugTypes.map(type => `
            <div class="ar-stack-item-right">${type.trim()}</div>
          `).join('')}
        </div>
      </td>
      <td class="py-2 px-4 text-right ar-col-drugs">
        <div class="ar-stack-container-right">
          ${drugs.map(drug => `
            <div class="ar-stack-item-right">${drug.trim()}</div>
          `).join('')}
        </div>
      </td>
    </tr>
  `;

          table.innerHTML = `<tbody>${dataRow}</tbody>`;
          resistanceContainer.appendChild(table);
          container.appendChild(resistanceContainer);
        });
      }

      // 页面加载时加载数据
      document.addEventListener('DOMContentLoaded', loadResistanceData);
    </script>

    <style>
      /* 耐药基因表格专用样式 */
      .ar-rounded-table {
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }

      .ar-resistance-info-container {
        /* 移除行横线 */
        border-bottom: none;
      }

      .ar-resistance-info-container:last-child {
        border-bottom: none;
      }

      .ar-resistance-table {
        width: 100%;
        border-collapse: collapse;
      }

      .ar-resistance-row {
        background-color: #fff;
        transition: background-color 0.2s ease;
      }

      /* 隔行灰色背景 */
      .ar-row-alternate {
        background-color: #f9f9f9;
      }

      .ar-resistance-row:hover {
        background-color: #f0f7fa;
      }

      /* 表格列宽设置 */
      .ar-col-source {
        width: 33%;
      }

      .ar-col-gene {
        width: 18%;
      }

      .ar-col-reads {
        width: 11%;
      }

      .ar-col-type {
        width: 12%;
        /* 减小分类列的CSS样式内边距 */
        padding-left: 2px !important;
        padding-right: 2px !important;
      }

      .ar-col-drug-type {
        width: 12%;
        padding-right: 4px;
        padding-left: 1px;
      }

      .ar-col-drugs {
        width: 14%;
      }

      /* 特定内容样式 */
      .ar-chinese-text {
        font-size: 10px;
        color: #4a5568;
        font-weight: 500;
      }

      .ar-gene-name {
        font-size: 10px;
        color: #2d3748;
        font-weight: 600;
        /* 移除特殊字体 */
      }

      .ar-reads-count {
        font-size: 10px;
        font-weight: 600;
        text-align: center;
        padding: 4px 5px; /* 调大上下内间距 */
        border-radius: 4px;
        display: inline-block;
        min-width: 50px;
        /* 统一灰色背景 */
        background-color: #e9e9e9;
        color: #4A5568;
      }

      /* 移除不同颜色的背景样式 */
      .ar-high, .ar-medium, .ar-low {
        background-color: #e9e9e9;
        color: #4A5568;
      }

      .ar-resistance-type {
        font-size: 10px;
        font-weight: 500;
        color: #4a5568;
        text-align: center;
        /* 减小分类文本内部的内边距 */
        padding: 2px 0px;
        /* 移除背景色 */
        background-color: transparent;
        border-radius: 0;
        display: inline-block;
      }

      /* 原始堆叠样式 - 保留但不再使用 */
      .ar-stack-container {
        display: flex;
        flex-direction: column;
        gap: 4px;
        align-items: center;
      }

      .ar-stack-item {
        font-size: 10px;
        padding: 2px 6px;
        color: #4A5568;
        width: fit-content;
        max-width: 100%;
        text-align: right;
        white-space: normal;
        word-break: break-word;
      }

      /* 新的右对齐堆叠样式 */
      .ar-stack-container-right {
        display: flex;
        flex-direction: column;
        gap: 4px;
        align-items: flex-end; /* 靠右对齐 */
        width: 100%;
      }

      .ar-stack-item-right {
        font-size: 10px;
        padding: 2px 0px 2px 0px; /* 上 右 下 左 - 减少右边距，增加左边距 */
        color: #4A5568;
        width: fit-content;
        max-width: 100%;
        text-align: right;
        white-space: normal;
        word-break: break-word;
      }
    </style>
  </div>


  <!-- 毒力基因板块 -->
  <h3
    class="custom-title-third-level page-break">
    毒力基因分布
  </h3>

  <div
    class="bg-white rounded-lg p-5 mb-5 mx-auto"
    style="width: 100%;">

    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            <i class="fas fa-info-circle icon"></i>
            毒力基因是指一类生物体内的基因，通过编码特定的蛋白质，使病原菌能够造成宿主细胞的伤害，从而引发感染和疾病。这些基因广泛存在于各种病原菌中，例如细菌、病毒和真菌，能够增强其致病能力和生存优势。
          </p>
<!--          <ul class="list-disc ml-5">-->
<!--            <li>-->
<!--              <strong>作用机制</strong>：-->
<!--              <ul class="list-disc ml-5">-->
<!--                <li>细胞破坏：通过产生毒素或酶破坏宿主细胞结构，从而导致宿主细胞死亡。</li>-->
<!--                <li>免疫逃逸：通过抑制宿主免疫反应，帮助病原体在宿主体内存活和繁殖。</li>-->
<!--                <li>定殖能力：促进病原体在宿主组织中的定殖和生长，增强感染的能力。</li>-->
<!--              </ul>-->
<!--            </li>-->
<!--            <li>-->
<!--              <strong>常见毒力基因</strong>：-->
<!--              <ul class="list-disc ml-5">-->
<!--                <li>shiga toxin (stx)：由志贺氏菌产生，能够抑制宿主蛋白合成，引发严重的肠道疾病。</li>-->
<!--                <li>enterotoxin (eae)：由某些大肠杆菌产生，能够引发腹泻和肠炎。</li>-->
<!--                <li>cholera toxin (ctx)：由霍乱弧菌产生，导致宿主细胞大量排泄水分，造成失水和电解质紊乱。</li>-->
<!--                <li>pore-forming toxins (PFTs)：能够在宿主细胞膜上形成孔洞，破坏细胞完整性。</li>-->
<!--                <li>adhesin genes：促进细菌与宿主细胞结合，从而增强感染能力。</li>-->
<!--              </ul>-->
<!--            </li>-->
<!--          </ul>-->
          <p>下列是您肠道中检出的毒力基因，按照相关毒力基因片段reads数量递减排列。</p>
        </div>
      </div>
    </div>

    <!-- 毒力基因表格 -->
    <div class="rounded-table">
      <table class="min-w-full">
        <thead>
        <tr style="background-color: #00B2B4; color: white;">
          <th class="py-2 px-4 text-left metal-tolerance-first-column"
              style="font-size: 11px;">
            来源菌株
          </th>
          <th class="py-2 px-4 text-center metal-tolerance-second-column"
              style="font-size: 11px; padding: 5px 5px;">
            毒力基因
          </th>
<!--          <th class="py-2 px-4 text-right metal-tolerance-third-column"-->
<!--              style="font-size: 11px;-->
<!--              padding: 5px 20px 5px 5px;"-->
<!--          >-->
<!--            机制类型-->
<!--          </th>-->
          <th class="py-2 px-4 text-center metal-tolerance-fourth-column"
              style="font-size: 11px; padding: 5px 5px;">
            reads数量
          </th>
          <th class="py-2 px-4 text-center metal-tolerance-fifth-column"
              style="font-size: 11px; padding: 5px 5px 5px 5px;">
            检测结果
          </th>
        </tr>
        </thead>
      </table>

      <div id="virulence-genes-data-table-body">
        <!-- 数据将通过 JavaScript 动态插入 -->
      </div>

      <script>
        async function loadVirulenceData() {
          try {
            const response = await fetch(DATA_PATHS.DATA);
            const data = await response.json();
            // data.virulence_genes_data.sort((a, b) => b.reads_count - a.reads_count);
            renderVirulenceTable(data.virulence_genes_data);
          } catch (error) {
            console.error('Error loading resistance data:', error);
          }
        }

        function renderVirulenceTable(resistanceData) {
          const container = document.getElementById('virulence-genes-data-table-body');
          if (!container) {
            console.error('Resistance table body not found');
            return;
          }

          container.innerHTML = '';

          resistanceData.forEach(resistance => {
            const resistanceContainer = document.createElement('div');
            resistanceContainer.className = 'resistance-info-container';

            const table = document.createElement('table');
            table.className = 'resistance-table min-w-full';

            // 修改 renderVirulenceTable 函数中的 dataRow 模板
            const dataRow = `
              <tr class="resistance-row">
                <td class="py-2 px-4 text-left metal-tolerance-first-column">
                  <div class="chinese-text">${resistance.chinese_name}</div>
                  <div class="latin-text">${resistance.latin_name}</div>
                </td>
                <td class="py-2 px-4 text-center resistance-column-text metal-tolerance-second-column">
                  <div class="genes-and-reads-stack-container">
                    ${resistance.resistance_gene.map(gene => `
                      <div class="stack-item">
                        <span class="resistance-gene">${gene}</span>
                      </div>
                    `).join('')}
                  </div>
                </td>

                <td class="py-2 px-4 text-center resistance-column-text metal-tolerance-fourth-column">
                  <div class="genes-and-reads-stack-container">
                    ${resistance.reads_count.map(count => `
                      <div class="stack-item">
                        <span class="reads-count ${parseInt(count) > 0 ? 'high' : 'low'}">
                          ${count}
                        </span>
                      </div>
                    `).join('')}
                  </div>
                </td>
                <td class="py-2 px-4 text-center resistance-column-text metal-tolerance-fifth-column">
                  <div class="genes-and-reads-stack-container">
                    ${resistance.resistance_drugs.map((drug, index) => `
                      <div class="stack-item">
                        <span class="reads-count ${parseInt(resistance.reads_count[index]) > 0 ? 'high' : 'low'}">
                          ${drug}
                        </span>
                      </div>
                    `).join('')}
                  </div>
                </td>
              </tr>
            `;

            table.innerHTML = `<tbody>${dataRow}</tbody>`;
            resistanceContainer.appendChild(table);
            container.appendChild(resistanceContainer);
          });
        }

        // 页面加载时加载数据
        document.addEventListener('DOMContentLoaded', loadVirulenceData);
      </script>

    </div>

  </div>

<!--  &lt;!&ndash; 菌群代谢物及神经递质评估板块 ： 首页 &ndash;&gt;-->

<!--  <h1 class="custom-title-1 page-break">菌群代谢物及神经递质评估</h1>-->

<!--  <div-->
<!--    class="bg-white rounded-lg p-5 mb-5 mx-auto"-->
<!--    style="width: 100%;"-->
<!--  >-->

<!--    &lt;!&ndash; 信息框 &ndash;&gt;-->
<!--    <div class="info-box">-->
<!--      <div class="flex items-start">-->
<!--        <div class="ml-2">-->
<!--          <p class="text-lg text-custom-teal">-->
<!--            <i class="fas fa-info-circle icon"></i>-->
<!--            菌群代谢物和神经递质是肠道微生物与宿主相互作用的重要媒介，已发现数百种不同的活性分子。这些代谢物在维持肠道健康和影响宿主生理功能方面发挥着关键作用。健康成年人肠道中的主要代谢产物包括短链脂肪酸（SCFAs）、胆汁酸、色氨酸代谢物和神经递质等。以下是对这些代谢物的详细介绍。-->
<!--          </p>-->
<!--        </div>-->
<!--      </div>-->
<!--    </div>-->

<!--    &lt;!&ndash;  免疫指标总结信息模块化图表 &ndash;&gt;-->
<!--    <div class="metabolism-card">-->
<!--      <div class="metabolism-icon-box organic-acid">-->
<!--        <i class="fas fa-flask"></i>-->
<!--        短链脂肪酸-->
<!--      </div>-->
<!--      <div class="metabolism-content-box">-->
<!--        短链脂肪酸（Short-Chain Fatty Acids，SCFAs）是指由2到6个碳原子组成的脂肪酸，主要在大肠内由肠道益生菌对可发酵纤维素和碳水化合物进行发酵而产生。最常见的短链脂肪酸包括乙酸、丙酸和丁酸。-->
<!--      </div>-->
<!--    </div>-->

<!--    <div class="metabolism-card">-->
<!--      <div class="metabolism-icon-box neuroactive">-->
<!--        <i class="fas fa-brain"></i>-->
<!--        神经活性物质-->
<!--      </div>-->
<!--      <div class="metabolism-content-box">-->
<!--        神经活性物质包括包括神经递质（如GABA、5-HT）等，影响神经系统功能和行为调节。-->
<!--      </div>-->
<!--    </div>-->

<!--&lt;!&ndash;    <div class="metabolism-card">&ndash;&gt;-->
<!--&lt;!&ndash;      <div class="metabolism-icon-box nitrogen-sulfur">&ndash;&gt;-->
<!--&lt;!&ndash;        <i class="fas fa-atom"></i>&ndash;&gt;-->
<!--&lt;!&ndash;        含氮含硫化合物&ndash;&gt;-->
<!--&lt;!&ndash;      </div>&ndash;&gt;-->
<!--&lt;!&ndash;      <div class="metabolism-content-box">&ndash;&gt;-->
<!--&lt;!&ndash;        含氮含硫化合物包括氨基酸代谢物和含硫化合物，参与多种生理过程和代谢调节。&ndash;&gt;-->
<!--&lt;!&ndash;      </div>&ndash;&gt;-->
<!--&lt;!&ndash;    </div>&ndash;&gt;-->

<!--    <div class="metabolism-card">-->
<!--      <div class="metabolism-icon-box other-metabolites">-->
<!--        <i class="fas fa-vial"></i>-->
<!--        其他代谢物-->
<!--      </div>-->
<!--      <div class="metabolism-content-box">-->
<!--        其他代谢物包括各类次级代谢产物，在机体代谢网络中发挥多样化的调节作用。-->
<!--      </div>-->
<!--    </div>-->

<!--  </div>-->

  <!-- 菌群代谢物及神经递质评估板块 : 其他代谢物评估 -->
  <h2
    class="custom-title-1 page-break">
    菌群代谢物评估
  </h2>

  <div
    class="bg-white rounded-lg p-5 mb-5 mx-auto"
    style="width: 100%;">

    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            <i class="fas fa-info-circle icon"></i>
            菌群代谢物和神经递质是肠道微生物与宿主相互作用的重要媒介，已发现数百种不同的活性分子。这些代谢物在维持肠道健康和影响宿主生理功能方面发挥着关键作用。健康成年人肠道中的主要代谢产物包括短链脂肪酸（SCFAs）、胆汁酸、色氨酸代谢物和神经递质等。以下是对这些代谢物的详细介绍。
          </p>
        </div>
      </div>
    </div>

    <!-- 菌群代谢物总表格 -->
    <div class="rounded-table">
      <table class="min-w-full">
        <thead>
        <tr style="background-color: #00B2B4; color: white;">
          <th class="py-2 px-4 text-left gut-microbial-metabolites-first-column"
              style="font-size: 13px;">
            菌群代谢物名称
          </th>
          <th class="py-2 px-4 text-center gut-microbial-metabolites-second-column"
              style="font-size: 13px; padding: 5px 5px;">
            参考范围
          </th>
          <th class="py-2 px-4 text-center gut-microbial-metabolites-third-column"
              style="font-size: 13px; padding: 5px 5px;">
            评估数值
          </th>
          <th class="py-2 px-4 text-center gut-microbial-metabolites-fourth-column"
              style="font-size: 13px; padding: 5px 5px;">
            评估结果
          </th>
        </tr>
        </thead>
      </table>

      <div id="other-metabolites-data-table-body">
        <!-- Data rows will be generated by Javascript code dynamically -->
      </div>

      <script>
        // 其他代谢物评估模块
        const OtherMetabolitesAssessment = {
          // 常量定义
          CONSTANTS: {
            COLORS: {
              RED: '#ff4d4f',     // 偏低或超标（红色）
              GREEN: '#52c41a',   // 正常（绿色）
              GRAY: '#808080',    // 灰色
              PRIMARY: '#00B2B4'  // 主题色
            }
          },

          // 代谢物介绍数据库 - 针对特定数据项的专业介绍
          METABOLITES_INFO: {
            "丁酸盐（Butyrate）": "短链脂肪酸，由肠道菌群通过发酵膳食纤维产生，为结肠细胞提供主要能量来源，维持肠道屏障完整性，具有抗炎和抗肿瘤作用。",
            "γ-氨基丁酸（GABA）": "主要抑制性神经递质，由谷氨酸脱羧酶作用于谷氨酸形成，调节神经系统活动，促进放松，减轻焦虑，改善睡眠质量。",
            "谷氨酸（Glutamate）": "最丰富的兴奋性神经递质，参与神经突触传递，对学习、记忆和认知功能至关重要，同时也是多种神经递质的前体物质。",
            "丙酸盐（Propionate）": "短链脂肪酸，肠道菌群代谢产物，调节食欲和能量代谢，降低血糖和胆固醇水平，具有抗炎作用，参与肠-脑轴通讯。",
            "对甲酚（p-Cresol）": "由肠道菌群代谢酪氨酸产生的芳香族化合物，高浓度时可作为尿毒症毒素，影响肠道屏障和神经发育，与多种疾病相关。",
            "血清素（5-HT）": "重要的神经递质和激素，调节情绪、睡眠、食欲和疼痛感知，肠道中产生的5-HT占体内总量的90%，参与肠道蠕动和免疫调节。",
            "乙酸盐（Acetate）": "最丰富的短链脂肪酸，被肝脏、肌肉和脑部利用产生能量，调节食欲和能量代谢，具有抗炎和免疫调节作用。",
            "异戊酸盐（Isovaleric）": "支链短链脂肪酸，由特定菌群代谢支链氨基酸产生，高浓度时可能具有神经毒性，影响能量代谢和神经系统功能。",
            "色氨（Tryptophan）": "必需氨基酸，是血清素和烟酸的前体，参与调节情绪、睡眠和免疫功能，肠道菌群可影响其代谢途径，进而影响宿主健康。",
            "DOPAC": "多巴胺的主要代谢产物，反映多巴胺的代谢和转换情况，与多巴胺能神经功能和神经退行性疾病相关，是评估多巴胺系统活性的指标。",
            "雌激素（Estrogen）": "性激素，由肠道菌群参与代谢和循环，影响生殖系统、骨骼健康、心血管系统和神经系统功能，肠道菌群可调节其活性。",
            "多巴胺": "重要的神经递质，参与奖励和动机系统，调节运动功能、情绪和认知过程，肠道菌群可通过多种途径影响其合成和代谢。",
            "组胺（Histamine）": "生物活性胺，由肠道菌群和宿主细胞产生，参与免疫应答、胃酸分泌和神经传递，过量可引起过敏反应和炎症。",
            "一氧化氮": "信号分子，参与血管舒张、神经传递和免疫防御，肠道菌群通过硝酸盐-亚硝酸盐途径影响其产生，调节肠道屏障和血压。",
            "喹啉（Quinolinic）": "色氨酸代谢产物，通过犬尿氨酸途径产生，高浓度具有神经毒性，与多种神经精神疾病和肝肾功能障碍相关。",
            "维生素k2": "由肠道菌群合成的脂溶性维生素，对骨骼健康和血液凝固至关重要，具有抗钙化作用，保护心血管系统，参与细胞信号传导。",
            "肌醇（Inositol）": "糖醇类化合物，参与细胞信号传导和脂质代谢，支持神经系统功能，改善胰岛素敏感性，肠道菌群可影响其代谢和吸收。",
            "吲哚": "由肠道菌群代谢色氨酸产生的芳香族化合物，低浓度时作为抗氧化剂和抗炎剂，高浓度时可能成为尿毒症毒素，影响肝功能。",
            "苯酚": "肠道菌群代谢酪氨酸产生的芳香族化合物，高浓度可能具有肝毒性和肾毒性，影响肠道屏障功能，与肠道炎症和多种代谢疾病相关。",
            "腐胺": "生物胺类化合物，由肠道菌群通过代谢精氨酸和鸟氨酸产生，参与细胞增殖和分化，高浓度可增加肠道通透性，促进炎症反应。",
            "硫化氢": "肠道菌群代谢含硫氨基酸产生的气体信号分子，低浓度时具有保护作用，高浓度时可能损伤肠黏膜，与肠道炎症和多种疾病相关。",
            "尸胺": "生物胺类化合物，由肠道菌群代谢赖氨酸产生，参与细胞增殖，高浓度可增加肠道通透性，影响神经系统功能，与多种疾病相关。"
          },

          // 获取代谢物介绍
          getMetaboliteIntro(name) {
            // 检查是否直接匹配
            if (this.METABOLITES_INFO[name]) {
              return this.METABOLITES_INFO[name];
            }

            // 尝试不区分大小写匹配
            const lowerName = name.toLowerCase();
            for (const key in this.METABOLITES_INFO) {
              if (key.toLowerCase() === lowerName) {
                return this.METABOLITES_INFO[key];
              }
            }

            // 尝试部分匹配
            for (const key in this.METABOLITES_INFO) {
              if (name.includes(key) || key.includes(name)) {
                return this.METABOLITES_INFO[key];
              }
            }

            // 默认介绍
            return "肠道菌群代谢产物，与人体健康状态密切相关。";
          },

          // 解析范围字符串
          parseRange(rangeStr) {
            if (!rangeStr || typeof rangeStr !== 'string') {
              return { min: 0, max: 100 };
            }

            const parts = rangeStr.split('-');
            return {
              min: parseFloat(parts[0] || 0),
              max: parseFloat(parts[1] || 100)
            };
          },

          // 获取状态信息
          getStatus(value, rangeStr) {
            const { min, max } = this.parseRange(rangeStr);

            // 处理非数值情况，如 "ND"（未检出）
            if (value === "ND" || value === "未检出" || value === 0) {
              return {
                color: this.CONSTANTS.COLORS.GREEN,
                text: '正常',
                isNormal: true,
                icon: ''
              };
            }

            const numValue = parseFloat(value);

            let status = {
              color: this.CONSTANTS.COLORS.GREEN,
              text: '正常',
              isNormal: true,
              icon: ''
            };

            if (numValue < min) {
              status.color = this.CONSTANTS.COLORS.RED;
              status.text = '偏低';
              status.isNormal = false;
              status.icon = '<i class="fas fa-arrow-down ml-1"></i>';
            } else if (numValue > max) {
              status.color = this.CONSTANTS.COLORS.RED;
              status.text = '超标';
              status.isNormal = false;
              status.icon = '<i class="fas fa-arrow-up ml-1"></i>';
            }

            return status;
          },

          // 格式化数字
          formatNumber(value) {
            if (value === "ND" || value === "未检出" || value === 0) {
              return "ND";
            }

            const num = Number(value);

            if (num >= 1) {
              const integerDigits = Math.floor(Math.log10(num)) + 1;
              const decimalPlaces = Math.max(0, 4 - integerDigits);
              return num.toFixed(decimalPlaces);
            } else {
              const str = num.toPrecision(4);
              return str.replace(/\.?0+$/, '');
            }
          },

          // 计算进度条百分比 - 修改后的进度条计算逻辑
          calculateProgress(value, rangeStr) {
            if (value === "ND" || value === "未检出" || value === 0 || isNaN(parseFloat(value))) {
              return 0;
            }

            const numValue = parseFloat(value);
            const { max } = this.parseRange(rangeStr);

            // 直接计算进度百分比：评估数值 / 参考范围的最大值 * 100
            // const percentage = (numValue / max) * 100;

            const percentage = (numValue / 100) * 100;

            // 确保显示最小宽度，以便即使是很小的值也能看到一点进度条
            return Math.max(3, percentage);
          },

          // 从说明字段中提取超标影响和偏低影响
          parseImpacts(description) {
            if (!description) {
              return { high: '', low: '' };
            }

            // 如果说明中包含"/"，按"/"分割
            if (description.includes('/')) {
              const parts = description.split('/');
              return {
                high: parts[0].trim() || '暂无数据', // 超标的影响
                low: parts[1].trim() || '暂无数据'   // 偏低的影响
              };
            }

            // 如果没有"/"，则全部内容作为说明
            return {
              high: description || '暂无数据',
              low: '暂无数据'
            };
          },

          // 创建描述行
          createDescriptionRow(item) {
            if (!item) return '';

            const intro = this.getMetaboliteIntro(item.检测项目);
            const impacts = this.parseImpacts(item.说明);

            return `
              <tr class="virus-desc-row">
                  <td colspan="4" class="py-2 px-4 text-left">
                      <div class="description-container text-gray-600" style="font-size: 10px;">
                          <div class="flex items-start">
                              <div class="ml-1 w-full">
                                  <p class="mb-1">
                                      <i class="fas fa-info-circle" style="color: ${this.CONSTANTS.COLORS.PRIMARY};"></i>
                                      ${intro}
                                  </p>
                                  <div class="ml-1 mt-1">
                                      • <strong>超标的影响：</strong> ${impacts.high}<br>
                                      • <strong>偏低的影响：</strong> ${impacts.low}
                                  </div>
                              </div>
                          </div>
                      </div>
                  </td>
              </tr>
            `;
          },

          // 渲染表格
          renderTable(metabolitesData) {
            const container = document.getElementById('other-metabolites-data-table-body');
            if (!container) {
              console.error('Container element not found');
              return;
            }
            container.innerHTML = '';

            if (!metabolitesData || !Array.isArray(metabolitesData) || metabolitesData.length === 0) {
              container.innerHTML = '<div class="no-data-message">暂无数据</div>';
              return;
            }

            const fragment = document.createDocumentFragment();

            // 使用所有数据项
            metabolitesData.forEach(item => {
              const value = item.评估值;
              const rangeStr = item.参考范围;
              const evaluation = item.结果评价;
              const name = item.检测项目;

              // 提取英文名称（如果有）
              let chineseName = name;
              let englishName = '';

              if (name.includes('（') && name.includes('）')) {
                const parts = name.split(/（|）/);
                chineseName = parts[0];
                englishName = parts[1] || '';
              }

              // 获取状态信息
              const status = this.getStatus(value, rangeStr);

              // 如果数据中已有结果评价，更新状态文本
              if (evaluation) {
                status.text = evaluation === "异常" ? (parseFloat(value) < this.parseRange(rangeStr).min ? "偏低" : "超标") : evaluation;
              }

              const progressPercentage = this.calculateProgress(value, rangeStr);
              const formattedValue = this.formatNumber(value);

              const metabolitesContainer = document.createElement('div');
              metabolitesContainer.className = 'bacteria-info-container';

              const table = document.createElement('table');
              table.className = 'bacteria-table min-w-full';

              const dataRow = `
                <tr class="metabolites-row">
                  <td class="py-2 px-4 text-left gut-microbial-metabolites-first-column">
                    <div class="gut-microbial-metabolites-chinese-text">${chineseName}</div>
                    ${englishName ? `<div class="gut-microbial-metabolites-english-text">${englishName}</div>` : ''}
                  </td>
                  <td class="py-2 px-4 text-center gut-microbial-metabolites-column-text gut-microbial-metabolites-second-column" style="font-size: 0.65rem;">
                    ${rangeStr}
                  </td>
                  <td class="py-2 px-4 text-center gut-microbial-metabolites-column-text gut-microbial-metabolites-third-column" style="font-size: 0.65rem;">
                    <div class="flex items-center justify-center">
                      <span style="color: ${status.color}; font-weight: bold;">
                        ${value}${status.icon}
                      </span>
                    </div>
                    <div class="progress-bar w-full mt-2" style="background-color: #e9ecef; height: 8px; border-radius: 4px; overflow: hidden;">
                      <div class="progress"
                           style="width: ${progressPercentage}%;
                                  height: 100%;
                                  background-color: ${status.color};
                                  transition: width 0.3s ease;">
                      </div>
                    </div>
                  </td>
                  <td class="py-2 px-4 text-center bold-text gut-microbial-metabolites-column-text gut-microbial-metabolites-fourth-column" style="font-size: 0.65rem;">
                    <span style="color: ${status.color}; font-weight: bold;">
                      ${status.text}
                    </span>
                  </td>
                </tr>
              `;

              const descRow = this.createDescriptionRow(item);

              table.innerHTML = `<tbody>${dataRow}${descRow}</tbody>`;
              metabolitesContainer.appendChild(table);
              fragment.appendChild(metabolitesContainer);
            });

            container.appendChild(fragment);
          },

          // 加载数据
          async loadData() {
            try {
              const response = await fetch(DATA_PATHS.DATA);
              if (!response.ok) {
                throw new Error(`Network response error: ${response.status}`);
              }
              const data = await response.json();
              // 使用"菌群代谢物"数据
              this.renderTable(data["菌群代谢物"] || []);
            } catch (error) {
              console.error('Error loading metabolites data:', error);
              document.getElementById('other-metabolites-data-table-body').innerHTML =
                '<div class="no-data-message">暂无数据</div>';
            }
          },

          // 初始化
          init() {
            document.addEventListener('DOMContentLoaded', () => this.loadData());
          }
        };

        // 初始化其他代谢物评估模块
        OtherMetabolitesAssessment.init();
      </script>
    </div>
  </div>

  <!-- 免疫指标评估板块 : 首页 -->

  <h1 class="custom-title-1 page-break">免疫指标评估</h1>
  <div class="bg-white rounded-lg p-5 mb-5 mx-auto" style="width: 100%;">

    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            <i class="fas fa-info-circle icon"></i>
            <strong>免疫指标</strong>是评估免疫系统的核心参数，涵盖体液免疫（IgG/IgA/IgM、补体系统）、细胞免疫（T/B/NK细胞及IL-6/TNF-α等因子）及免疫代谢网络，其中免疫球蛋白与免疫细胞承担80%以上的特异性防御功能。研究揭示肠道菌群通过短链脂肪酸等代谢产物，直接激活树突状细胞促进IgA分泌，并调控Th17/Treg平衡影响IL-10/IL-17表达，形成菌群-免疫互作网络。这种协同作用既维持免疫活性（吞噬指数、补体效价），又保障免疫特异性（抗体亲和力、TCR多样性），其代谢产物丁酸盐可同步提升NK细胞活性并抑制过度炎症反应，构成免疫稳态的双向调节枢纽。
          </p>
        </div>
      </div>
    </div>

    <!--  免疫指标总结信息模块化图表 -->
    <div class="immunity-card">
      <div class="immunity-icon-box immune">
        <i class="fas fa-shield-virus"></i>
        体液免疫
      </div>
      <div class="immunity-content-box">
        体液免疫是机体重要的防御系统，主要由免疫球蛋白（IgA、IgG、IgM 等）和补体系统（C3、C4 等）构成。其中，免疫球蛋白能特异性识别和中和病原体，而补体系统则通过级联反应增强免疫应答，共同构成体液免疫防御网络。
      </div>
    </div>

    <div class="immunity-card">
      <div class="immunity-icon-box inflammation">
        <i class="fas fa-fire"></i>
        炎症感染
      </div>
      <div class="immunity-content-box">
        炎症指标是反映机体炎症状态的重要生物标志物，主要包括急性时相蛋白（如 CRP、SAA）、促炎因子（IL-1β、IL-6、TNF-α 等）和抗炎因子（IL-10、TGF-β 等）。这些指标能够及时反映机体的炎症水平和免疫状态，是疾病诊断和预后评估的重要依据。
      </div>
    </div>

    <div class="immunity-card">
      <div class="immunity-icon-box metabolism">
        <i class="fas fa-flask"></i>
        菌群代谢
      </div>
      <div class="immunity-content-box">
        代谢物质是肠道菌群与宿主互作的关键媒介，主要包括短链脂肪酸（乙酸盐、丙酸盐、丁酸盐）、胆汁酸代谢物、色氨酸代谢物和神经递质（GABA、5-HT 等）。这些代谢产物不仅参与能量代谢，还具有调节免疫、影响神经功能等多重生物学作用。
      </div>
    </div>

    <div class="immunity-card">
      <div class="immunity-icon-box cytokine">
        <i class="fas fa-dna"></i>
        细胞因子
      </div>
      <div class="immunity-content-box">
        细胞因子是一类调节免疫和炎症反应的小分子蛋白，主要包括白介素家族（IL-1β、IL-6、IL-10 等）、肿瘤坏死因子（TNF-α）和转化生长因子（TGF-β）等。它们作为免疫细胞间的信使分子，在免疫应答、炎症调控和组织修复中发挥关键作用。
      </div>
    </div>

    <div class="immunity-card">
      <div class="immunity-icon-box cancer">
        <i class="fas fa-microscope"></i>
        免疫肿瘤
      </div>
      <div class="immunity-content-box">
        免疫系统是机体抵抗肿瘤的重要防线，通过免疫监视、免疫编辑和免疫清除等机制识别和消灭肿瘤细胞。肿瘤免疫涉及天然免疫和适应性免疫多个组分，包括 NK 细胞、T 细胞、树突状细胞等免疫细胞以及细胞因子网络。
      </div>
    </div>


  </div>

  <!-- 免疫指标评估板块 : 体液免疫评估 -->
  <h2 class="custom-title-1 page-break">体液免疫评估</h2>

  <div class="bg-white rounded-lg p-5 mb-5 mx-auto" style="width: 100%;">

    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            <i class="fas fa-info-circle icon"></i>
            体液免疫是机体重要的防御系统，通过产生多种免疫活性物质来识别和清除病原体。通过检测这些指标，可以评估机体的免疫防御能力和炎症状态。
          </p>
        </div>
      </div>
    </div>

    <!-- 体液免疫评估 -->
    <div class="rounded-table">
      <table class="min-w-full">
        <thead>
        <tr style="background-color: #00B2B4; color: white;">
          <th
            class="py-2 px-4 text-left immunity-first-column"
            style="font-size: 13px;">
            体液免疫指标
          </th>
          <th
            class="py-2 px-4 text-center immunity-second-column"
            style="font-size: 13px; padding: 5px 5px;">
            参考范围
          </th>
          <th
            class="py-2 px-4 text-center immunity-third-column"
            style="font-size: 13px; padding: 5px 5px;">
            评估数值
          </th>
          <th
            class="py-2 px-4 text-center immunity-fourth-column"
            style="font-size: 13px; padding: 5px 5px;">
            评估结果
          </th>
        </tr>
        </thead>
      </table>

      <div id="humoral-immunity-data-table-body">
        <!-- 数据将通过 JavaScript 动态插入 -->
      </div>
    </div>

    <script>
      // 体液免疫评估模块
      const HumoralImmunityEvaluation = {
        // 常量定义
        CONSTANTS: {
          COLORS: {
            RED: '#ff4d4f',
            GREEN: '#52c41a',
            GRAY: '#808080',
            PRIMARY: '#00B2B4'
          },
          // 定义我们需要显示的免疫指标列表
          EVALUATION_ITEMS: [
            { name: "IgA", displayName: "免疫球蛋白A", englishName: "IgA" },
            { name: "IgD", displayName: "免疫球蛋白D", englishName: "IgD" },
            { name: "IgM", displayName: "免疫球蛋白M", englishName: "IgM" },
            { name: "白蛋白", displayName: "白蛋白", englishName: "Albumin" }
          ]
        },

        // 解析范围字符串
        parseRange(rangeStr) {
          if (!rangeStr || typeof rangeStr !== 'string') {
            return { min: 0, max: 0 };
          }
          const parts = rangeStr.split('-');
          return {
            min: parseFloat(parts[0] || 0),
            max: parseFloat(parts[1] || 0)
          };
        },

        // 获取状态信息
        getStatus(value, rangeStr) {
          // 特殊情况处理：若值为"未检出"或"ND"
          if (value === "未检出" || value === "ND") {
            return {
              color: this.CONSTANTS.COLORS.GREEN,
              text: '正常',
              icon: '',
              isNormal: true,
              valueColor: this.CONSTANTS.COLORS.GREEN
            };
          }

          const { min, max } = this.parseRange(rangeStr);
          const numValue = parseFloat(value);

          let status = {
            color: this.CONSTANTS.COLORS.GREEN,
            text: '正常',
            icon: '',
            isNormal: true,
            valueColor: this.CONSTANTS.COLORS.GREEN
          };

          if (numValue < min) {
            status.color = this.CONSTANTS.COLORS.RED;
            status.text = '偏低';
            status.icon = '<i class="fas fa-arrow-down ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>';
            status.isNormal = false;
            status.valueColor = this.CONSTANTS.COLORS.RED;
          }
          else if (numValue > max) {
            status.color = this.CONSTANTS.COLORS.RED;
            status.text = '超标';
            status.icon = '<i class="fas fa-arrow-up ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>';
            status.isNormal = false;
            status.valueColor = this.CONSTANTS.COLORS.RED;
          }

          return status;
        },

        // 计算进度条百分比
        calculateProgress(value, rangeStr) {
          // 处理特殊值
          if (value === "未检出" || value === "ND" || value === 0 || value === "0") {
            return 0;
          }

          const { max } = this.parseRange(rangeStr);
          if (!value || max === 0) return 0;

          const num = Number(value);
          // 使进度条以max值为基准计算百分比，但限制在5%-100%范围内
          const percentage = (num / max) * 100;
          return Math.min(100, Math.max(5, percentage));
        },

        // 创建描述行
        createDescriptionRow(item) {
          if (!item || !item.说明) {
            return '';
          }

          return `
          <tr class="immunity-desc-row">
            <td colspan="4" class="py-2 px-4 text-left">
              <div class="description-container text-gray-600" style="font-size: 11px;">
                <div class="flex items-start mb-0">
                  <div class="ml-1">
                    <p>
                      <i class="fas fa-info-circle" style="color: ${this.CONSTANTS.COLORS.PRIMARY};"></i>
                      ${item.说明}
                    </p>
                  </div>
                </div>
              </div>
            </td>
          </tr>
        `;
        },

        // 渲染表格
        renderTable(immunityData) {
          const container = document.getElementById('humoral-immunity-data-table-body');
          if (!container) {
            console.error('Container element not found');
            return;
          }
          container.innerHTML = '';

          if (!immunityData || !Array.isArray(immunityData) || immunityData.length === 0) {
            container.innerHTML = '<div class="no-data-message">暂无数据</div>';
            return;
          }

          const fragment = document.createDocumentFragment();

          // 遍历我们定义的评估项目列表
          this.CONSTANTS.EVALUATION_ITEMS.forEach(evaluationItem => {
            // 从数据中查找匹配的项目
            const matchedItem = immunityData.find(item =>
              item.检测项目 === evaluationItem.name ||
              item.检测项目.includes(evaluationItem.name)
            );

            if (!matchedItem) {
              // 如果没有找到匹配项，可以选择跳过或显示空值
              return;
            }

            const value = matchedItem.评估值;
            const rangeStr = matchedItem.参考范围;
            const evaluation = matchedItem.结果评价;

            // 获取状态信息
            const status = this.getStatus(value, rangeStr);

            // 如果数据中已有结果评价，更新状态文本
            if (evaluation) {
              status.text = evaluation;
              // 根据评价结果更新颜色
              if (evaluation !== "正常") {
                status.isNormal = false;
                status.color = this.CONSTANTS.COLORS.RED;
                status.valueColor = this.CONSTANTS.COLORS.RED;
              }
            }

            const progressPercentage = this.calculateProgress(value, rangeStr);

            const itemContainer = document.createElement('div');
            itemContainer.className = 'immunity-info-container';

            const table = document.createElement('table');
            table.className = 'immunity-table min-w-full';

            const dataRow = `
            <tr>
              <td class="py-2 px-4 text-left immunity-first-column">
                <div class="immunity-chinese-text"><strong>${evaluationItem.displayName}</strong></div>
                <div class="immunity-english-text">${evaluationItem.englishName}</div>
              </td>
              <td class="py-2 px-4 text-center immunity-column-text immunity-second-column">
                ${rangeStr}
              </td>
              <td class="py-2 px-4 text-center immunity-column-text immunity-third-column">
                <div class="flex items-center justify-center">
                  <span style="color: ${status.valueColor}">
                    <strong>${value}${status.icon}</strong>
                  </span>
                </div>
                <div class="progress-bar w-full mt-2" style="background-color: #e9ecef; height: 8px; border-radius: 4px; overflow: hidden;">
                  <div class="progress"
                       style="width: ${progressPercentage}%;
                              height: 100%;
                              background-color: ${status.isNormal ? this.CONSTANTS.COLORS.GREEN : this.CONSTANTS.COLORS.RED};
                              transition: width 0.3s ease;">
                  </div>
                </div>
              </td>
              <td class="py-2 px-4 text-center immunity-column-text immunity-fourth-column">
                <span style="color: ${status.color}">
                  <strong>${status.text}</strong>
                </span>
              </td>
            </tr>
          `;

            const descRow = this.createDescriptionRow(matchedItem);

            table.innerHTML = `<tbody>${dataRow}${descRow}</tbody>`;
            itemContainer.appendChild(table);
            fragment.appendChild(itemContainer);
          });

          container.appendChild(fragment);
        },

        // 加载数据
        async loadData() {
          try {
            const response = await fetch(DATA_PATHS.DATA);
            if (!response.ok) {
              throw new Error(`Network response error: ${response.status}`);
            }
            const data = await response.json();
            // 使用"免疫指标"数据
            this.renderTable(data["免疫指标"] || []);
          } catch (error) {
            console.error('Error loading humoral immunity data:', error);
            document.getElementById('humoral-immunity-data-table-body').innerHTML =
              '<div class="no-data-message">暂无数据</div>';
          }
        },

        // 初始化
        init() {
          document.addEventListener('DOMContentLoaded', () => this.loadData());
        }
      };

      // 初始化体液免疫评估模块
      HumoralImmunityEvaluation.init();
    </script>
  </div>

  <!-- 免疫指标评估板块 : 炎症感染评估 -->
  <h2 class="custom-title-1 page-break">炎症感染指标评估</h2>

  <div class="bg-white rounded-lg p-5 mb-5 mx-auto" style="width: 100%;">

    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            <i class="fas fa-info-circle icon"></i>
            炎症标志物是评估机体炎症状态的重要指标。通过检测不同的炎症标志物，可以了解系统的炎症程度。
          </p>
        </div>
      </div>
    </div>

    <!-- 炎症感染评估表格 -->
    <div class="rounded-table">
      <table class="min-w-full">
        <thead>
        <tr style="background-color: #00B2B4; color: white;">
          <th class="py-2 px-4 text-left immunity-first-column"
              style="font-size: 13px;">
            炎症感染指标
          </th>
          <th class="py-2 px-4 text-center immunity-second-column"
              style="font-size: 13px; padding: 5px 5px;">
            参考范围
          </th>
          <th class="py-2 px-4 text-center immunity-third-column"
              style="font-size: 13px; padding: 5px 5px;">
            评估数值
          </th>
          <th class="py-2 px-4 text-center immunity-fourth-column"
              style="font-size: 13px; padding: 5px 5px;">
            评估结果
          </th>
        </tr>
        </thead>
      </table>

      <div id="inflammatory-infection-data-table-body">
        <!-- 数据将通过 JavaScript 动态插入 -->
      </div>
    </div>

    <script>
      // 炎症感染指标评估模块
      const InflammatoryInfectionEvaluation = {
        // 常量定义
        CONSTANTS: {
          COLORS: {
            RED: '#ff4d4f',
            GREEN: '#52c41a',
            GRAY: '#808080',
            PRIMARY: '#00B2B4'
          },
          // 定义我们需要显示的炎症感染指标列表
          EVALUATION_ITEMS: [
            { name: "Albumin", displayName: "白蛋白", englishName: "Albumin" },
            { name: "IgA", displayName: "白细胞总数及分类", englishName: "IgA" },
            { name: "PCT", displayName: "降钙素原", englishName: "PCT" },
            { name: "hsCRP", displayName: "高敏C反应蛋白", englishName: "hsCRP" },
            { name: "FC", displayName: "粪便钙蛋白", englishName: "FC" },
            { name: "EPX", displayName: "粪便嗜酸性粒细胞蛋白X", englishName: "EPX" }
          ]
        },

        // 解析范围字符串
        parseRange(rangeStr) {
          if (!rangeStr || typeof rangeStr !== 'string') {
            return { min: 0, max: 0 };
          }
          const parts = rangeStr.split('-');
          return {
            min: parseFloat(parts[0] || 0),
            max: parseFloat(parts[1] || 0)
          };
        },

        // 获取状态信息
        getStatus(value, rangeStr) {
          // 特殊情况处理：若值为"未检出"或"ND"
          if (value === "未检出" || value === "ND") {
            return {
              color: this.CONSTANTS.COLORS.GREEN,
              text: '正常',
              icon: '',
              isNormal: true,
              valueColor: this.CONSTANTS.COLORS.GREEN
            };
          }

          const { min, max } = this.parseRange(rangeStr);
          const numValue = parseFloat(value);

          let status = {
            color: this.CONSTANTS.COLORS.GREEN,
            text: '正常',
            icon: '',
            isNormal: true,
            valueColor: this.CONSTANTS.COLORS.GREEN
          };

          if (numValue < min) {
            status.color = this.CONSTANTS.COLORS.RED;
            status.text = '偏低';
            status.icon = '<i class="fas fa-arrow-down ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>';
            status.isNormal = false;
            status.valueColor = this.CONSTANTS.COLORS.RED;
          }
          else if (numValue > max) {
            status.color = this.CONSTANTS.COLORS.RED;
            status.text = '超标';
            status.icon = '<i class="fas fa-arrow-up ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>';
            status.isNormal = false;
            status.valueColor = this.CONSTANTS.COLORS.RED;
          }

          return status;
        },

        // 计算进度条百分比
        calculateProgress(value, rangeStr) {
          // 处理特殊值
          if (value === "未检出" || value === "ND" || value === 0 || value === "0") {
            return 0;
          }

          const { max } = this.parseRange(rangeStr);
          if (!value || max === 0) return 0;

          const num = Number(value);
          // 使进度条以max值为基准计算百分比，但限制在5%-100%范围内
          const percentage = (num / max) * 100;
          return Math.min(100, Math.max(5, percentage));
        },

        // 创建描述行
        createDescriptionRow(item) {
          if (!item || !item.说明) {
            return '';
          }

          return `
          <tr class="inflammatory-desc-row">
            <td colspan="4" class="py-2 px-4 text-left">
              <div class="description-container text-gray-600" style="font-size: 11px;">
                <div class="flex items-start mb-0">
                  <div class="ml-1">
                    <p>
                      <i class="fas fa-info-circle" style="color: ${this.CONSTANTS.COLORS.PRIMARY};"></i>
                      ${item.说明}
                    </p>
                  </div>
                </div>
              </div>
            </td>
          </tr>
        `;
        },

        // 渲染表格
        renderTable(inflammatoryData) {
          const container = document.getElementById('inflammatory-infection-data-table-body');
          if (!container) {
            console.error('Container element not found');
            return;
          }
          container.innerHTML = '';

          if (!inflammatoryData || !Array.isArray(inflammatoryData) || inflammatoryData.length === 0) {
            container.innerHTML = '<div class="no-data-message">暂无数据</div>';
            return;
          }

          const fragment = document.createDocumentFragment();

          // 遍历我们定义的评估项目列表
          this.CONSTANTS.EVALUATION_ITEMS.forEach(evaluationItem => {
            // 从数据中查找匹配的项目
            const matchedItem = inflammatoryData.find(item =>
              item.检测项目 === evaluationItem.name ||
              item.检测项目.includes(evaluationItem.name)
            );

            if (!matchedItem) {
              // 如果没有找到匹配项，可以选择跳过或显示空值
              return;
            }

            const value = matchedItem.评估值;
            const rangeStr = matchedItem.参考范围;
            const evaluation = matchedItem.结果评价;

            // 获取状态信息
            const status = this.getStatus(value, rangeStr);

            // 如果数据中已有结果评价，更新状态文本
            if (evaluation) {
              status.text = evaluation;
              // 根据评价结果更新颜色
              if (evaluation !== "正常") {
                status.isNormal = false;
                status.color = this.CONSTANTS.COLORS.RED;
                status.valueColor = this.CONSTANTS.COLORS.RED;
              }
            }

            const progressPercentage = this.calculateProgress(value, rangeStr);

            const itemContainer = document.createElement('div');
            itemContainer.className = 'inflammatory-info-container';

            const table = document.createElement('table');
            table.className = 'inflammatory-table min-w-full';

            const dataRow = `
            <tr>
              <td class="py-2 px-4 text-left immunity-first-column">
                <div class="immunity-chinese-text"><strong>${evaluationItem.displayName}</strong></div>
                <div class="immunity-english-text">${evaluationItem.englishName}</div>
              </td>
              <td class="py-2 px-4 text-center immunity-column-text immunity-second-column">
                ${rangeStr}
              </td>
              <td class="py-2 px-4 text-center immunity-column-text immunity-third-column">
                <div class="flex items-center justify-center">
                  <span style="color: ${status.valueColor}">
                    <strong>${value}${status.icon}</strong>
                  </span>
                </div>
                <div class="progress-bar w-full mt-2" style="background-color: #e9ecef; height: 8px; border-radius: 4px; overflow: hidden;">
                  <div class="progress"
                       style="width: ${progressPercentage}%;
                              height: 100%;
                              background-color: ${status.isNormal ? this.CONSTANTS.COLORS.GREEN : this.CONSTANTS.COLORS.RED};
                              transition: width 0.3s ease;">
                  </div>
                </div>
              </td>
              <td class="py-2 px-4 text-center immunity-column-text immunity-fourth-column">
                <span style="color: ${status.color}">
                  <strong>${status.text}</strong>
                </span>
              </td>
            </tr>
          `;

            const descRow = this.createDescriptionRow(matchedItem);

            table.innerHTML = `<tbody>${dataRow}${descRow}</tbody>`;
            itemContainer.appendChild(table);
            fragment.appendChild(itemContainer);
          });

          container.appendChild(fragment);
        },

        // 加载数据
        async loadData() {
          try {
            const response = await fetch(DATA_PATHS.DATA);
            if (!response.ok) {
              throw new Error(`Network response error: ${response.status}`);
            }
            const data = await response.json();
            // 使用"炎症指标"数据
            this.renderTable(data["免疫指标"] || []);
          } catch (error) {
            console.error('Error loading inflammatory infection data:', error);
            document.getElementById('inflammatory-infection-data-table-body').innerHTML =
              '<div class="no-data-message">暂无数据</div>';
          }
        },

        // 初始化
        init() {
          document.addEventListener('DOMContentLoaded', () => this.loadData());
        }
      };

      // 初始化炎症感染指标评估模块
      InflammatoryInfectionEvaluation.init();
    </script>
  </div>

  <!-- 免疫指标评估板块 : 菌群代谢物评估 -->
  <h2 class="custom-title-1 page-break">菌群代谢物指标评估</h2>

  <div class="bg-white rounded-lg p-5 mb-5 mx-auto" style="width: 100%;">
    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            <i class="fas fa-info-circle icon"></i>
            肠道菌群代谢物是评估肠道健康和免疫功能的重要指标。这些指标可以反应肠道微生态平衡状况和炎症反应水平。
          </p>
        </div>
      </div>
    </div>

    <div class="rounded-table">
      <table class="min-w-full">
        <thead>
        <tr style="background-color: #00B2B4; color: white;">
          <th
            class="py-2 px-4 text-left immunity-first-column"
            style="font-size: 13px;">
            菌群代谢物指标
          </th>
          <th
            class="py-2 px-4 text-center immunity-second-column"
            style="font-size: 13px; padding: 5px 5px;">
            参考范围
          </th>
          <th
            class="py-2 px-4 text-center immunity-third-column"
            style="font-size: 13px; padding: 5px 5px;">
            评估数值
          </th>
          <th
            class="py-2 px-4 text-center immunity-fourth-column"
            style="font-size: 13px; padding: 5px 5px;">
            评估结果
          </th>
        </tr>
        </thead>
      </table>

      <div id="microbial-metabolites-data-table-body">
        <!-- 数据将通过 JavaScript 动态插入 -->
      </div>

      <script>
        // 菌群代谢物指标评估模块
        const MicrobialMetabolitesEvaluation = {
          // 常量定义
          CONSTANTS: {
            COLORS: {
              RED: '#ff4d4f',
              GREEN: '#52c41a',
              GRAY: '#808080',
              PRIMARY: '#00B2B4'
            },
            // 定义我们需要显示的菌群代谢物指标列表
            EVALUATION_ITEMS: [
              { name: "脂多糖LPS", displayName: "脂多糖", englishName: "LPS" },
              { name: "胆汁酸", displayName: "胆汁酸", englishName: "Bile acid" },
              { name: "氢", displayName: "氢气", englishName: "H₂" },
              { name: "丁酸盐", displayName: "丁酸盐", englishName: "Butyrate" },
              { name: "丁酸盐", displayName: "丁酸盐", englishName: "Acetate" }
            ]
          },

          // 解析范围字符串
          parseRange(rangeStr) {
            if (!rangeStr || typeof rangeStr !== 'string') {
              return { min: 0, max: 0 };
            }
            const parts = rangeStr.split('-');
            return {
              min: parseFloat(parts[0] || 0),
              max: parseFloat(parts[1] || 0)
            };
          },

          // 获取状态信息
          getStatus(value, rangeStr) {
            // 特殊情况处理：若值为"未检出"或"ND"
            if (value === "未检出" || value === "ND") {
              return {
                color: this.CONSTANTS.COLORS.GREEN,
                text: '正常',
                icon: '',
                isNormal: true,
                valueColor: this.CONSTANTS.COLORS.GREEN
              };
            }

            const { min, max } = this.parseRange(rangeStr);
            const numValue = parseFloat(value);

            let status = {
              color: this.CONSTANTS.COLORS.GREEN,
              text: '正常',
              icon: '',
              isNormal: true,
              valueColor: this.CONSTANTS.COLORS.GREEN
            };

            if (numValue < min) {
              status.color = this.CONSTANTS.COLORS.RED;
              status.text = '偏低';
              status.icon = '<i class="fas fa-arrow-down ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>';
              status.isNormal = false;
              status.valueColor = this.CONSTANTS.COLORS.RED;
            }
            else if (numValue > max) {
              status.color = this.CONSTANTS.COLORS.RED;
              status.text = '超标';
              status.icon = '<i class="fas fa-arrow-up ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>';
              status.isNormal = false;
              status.valueColor = this.CONSTANTS.COLORS.RED;
            }

            return status;
          },

          // 计算进度条百分比
          calculateProgress(value, rangeStr) {
            // 处理特殊值
            if (value === "未检出" || value === "ND" || value === 0 || value === "0") {
              return 0;
            }

            const { max } = this.parseRange(rangeStr);
            if (!value || max === 0) return 0;

            const num = Number(value);
            // 使进度条以max值为基准计算百分比，但限制在5%-100%范围内
            const percentage = (num / max) * 100;
            return Math.min(100, Math.max(5, percentage));
          },

          // 创建描述行
          createDescriptionRow(item) {
            if (!item || !item.说明) {
              return '';
            }

            return `
            <tr class="metabolite-desc-row">
              <td colspan="4" class="py-2 px-4 text-left">
                <div class="description-container text-gray-600" style="font-size: 11px;">
                  <div class="flex items-start mb-0">
                    <div class="ml-1">
                      <p>
                        <i class="fas fa-info-circle" style="color: ${this.CONSTANTS.COLORS.PRIMARY};"></i>
                        ${item.说明}
                      </p>
                    </div>
                  </div>
                </div>
              </td>
            </tr>
          `;
          },

          // 渲染表格
          renderTable(metabolitesData) {
            const container = document.getElementById('microbial-metabolites-data-table-body');
            if (!container) {
              console.error('Container element not found');
              return;
            }
            container.innerHTML = '';

            if (!metabolitesData || !Array.isArray(metabolitesData) || metabolitesData.length === 0) {
              container.innerHTML = '<div class="no-data-message">暂无数据</div>';
              return;
            }

            const fragment = document.createDocumentFragment();

            // 遍历我们定义的评估项目列表
            this.CONSTANTS.EVALUATION_ITEMS.forEach(evaluationItem => {
              // 从数据中查找匹配的项目
              const matchedItem = metabolitesData.find(item =>
                item.检测项目 === evaluationItem.name ||
                item.检测项目.includes(evaluationItem.name)
              );

              if (!matchedItem) {
                // 如果没有找到匹配项，可以选择跳过或显示空值
                return;
              }

              const value = matchedItem.评估值;
              const rangeStr = matchedItem.参考范围;
              const evaluation = matchedItem.结果评价;

              // 获取状态信息
              const status = this.getStatus(value, rangeStr);

              // 如果数据中已有结果评价，更新状态文本
              if (evaluation) {
                status.text = evaluation;
                // 根据评价结果更新颜色
                if (evaluation !== "正常") {
                  status.isNormal = false;
                  status.color = this.CONSTANTS.COLORS.RED;
                  status.valueColor = this.CONSTANTS.COLORS.RED;
                }
              }

              const progressPercentage = this.calculateProgress(value, rangeStr);

              const itemContainer = document.createElement('div');
              itemContainer.className = 'metabolite-info-container';

              const table = document.createElement('table');
              table.className = 'metabolite-table min-w-full';

              const dataRow = `
              <tr>
                <td class="py-2 px-4 text-left immunity-first-column">
                  <div class="chinese-text"><strong>${evaluationItem.displayName}</strong></div>
                  <div class="latin-text">${evaluationItem.englishName}</div>
                </td>
                <td class="py-2 px-4 text-center immunity-column-text immunity-second-column">
                  ${rangeStr}
                </td>
                <td class="py-2 px-4 text-center immunity-column-text immunity-third-column">
                  <div class="flex items-center justify-center">
                    <span style="color: ${status.valueColor}">
                      <strong>${value}${status.icon}</strong>
                    </span>
                  </div>
                  <div class="progress-bar w-full mt-2" style="background-color: #e9ecef; height: 8px; border-radius: 4px; overflow: hidden;">
                    <div class="progress"
                         style="width: ${progressPercentage}%;
                                height: 100%;
                                background-color: ${status.isNormal ? this.CONSTANTS.COLORS.GREEN : this.CONSTANTS.COLORS.RED};
                                transition: width 0.3s ease;">
                    </div>
                  </div>
                </td>
                <td class="py-2 px-4 text-center immunity-column-text immunity-fourth-column">
                  <span style="color: ${status.color}">
                    <strong>${status.text}</strong>
                  </span>
                </td>
              </tr>
            `;

              const descRow = this.createDescriptionRow(matchedItem);

              table.innerHTML = `<tbody>${dataRow}${descRow}</tbody>`;
              itemContainer.appendChild(table);
              fragment.appendChild(itemContainer);
            });

            container.appendChild(fragment);
          },

          // 加载数据
          async loadData() {
            try {
              const response = await fetch(DATA_PATHS.DATA);
              if (!response.ok) {
                throw new Error(`Network response error: ${response.status}`);
              }
              const data = await response.json();
              // 使用"菌群代谢物"数据
              this.renderTable(data["免疫指标"] || []);
            } catch (error) {
              console.error('Error loading microbial metabolites data:', error);
              document.getElementById('microbial-metabolites-data-table-body').innerHTML =
                '<div class="no-data-message">暂无数据</div>';
            }
          },

          // 初始化
          init() {
            document.addEventListener('DOMContentLoaded', () => this.loadData());
          }
        };

        // 初始化菌群代谢物指标评估模块
        MicrobialMetabolitesEvaluation.init();
      </script>
    </div>
  </div>

  <!-- 免疫指标评估板块 : 细胞因子指标评估 -->
  <h2 class="custom-title-1 page-break">细胞因子指标评估</h2>

  <div class="bg-white rounded-lg p-5 mb-5 mx-auto" style="width: 100%;">
    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            <i class="fas fa-info-circle icon"></i>
            细胞因子是免疫系统中重要的信号分子，通过检测不同的细胞因子水平，可以了解机体的免疫状态和炎症程度。
          </p>
        </div>
      </div>
    </div>

    <div class="rounded-table">
      <table class="min-w-full">
        <thead>
        <tr style="background-color: #00B2B4; color: white;">
          <th class="py-2 px-4 text-left immunity-first-column"
              style="font-size: 13px;">
            细胞因子指标
          </th>
          <th class="py-2 px-4 text-center immunity-second-column"
              style="font-size: 13px; padding: 5px 5px;">
            参考范围
          </th>
          <th class="py-2 px-4 text-center immunity-third-column"
              style="font-size: 13px; padding: 5px 5px;">
            评估数值
          </th>
          <th class="py-2 px-4 text-center immunity-fourth-column"
              style="font-size: 13px; padding: 5px 5px;">
            评估结果
          </th>
        </tr>
        </thead>
      </table>

      <div id="cytokines-data-table-body">
        <!-- 数据将通过 JavaScript 动态插入 -->
      </div>

      <script>
        // 细胞因子指标评估模块
        const CytokinesEvaluation = {
          // 常量定义
          CONSTANTS: {
            COLORS: {
              RED: '#ff4d4f',
              GREEN: '#52c41a',
              GRAY: '#808080',
              PRIMARY: '#00B2B4'
            },
            // 定义我们需要显示的细胞因子指标列表
            EVALUATION_ITEMS: [
              { name: "IL-6", displayName: "白介素6", englishName: "IL-6" },
              { name: "TNF-α", displayName: "肿瘤坏死因子-α", englishName: "TNF-α" },
              { name: "Il-17a", displayName: "IL-17a", englishName: "IL-17a" },
              { name: "Il-10", displayName: "IL-10", englishName: "IL-10" },
              { name: "IFN-γ", displayName: "干扰素-γ", englishName: "IFN-γ" }
            ]
          },

          // 解析范围字符串
          parseRange(rangeStr) {
            if (!rangeStr || typeof rangeStr !== 'string') {
              return { min: 0, max: 0 };
            }
            const parts = rangeStr.split('-');
            return {
              min: parseFloat(parts[0] || 0),
              max: parseFloat(parts[1] || 0)
            };
          },

          // 获取状态信息
          getStatus(value, rangeStr) {
            // 特殊情况处理：若值为"未检出"或"ND"
            if (value === "未检出" || value === "ND") {
              return {
                color: this.CONSTANTS.COLORS.GREEN,
                text: '正常',
                icon: '',
                isNormal: true,
                valueColor: this.CONSTANTS.COLORS.GREEN
              };
            }

            const { min, max } = this.parseRange(rangeStr);
            const numValue = parseFloat(value);

            let status = {
              color: this.CONSTANTS.COLORS.GREEN,
              text: '正常',
              icon: '',
              isNormal: true,
              valueColor: this.CONSTANTS.COLORS.GREEN
            };

            if (numValue < min) {
              status.color = this.CONSTANTS.COLORS.RED;
              status.text = '偏低';
              status.icon = '<i class="fas fa-arrow-down ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>';
              status.isNormal = false;
              status.valueColor = this.CONSTANTS.COLORS.RED;
            }
            else if (numValue > max) {
              status.color = this.CONSTANTS.COLORS.RED;
              status.text = '超标';
              status.icon = '<i class="fas fa-arrow-up ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>';
              status.isNormal = false;
              status.valueColor = this.CONSTANTS.COLORS.RED;
            }

            return status;
          },

          // 计算进度条百分比
          calculateProgress(value, rangeStr) {
            // 处理特殊值
            if (value === "未检出" || value === "ND" || value === 0 || value === "0") {
              return 0;
            }

            const { max } = this.parseRange(rangeStr);
            if (!value || max === 0) return 0;

            const num = Number(value);
            // 使进度条以max值为基准计算百分比，但限制在5%-100%范围内
            const percentage = (num / max) * 100;
            return Math.min(100, Math.max(5, percentage));
          },

          // 创建描述行
          createDescriptionRow(item) {
            if (!item || !item.说明) {
              return '';
            }

            return `
            <tr class="cytokine-desc-row">
              <td colspan="4" class="py-2 px-4 text-left">
                <div class="description-container text-gray-600" style="font-size: 11px;">
                  <div class="flex items-start mb-0">
                    <div class="ml-1">
                      <p>
                        <i class="fas fa-info-circle" style="color: ${this.CONSTANTS.COLORS.PRIMARY};"></i>
                        ${item.说明}
                      </p>
                    </div>
                  </div>
                </div>
              </td>
            </tr>
          `;
          },

          // 渲染表格
          renderTable(cytokinesData) {
            const container = document.getElementById('cytokines-data-table-body');
            if (!container) {
              console.error('Container element not found');
              return;
            }
            container.innerHTML = '';

            if (!cytokinesData || !Array.isArray(cytokinesData) || cytokinesData.length === 0) {
              container.innerHTML = '<div class="no-data-message">暂无数据</div>';
              return;
            }

            const fragment = document.createDocumentFragment();

            // 遍历我们定义的评估项目列表
            this.CONSTANTS.EVALUATION_ITEMS.forEach(evaluationItem => {
              // 从数据中查找匹配的项目
              const matchedItem = cytokinesData.find(item =>
                item.检测项目 === evaluationItem.name ||
                item.检测项目.includes(evaluationItem.name)
              );

              if (!matchedItem) {
                // 如果没有找到匹配项，可以选择跳过或显示空值
                return;
              }

              const value = matchedItem.评估值;
              const rangeStr = matchedItem.参考范围;
              const evaluation = matchedItem.结果评价;

              // 获取状态信息
              const status = this.getStatus(value, rangeStr);

              // 如果数据中已有结果评价，更新状态文本
              if (evaluation) {
                status.text = evaluation;
                // 根据评价结果更新颜色
                if (evaluation !== "正常") {
                  status.isNormal = false;
                  status.color = this.CONSTANTS.COLORS.RED;
                  status.valueColor = this.CONSTANTS.COLORS.RED;
                }
              }

              const progressPercentage = this.calculateProgress(value, rangeStr);

              const itemContainer = document.createElement('div');
              itemContainer.className = 'cytokine-info-container';

              const table = document.createElement('table');
              table.className = 'cytokine-table min-w-full';

              const dataRow = `
              <tr>
                <td class="py-2 px-4 text-left immunity-first-column">
                  <div class="immunity-chinese-text"><strong>${evaluationItem.displayName}</strong></div>
                  <div class="immunity-english-text">${evaluationItem.englishName}</div>
                </td>
                <td class="py-2 px-4 text-center immunity-column-text immunity-second-column">
                  ${rangeStr}
                </td>
                <td class="py-2 px-4 text-center immunity-column-text immunity-third-column">
                  <div class="flex items-center justify-center">
                    <span style="color: ${status.valueColor}">
                      <strong>${value}${status.icon}</strong>
                    </span>
                  </div>
                  <div class="progress-bar w-full mt-2" style="background-color: #e9ecef; height: 8px; border-radius: 4px; overflow: hidden;">
                    <div class="progress"
                         style="width: ${progressPercentage}%;
                                height: 100%;
                                background-color: ${status.isNormal ? this.CONSTANTS.COLORS.GREEN : this.CONSTANTS.COLORS.RED};
                                transition: width 0.3s ease;">
                    </div>
                  </div>
                </td>
                <td class="py-2 px-4 text-center immunity-column-text immunity-fourth-column">
                  <span style="color: ${status.color}">
                    <strong>${status.text}</strong>
                  </span>
                </td>
              </tr>
            `;

              const descRow = this.createDescriptionRow(matchedItem);

              table.innerHTML = `<tbody>${dataRow}${descRow}</tbody>`;
              itemContainer.appendChild(table);
              fragment.appendChild(itemContainer);
            });

            container.appendChild(fragment);
          },

          // 加载数据
          async loadData() {
            try {
              const response = await fetch(DATA_PATHS.DATA);
              if (!response.ok) {
                throw new Error(`Network response error: ${response.status}`);
              }
              const data = await response.json();
              // 使用"细胞因子"数据
              this.renderTable(data["免疫指标"] || []);
            } catch (error) {
              console.error('Error loading cytokines data:', error);
              document.getElementById('cytokines-data-table-body').innerHTML =
                '<div class="no-data-message">暂无数据</div>';
            }
          },

          // 初始化
          init() {
            document.addEventListener('DOMContentLoaded', () => this.loadData());
          }
        };

        // 初始化细胞因子指标评估模块
        CytokinesEvaluation.init();
      </script>
    </div>
  </div>

  <!-- 免疫指标评估板块 : 免疫肿瘤指标评估 -->
  <h2 class="custom-title-1 page-break">免疫肿瘤指标评估</h2>

  <div class="bg-white rounded-lg p-5 mb-5 mx-auto" style="width: 100%;">
    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            <i class="fas fa-info-circle icon"></i>
            肿瘤免疫指标是评估机体抗肿瘤免疫功能的重要标志物，通过检测这些指标可以了解机体的免疫监视和抗肿瘤能力。这些指标的变化可以反映肿瘤的发生发展，也可用于免疫治疗的疗效评估和预后判断。
          </p>
        </div>
      </div>
    </div>

    <div class="rounded-table">
      <table class="min-w-full">
        <thead>
        <tr style="background-color: #00B2B4; color: white;">
          <th
            class="py-2 px-4 text-left immunity-first-column"
            style="font-size: 13px;">
            免疫肿瘤指标
          </th>
          <th
            class="py-2 px-4 text-center immunity-second-column"
            style="font-size: 13px; padding: 5px 5px;">
            参考范围
          </th>
          <th
            class="py-2 px-4 text-center immunity-third-column"
            style="font-size: 13px; padding: 5px 5px;">
            评估数值
          </th>
          <th
            class="py-2 px-4 text-center immunity-fourth-column"
            style="font-size: 13px; padding: 5px 5px;">
            评估结果
          </th>
        </tr>
        </thead>
      </table>

      <div id="immune-oncology-markers-data-table-body">
        <!-- 数据将通过 JavaScript 动态插入 -->
      </div>

      <script>
        // 免疫肿瘤指标评估模块
        const ImmuneOncologyEvaluation = {
          // 常量定义
          CONSTANTS: {
            COLORS: {
              RED: '#ff4d4f',
              GREEN: '#52c41a',
              GRAY: '#808080',
              PRIMARY: '#00B2B4'
            },
            // 定义我们需要显示的免疫肿瘤指标列表
            EVALUATION_ITEMS: [
              { name: "嗜铬粒蛋白A", displayName: "嗜铬粒蛋白A", englishName: "Chromogranin A (CgA)" }
            ]
          },

          // 解析范围字符串
          parseRange(rangeStr) {
            if (!rangeStr || typeof rangeStr !== 'string') {
              return { min: 0, max: 0 };
            }
            const parts = rangeStr.split('-');
            return {
              min: parseFloat(parts[0] || 0),
              max: parseFloat(parts[1] || 0)
            };
          },

          // 获取状态信息
          getStatus(value, rangeStr) {
            // 特殊情况处理：若值为"未检出"或"ND"
            if (value === "未检出" || value === "ND") {
              return {
                color: this.CONSTANTS.COLORS.GREEN,
                text: '正常',
                icon: '',
                isNormal: true,
                valueColor: this.CONSTANTS.COLORS.GREEN
              };
            }

            const { min, max } = this.parseRange(rangeStr);
            const numValue = parseFloat(value);

            let status = {
              color: this.CONSTANTS.COLORS.GREEN,
              text: '正常',
              icon: '',
              isNormal: true,
              valueColor: this.CONSTANTS.COLORS.GREEN
            };

            if (numValue < min) {
              status.color = this.CONSTANTS.COLORS.RED;
              status.text = '偏低';
              status.icon = '<i class="fas fa-arrow-down ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>';
              status.isNormal = false;
              status.valueColor = this.CONSTANTS.COLORS.RED;
            }
            else if (numValue > max) {
              status.color = this.CONSTANTS.COLORS.RED;
              status.text = '超标';
              status.icon = '<i class="fas fa-arrow-up ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>';
              status.isNormal = false;
              status.valueColor = this.CONSTANTS.COLORS.RED;
            }

            return status;
          },

          // 计算进度条百分比
          calculateProgress(value, rangeStr) {
            // 处理特殊值
            if (value === "未检出" || value === "ND" || value === 0 || value === "0") {
              return 0;
            }

            const { max } = this.parseRange(rangeStr);
            if (!value || max === 0) return 0;

            const num = Number(value);
            // 使进度条以max值为基准计算百分比，但限制在5%-100%范围内
            const percentage = (num / max) * 100;
            return Math.min(100, Math.max(5, percentage));
          },

          // 创建描述行
          createDescriptionRow(item) {
            if (!item || !item.说明) {
              return '';
            }

            return `
            <tr class="immune-desc-row">
              <td colspan="4" class="py-2 px-4 text-left">
                <div class="description-container text-gray-600" style="font-size: 11px;">
                  <div class="flex items-start mb-0">
                    <div class="ml-1">
                      <p>
                        <i class="fas fa-info-circle" style="color: ${this.CONSTANTS.COLORS.PRIMARY};"></i>
                        ${item.说明}
                      </p>
                    </div>
                  </div>
                </div>
              </td>
            </tr>
          `;
          },

          // 渲染表格
          renderTable(immuneData) {
            const container = document.getElementById('immune-oncology-markers-data-table-body');
            if (!container) {
              console.error('Container element not found');
              return;
            }
            container.innerHTML = '';

            if (!immuneData || !Array.isArray(immuneData) || immuneData.length === 0) {
              container.innerHTML = '<div class="no-data-message">暂无数据</div>';
              return;
            }

            const fragment = document.createDocumentFragment();

            // 遍历我们定义的评估项目列表
            this.CONSTANTS.EVALUATION_ITEMS.forEach(evaluationItem => {
              // 从数据中查找匹配的项目
              const matchedItem = immuneData.find(item =>
                item.检测项目 === evaluationItem.name ||
                item.检测项目.includes(evaluationItem.name)
              );

              if (!matchedItem) {
                // 如果没有找到匹配项，可以选择跳过或显示空值
                return;
              }

              const value = matchedItem.评估值;
              const rangeStr = matchedItem.参考范围;
              const evaluation = matchedItem.结果评价;

              // 获取状态信息
              const status = this.getStatus(value, rangeStr);

              // 如果数据中已有结果评价，更新状态文本
              if (evaluation) {
                status.text = evaluation;
                // 根据评价结果更新颜色
                if (evaluation !== "正常") {
                  status.isNormal = false;
                  status.color = this.CONSTANTS.COLORS.RED;
                  status.valueColor = this.CONSTANTS.COLORS.RED;
                }
              }

              const progressPercentage = this.calculateProgress(value, rangeStr);

              const itemContainer = document.createElement('div');
              itemContainer.className = 'immune-info-container';

              const table = document.createElement('table');
              table.className = 'immune-table min-w-full';

              const dataRow = `
              <tr>
                <td class="py-2 px-4 text-left immunity-first-column">
                  <div class="chinese-text"><strong>${evaluationItem.displayName}</strong></div>
                  <div class="latin-text">${evaluationItem.englishName}</div>
                </td>
                <td class="py-2 px-4 text-center immunity-column-text immunity-second-column">
                  ${rangeStr}
                </td>
                <td class="py-2 px-4 text-center immunity-column-text immunity-third-column">
                  <div class="flex items-center justify-center">
                    <span style="color: ${status.valueColor}">
                      <strong>${value}${status.icon}</strong>
                    </span>
                  </div>
                  <div class="progress-bar w-full mt-2" style="background-color: #e9ecef; height: 8px; border-radius: 4px; overflow: hidden;">
                    <div class="progress"
                         style="width: ${progressPercentage}%;
                                height: 100%;
                                background-color: ${status.isNormal ? this.CONSTANTS.COLORS.GREEN : this.CONSTANTS.COLORS.RED};
                                transition: width 0.3s ease;">
                    </div>
                  </div>
                </td>
                <td class="py-2 px-4 text-center immunity-column-text immunity-fourth-column">
                  <span style="color: ${status.color}">
                    <strong>${status.text}</strong>
                  </span>
                </td>
              </tr>
            `;

              const descRow = this.createDescriptionRow(matchedItem);

              table.innerHTML = `<tbody>${dataRow}${descRow}</tbody>`;
              itemContainer.appendChild(table);
              fragment.appendChild(itemContainer);
            });

            container.appendChild(fragment);
          },

          // 加载数据
          async loadData() {
            try {
              const response = await fetch(DATA_PATHS.DATA);
              if (!response.ok) {
                throw new Error(`Network response error: ${response.status}`);
              }
              const data = await response.json();
              // 使用"免疫肿瘤指标"数据
              this.renderTable(data["免疫指标"] || []);
            } catch (error) {
              console.error('Error loading immune oncology data:', error);
              document.getElementById('immune-oncology-markers-data-table-body').innerHTML =
                '<div class="no-data-message">暂无数据</div>';
            }
          },

          // 初始化
          init() {
            document.addEventListener('DOMContentLoaded', () => this.loadData());
          }
        };

        // 初始化免疫肿瘤指标评估模块
        ImmuneOncologyEvaluation.init();
      </script>
    </div>
  </div>

  <!-- 日常饮食和矿物质微量元素评估板块 -->
  <h3 class="custom-title-1 page-break">日常饮食和微量元素评估</h3>

  <div class="bg-white rounded-lg p-5 mb-5 mx-auto" style="width: 100%;">
    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            <i class="fas fa-info-circle icon"></i>
            糖、盐、膳食纤维和乳制品是人体日常饮食中重要的营养成分，对维持人体基本生理功能和健康发挥着关键作用。本报告将通过肠道菌群等检测指标，全面评估这些营养成分在人体中的代谢水平和整体状况。
          </p>
        </div>
      </div>
    </div>

    <!-- 日常饮食表格 -->
    <div class="rounded-table">
      <table class="min-w-full">
        <thead>
        <!-- 标题行 -->
        <tr style="background-color: #00B2B4; color: white;">
          <th
            class="py-2 px-4 text-left nutrition-first-column"
            style="font-size: 13px;">
            饮食评估指标
          </th>
          <th
            class="py-2 px-4 text-center nutrition-second-column"
            style="font-size: 13px; padding: 5px 5px;">
            参考范围（缺乏-不足-过量）
          </th>
          <th
            class="py-2 px-4 text-center nutrition-third-column"
            style="font-size: 13px; padding: 5px 5px;">
            评估数值
          </th>
          <th
            class="py-2 px-4 text-center nutrition-fourth-column"
            style="font-size: 13px; padding: 5px 5px;">
            评估结果
          </th>
        </tr>
        </thead>
      </table>

      <div id="daily-food-data-table-body">
        <!-- 数据将通过 JavaScript 动态插入 -->
      </div>

      <script>
        // 日常饮食和微量元素评估模块
        const DietaryAssessment = {
          // 常量定义
          CONSTANTS: {
            COLORS: {
              RED: '#ff4d4f',     // 缺乏（红色）
              YELLOW: '#fadb14',  // 不足（黄色）
              GREEN: '#52c41a',   // 正常（绿色）
              BLUE: '#ff4d4f',    // 过量（蓝色）
              PRIMARY: '#00B2B4'  // 主题色
            },
            // 定义需要显示的饮食指标列表
            EVALUATION_ITEMS: [
              { name: "糖", displayName: "糖", englishName: "Sugar" },
              { name: "盐", displayName: "盐", englishName: "Salt" },
              { name: "膳食纤维", displayName: "膳食纤维", englishName: "Dietary Fiber" },
              { name: "乳制品", displayName: "乳制品", englishName: "Dairy Products" },
              { name: "铁", displayName: "铁", englishName: "Iron" },
              { name: "锌", displayName: "锌", englishName: "Zinc" }
            ]
          },

          // 解析范围字符串（缺乏-不足-过量）
          parseRange(rangeStr) {
            if (!rangeStr || typeof rangeStr !== 'string') {
              return { deficiency: 0, insufficiency: 0, excess: 100 };
            }

            const parts = rangeStr.split('-');
            return {
              deficiency: parseFloat(parts[0] || 0),
              insufficiency: parseFloat(parts[1] || 0),
              excess: parseFloat(parts[2] || 100)
            };
          },

          // 获取状态信息
          getStatus(value, rangeStr) {
            const { deficiency, insufficiency, excess } = this.parseRange(rangeStr);
            const numValue = parseFloat(value);

            let status = {
              color: this.CONSTANTS.COLORS.GREEN,
              text: '正常',
              isNormal: true,
              showArrow: false,
              arrowDirection: 'none'
            };

            if (numValue < deficiency) {
              status.color = this.CONSTANTS.COLORS.RED;
              status.text = '缺乏';
              status.isNormal = false;
              status.showArrow = true;
              status.arrowDirection = 'down';
            } else if (numValue < insufficiency) {
              status.color = this.CONSTANTS.COLORS.YELLOW;
              status.text = '不足';
              status.isNormal = false;
              status.showArrow = true;
              status.arrowDirection = 'down';
            } else if (numValue >= excess) {
              status.color = this.CONSTANTS.COLORS.BLUE;
              status.text = '过量';
              status.isNormal = false;
              status.showArrow = true;
              status.arrowDirection = 'up';
            }

            return status;
          },

          // 计算进度条百分比
          calculateProgress(value, rangeStr) {
            if (!value) return 0;

            const { excess } = this.parseRange(rangeStr);
            const numValue = parseFloat(value);

            // 以excess为基准计算百分比，但不超过100%
            const percentage = (numValue / excess) * 100;
            return Math.min(100, Math.max(5, percentage));
          },

          // 获取箭头HTML
          getArrowHtml(status) {
            if (!status.showArrow) return '';

            const arrowIcon = status.arrowDirection === 'up'
              ? '<i class="fas fa-arrow-up"></i>'
              : '<i class="fas fa-arrow-down"></i>';

            return `<span style="color: ${status.color}; margin-left: 5px;">${arrowIcon}</span>`;
          },

          // 创建描述行
          createDescriptionRow(item) {
            if (!item || !item.说明) {
              return '';
            }

            return `
          <tr class="dietary-desc-row">
            <td colspan="4" class="py-2 px-4 text-left">
              <div class="description-container text-gray-600" style="font-size: 11px;">
                <div class="flex items-start mb-0">
                  <div class="ml-1">
                    <p>
                      <i class="fas fa-info-circle" style="color: ${this.CONSTANTS.COLORS.PRIMARY};"></i>
                      ${item.说明}
                    </p>
                  </div>
                </div>
              </div>
            </td>
          </tr>
        `;
          },

          // 渲染表格
          renderTable(dietaryData) {
            const container = document.getElementById('daily-food-data-table-body');
            if (!container) {
              console.error('Container element not found');
              return;
            }
            container.innerHTML = '';

            if (!dietaryData || !Array.isArray(dietaryData) || dietaryData.length === 0) {
              container.innerHTML = '<div class="no-data-message">暂无数据</div>';
              return;
            }

            const fragment = document.createDocumentFragment();

            // 遍历我们定义的评估项目列表
            this.CONSTANTS.EVALUATION_ITEMS.forEach(evaluationItem => {
              // 从数据中查找匹配的项目
              const matchedItem = dietaryData.find(item =>
                item.检测项目 === evaluationItem.name ||
                item.检测项目.includes(evaluationItem.name));

              if (!matchedItem) {
                // 如果没有找到匹配项，可以选择跳过或显示空值
                return;
              }

              const value = matchedItem.评估值;
              const rangeStr = matchedItem.参考范围;
              const evaluation = matchedItem.结果评价;

              // 获取状态信息
              const status = this.getStatus(value, rangeStr);

              // 如果数据中已有结果评价，更新状态文本
              if (evaluation) {
                status.text = evaluation;
              }

              // 获取箭头HTML
              const arrowHtml = this.getArrowHtml(status);

              const progressPercentage = this.calculateProgress(value, rangeStr);

              const itemContainer = document.createElement('div');
              itemContainer.className = 'dietary-info-container';

              const table = document.createElement('table');
              table.className = 'dietary-table min-w-full';

              const dataRow = `
            <tr>
              <td class="py-2 px-4 text-left nutrition-first-column">
                <div class="chinese-text"><strong>${evaluationItem.displayName}</strong></div>
                <div class="latin-text">${evaluationItem.englishName}</div>
              </td>
              <td class="py-2 px-4 text-center nutrition-column-text nutrition-second-column">
                ${rangeStr.replace(/-/g, '-')}
              </td>
              <td class="py-2 px-4 text-center nutrition-column-text nutrition-third-column">
                <div class="flex items-center justify-center">
                  <span style="color: ${status.color}">
                    <strong>${value}</strong>
                  </span>
                  ${arrowHtml}
                </div>
              </td>
              <td class="py-2 px-4 text-center nutrition-column-text nutrition-fourth-column">
                <span style="color: ${status.color}">
                  <strong>${status.text}</strong>
                </span>
              </td>
            </tr>
          `;

              const descRow = this.createDescriptionRow(matchedItem);

              table.innerHTML = `<tbody>${dataRow}${descRow}</tbody>`;
              itemContainer.appendChild(table);
              fragment.appendChild(itemContainer);
            });

            container.appendChild(fragment);
          },

          // 加载数据
          async loadData() {
            try {
              const response = await fetch(DATA_PATHS.DATA);
              if (!response.ok) {
                throw new Error(`Network response error: ${response.status}`);
              }
              const data = await response.json();
              // 使用"营养评估"数据
              this.renderTable(data["营养评估"] || []);
            } catch (error) {
              console.error('Error loading dietary assessment data:', error);
              document.getElementById('daily-food-data-table-body').innerHTML =
                '<div class="no-data-message">暂无数据</div>';
            }
          },

          // 初始化
          init() {
            document.addEventListener('DOMContentLoaded', () => this.loadData());
          }
        };

        // 初始化日常饮食和微量元素评估模块
        DietaryAssessment.init();
      </script>
    </div>
  </div>

  <!-- 维生素评估板块 -->
  <h3
    class="custom-title-third-level page-break">
    维生素评估
  </h3>

  <div
    class="bg-white rounded-lg p-5 mb-5 mx-auto"
    style="width: 100%;">

    <!-- 维生素表格 -->
    <div class="rounded-table">
      <table class="min-w-full">
        <thead>
        <!-- 标题行 -->
        <tr style="background-color: #00B2B4; color: white;">
          <th
            class="py-2 px-4 text-left nutrition-first-column"
            style="font-size: 13px;">
            维生素评估指标
          </th>
          <th
            class="py-2 px-4 text-center nutrition-second-column"
            style="font-size: 13px; padding: 5px 5px;">
            参考范围（缺乏-不足-过量）
          </th>
          <th
            class="py-2 px-4 text-center nutrition-third-column"
            style="font-size: 13px; padding: 5px 5px;">
            评估数值
          </th>
          <th
            class="py-2 px-4 text-center nutrition-fourth-column"
            style="font-size: 13px; padding: 5px 5px;">
            评估结果
          </th>
        </tr>
        </thead>
      </table>

      <div id="vitamins-data-table-body">
        <!-- 数据将通过 JavaScript 动态插入 -->
      </div>

      <script>
        // 维生素评估模块
        const VitaminsAssessment = {
          // 常量定义
          CONSTANTS: {
            COLORS: {
              RED: '#ff4d4f',     // 缺乏（红色）
              YELLOW: '#fadb14',  // 不足（黄色）
              GREEN: '#52c41a',   // 正常（绿色）
              BLUE: '#ff4d4f',    // 过量（红色）- 改为与日常饮食一致
              PRIMARY: '#00B2B4'  // 主题色
            },
            // 定义需要显示的维生素指标列表
            EVALUATION_ITEMS: [
              { name: "维生素A", displayName: "维生素A", englishName: "Vitamin A" },
              { name: "维生素B1", displayName: "维生素B1", englishName: "Vitamin B1" },
              { name: "维生素B2", displayName: "维生素B2", englishName: "Vitamin B2" },
              { name: "维生素B6", displayName: "维生素B6", englishName: "Vitamin B6" },
              { name: "维生素B12", displayName: "维生素B12", englishName: "Vitamin B12" },
              { name: "叶酸", displayName: "维生素B9 (叶酸)", englishName: "Folic Acid" },
              { name: "维生素C", displayName: "维生素C", englishName: "Vitamin C" },
              { name: "维生素D", displayName: "维生素D", englishName: "Vitamin D" },
              { name: "维生素E", displayName: "维生素E", englishName: "Vitamin E" },
              { name: "维生素K", displayName: "维生素K", englishName: "Vitamin K" }
            ]
          },

          // 解析范围字符串
          parseRange(rangeStr) {
            if (!rangeStr || typeof rangeStr !== 'string') {
              return { deficiency: 0, insufficiency: 0, excess: 100 };
            }

            const parts = rangeStr.split('-');
            return {
              deficiency: parseFloat(parts[0] || 0),
              insufficiency: parseFloat(parts[1] || 0),
              excess: parseFloat(parts[2] || 100)
            };
          },

          // 获取状态信息
          getStatus(value, rangeStr) {
            const { deficiency, insufficiency, excess } = this.parseRange(rangeStr);
            const numValue = parseFloat(value);

            let status = {
              color: this.CONSTANTS.COLORS.GREEN,
              text: '正常',
              isNormal: true,
              showArrow: false,
              arrowDirection: 'none'
            };

            if (numValue < deficiency) {
              status.color = this.CONSTANTS.COLORS.RED;
              status.text = '缺乏';
              status.isNormal = false;
              status.showArrow = true;
              status.arrowDirection = 'down';
            } else if (numValue < insufficiency) {
              status.color = this.CONSTANTS.COLORS.YELLOW;
              status.text = '不足';
              status.isNormal = false;
              status.showArrow = true;
              status.arrowDirection = 'down';
            } else if (numValue >= excess) {
              status.color = this.CONSTANTS.COLORS.BLUE;
              status.text = '过量';
              status.isNormal = false;
              status.showArrow = true;
              status.arrowDirection = 'up';
            }

            return status;
          },

          // 获取箭头HTML
          getArrowHtml(status) {
            if (!status.showArrow) return '';

            const arrowIcon = status.arrowDirection === 'up'
              ? '<i class="fas fa-arrow-up"></i>'
              : '<i class="fas fa-arrow-down"></i>';

            return `<span style="color: ${status.color}; margin-left: 5px;">${arrowIcon}</span>`;
          },

          // 创建描述行
          createDescriptionRow(item) {
            if (!item || !item.说明) {
              return '';
            }

            return `
          <tr class="vitamins-desc-row">
            <td colspan="4" class="py-2 px-4 text-left">
              <div class="description-container text-gray-600" style="font-size: 11px;">
                <div class="flex items-start mb-0">
                  <div class="ml-1">
                    <p>
                      <i class="fas fa-info-circle" style="color: ${this.CONSTANTS.COLORS.PRIMARY};"></i>
                      ${item.说明}
                    </p>
                  </div>
                </div>
              </div>
            </td>
          </tr>
        `;
          },

          // 渲染表格
          renderTable(vitaminsData) {
            const container = document.getElementById('vitamins-data-table-body');
            if (!container) {
              console.error('Container element not found');
              return;
            }
            container.innerHTML = '';

            if (!vitaminsData || !Array.isArray(vitaminsData) || vitaminsData.length === 0) {
              container.innerHTML = '<div class="no-data-message">暂无数据</div>';
              return;
            }

            const fragment = document.createDocumentFragment();

            // 遍历我们定义的评估项目列表
            this.CONSTANTS.EVALUATION_ITEMS.forEach(evaluationItem => {
              // 从数据中查找匹配的项目
              const matchedItem = vitaminsData.find(item =>
                item.检测项目 === evaluationItem.name ||
                item.检测项目.includes(evaluationItem.name));

              if (!matchedItem) {
                // 如果没有找到匹配项，可以选择跳过或显示空值
                return;
              }

              const value = matchedItem.评估值;
              const rangeStr = matchedItem.参考范围;
              const evaluation = matchedItem.结果评价;

              // 获取状态信息
              const status = this.getStatus(value, rangeStr);

              // 如果数据中已有结果评价，更新状态文本
              if (evaluation) {
                status.text = evaluation;
              }

              // 获取箭头HTML
              const arrowHtml = this.getArrowHtml(status);

              const itemContainer = document.createElement('div');
              itemContainer.className = 'bacteria-info-container';

              const table = document.createElement('table');
              table.className = 'vitamins-table min-w-full';

              const dataRow = `
                <tr>
                  <td class="py-2 px-4 text-left nutrition-first-column">
                    <div class="chinese-text"><strong>${evaluationItem.displayName}</strong></div>
                    <div class="latin-text">${evaluationItem.englishName}</div>
                  </td>
                  <td class="py-2 px-4 text-center nutrition-column-text nutrition-second-column">
                    ${rangeStr.replace(/-/g, '-')}
                  </td>
                  <td class="py-2 px-4 text-center nutrition-column-text nutrition-third-column">
                    <div class="flex items-center justify-center">
                      <span style="color: ${status.color}">
                        <strong>${value}</strong>
                      </span>
                      ${arrowHtml}
                    </div>
                  </td>
                  <td class="py-2 px-4 text-center nutrition-column-text nutrition-fourth-column">
                    <span style="color: ${status.color}">
                      <strong>${status.text}</strong>
                    </span>
                  </td>
                </tr>
              `;

              const descRow = this.createDescriptionRow(matchedItem);

              table.innerHTML = `<tbody>${dataRow}${descRow}</tbody>`;
              itemContainer.appendChild(table);
              fragment.appendChild(itemContainer);
            });

            container.appendChild(fragment);
          },

          // 加载数据
          async loadData() {
            try {
              const response = await fetch(DATA_PATHS.DATA);
              if (!response.ok) {
                throw new Error(`Network response error: ${response.status}`);
              }
              const data = await response.json();
              // 使用"维生素"数据
              this.renderTable(data["营养评估"] || []);
            } catch (error) {
              console.error('Error loading vitamins data:', error);
              document.getElementById('vitamins-data-table-body').innerHTML =
                '<div class="no-data-message">暂无数据</div>';
            }
          },

          // 初始化
          init() {
            document.addEventListener('DOMContentLoaded', () => this.loadData());
          }
        };

        // 初始化维生素评估模块
        VitaminsAssessment.init();
      </script>
    </div>
  </div>

  <!-- 氨基酸评估板块 -->
  <h3 class="custom-title-third-level page-break">氨基酸评估</h3>

  <div class="bg-white rounded-lg p-5 mb-5 mx-auto" style="width: 100%;">
    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            <i class="fas fa-info-circle icon"></i>
            氨基酸是蛋白质的基本构建单位，在人体内参与多种重要的生理功能。人体所需的 20 种氨基酸中，9 种必需氨基酸需要从食物中获取，其余可由人体自身合成。氨基酸评估可以反映蛋白质营养状况以及代谢功能等。
          </p>
        </div>
      </div>
    </div>

    <!-- 氨基酸表格 -->
    <div class="rounded-table">
      <table class="min-w-full">
        <thead>
        <tr style="background-color: #00B2B4; color: white;">
          <th
            class="py-2 px-4 text-left nutrition-first-column"
            style="font-size: 13px;">
            氨基酸评估指标
          </th>
          <th
            class="py-2 px-4 text-center nutrition-second-column"
            style="font-size: 13px; padding: 5px 5px;">
            参考范围（缺乏-不足-过量）
          </th>
          <th
            class="py-2 px-4 text-center nutrition-third-column"
            style="font-size: 13px; padding: 5px 5px;">
            评估数值
          </th>
          <th
            class="py-2 px-4 text-center nutrition-fourth-column"
            style="font-size: 13px; padding: 5px 5px;">
            评估结果
          </th>
        </tr>
        </thead>
      </table>

      <div id="amino-acids-data-table-body">
        <!-- 数据将通过 JavaScript 动态插入 -->
      </div>

      <script>
        // 氨基酸评估模块
        const AminoAcidsAssessment = {
          // 常量定义
          CONSTANTS: {
            COLORS: {
              RED: '#ff4d4f',     // 缺乏（红色）
              YELLOW: '#fadb14',  // 不足（黄色）
              GREEN: '#52c41a',   // 正常（绿色）
              BLUE: '#ff4d4f',    // 过量（红色）- 改为与其他板块一致
              PRIMARY: '#00B2B4'  // 主题色
            },
            // 定义需要显示的氨基酸指标列表
            EVALUATION_ITEMS: [
              { name: "苏氨酸", displayName: "苏氨酸", englishName: "Threonine" },
              { name: "异亮氨酸", displayName: "异亮氨酸", englishName: "Isoleucine" },
              { name: "亮氨酸", displayName: "亮氨酸", englishName: "Leucine" },
              { name: "赖氨酸", displayName: "赖氨酸", englishName: "Lysine" },
              { name: "蛋氨酸", displayName: "蛋氨酸", englishName: "Methionine" },
              { name: "半胱氨酸", displayName: "半胱氨酸", englishName: "Cysteine" },
              { name: "苯丙氨酸", displayName: "苯丙氨酸", englishName: "Phenylalanine" },
              { name: "酪氨酸", displayName: "酪氨酸", englishName: "Tyrosine" },
              { name: "缬氨酸", displayName: "缬氨酸", englishName: "Valine" },
              { name: "组氨酸", displayName: "组氨酸", englishName: "Histidine" },
              { name: "丙氨酸", displayName: "丙氨酸", englishName: "Alanine" },
              { name: "谷氨酸", displayName: "谷氨酸", englishName: "Glutamic Acid" },
              { name: "甘氨酸", displayName: "甘氨酸", englishName: "Glycine" },
              { name: "脯氨酸", displayName: "脯氨酸", englishName: "Proline" },
              { name: "丝氨酸", displayName: "丝氨酸", englishName: "Serine" },
              { name: "色氨酸", displayName: "色氨酸", englishName: "Tryptophan" }
            ]
          },

          // 解析范围字符串
          parseRange(rangeStr) {
            if (!rangeStr || typeof rangeStr !== 'string') {
              return { deficiency: 0, insufficiency: 0, excess: 100 };
            }

            const parts = rangeStr.split('-');
            return {
              deficiency: parseFloat(parts[0] || 0),
              insufficiency: parseFloat(parts[1] || 0),
              excess: parseFloat(parts[2] || 100)
            };
          },

          // 获取状态信息
          getStatus(value, rangeStr) {
            const { deficiency, insufficiency, excess } = this.parseRange(rangeStr);

            // 处理非数值情况，如 "ND"（未检出）
            if (value === "ND" || isNaN(parseFloat(value))) {
              return {
                color: this.CONSTANTS.COLORS.GREEN,
                text: '正常',
                isNormal: true,
                showArrow: false,
                arrowDirection: 'none'
              };
            }

            const numValue = parseFloat(value);

            let status = {
              color: this.CONSTANTS.COLORS.GREEN,
              text: '正常',
              isNormal: true,
              showArrow: false,
              arrowDirection: 'none'
            };

            if (numValue < deficiency) {
              status.color = this.CONSTANTS.COLORS.RED;
              status.text = '缺乏';
              status.isNormal = false;
              status.showArrow = true;
              status.arrowDirection = 'down';
            } else if (numValue < insufficiency) {
              status.color = this.CONSTANTS.COLORS.YELLOW;
              status.text = '不足';
              status.isNormal = false;
              status.showArrow = true;
              status.arrowDirection = 'down';
            } else if (numValue >= excess) {
              status.color = this.CONSTANTS.COLORS.BLUE;
              status.text = '过量';
              status.isNormal = false;
              status.showArrow = true;
              status.arrowDirection = 'up';
            }

            return status;
          },

          // 获取箭头HTML
          getArrowHtml(status) {
            if (!status.showArrow) return '';

            const arrowIcon = status.arrowDirection === 'up'
              ? '<i class="fas fa-arrow-up"></i>'
              : '<i class="fas fa-arrow-down"></i>';

            return `<span style="color: ${status.color}; margin-left: 5px;">${arrowIcon}</span>`;
          },

          // 创建描述行
          createDescriptionRow(item) {
            if (!item || !item.说明) {
              return '';
            }

            return `
          <tr class="amino-acids-desc-row">
            <td colspan="4" class="py-2 px-4 text-left">
              <div class="description-container text-gray-600" style="font-size: 10px;">
                <div class="flex items-start">
                  <div class="ml-1">
                    <p>
                      <i class="fas fa-info-circle" style="color: ${this.CONSTANTS.COLORS.PRIMARY};"></i>
                      ${item.说明}
                    </p>
                  </div>
                </div>
              </div>
            </td>
          </tr>
        `;
          },

          // 渲染表格
          renderTable(aminoacidsData) {
            const container = document.getElementById('amino-acids-data-table-body');
            if (!container) {
              console.error('Container element not found');
              return;
            }
            container.innerHTML = '';

            if (!aminoacidsData || !Array.isArray(aminoacidsData) || aminoacidsData.length === 0) {
              container.innerHTML = '<div class="no-data-message">暂无数据</div>';
              return;
            }

            const fragment = document.createDocumentFragment();

            // 遍历我们定义的评估项目列表
            this.CONSTANTS.EVALUATION_ITEMS.forEach(evaluationItem => {
              // 从数据中查找匹配的项目
              const matchedItem = aminoacidsData.find(item =>
                item.检测项目 === evaluationItem.name ||
                item.检测项目.includes(evaluationItem.name));

              if (!matchedItem) {
                // 如果没有找到匹配项，可以选择跳过或显示空值
                return;
              }

              const value = matchedItem.评估值;
              const rangeStr = matchedItem.参考范围;
              const evaluation = matchedItem.结果评价;

              // 获取状态信息
              const status = this.getStatus(value, rangeStr);

              // 如果数据中已有结果评价，更新状态文本
              if (evaluation) {
                status.text = evaluation;
              }

              // 获取箭头HTML
              const arrowHtml = this.getArrowHtml(status);

              const itemContainer = document.createElement('div');
              itemContainer.className = 'amino-acids-info-container';

              const table = document.createElement('table');
              table.className = 'amino-acids-table min-w-full';

              const dataRow = `
            <tr>
              <td class="py-2 px-4 text-left nutrition-first-column">
                <div class="chinese-text"><strong>${evaluationItem.displayName}</strong></div>
                <div class="latin-text">${evaluationItem.englishName}</div>
              </td>
              <td class="py-2 px-4 text-center nutrition-column-text nutrition-second-column" style="font-size: 0.65rem;">
                ${rangeStr.replace(/-/g, '-')}
              </td>
              <td class="py-2 px-4 text-center nutrition-column-text nutrition-third-column" style="font-size: 0.65rem;">
                <div class="flex items-center justify-center">
                  <span style="color: ${status.color}">
                    <strong>${value}</strong>
                  </span>
                  ${arrowHtml}
                </div>
              </td>
              <td class="py-2 px-4 text-center nutrition-column-text nutrition-fourth-column" style="font-size: 0.65rem;">
                <span style="color: ${status.color}">
                  <strong>${status.text}</strong>
                </span>
              </td>
            </tr>
          `;

              const descRow = this.createDescriptionRow(matchedItem);

              table.innerHTML = `<tbody>${dataRow}${descRow}</tbody>`;
              itemContainer.appendChild(table);
              fragment.appendChild(itemContainer);
            });

            container.appendChild(fragment);
          },

          // 加载数据
          async loadData() {
            try {
              const response = await fetch(DATA_PATHS.DATA);
              if (!response.ok) {
                throw new Error(`Network response error: ${response.status}`);
              }
              const data = await response.json();
              // 使用"氨基酸"数据
              this.renderTable(data["营养评估"] || []);
            } catch (error) {
              console.error('Error loading amino acids data:', error);
              document.getElementById('amino-acids-data-table-body').innerHTML =
                '<div class="no-data-message">暂无数据</div>';
            }
          },

          // 初始化
          init() {
            document.addEventListener('DOMContentLoaded', () => this.loadData());
          }
        };

        // 初始化氨基酸评估模块
        AminoAcidsAssessment.init();
      </script>
    </div>
  </div>

  <!-- 慢病整体对比图示 -->
  <h2 class="custom-title-second-level page-break">慢病风险评估</h2>

  <div class="bg-white rounded-lg p-5 mb-5 mx-auto" style="width: 100%;">

    <!-- 信息框 -->
    <div class="info-box mb-10">
      <div class="flex items-start">
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            <i class="fas fa-info-circle icon"></i>
            肠道菌群是人体最大的微生物群落，在维持人体健康中发挥着关键作用。大量研究表明，肠道菌群的失衡与多种慢性疾病（包括但不限于消化系统疾病，免疫系统疾病，代谢性疾病，心脑血管疾病，神经系统疾病等）的发生发展密切相关。通过对肠道菌群的分析，我们可以及早发现疾病风险，实现疾病的预防和干预。下列图式是您整体的慢病风险评估汇总与对比。
          </p>
        </div>
      </div>
    </div>

    <div id="slow-disease-summary-container" class="flex flex-col gap-4 w-full">
      <!-- 内容将通过JavaScript动态生成 -->
    </div>

    <script>
      // 确保 DATA_PATHS 已定义
      if (typeof DATA_PATHS === 'undefined') {
        var DATA_PATHS = {
          DATA: './data.json' // 默认路径，请确保这个路径是正确的
        };
      }

      // 慢病风险评估汇总图示模块
      const SlowDiseaseSummary = {
        // 常量定义
        CONSTANTS: {
          COLORS: {
            GREEN: '#4ade80',   // 低风险 (绿色)
            YELLOW: '#facc15',  // 注意 (黄色)
            ORANGE: '#fb923c',  // 中高风险 (橙色)
            RED: '#f87171',     // 高风险 (红色)
            GRAY: '#e5e7eb'     // 背景色 (灰色)
          },
          CATEGORIES: {
            INTESTINAL: {
              name: "肠道疾病",
              diseases: ["炎症性肠炎", "肠易激综合征", "感染型腹泻", "肠道病毒感染", "过敏性腹泻"]
            },
            ORGAN: {
              name: "器官性疾病",
              diseases: ["肝病", "心脑血管疾病", "甲状腺疾病", "肺部疾病"]
            },
            NEURO: {
              name: "神经系统",
              diseases: ["神经行为发育异常"]
            }
          }
        },

        // 获取风险颜色
        getRiskColor(value) {
          if (value < 0.3) return this.CONSTANTS.COLORS.GREEN;
          if (value < 0.5) return this.CONSTANTS.COLORS.YELLOW;
          if (value < 0.7) return this.CONSTANTS.COLORS.ORANGE;
          return this.CONSTANTS.COLORS.RED;
        },

        // 创建标准风险进度条
        createRiskStandardRow() {
          return `
          <!-- 第一行 -->
          <div class="flex gap-2">
            <!-- 风险评估参考标准 -->
            <div class="w-[410px] slow-disease-summary-info-card py-2 flex justify-center items-center">
              <div class="text-base font-bold">风险评估参考标准</div>
            </div>

            <!-- 风险进度条 -->
            <div class="w-[600px] summary-info-card p-4 flex flex-col justify-center gap-1">
              <!-- 风险标签 -->
              <div class="flex w-full">
                <div class="w-[30%] text-center">
                  <span class="text-sm text-gray-600">低风险</span>
                </div>
                <div class="w-[20%] text-center">
                  <span class="text-sm text-gray-600">注意</span>
                </div>
                <div class="w-[20%] text-center">
                  <span class="text-sm text-gray-600">中高风险</span>
                </div>
                <div class="w-[30%] text-center">
                  <span class="text-sm text-gray-600">高风险</span>
                </div>
              </div>

              <!-- 分段进度条 -->
              <div class="flex w-full h-3 rounded-full overflow-hidden">
                <div class="bg-green-400" style="width: 30%"></div>
                <div class="bg-yellow-400" style="width: 20%"></div>
                <div class="bg-orange-400" style="width: 20%"></div>
                <div class="bg-red-400" style="width: 30%"></div>
              </div>

              <!-- 刻度值 -->
              <div class="flex w-full h-4 relative">
                <div class="absolute w-full flex">
                  <span class="absolute left-0 -translate-x-1/2 text-xs text-gray-500">0</span>
                  <span class="absolute left-[30%] -translate-x-1/2 text-xs text-gray-500">0.3</span>
                  <span class="absolute left-[50%] -translate-x-1/2 text-xs text-gray-500">0.5</span>
                  <span class="absolute left-[70%] -translate-x-1/2 text-xs text-gray-500">0.7</span>
                  <span class="absolute right-0 -translate-x-1/2 text-xs text-gray-500">1</span>
                </div>
              </div>
            </div>
          </div>
        `;
        },

        // 创建疾病名称列表HTML
        createDiseaseNamesList(diseases) {
          return diseases.map(disease => `
          <div class="slow-disease-summary-info-card py-1 px-4 flex-1 flex justify-end items-center"
               style="background: linear-gradient(135deg, #F5F8FF, #FAFBFF);">
            <div class="text-base font-bold">${disease.name}</div>
          </div>
        `).join('');
        },

        // 创建进度条HTML
        createProgressBars(diseases) {
          return diseases.map(disease => {
            const percentage = (disease.value * 100).toFixed(0);
            const color = this.getRiskColor(disease.value);

            return `
            <div class="summary-info-card py-1 px-4 flex-1 flex items-center">
              <div class="flex-1">
                <div class="w-full bg-gray-200 rounded-full h-6 relative">
                  <div class="${this.getColorClass(color)} h-6 rounded-full flex items-center justify-end pr-2"
                       style="width: ${percentage}%">
                    <span class="text-white font-medium" style="font-size: 0.5rem;"><strong>${percentage}%</strong></span>
                  </div>
                </div>
              </div>
            </div>
          `;
          }).join('');
        },

        // 获取颜色类
        getColorClass(color) {
          const colorMap = {
            [this.CONSTANTS.COLORS.GREEN]: 'bg-green-400',
            [this.CONSTANTS.COLORS.YELLOW]: 'bg-yellow-400',
            [this.CONSTANTS.COLORS.ORANGE]: 'bg-orange-400',
            [this.CONSTANTS.COLORS.RED]: 'bg-red-400'
          };
          return colorMap[color] || 'bg-gray-400';
        },

        // 创建分类行
        createCategoryRow(categoryKey, categoryData, diseaseDataMap) {
          const category = this.CONSTANTS.CATEGORIES[categoryKey];
          const rowHeight = category.diseases.length * 50; // 每个疾病50px高度

          // 找出此分类中的所有疾病数据
          const diseasesInCategory = category.diseases
            .map(diseaseName => {
              const diseaseData = diseaseDataMap[diseaseName];
              return diseaseData ? {
                name: diseaseName,
                value: diseaseData.评估值
              } : null;
            })
            .filter(data => data !== null);

          // 如果没有此分类的疾病数据，则不生成此行
          if (diseasesInCategory.length === 0) return '';

          return `
          <div class="flex gap-2" style="height: ${rowHeight}px">
            <!-- 左侧区域（包含标题和疾病列表） -->
            <div class="w-[400px] flex gap-2">
              <!-- 分类标题 -->
              <div class="w-[80px] slow-disease-summary-info-card py-2 flex justify-center items-center"
                   style="background: linear-gradient(135deg, #E6F4F1, #F0F7F7);">
                <div class="${categoryKey === 'INTESTINAL' || categoryKey === 'ORGAN' ? 'writing-vertical' : ''} text-base font-bold">
                  ${category.name}
                </div>
              </div>

              <!-- 疾病名称列表 -->
              <div class="flex-1 flex flex-col gap-2">
                ${this.createDiseaseNamesList(diseasesInCategory)}
              </div>
            </div>

            <!-- 右侧进度条列表 -->
            <div class="w-[600px] flex flex-col gap-2">
              ${this.createProgressBars(diseasesInCategory)}
            </div>
          </div>
        `;
        },

        // 处理数据并生成HTML
        generateHTML(data) {
          if (!data || !data.慢病风险 || !Array.isArray(data.慢病风险)) {
            return '<div class="text-center p-4 text-red-500">暂无慢病风险数据</div>';
          }

          // 创建疾病名称到数据的映射
          const diseaseDataMap = {};
          data.慢病风险.forEach(disease => {
            if (disease && disease.检测项目) {
              diseaseDataMap[disease.检测项目] = disease;
            }
          });

          // 生成HTML
          let html = this.createRiskStandardRow();

          // 生成每个分类的行
          for (const categoryKey in this.CONSTANTS.CATEGORIES) {
            html += this.createCategoryRow(categoryKey, this.CONSTANTS.CATEGORIES[categoryKey], diseaseDataMap);
          }

          return html;
        },

        // 渲染图表
        render(data) {
          const container = document.getElementById('slow-disease-summary-container');
          if (!container) {
            console.error('找不到慢病风险汇总容器元素');
            return;
          }

          container.innerHTML = this.generateHTML(data);
        },

        // 加载数据
        async loadData() {
          try {
            const response = await fetch(DATA_PATHS.DATA);
            if (!response.ok) {
              throw new Error(`网络响应错误: ${response.status}`);
            }

            const data = await response.json();
            this.render(data);
          } catch (error) {
            console.error('加载慢病风险数据时出错:', error);
            document.getElementById('slow-disease-summary-container').innerHTML =
              '<div class="text-center p-4 text-red-500">数据加载失败，请稍后再试</div>';
          }
        },

        // 初始化
        init() {
          if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => this.loadData());
          } else {
            this.loadData();
          }
        }
      };

      // 初始化慢病风险汇总模块
      SlowDiseaseSummary.init();
    </script>
  </div>

  <h3 class="custom-title-third-level page-break">阅读指南</h3>

  <div class="bg-white rounded-lg p-5 mb-5 mx-auto" style="width: 100%;">
    <!-- 问答信息框 -->
    <div class="qa-box">
      <div class="flex items-start ml-2">
        <p class="text-lg font-bold text-lightpurple">
          <i class="fas fa-question-circle icon icon-purple"></i>
          如何阅读慢病风险评估的表格？
        </p>
      </div>
      <div class="flex items-start ml-2 mt-2">
        <p class="answer-text">
          <i class="fas fa-comments icon icon-orange"></i>
          以下是对慢病风险评估的表格中的各部分信息进行的说明解释：
        </p>
      </div>
      <div class="flex items-start ml-2 mt-2">
        <ul style="margin-left: 50px; list-style-type: disc;">
          <li class="answer-text">
            <strong>慢病名称：</strong>
            这一列列出进行风险评估的慢病名称。
          </li>
          <li class="answer-text">
            <strong>风险评估数值：</strong>
            此列显示该慢病的具体风险评估数值，以0-1之间的小数和进度条显示（进度条中的刻度代表了四个风险等级所对应的区间）。
          </li>
          <li class="answer-text">
            <strong>风险评估结果：</strong>
            这一列显示该慢病的风险评估值经过预设的4个风险等级区间比较后所得到的对应的风险评估等级，4个预设的风险等级区间定义如下：
            <ul style="margin-left: 30px; margin-top: 8px; list-style-type: none; display: flex; gap: 20px; padding: 0; margin-bottom: -10px;">
              <li class="text-green-500">
                <strong>0-0.3：低风险</strong>
              </li>
              <li class="text-yellow-500">
                | <strong>0.3-0.5：注意</strong>
              </li>
              <li class="text-orange-500">
                | <strong>0.5-0.7：中高风险</strong>
              </li>
              <li class="text-red-500">
                | <strong>0.7-1.0：高风险</strong>
              </li>
            </ul>
          </li>
          <li class="answer-text">
            <strong>疾病分类：</strong>
            这一列展示了该慢病属于的具体疾病大类，目前涉及到的有：
            <ul style="margin-left: 30px; margin-top:5px; list-style-type: disc;">
              <li>
                肠道疾病：肠道疾病大类包含了一些常见的消化系统慢性疾病
                <ul style="margin-left: 30px; margin-top:5px; list-style-type: disc;">
                  <li>
                    炎症性肠病 (IBD)：如克罗恩病、溃疡性结肠炎。
                  </li>
                  <li>
                    肠易激综合征 (IBS)：由于肠道功能失调导致的腹痛、腹泻或便秘等症状。
                  </li>
                  <li>
                    肠道病毒感染：属于由病毒引起的常见肠道感染性疾病，如轮状病毒、诺如病毒感染，可能引发腹泻等。
                  </li>
                  <li>
                    感染型腹泻：常见于细菌、病毒、寄生虫等感染的情况下导致的腹泻，主要原因是肠道感染的病原体。
                  </li>
                  <li>
                    过敏性腹泻：属于由食物过敏或免疫反应引起的腹泻类型，通常与特定食物或肠道敏感性有关。
                  </li>
                </ul>
              </li>
              <li>
                器官性疾病：器官性疾病大类主要涉及特定器官或器官系统的功能障碍或疾病。
                <ul style="margin-left: 30px; margin-top:5px; list-style-type: disc;">
                  <li>
                    肝病：如脂肪肝、病毒性肝炎、肝硬化等，与肝脏代谢和解毒功能异常等。
                  </li>
                  <li>
                    心脑血管疾病：如高血压、冠心病、心肌梗塞、脑梗等，与血管功能和心脑供血异常等。
                  </li>
                  <li>
                    甲状腺疾病：如甲状腺功能亢进、甲状腺功能减退和甲状腺结节等，涉及甲状腺激素的分泌异常。
                  </li>
                  <li>
                    肺部疾病：如慢性阻塞性肺疾病（COPD）、哮喘、肺炎等。
                  </li>
                </ul>
              </li>
              <li>
                神经系统疾病：神经系统疾病大类主要影响中枢神经系统（如大脑和脊髓）以及外周神经系统的功能和结构。
                <ul style="margin-left: 30px; margin-top:5px; list-style-type: disc;">
                  <li>
                    神经行为发育异常：如儿童发生的神经发育障碍，如自闭症谱系障碍（ASD）和注意缺陷多动障碍（ADHD）等。
                  </li>
                </ul>
              </li>

            </ul>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <h3 class="custom-title-third-level page-break">常见问题及说明</h3>

  <div class="bg-white rounded-lg p-5 mb-5 mx-auto" style="width: 100%;">

    <div class="qa-box">
      <div class="flex items-start ml-2">
        <p class="text-lg font-bold text-lightpurple">
          <i class="fas fa-question-circle icon icon-purple"></i>
          慢病的风险是如何评估的？
        </p>
      </div>
      <div class="flex items-start ml-2 mt-2">
        <p class="answer-text">
          <i class="fas fa-comments icon icon-orange"></i>
          利用数十万例的临床和人群样本数据，结合机器学习方法，我们针对数十种疾病使用肠道菌群数据进行疾病状态和风险的预测，并给出了精确的风险概率。
        </p>
      </div>
    </div>

    <div class="qa-box">
      <div class="flex items-start ml-2">
        <p class="text-lg font-bold text-lightpurple">
          <i class="fas fa-question-circle icon icon-purple"></i>
          评估结果易受到自身的一些疾病症状或者环境影响吗？
        </p>
      </div>
      <div class="flex items-start ml-2 mt-2">
        <p class="answer-text">
          <i class="fas fa-comments icon icon-orange"></i>
          疾病症状相关菌的检测丰度异常（无论是较参考范围偏少还是偏多）只是提示该菌群可能与某种疾病的相关症状相关，但它并不能直接证明一定会出现该疾病的相关症状。人体微生物组是一个复杂的生态系统，菌群丰度的变化受到多种因素的影响，包括饮食、生活习惯、遗传、药物使用等。此外，疾病的发生往往是多因素共同作用的结果，即使某种菌群与疾病存在关联，也需结合其他生物标志物、临床症状和医学检查进行综合评估。菌群的丰度异常更倾向于提供风险提示，如果确实出现了相关疾病症状，请及时咨询医生，以便得到专业诊断和治疗。
        </p>
      </div>
    </div>

    <div class="qa-box">
      <div class="flex items-start ml-2">
        <p class="text-lg font-bold text-lightpurple">
          <i class="fas fa-question-circle icon icon-purple"></i>
          如果慢病的风险评估不是中高风险，是否不用关注？
        </p>
      </div>
      <div class="flex items-start ml-2 mt-2">
        <p class="answer-text">
          <i class="fas fa-comments icon icon-orange"></i>
          疾病症状相关菌的检测丰度异常（无论是较参考范围偏少还是偏多）只是提示该菌群可能与某种疾病的相关症状相关，但它并不能直接证明一定会出现该疾病的相关症状。人体微生物组是一个复杂的生态系统，菌群丰度的变化受到多种因素的影响，包括饮食、生活习惯、遗传、药物使用等。此外，疾病的发生往往是多因素共同作用的结果，即使某种菌群与疾病存在关联，也需结合其他生物标志物、临床症状和医学检查进行综合评估。菌群的丰度异常更倾向于提供风险提示，如果确实出现了相关疾病症状，请及时咨询医生，以便得到专业诊断和治疗。
        </p>
      </div>
    </div>

    <!-- 严重疾病或家族疾病警告提示信息框 -->
<!--    <div class="info-box">-->
<!--      <div class="flex items-start">-->
<!--        <div class="ml-2">-->
<!--          <p class="text-lg">-->
<!--            <i class="fas fa-exclamation-triangle" style="color: orange;"></i>-->
<!--            <strong>注意：</strong>-->
<!--            慢病相关风险评估结果旨在提供参考信息，不能作为疾病诊断或治疗的唯一依据。慢性疾病的发生和发展通常受到多种因素（如生活方式、遗传因素、环境因素等）的综合影响，检测结果需结合个人的实际情况、其他医学检查和专业医生的建议进行综合评估。分析结果中提及的风险相关性仅为可能性参考，不能直接等同于因果关系或作为健康状况的绝对判断依据。如果出现与相关慢病风险相关的异常症状或健康问题，请务必及时咨询医生，以确保获得科学、准确的诊断和适当的治疗或干预方案。-->
<!--          </p>-->
<!--        </div>-->
<!--      </div>-->
<!--    </div>-->

    <!-- 警告提示信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <div class="ml-2">
          <p class="text-lg">
            <i class="fas fa-exclamation-triangle" style="color: orange;"></i>
            <strong>特别注意：</strong>
            慢病相关风险评估结果旨在提供参考信息，不能作为疾病诊断或治疗的唯一依据。慢性疾病的发生和发展通常受到多种因素（如生活方式、遗传因素、环境因素等）的综合影响，检测结果需结合个人的实际情况、其他医学检查和专业医生的建议进行综合评估。分析结果中提及的风险相关性仅为可能性参考，不能直接等同于因果关系或作为健康状况的绝对判断依据。如果出现与相关慢病风险相关的异常症状或健康问题，请务必及时咨询医生，以确保获得科学、准确的诊断和适当的治疗或干预方案。
          </p>
        </div>
      </div>
    </div>
  </div>


  <!-- 慢病风险评估板块 -->
  <h3 class="custom-title-1 page-break">慢病风险评估表格</h3>

  <div class="bg-white rounded-lg p-5 mb-5 mx-auto" style="width: 100%;">
    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            <i class="fas fa-info-circle icon"></i>
            下列表格展示了您的慢病风险评估数据（以风险评估等级递减排序）。
          </p>
        </div>
      </div>
    </div>

    <!-- 慢病风险评估板块 : 慢病风险表格 -->
    <div class="rounded-table">
      <!-- 主表格只包含标题 -->
      <table class="min-w-full">
        <thead>
        <tr style="background-color: #00B2B4; color: white;">
          <th class="py-2 px-4 text-left slow-disease-first-column" style="font-size: 13px;">
            评估慢病名称
          </th>
          <th class="py-2 px-4 text-center slow-disease-second-column" style="font-size: 13px; padding: 5px 5px;">
            风险评估数值
          </th>
          <th class="py-2 px-4 text-center slow-disease-third-column" style="font-size: 13px; padding: 5px 5px;">
            风险评估结果
          </th>
        </tr>
        </thead>
      </table>

      <!-- 数据表格容器 -->
      <div id="slow-disease-table-body">
        <!-- 数据将通过 JavaScript 动态插入 -->
      </div>
    </div>

    <script>
      // 确保 DATA_PATHS 已定义
      if (typeof DATA_PATHS === 'undefined') {
        var DATA_PATHS = {
          DATA: './data.json' // 默认路径，请确保这个路径是正确的
        };
      }

      // 慢病风险评估命名空间
      const SlowDiseaseRisk = {
        // 常量定义
        CONSTANTS: {
          COLORS: {
            RED: '#ff4d4f',
            GREEN: '#389e0d',
            GRAY: '#808080',
            PRIMARY: '#00B2B4',
            WARNING: '#FF0000',
            BLACK: '#000000',
            LOW_RISK: '#52c41a',    // 低风险
            ATTENTION: '#fadb14',   // 注意
            MEDIUM_RISK: '#faad14', // 中高风险
            HIGH_RISK: '#ff4d4f'    // 高风险
          },
          RANGE_MARKERS: [0.3, 0.5, 0.7] // 风险阈值标记
        },

        // 获取风险级别颜色
        getRiskColor(evaluationValue) {
          if (evaluationValue < this.CONSTANTS.RANGE_MARKERS[0]) return this.CONSTANTS.COLORS.LOW_RISK;
          if (evaluationValue < this.CONSTANTS.RANGE_MARKERS[1]) return this.CONSTANTS.COLORS.ATTENTION;
          if (evaluationValue < this.CONSTANTS.RANGE_MARKERS[2]) return this.CONSTANTS.COLORS.MEDIUM_RISK;
          return this.CONSTANTS.COLORS.HIGH_RISK;
        },

        // 获取风险级别标签
        getRiskLabel(evaluationValue) {
          if (evaluationValue < this.CONSTANTS.RANGE_MARKERS[0]) return "低风险";
          if (evaluationValue < this.CONSTANTS.RANGE_MARKERS[1]) return "注意";
          if (evaluationValue < this.CONSTANTS.RANGE_MARKERS[2]) return "中等风险";
          return "高风险";
        },

        // 创建描述行
        createDescriptionRow(disease) {
          // 如果没有说明，返回空字符串
          if (!disease["说明"] || disease["说明"].trim() === '') {
            return '';
          }

          return `
          <tr class="disease-desc-row">
            <td colspan="3" class="py-2 px-4 text-left">
              <div class="description-container text-gray-600" style="font-size: 11px;">
                <div class="flex items-start mb-0">
                  <div class="ml-1">
                    <p>
                      <i class="fas fa-info-circle" style="color: ${this.CONSTANTS.COLORS.PRIMARY};"></i>
                      ${disease["说明"]}
                    </p>
                  </div>
                </div>
              </div>
            </td>
          </tr>
        `;
        },

        // 创建疾病行
        createDiseaseRow(disease) {
          // 处理评估值 - 直接使用数字类型
          const evaluationValue = typeof disease["评估值"] === 'number'
            ? disease["评估值"]
            : parseFloat(disease["评估值"] || 0);

          if (isNaN(evaluationValue)) {
            return document.createElement('div'); // 返回空div避免错误
          }

          const riskColor = this.getRiskColor(evaluationValue);
          const resultLabel = disease["结果评价"] || this.getRiskLabel(evaluationValue);

          // 创建行容器
          const diseaseContainer = document.createElement('div');
          diseaseContainer.className = 'bacteria-info-container';

          const table = document.createElement('table');
          table.className = 'bacteria-table min-w-full';

          // 生成显示值的行
          const dataRow = `
          <tr>
            <td class="py-2 pl-4 pr-2 text-left slow-disease-first-column">
              <div class="slow-disease-chinese-text"><strong>${disease["检测项目"] || '未知项目'}</strong></div>
              <div class="slow-disease-english-text">${disease["英文名"] || '未知'}</div>
            </td>
            <td class="py-2 px-4 text-center slow-disease-column-text slow-disease-second-column">
              <div class="flex items-center justify-center">
                <span style="color: ${riskColor}">
                  <strong>${evaluationValue.toFixed(2)}</strong>
                </span>
              </div>
              <!-- 进度条及分界线 -->
              <div class="progress-bar-container w-full mt-2 relative">
                <div class="progress-bar w-full" style="background-color: #e9ecef; height: 8px; border-radius: 4px; overflow: hidden;">
                  <div class="progress"
                      style="width: ${(evaluationValue * 100) + '%'};
                            height: 100%;
                            background-color: ${riskColor};
                            transition: width 0.3s ease;">
                  </div>
                </div>
                <!-- 分界线 -->
                <div class="division-line" style="position: absolute; top: 0; bottom: 0; left: 30%; width: 1px; background-color: rgba(0,0,0,0.1);"></div>
                <div class="division-line" style="position: absolute; top: 0; bottom: 0; left: 50%; width: 1px; background-color: rgba(0,0,0,0.1);"></div>
                <div class="division-line" style="position: absolute; top: 0; bottom: 0; left: 70%; width: 1px; background-color: rgba(0,0,0,0.1);"></div>

                <!-- 范围标记 -->
                <div class="range-labels flex justify-between mt-1" style="font-size: 9px; color: #666;">
                  <span>0</span>
                  <span>0.3</span>
                  <span>0.5</span>
                  <span>0.7</span>
                  <span>1</span>
                </div>
              </div>
            </td>
            <td class="py-2 px-4 text-center slow-disease-column-text slow-disease-third-column">
              <span class="risk-label px-4 py-2 rounded-full text-white"
                    style="background-color: ${riskColor}; font-size: 12px; display: inline-block; min-width: 70px;">
                <strong>${resultLabel}</strong>
              </span>
            </td>
          </tr>
        `;

          // 生成描述行
          const descRow = this.createDescriptionRow(disease);

          table.innerHTML = `<tbody>${dataRow}${descRow}</tbody>`;
          diseaseContainer.appendChild(table);

          return diseaseContainer;
        },

        // 主渲染函数
        renderTable(diseaseData) {
          const container = document.getElementById('slow-disease-table-body');
          if (!container) {
            console.error('Cannot find container element: slow-disease-table-body');
            return;
          }

          container.innerHTML = '';

          // 如果没有数据
          if (!diseaseData || !Array.isArray(diseaseData) || diseaseData.length === 0) {
            container.innerHTML = '<div class="no-data-message">暂无数据</div>';
            return;
          }

          // 使用DocumentFragment批量处理DOM操作
          const fragment = document.createDocumentFragment();

          diseaseData.forEach(disease => {
            if (disease) {  // 确保disease存在
              const diseaseElement = this.createDiseaseRow(disease);
              fragment.appendChild(diseaseElement);
            }
          });

          // 一次性添加所有元素到DOM
          container.appendChild(fragment);
        },

        // 加载数据
        async loadData() {
          try {
            const response = await fetch(DATA_PATHS.DATA);
            if (!response.ok) {
              throw new Error(`Network response error: ${response.status}`);
            }

            const data = await response.json();

            // 检查慢病风险数据是否存在
            if (!data["慢病风险"] || !Array.isArray(data["慢病风险"])) {
              document.getElementById('slow-disease-table-body').innerHTML =
                '<div class="error-message">数据格式不正确</div>';
              return;
            }

            // 对慢病风险按照评估值从大到小排序
            data["慢病风险"].sort((a, b) => {
              // 处理数字类型的评估值
              const valueA = typeof a["评估值"] === 'number' ? a["评估值"] : parseFloat(a["评估值"] || 0);
              const valueB = typeof b["评估值"] === 'number' ? b["评估值"] : parseFloat(b["评估值"] || 0);
              return valueB - valueA;
            });

            this.renderTable(data["慢病风险"]);
          } catch (error) {
            console.error('Error loading slow disease risk data:', error);
            document.getElementById('slow-disease-table-body').innerHTML =
              '<div class="error-message">数据加载失败，请稍后再试</div>';
          }
        },

        // 初始化
        init() {
          if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => this.loadData());
          } else {
            this.loadData();
          }
        }
      };

      // 初始化慢病风险评估模块
      SlowDiseaseRisk.init();
    </script>
  </div>


  <!-- 疾病症状相关菌板块 -->

  <!-- 疾病症状相关菌首页 -->

  <h1 class="custom-title-second-level page-break">疾病症状相关菌</h1>

  <div class="bg-white rounded-lg p-5 mb-5 mx-auto" style="width: 100%;">
    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            <i class="fas fa-info-circle icon"></i>
            临床研究数据揭示，肠道菌群丰度特征与疾病发生呈现显著相关性。特定菌群失调（如拟杆菌/厚壁菌比值异常）与代谢性疾病（肥胖、糖尿病）、免疫性疾病（过敏、IBD）及神经精神类疾病（抑郁、自闭症）存在明确生物标志物关联。通过菌群检测可识别微生态失衡特征，为疾病早期预警和精准干预提供重要依据。
          </p>
        </div>
      </div>
    </div>

    <!-- 6中疾病症状总结性的信息图表 -->

    <div class="disease-card">
      <div class="disease-icon-box obesity">
        <i class="fas fa-weight"></i>
        肥胖
      </div>
      <div class="disease-content-box">
        肥胖与肠道菌群失调密切相关，研究表明肥胖人群的肠道菌群多样性显著降低，拟杆菌/厚壁菌比例失衡。这种失衡会影响能量代谢、脂肪存储和食欲调节，同时增加炎症因子水平，形成恶性循环。益生菌干预可通过调节GLP-1和PYY等饱腹激素，帮助改善代谢功能。
      </div>
    </div>

    <div class="disease-card">
      <div class="disease-icon-box constipation">
        <i class="fas fa-exclamation-circle"></i>
        便秘
      </div>
      <div class="disease-content-box">
        便秘往往反映肠道菌群功能紊乱，主要表现为产丁酸菌群减少、肠道蠕动功能受损。健康菌群通过产生短链脂肪酸促进肠道蠕动，调节水分代谢，维持正常排便功能。双歧杆菌和乳酸菌的补充可有效改善肠道微环境，促进肠道蠕动。
      </div>
    </div>

    <div class="disease-card">
      <div class="disease-icon-box bloating">
        <i class="fas fa-expand-alt"></i>
        腹胀
      </div>
      <div class="disease-content-box">
        腹胀常见于肠道菌群发酵异常，产气菌群过度生长。这种状况会导致肠道气体产生增多，肠壁张力改变，引起腹部不适。调节肠道菌群结构，特别是限制产气菌群过度生长，同时增加有益菌数量，可有效缓解腹胀症状。
      </div>
    </div>

    <div class="disease-card">
      <div class="disease-icon-box allergy">
        <i class="fas fa-allergies"></i>
        过敏
      </div>
      <div class="disease-content-box">
        过敏与免疫系统过度反应及肠道屏障功能受损有关。健康的肠道菌群可通过调节Th1/Th2平衡，促进调节性T细胞生成，抑制过度免疫反应。益生菌干预能够增强肠道屏障功能，降低过敏原穿透，减轻过敏症状。
      </div>
    </div>

    <div class="disease-card">
      <div class="disease-icon-box depression">
        <i class="fas fa-brain"></i>
        抑郁
      </div>
      <div class="disease-content-box">
        肠-脑轴研究表明，肠道菌群通过神经递质、内分泌和免疫调节影响情绪。菌群失调会降低血清素、GABA等神经递质水平，增加炎症因子表达，影响认知功能和情绪调节。补充特定益生菌可改善肠道微生态，帮助缓解抑郁症状。
      </div>
    </div>

    <div class="disease-card">
      <div class="disease-icon-box insomnia">
        <i class="fas fa-moon"></i>
        失眠
      </div>
      <div class="disease-content-box">
        失眠与昼夜节律紊乱和神经递质失衡相关。肠道菌群参与褪黑激素、血清素等睡眠相关物质的合成与代谢，影响睡眠-觉醒周期。改善肠道菌群结构可以优化褪黑激素分泌节律，帮助调节睡眠周期。
      </div>
    </div>

  </div>

  <!-- 疾病相关菌阅读指南 -->
  <h1 class="custom-title-third-level page-break">阅读指南</h1>

  <div class="bg-white rounded-lg p-5 mb-5 mx-auto" style="width: 100%;">
    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            <i class="fas fa-info-circle icon"></i>
            临床研究数据揭示，肠道菌群丰度特征与疾病症状的表现呈现显著相关性。通过菌群检测可识别微生态失衡特征，为疾病症状早期预警和精准干预提供重要依据。
          </p>
        </div>
      </div>
    </div>

    <!-- 问答信息框 -->
    <div class="qa-box">
      <div class="flex items-start ml-2">
        <p class="text-lg font-bold text-lightpurple">
          <i class="fas fa-question-circle icon icon-purple"></i>
          如何阅读疾病症状相关菌的表格？
        </p>
      </div>
      <div class="flex items-start ml-2 mt-2">
        <p class="answer-text">
          <i class="fas fa-comments icon icon-orange"></i>
          以下是对疾病症状相关菌的表格中的各部分信息进行的说明解释：
        </p>
      </div>
      <div class="flex items-start ml-2 mt-2">
        <ul style="margin-left: 50px; list-style-type: disc;">
          <li class="answer-text">
            <strong>疾病症状相关菌名称：</strong>
            这一列列出特定的症状相关菌群名称。
          </li>
          <li class="answer-text">
            <strong>参考范围%：</strong>
            此列显示该菌群的参考范围，此范围为比较您的检测结果提供了参考标准。
          </li>
          <li class="answer-text">
            <strong>检测丰度%：</strong>
            这一列显示经过检测后您体内该菌群在肠道微生物中的相对丰度，以数字（包括未检出）和进度条展示。
            <ul style="margin-left: 30px; margin-top:5px; list-style-type: disc;">
              <li>
                <i class="fas fa-arrow-up text-red-500 ml-0.5"></i>：表示该菌群的检测丰度较参考范围的下限偏少。
              </li>
              <li>
                <i class="fas fa-arrow-down text-red-500 ml-0.5"></i>：表示该菌群的检测丰度较参考范围的上限偏多。
              </li>
              <li>
                未检出：表示表示该菌群的相对丰度低于检出下限。
              </li>
            </ul>
          </li>
          <li class="answer-text">
            <strong>相关性：</strong>
            这一列标示该菌群丰度与特定疾病相关症状之间的关系。
            <ul style="margin-left: 30px; margin-top:5px; list-style-type: disc;">
              <li>
                若标记为“正相关”，则表示菌群丰度的升高与症状的发生与进展呈正相关。
              </li>
              <li>
                若标记为“负相关”，则表示菌群丰度的降低与症状的发生与进展呈正相关。
              </li>
            </ul>
          </li>
          <li class="answer-text">
            <strong>相关性强度：</strong>
            这一列表明该菌群和该疾病症状之间的相关性证据的强度，分为三个强度级别（正相关的相关性强度为<i class="fa fa-star text-orange-500" aria-hidden="true"></i>，负相关的相关性强度为<i class="fa fa-star text-blue-500" aria-hidden="true"></i>）
            <ul style="margin-left: 30px; margin-top:5px; list-style-type: disc;">
              <li>
                <i class="fa fa-star text-orange-500" aria-hidden="true"></i>（<i class="fa fa-star text-blue-500" aria-hidden="true"></i>）：依据的是单一研究或人群数据统计。
              </li>
              <li>
                <i class="fa fa-star text-orange-500" aria-hidden="true"></i><i class="fa fa-star text-orange-500" aria-hidden="true"></i>（<i class="fa fa-star text-blue-500" aria-hidden="true"></i><i class="fa fa-star text-blue-500" aria-hidden="true"></i>）：基于大规模人群样本统计和至少一项研究的支持。
              </li>
              <li>
                <i class="fa fa-star text-orange-500" aria-hidden="true"></i><i class="fa fa-star text-orange-500" aria-hidden="true"></i><i class="fa fa-star text-orange-500" aria-hidden="true"></i>（<i class="fa fa-star text-blue-500" aria-hidden="true"></i><i class="fa fa-star text-blue-500" aria-hidden="true"></i><i class="fa fa-star text-blue-500" aria-hidden="true"></i>）：有大量研究论文对此结果的确认。
              </li>
            </ul>
            在阅读表格时应着重关注下列菌群：
            <ul style="margin-left: 30px; margin-top:5px; list-style-type: disc;">
              <li>
                检测丰度较参考范围相对超标+相关性为正相关的菌群，该菌群整行会被橙色的边框包围来提示您重点关注。
              </li>
              <li>
                检测丰度较参考范围相对偏少+相关性为负相关的菌群，该菌群整行会被蓝色的边框包围来提示您重点关注。
              </li>
            </ul>
          </li>
          <li>
            <i class="fa fa-info-circle" style="color: rgb(0, 178, 180);"></i> 与 <i class="fa fa-bell text-red-500"></i> 分别是通过对全球最大规模的调查样本进行相关性分析和统计检验得出的菌群简介信息和丰度较参考范围异常时相对应的饮食改善。
          </li>
        </ul>
      </div>
    </div>

  </div>

  <h3 class="custom-title-third-level page-break">常见问题与说明</h3>

  <div class="bg-white rounded-lg p-5 mb-5 mx-auto" style="width: 100%;">
    <div class="qa-box">
      <div class="flex items-start ml-2">
        <p class="text-lg font-bold text-lightpurple">
          <i class="fas fa-question-circle icon icon-purple"></i>
          为什么选取这些疾病症状相关菌？
        </p>
      </div>
      <div class="flex items-start ml-2 mt-2">
        <p class="answer-text">
          <i class="fas fa-comments icon icon-orange"></i>
          这些疾病症状相关菌的选取主要基于两方面的依据：
        </p>
      </div>
      <div class="flex items-start ml-2 mt-2">
        <ul style="margin-left: 50px; list-style-type: disc;">
          <li class="answer-text">
            <strong>文献报告：</strong>
            通过参考已有的科学文献和研究成果，筛选出不同疾病和健康状态中具有明确关联的菌群。
          </li>
          <li class="answer-text">
            <strong>数据分析：</strong>
            利用我们数据库中的疾病样本与健康对照样本进行统计分析，筛选出在两者之间存在显著差异的菌群。
          </li>
        </ul>
      </div>
    </div>
    <div class="qa-box">
      <div class="flex items-start ml-2">
        <p class="text-lg font-bold text-lightpurple">
          <i class="fas fa-question-circle icon icon-purple"></i>
          涉及到的疾病症状相关菌和相对应的疾病症状存在因果关系吗？
        </p>
      </div>
      <div class="flex items-start ml-2 mt-2">
        <p class="answer-text">
          <i class="fas fa-comments icon icon-orange"></i>
          涉及到的疾病症状相关菌与相对应的疾病症状之间仅表现为相关性，并不能直接说明存在因果关系。相关性仅说明两者在统计数据中具有一定关联，但并不意味着一种情况会直接导致另一种情况的发生。对于因果关系的判断，还需要通过更多的机制研究才能确定。
        </p>
      </div>
    </div>
    <div class="qa-box">
      <div class="flex items-start ml-2">
        <p class="text-lg font-bold text-lightpurple">
          <i class="fas fa-question-circle icon icon-purple"></i>
          疾病症状相关菌的检测丰度较参考范围正常代表着一定不会出现该疾病相关症状吗？
        </p>
      </div>
      <div class="flex items-start ml-2 mt-2">
        <p class="answer-text">
          <i class="fas fa-comments icon icon-orange"></i>
          菌群的检测丰度较参考违反正常并不能完全排除疾病相关症状的出现。疾病的发生通常是多种因素综合作用的结果，包括其他菌群的丰度变化、遗传因素、免疫状态、环境影响、生活习惯等。此外，有些疾病的表现可能由其他病原体或非微生物因素引发，而不一定完全依赖特定菌群的丰度异常。
          因此，即使检测结果显示菌群丰度正常，如果仍出现相关疾病的症状，建议及时咨询医生进行更全面的检查和评估，以明确病因并采取适当的诊疗措施。
        </p>
      </div>
    </div>
    <div class="qa-box">
      <div class="flex items-start ml-2">
        <p class="text-lg font-bold text-lightpurple">
          <i class="fas fa-question-circle icon icon-purple"></i>
          疾病症状相关菌的检测丰度较参考范围异常代表着一定会出现该疾病相关症状吗？
        </p>
      </div>
      <div class="flex items-start ml-2 mt-2">
        <p class="answer-text">
          <i class="fas fa-comments icon icon-orange"></i>
          疾病症状相关菌的检测丰度异常（无论是较参考范围偏少还是偏多）只是提示该菌群可能与某种疾病的相关症状相关，但它并不能直接证明一定会出现该疾病的相关症状。人体微生物组是一个复杂的生态系统，菌群丰度的变化受到多种因素的影响，包括饮食、生活习惯、遗传、药物使用等。此外，疾病的发生往往是多因素共同作用的结果，即使某种菌群与疾病存在关联，也需结合其他生物标志物、临床症状和医学检查进行综合评估。菌群的丰度异常更倾向于提供风险提示，如果确实出现了相关疾病症状，请及时咨询医生，以便得到专业诊断和治疗。
        </p>
      </div>
    </div>

<!--    &lt;!&ndash; 警告提示信息框 &ndash;&gt;-->
<!--    <div class="info-box">-->
<!--      <div class="flex items-start">-->
<!--        <div class="ml-2">-->
<!--          <p class="text-lg">-->
<!--            <i class="fas fa-exclamation-triangle" style="color: orange;"></i>-->
<!--            <strong>特别注意：</strong>-->
<!--            疾病症状相关群的分析结果旨在提供参考信息，不能作为疾病症状诊断或治疗的唯一依据。微生物组的变化具有复杂性，检测结果需结合个人的实际情况、其他医学检查和专业医生的建议进行综合评估。请勿将相关性结果直接等同于因果关系或作为健康状况的绝对判断依据。如果出现相关疾病的症状，务必及时咨询医生，以确保获得科学准确的诊断和适当的治疗方案。-->
<!--          </p>-->
<!--        </div>-->
<!--      </div>-->
<!--    </div>-->

  </div>

  <!-- 疾病症状相关菌 : 肥胖相关菌 -->

  <h3
    class="custom-title-third-level page-break">
    肥胖相关菌
  </h3>

  <div class="bg-white rounded-lg p-5 mb-5 mx-auto" style="width: 100%;">
    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            <i class="fas fa-info-circle icon"></i>
            肠道菌群失衡会显著影响人体的代谢功能，研究表明，肥胖人群的肠道菌群结构与正常体重人群存在明显差异，这种失衡可能是导致肥胖的重要因素之一。
          </p>
        </div>
      </div>
    </div>

    <div class="rounded-table">
      <!-- 创建表格头部 -->
      <table class="min-w-full">
        <thead>
        <tr style="background-color: #00B2B4; color: white;">
          <th
            class="py-2 px-4 text-left constipation-first-column"
            style="font-size: 13px;">
            肥胖相关菌名称
          </th>
          <th
            class="py-2 px-4 text-center constipation-second-column"
            style="font-size: 13px; padding: 5px 5px;">
            参考范围%
          </th>
          <th
            class="py-2 px-4 text-center constipation-third-column"
            style="font-size: 13px; padding: 5px 5px;">
            检测丰度%
          </th>
          <th
            class="py-2 px-4 text-center constipation-fourth-column"
            style="font-size: 13px; padding: 5px 5px;">
            相关性
          </th>
          <th
            class="py-2 px-4 text-center constipation-fifth-column"
            style="font-size: 13px; padding: 5px 5px;">
            相关性强度
          </th>
        </tr>
        </thead>
      </table>

      <!-- 数据表格容器 -->
      <div id="obesity-data-table-body">
        <!-- 数据将通过 JavaScript 动态插入 -->
      </div>
    </div>

    <script>
      // 肥胖相关菌数据展示模块
      const ObesityBacteria = {
        // 常量定义
        CONSTANTS: {
          COLORS: {
            RED: '#ff4d4f',
            GREEN: '#389e0d',
            YELLOW: '#faad14',
            BLUE: '#3b82f6',
            GRAY: '#808080',
            BLACK: '#000000',
            PRIMARY: '#00B2B4',
            WARNING: '#faad14',
            ORANGE: '#fa8c16'
          },
          CORRELATION: {
            "+": {
              text: "正相关",
              textColor: "text-black",
              starColor: "text-orange-500"
            },
            "-": {
              text: "负相关",
              textColor: "text-black",
              starColor: "text-blue-500"
            }
          }
        },

        // 格式化数字
        formatNumber(value) {
          if (value === "ND" || value === "-") return value;
          const num = Number(value);
          if (isNaN(num)) return value;
          return num.toFixed(3).replace(/\.?0+$/, '');
        },

        // 解析正常范围
        parseRange(rangeStr) {
          if (!rangeStr || typeof rangeStr !== 'string') {
            return { min: 0, max: 0 };
          }
          const parts = rangeStr.split('-');
          return {
            min: parseFloat(parts[0] || 0),
            max: parseFloat(parts[1] || 0)
          };
        },

        // 分离中文名和拉丁名
        separateName(fullName) {
          if (!fullName) return { chineseName: '', latinName: '' };

          // 假设格式是"中文名 拉丁名"，用空格分隔
          const parts = fullName.split(' ');

          // 如果只有一个部分，或者没有包含拉丁字符的部分
          if (parts.length === 1) {
            return { chineseName: parts[0], latinName: '' };
          }

          // 找到第一个包含拉丁字符的部分
          let latinIndex = -1;
          for (let i = 0; i < parts.length; i++) {
            if (/[a-zA-Z]/.test(parts[i])) {
              latinIndex = i;
              break;
            }
          }

          if (latinIndex === -1) {
            // 如果没有找到拉丁字符，全部作为中文名
            return { chineseName: fullName, latinName: '' };
          }

          // 分离中文名和拉丁名
          const chineseName = parts.slice(0, latinIndex).join(' ');
          const latinName = parts.slice(latinIndex).join(' ');

          return { chineseName, latinName };
        },

        // 获取状态信息
        getStatus(detected, normalRange) {
          const { min, max } = this.parseRange(normalRange);

          if (detected === "ND") {
            if (min > 0) {
              return {
                text: '缺乏',
                color: this.CONSTANTS.COLORS.RED,
                icon: '<i class="fas fa-arrow-down ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>',
                isNormal: false,
                direction: 'down',
                isGrayND: false
              };
            } else {
              return {
                text: '正常',
                color: this.CONSTANTS.COLORS.GRAY,
                icon: '',
                isNormal: true,
                direction: null,
                isGrayND: true
              };
            }
          }

          // 如果检测值不是ND，转换为数字进行比较
          const numDetected = Number(detected);

          if (numDetected < min) {
            return {
              text: '偏低',
              color: this.CONSTANTS.COLORS.RED,
              icon: '<i class="fas fa-arrow-down ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>',
              isNormal: false,
              direction: 'down',
              isGrayND: false
            };
          } else if (numDetected > max) {
            return {
              text: '超标',
              color: this.CONSTANTS.COLORS.RED,
              icon: '<i class="fas fa-arrow-up ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>',
              isNormal: false,
              direction: 'up',
              isGrayND: false
            };
          } else {
            return {
              text: '正常',
              color: this.CONSTANTS.COLORS.GREEN,
              icon: '',
              isNormal: true,
              direction: null,
              isGrayND: false
            };
          }
        },

        // 生成星星评级
        generateStars(count, correlationType) {
          const starColor = this.CONSTANTS.CORRELATION[correlationType].starColor;
          return Array(3).fill().map((_, i) =>
            `<i class="fa fa-star ${i < count ? starColor : 'text-gray-300'}" aria-hidden="true"></i>`
          ).join('');
        },

        // 计算进度条百分比
        calculateProgressWidth(value) {
          if (value === 'ND' || value === 0) return 0;

          const num = Number(value);
          if (isNaN(num)) return 0;

          if (num <= 20) {
            return Math.min(20, Math.max(5, num * 1.5));
          }
          return Math.min(100, Math.max(0, num));
        },

        // 创建描述行
        createDescriptionRow(bacteria, status) {
          let descriptionContent = '';

          // 添加常规说明
          if (bacteria.说明 && bacteria.说明.trim()) {
            descriptionContent += `
            <div class="flex items-start mb-0">
              <div class="ml-1">
                <p>
                  <i class="fas fa-info-circle" style="color: ${this.CONSTANTS.COLORS.PRIMARY};"></i>
                  ${bacteria.说明}
                </p>
              </div>
            </div>
          `;
          }

          // 如果状态不是正常，并且有改善方式，添加改善建议
          if (!status.isNormal && bacteria.改善方式 && bacteria.改善方式.trim()) {
            descriptionContent += `
            <div class="flex items-start mt-0">
              <div class="ml-1">
                <p>
                  <i class="fas fa-bell" style="color: ${this.CONSTANTS.COLORS.WARNING};"></i>
                  <strong>改善建议：</strong> ${bacteria.改善方式}
                </p>
              </div>
            </div>
          `;
          }

          // 如果有内容需要显示，返回完整的行
          if (descriptionContent.trim()) {
            return `
            <tr class="description-row">
              <td colspan="5" class="py-2 px-4 text-left">
                <div class="description-container text-gray-600" style="font-size: 11px;">
                  ${descriptionContent}
                </div>
              </td>
            </tr>
          `;
          }

          // 如果没有描述内容，返回空字符串
          return '';
        },

        // 渲染表格
        renderTable(obesityData) {
          const container = document.getElementById('obesity-data-table-body');
          if (!container) {
            console.error('Cannot find container element');
            return;
          }

          container.innerHTML = '';

          if (!obesityData || !Array.isArray(obesityData) || obesityData.length === 0) {
            container.innerHTML = '<div class="text-center p-4 text-red-500">暂无肥胖相关菌数据</div>';
            return;
          }

          const fragment = document.createDocumentFragment();

          obesityData.forEach(bacteria => {
            const { chineseName, latinName } = this.separateName(bacteria.名称);
            const normalRange = bacteria.正常范围;
            const detected = bacteria["丰度%"];
            const correlation = bacteria.问题相关性;
            const evidenceStrength = parseInt(bacteria.证据强度 || "0", 10);

            const { min, max } = this.parseRange(normalRange);
            const status = this.getStatus(detected, normalRange);
            const isPositive = correlation === "+";
            const isNegative = correlation === "-";

            // 创建容器
            const bacteriaContainer = document.createElement('div');
            bacteriaContainer.className = 'bacteria-info-container';

            // 高亮风险组合
            if ((status.text === '超标' && isPositive) ||
              ((status.text === '偏低' || status.text === '缺乏') && isNegative)) {
              // 选择合适的边框颜色
              let borderColor;
              if (isPositive) {
                borderColor = this.CONSTANTS.COLORS.RED; // 正相关+超标用红色
              } else {
                borderColor = this.CONSTANTS.COLORS.ORANGE; // 负相关+偏低/缺乏用橙色
              }

              bacteriaContainer.style.border = `1px solid ${borderColor}`;
              bacteriaContainer.style.borderRadius = '4px';
              bacteriaContainer.style.margin = '4px 0';
            } else {
              bacteriaContainer.style.border = '1px solid transparent';
            }

            // 创建表格
            const table = document.createElement('table');
            table.className = 'bacteria-table min-w-full';

            // 格式化数值
            const formattedMinRange = this.formatNumber(min);
            const formattedMaxRange = this.formatNumber(max);

            // 数据行
            const progressPercentage = this.calculateProgressWidth(detected);

            // 根据状态确定未检出的颜色
            const detectedText = detected === "ND"
              ? (status.isGrayND ? `<span style="color: ${this.CONSTANTS.COLORS.GRAY}">ND</span>` : 'ND')
              : this.formatNumber(detected);

            const dataRow = `
              <tr>
                <td class="py-2 px-4 text-left constipation-first-column">
                  <div class="obesity-chinese-text"><strong>${chineseName || '未知'}</strong></div>
                  <div class="obesity-latin-text text-gray-500">${latinName || ''}</div>
                </td>
                <td class="py-2 px-4 text-center constipation-second-column obesity-column-text">
                  ${formattedMinRange}-${formattedMaxRange}
                </td>
                <td class="py-2 px-4 text-center constipation-third-column obesity-column-text">
                  <span style="color: ${status.isNormal && !status.isGrayND ? 'inherit' : status.color}">
                    ${detectedText}
                    ${status.icon || ''}
                  </span>
                  <div class="progress-bar w-full mt-2" style="background-color: #e9ecef; height: 8px; border-radius: 4px; overflow: hidden;">
                    <div class="progress"
                         style="width: ${progressPercentage}%;
                                height: 100%;
                                background-color: ${this.CONSTANTS.COLORS.PRIMARY};
                                transition: width 0.3s ease;">
                    </div>
                  </div>
                </td>

                <td class="py-2 px-4 text-center constipation-fourth-column obesity-column-text">
                  <span class="${this.CONSTANTS.CORRELATION[correlation].textColor}">${this.CONSTANTS.CORRELATION[correlation].text}</span>
                </td>
                <td class="py-2 px-4 text-center constipation-fifth-column obesity-column-text">
                  <div class="flex justify-center items-center">
                    ${this.generateStars(evidenceStrength, correlation)}
                  </div>
                </td>
              </tr>
            `;

            // 描述行
            const descRow = this.createDescriptionRow(bacteria, status);

            table.innerHTML = `<tbody>${dataRow}${descRow}</tbody>`;
            bacteriaContainer.appendChild(table);
            fragment.appendChild(bacteriaContainer);
          });

          container.appendChild(fragment);
        },

        // 加载数据
        async loadData() {
          try {
            const response = await fetch(DATA_PATHS.DATA);
            if (!response.ok) {
              throw new Error(`Network response error: ${response.status}`);
            }
            const data = await response.json();

            // 提取肥胖相关菌数据
            const obesityData = data["疾病相关菌"] ? data["疾病相关菌"]["肥胖"] : [];
            this.renderTable(obesityData);
          } catch (error) {
            console.error('Error loading obesity bacteria data:', error);
            document.getElementById('obesity-data-table-body').innerHTML =
              '<div class="text-center p-4 text-red-500">数据加载失败，请稍后再试</div>';
          }
        },

        // 初始化
        init() {
          if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => this.loadData());
          } else {
            this.loadData();
          }
        }
      };

      // 初始化肥胖相关菌模块
      ObesityBacteria.init();
    </script>
  </div>

  <!-- 疾病症状相关菌 : 便秘相关菌 -->

  <h3 class="custom-title-third-level page-break">
    便秘相关菌
  </h3>

  <div class="bg-white rounded-lg p-5 mb-5 mx-auto" style="width: 100%;">
    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            <i class="fas fa-info-circle icon"></i>
            肠道菌群失衡与便秘密切相关。健康肠道需要微生物平衡，当有益菌减少时，肠道蠕动变慢，易导致便秘。便秘患者的菌群多样性降低，微生物组成异常，影响肠道正常功能。调节肠道菌群平衡，如补充益生菌和调整饮食，能有效改善便秘症状，促进肠道健康。
          </p>
        </div>
      </div>
    </div>

    <div class="rounded-table">
      <!-- 创建表格头部 -->
      <table class="min-w-full">
        <thead>
        <tr style="background-color: #00B2B4; color: white;">
          <th
            class="py-2 px-4 text-left constipation-first-column"
            style="font-size: 13px;"
          >
            便秘相关菌种名称
          </th>
          <th
            class="py-2 px-4 text-center constipation-second-column"
            style="font-size: 13px; padding: 5px 5px;"
          >
            参考范围%
          </th>
          <th
            class="py-2 px-4 text-center constipation-third-column"
            style="font-size: 13px; padding: 5px 5px;"
          >
            检测丰度%
          </th>
          <th
            class="py-2 px-4 text-center constipation-fourth-column"
            style="font-size: 13px; padding: 5px 5px;"
          >
            相关性
          </th>
          <th
            class="py-2 px-4 text-center constipation-fifth-column"
            style="font-size: 13px; padding: 5px 5px;"
          >
            相关性强度
          </th>
        </tr>
        </thead>
      </table>

      <!-- 数据表格容器 -->
      <div id="constipation-data-table-body">
        <!-- 数据将通过 JavaScript 动态插入 -->
      </div>
    </div>

    <script>
      // 便秘相关菌数据展示模块
      const ConstipationBacteria = {
        // 常量定义
        CONSTANTS: {
          COLORS: {
            RED: '#ff4d4f',
            GREEN: '#389e0d',
            YELLOW: '#faad14',
            BLUE: '#3b82f6',
            GRAY: '#808080',
            BLACK: '#000000',
            PRIMARY: '#00B2B4',
            WARNING: '#faad14',
            ORANGE: '#fa8c16'
          },
          CORRELATION: {
            "+": {
              text: "正相关",
              textColor: "text-black",
              starColor: "text-orange-500"
            },
            "-": {
              text: "负相关",
              textColor: "text-black",
              starColor: "text-blue-500"
            }
          }
        },

        // 格式化数字
        formatNumber(value) {
          if (value === "ND" || value === "-") return value;
          const num = Number(value);
          if (isNaN(num)) return value;
          return num.toFixed(3).replace(/\.?0+$/, '');
        },

        // 解析正常范围
        parseRange(rangeStr) {
          if (!rangeStr || typeof rangeStr !== 'string') {
            return { min: 0, max: 0 };
          }
          const parts = rangeStr.split('-');
          return {
            min: parseFloat(parts[0] || 0),
            max: parseFloat(parts[1] || 0)
          };
        },

        // 分离中文名和拉丁名
        separateName(fullName) {
          if (!fullName) return { chineseName: '', latinName: '' };

          // 假设格式是"中文名 拉丁名"，用空格分隔
          const parts = fullName.split(' ');

          // 如果只有一个部分，或者没有包含拉丁字符的部分
          if (parts.length === 1) {
            return { chineseName: parts[0], latinName: '' };
          }

          // 找到第一个包含拉丁字符的部分
          let latinIndex = -1;
          for (let i = 0; i < parts.length; i++) {
            if (/[a-zA-Z]/.test(parts[i])) {
              latinIndex = i;
              break;
            }
          }

          if (latinIndex === -1) {
            // 如果没有找到拉丁字符，全部作为中文名
            return { chineseName: fullName, latinName: '' };
          }

          // 分离中文名和拉丁名
          const chineseName = parts.slice(0, latinIndex).join(' ');
          const latinName = parts.slice(latinIndex).join(' ');

          return { chineseName, latinName };
        },

        // 获取状态信息
        getStatus(detected, normalRange) {
          const { min, max } = this.parseRange(normalRange);

          if (detected === "ND") {
            if (min > 0) {
              return {
                text: '缺乏',
                color: this.CONSTANTS.COLORS.RED,
                icon: '<i class="fas fa-arrow-down ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>',
                isNormal: false,
                direction: 'down',
                isGrayND: false
              };
            } else {
              return {
                text: '正常',
                color: this.CONSTANTS.COLORS.GRAY,
                icon: '',
                isNormal: true,
                direction: null,
                isGrayND: true
              };
            }
          }

          // 如果检测值不是ND，转换为数字进行比较
          const numDetected = Number(detected);

          if (numDetected < min) {
            return {
              text: '偏低',
              color: this.CONSTANTS.COLORS.RED,
              icon: '<i class="fas fa-arrow-down ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>',
              isNormal: false,
              direction: 'down',
              isGrayND: false
            };
          } else if (numDetected > max) {
            return {
              text: '超标',
              color: this.CONSTANTS.COLORS.RED,
              icon: '<i class="fas fa-arrow-up ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>',
              isNormal: false,
              direction: 'up',
              isGrayND: false
            };
          } else {
            return {
              text: '正常',
              color: this.CONSTANTS.COLORS.GREEN,
              icon: '',
              isNormal: true,
              direction: null,
              isGrayND: false
            };
          }
        },

        // 生成星星评级
        generateStars(count, correlationType) {
          const starColor = this.CONSTANTS.CORRELATION[correlationType].starColor;
          return Array(3).fill().map((_, i) =>
            `<i class="fa fa-star ${i < count ? starColor : 'text-gray-300'}" aria-hidden="true"></i>`
          ).join('');
        },

        // 计算进度条百分比
        calculateProgressWidth(value) {
          if (value === 'ND' || value === 0) return 0;

          const num = Number(value);
          if (isNaN(num)) return 0;

          if (num <= 20) {
            return Math.min(20, Math.max(5, num * 1.5));
          }
          return Math.min(100, Math.max(0, num));
        },

        // 创建描述行
        createDescriptionRow(bacteria, status) {
          let descriptionContent = '';

          // 添加常规说明
          if (bacteria.说明 && bacteria.说明.trim()) {
            descriptionContent += `
            <div class="flex items-start mb-0">
              <div class="ml-1">
                <p>
                  <i class="fas fa-info-circle" style="color: ${this.CONSTANTS.COLORS.PRIMARY};"></i>
                  ${bacteria.说明}
                </p>
              </div>
            </div>
          `;
          }

          // 如果状态不是正常，并且有改善方式，添加改善建议
          if (!status.isNormal && bacteria.改善方式 && bacteria.改善方式.trim()) {
            descriptionContent += `
            <div class="flex items-start mt-0">
              <div class="ml-1">
                <p>
                  <i class="fas fa-bell" style="color: ${this.CONSTANTS.COLORS.WARNING};"></i>
                  <strong>改善建议：</strong> ${bacteria.改善方式}
                </p>
              </div>
            </div>
          `;
          }

          // 如果有内容需要显示，返回完整的行
          if (descriptionContent.trim()) {
            return `
            <tr class="description-row">
              <td colspan="5" class="py-2 px-4 text-left">
                <div class="description-container text-gray-600" style="font-size: 11px;">
                  ${descriptionContent}
                </div>
              </td>
            </tr>
          `;
          }

          // 如果没有描述内容，返回空字符串
          return '';
        },

        // 渲染表格
        renderTable(constipationData) {
          const container = document.getElementById('constipation-data-table-body');
          if (!container) {
            console.error('Cannot find container element');
            return;
          }

          container.innerHTML = '';

          if (!constipationData || !Array.isArray(constipationData) || constipationData.length === 0) {
            container.innerHTML = '<div class="text-center p-4 text-red-500">暂无便秘相关菌数据</div>';
            return;
          }

          const fragment = document.createDocumentFragment();

          constipationData.forEach(bacteria => {
            const { chineseName, latinName } = this.separateName(bacteria.名称);
            const normalRange = bacteria.正常范围;
            const detected = bacteria["丰度%"];
            const higherThanPercentage = bacteria.超过人群百分比 || "-";
            const correlation = bacteria.问题相关性;
            const evidenceStrength = parseInt(bacteria.证据强度 || "0", 10);

            const { min, max } = this.parseRange(normalRange);
            const status = this.getStatus(detected, normalRange);
            const isPositive = correlation === "+";
            const isNegative = correlation === "-";

            // 创建容器
            const bacteriaContainer = document.createElement('div');
            bacteriaContainer.className = 'bacteria-info-container';

            // 高亮风险组合
            if ((status.text === '超标' && isPositive) ||
              ((status.text === '偏低' || status.text === '缺乏') && isNegative)) {
              // 选择合适的边框颜色
              let borderColor;
              if (isPositive) {
                borderColor = this.CONSTANTS.COLORS.RED; // 正相关+超标用红色
              } else {
                borderColor = this.CONSTANTS.COLORS.ORANGE; // 负相关+偏低/缺乏用橙色
              }

              bacteriaContainer.style.border = `1px solid ${borderColor}`;
              bacteriaContainer.style.borderRadius = '4px';
              bacteriaContainer.style.margin = '4px 0';
            } else {
              bacteriaContainer.style.border = '1px solid transparent';
            }

            // 创建表格
            const table = document.createElement('table');
            table.className = 'bacteria-table min-w-full';

            // 格式化数值
            const formattedMinRange = this.formatNumber(min, 2);
            const formattedMaxRange = this.formatNumber(max, 2);

            // 数据行
            const progressPercentage = this.calculateProgressWidth(detected);

            // 根据状态确定未检出的颜色
            const detectedText = detected === "ND"
              ? (status.isGrayND ? `<span style="color: ${this.CONSTANTS.COLORS.GRAY}">ND</span>` : 'ND')
              : this.formatNumber(detected);

            const dataRow = `
              <tr>
                <td class="py-2 px-4 text-left constipation-first-column">
                  <div class="constipation-chinese-text">
                    <strong>${chineseName || '未知'}</strong>
                  </div>
                  <div class="constipation-latin-text text-gray-500">
                    ${latinName || ''}
                  </div>
                </td>
                <td class="py-2 px-4 text-center constipation-second-column constipation-column-text">
                  ${formattedMinRange}-${formattedMaxRange}
                </td>
                <td class="py-2 px-4 text-center constipation-third-column constipation-column-text">
                  <span style="color: ${status.isNormal && !status.isGrayND ? 'inherit' : status.color}">
                    ${detectedText}
                    ${status.icon || ''}
                  </span>
                  <div class="progress-bar w-full mt-2" style="background-color: #e9ecef; height: 8px; border-radius: 4px; overflow: hidden;">
                    <div class="progress"
                         style="width: ${progressPercentage}%;
                                height: 100%;
                                background-color: ${this.CONSTANTS.COLORS.PRIMARY};
                                transition: width 0.3s ease;">
                    </div>
                  </div>
                </td>

                <td class="py-2 px-4 text-center constipation-fourth-column constipation-column-text">
                  <span class="${this.CONSTANTS.CORRELATION[correlation].textColor}">${this.CONSTANTS.CORRELATION[correlation].text}</span>
                </td>
                <td class="py-2 px-4 text-center constipation-fifth-column constipation-column-text">
                  <div class="flex justify-center items-center">
                    ${this.generateStars(evidenceStrength, correlation)}
                  </div>
                </td>
              </tr>
            `;

            // 描述行
            const descRow = this.createDescriptionRow(bacteria, status);

            table.innerHTML = `<tbody>${dataRow}${descRow}</tbody>`;
            bacteriaContainer.appendChild(table);
            fragment.appendChild(bacteriaContainer);
          });

          container.appendChild(fragment);
        },

        // 加载数据
        async loadData() {
          try {
            const response = await fetch(DATA_PATHS.DATA);
            if (!response.ok) {
              throw new Error(`Network response error: ${response.status}`);
            }
            const data = await response.json();

            // 提取便秘相关菌数据
            const constipationData = data["疾病相关菌"] ? data["疾病相关菌"]["便秘"] : [];
            this.renderTable(constipationData);
          } catch (error) {
            console.error('Error loading constipation bacteria data:', error);
            document.getElementById('constipation-data-table-body').innerHTML =
              '<div class="text-center p-4 text-red-500">数据加载失败，请稍后再试</div>';
          }
        },

        // 初始化
        init() {
          if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => this.loadData());
          } else {
            this.loadData();
          }
        }
      };

      // 初始化便秘相关菌模块
      ConstipationBacteria.init();
    </script>
  </div>

  <!-- 疾病症状相关菌 : 腹胀相关菌 -->

  <h3 class="custom-title-third-level page-break">
    腹胀相关菌
  </h3>

  <div class="bg-white rounded-lg p-5 mb-5 mx-auto" style="width: 100%;">
    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            <i class="fas fa-info-circle icon"></i>
            肠道菌群失衡与腹胀症状关系密切。当肠道内产气菌群过度增殖时，肠道气体产生增多，容易导致腹部膨胀和不适感。腹胀患者常见双歧杆菌等有益菌减少，而产气细菌和产甲烷菌增多，导致肠道发酵异常。调节肠道菌群结构，减少高发酵食物摄入，补充特定益生菌，有助于缓解腹胀症状，恢复肠道健康。
          </p>
        </div>
      </div>
    </div>

    <div class="rounded-table">
      <!-- 创建表格头部 -->
      <table class="min-w-full">
        <thead>
        <tr style="background-color: #00B2B4; color: white;">
          <th
            class="py-2 px-4 text-left bloating-first-column"
            style="font-size: 13px;"
          >
            腹胀相关菌名称
          </th>
          <th
            class="py-2 px-4 text-center bloating-second-column"
            style="font-size: 13px; padding: 5px 5px;"
          >
            参考范围%
          </th>
          <th
            class="py-2 px-4 text-center bloating-third-column"
            style="font-size: 13px; padding: 5px 5px;"
          >
            检测丰度%
          </th>
          <th
            class="py-2 px-4 text-center bloating-fourth-column"
            style="font-size: 13px; padding: 5px 5px;"
          >
            相关性
          </th>
          <th
            class="py-2 px-4 text-center bloating-fifth-column"
            style="font-size: 13px; padding: 5px 5px;"
          >
            相关性强度
          </th>
        </tr>
        </thead>
      </table>

      <!-- 数据表格容器 -->
      <div id="bloating-data-table-body">
        <!-- 数据将通过 JavaScript 动态插入 -->
      </div>
    </div>

    <script>
      // 腹胀相关菌数据展示模块
      const BloatingBacteria = {
        // 常量定义
        CONSTANTS: {
          COLORS: {
            RED: '#ff4d4f',
            GREEN: '#389e0d',
            YELLOW: '#faad14',
            BLUE: '#3b82f6',
            GRAY: '#808080',
            BLACK: '#000000',
            PRIMARY: '#00B2B4',
            WARNING: '#faad14',
            ORANGE: '#fa8c16'
          },
          CORRELATION: {
            "+": {
              text: "正相关",
              textColor: "text-black",
              starColor: "text-orange-500"
            },
            "-": {
              text: "负相关",
              textColor: "text-black",
              starColor: "text-blue-500"
            }
          }
        },

        // 格式化数字
        formatNumber(value) {
          if (value === "ND" || value === "-") return value;
          const num = Number(value);
          if (isNaN(num)) return value;
          return num.toFixed(3).replace(/\.?0+$/, '');
        },

        // 解析正常范围
        parseRange(rangeStr) {
          if (!rangeStr || typeof rangeStr !== 'string') {
            return { min: 0, max: 0 };
          }
          const parts = rangeStr.split('-');
          return {
            min: parseFloat(parts[0] || 0),
            max: parseFloat(parts[1] || 0)
          };
        },

        // 分离中文名和拉丁名
        separateName(fullName) {
          if (!fullName) return { chineseName: '', latinName: '' };

          // 假设格式是"中文名 拉丁名"，用空格分隔
          const parts = fullName.split(' ');

          // 如果只有一个部分，或者没有包含拉丁字符的部分
          if (parts.length === 1) {
            return { chineseName: parts[0], latinName: '' };
          }

          // 找到第一个包含拉丁字符的部分
          let latinIndex = -1;
          for (let i = 0; i < parts.length; i++) {
            if (/[a-zA-Z]/.test(parts[i])) {
              latinIndex = i;
              break;
            }
          }

          if (latinIndex === -1) {
            // 如果没有找到拉丁字符，全部作为中文名
            return { chineseName: fullName, latinName: '' };
          }

          // 分离中文名和拉丁名
          const chineseName = parts.slice(0, latinIndex).join(' ');
          const latinName = parts.slice(latinIndex).join(' ');

          return { chineseName, latinName };
        },

        // 获取状态信息
        getStatus(detected, normalRange) {
          const { min, max } = this.parseRange(normalRange);

          if (detected === "ND") {
            if (min > 0) {
              return {
                text: '缺乏',
                color: this.CONSTANTS.COLORS.RED,
                icon: '<i class="fas fa-arrow-down ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>',
                isNormal: false,
                direction: 'down',
                isGrayND: false
              };
            } else {
              return {
                text: '正常',
                color: this.CONSTANTS.COLORS.GRAY,
                icon: '',
                isNormal: true,
                direction: null,
                isGrayND: true
              };
            }
          }

          // 如果检测值不是ND，转换为数字进行比较
          const numDetected = Number(detected);

          if (numDetected < min) {
            return {
              text: '偏低',
              color: this.CONSTANTS.COLORS.RED,
              icon: '<i class="fas fa-arrow-down ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>',
              isNormal: false,
              direction: 'down',
              isGrayND: false
            };
          } else if (numDetected > max) {
            return {
              text: '超标',
              color: this.CONSTANTS.COLORS.RED,
              icon: '<i class="fas fa-arrow-up ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>',
              isNormal: false,
              direction: 'up',
              isGrayND: false
            };
          } else {
            return {
              text: '正常',
              color: this.CONSTANTS.COLORS.GREEN,
              icon: '',
              isNormal: true,
              direction: null,
              isGrayND: false
            };
          }
        },

        // 生成星星评级
        generateStars(count, correlationType) {
          const starColor = this.CONSTANTS.CORRELATION[correlationType].starColor;
          return Array(3).fill().map((_, i) =>
            `<i class="fa fa-star ${i < count ? starColor : 'text-gray-300'}" aria-hidden="true"></i>`
          ).join('');
        },

        // 计算进度条百分比
        calculateProgressWidth(value) {
          if (value === 'ND' || value === 0) return 0;

          const num = Number(value);
          if (isNaN(num)) return 0;

          if (num <= 20) {
            return Math.min(20, Math.max(5, num * 1.5));
          }
          return Math.min(100, Math.max(0, num));
        },

        // 创建描述行
        createDescriptionRow(bacteria, status) {
          let descriptionContent = '';

          // 添加常规说明
          if (bacteria.说明 && bacteria.说明.trim()) {
            descriptionContent += `
            <div class="flex items-start mb-0">
              <div class="ml-1">
                <p>
                  <i class="fas fa-info-circle" style="color: ${this.CONSTANTS.COLORS.PRIMARY};"></i>
                  ${bacteria.说明}
                </p>
              </div>
            </div>
          `;
          }

          // 如果状态不是正常，并且有改善方式，添加改善建议
          if (!status.isNormal && bacteria.改善方式 && bacteria.改善方式.trim()) {
            descriptionContent += `
            <div class="flex items-start mt-0">
              <div class="ml-1">
                <p>
                  <i class="fas fa-bell" style="color: ${this.CONSTANTS.COLORS.WARNING};"></i>
                  <strong>改善建议：</strong> ${bacteria.改善方式}
                </p>
              </div>
            </div>
          `;
          }

          // 如果有内容需要显示，返回完整的行
          if (descriptionContent.trim()) {
            return `
            <tr class="description-row">
              <td colspan="7" class="py-2 px-4 text-left">
                <div class="description-container text-gray-600" style="font-size: 11px;">
                  ${descriptionContent}
                </div>
              </td>
            </tr>
          `;
          }

          // 如果没有描述内容，返回空字符串
          return '';
        },

        // 渲染表格
        renderTable(bloatingData) {
          const container = document.getElementById('bloating-data-table-body');
          if (!container) {
            console.error('Cannot find container element');
            return;
          }

          container.innerHTML = '';

          if (!bloatingData || !Array.isArray(bloatingData) || bloatingData.length === 0) {
            container.innerHTML = '<div class="text-center p-4 text-red-500">暂无腹胀相关菌数据</div>';
            return;
          }

          const fragment = document.createDocumentFragment();

          bloatingData.forEach(bacteria => {
            const { chineseName, latinName } = this.separateName(bacteria.名称);
            const normalRange = bacteria.正常范围;
            const detected = bacteria["丰度%"];
            const higherThanPercentage = bacteria.超过人群百分比 || "-";
            const correlation = bacteria.问题相关性;
            const evidenceStrength = parseInt(bacteria.证据强度 || "0", 10);

            const { min, max } = this.parseRange(normalRange);
            const status = this.getStatus(detected, normalRange);
            const isPositive = correlation === "+";
            const isNegative = correlation === "-";

            // 创建容器
            const bacteriaContainer = document.createElement('div');
            bacteriaContainer.className = 'bacteria-info-container';

            // 高亮风险组合
            if ((status.text === '超标' && isPositive) ||
              ((status.text === '偏低' || status.text === '缺乏') && isNegative)) {
              // 选择合适的边框颜色
              let borderColor;
              if (isPositive) {
                borderColor = this.CONSTANTS.COLORS.RED; // 正相关+超标用红色
              } else {
                borderColor = this.CONSTANTS.COLORS.ORANGE; // 负相关+偏低/缺乏用橙色
              }

              bacteriaContainer.style.border = `1px solid ${borderColor}`;
              bacteriaContainer.style.borderRadius = '4px';
              bacteriaContainer.style.margin = '4px 0';
            } else {
              bacteriaContainer.style.border = '1px solid transparent';
            }

            // 创建表格
            const table = document.createElement('table');
            table.className = 'bacteria-table min-w-full';

            // 格式化数值
            const formattedMinRange = this.formatNumber(min, 2);
            const formattedMaxRange = this.formatNumber(max, 2);

            // 数据行
            const progressPercentage = this.calculateProgressWidth(detected);

            // 根据状态确定未检出的颜色
            const detectedText = detected === "ND"
              ? (status.isGrayND ? `<span style="color: ${this.CONSTANTS.COLORS.GRAY}">ND</span>` : 'ND')
              : this.formatNumber(detected);

            const dataRow = `
            <tr>
              <td class="py-2 px-4 text-left bloating-first-column">
                <div class="obesity-chinese-text"><strong>${chineseName || '未知'}</strong></div>
                <div class="obesity-latin-text text-gray-500">${latinName || ''}</div>
              </td>
              <td class="py-2 px-4 text-center bloating-second-column obesity-column-text">
                ${formattedMinRange}-${formattedMaxRange}
              </td>
              <td class="py-2 px-4 text-center bloating-third-column disease-column-text">
                <span style="color: ${status.isNormal && !status.isGrayND ? 'inherit' : status.color}">
                  ${detectedText}
                  ${status.icon || ''}
                </span>
                <div class="progress-bar w-full mt-2" style="background-color: #e9ecef; height: 8px; border-radius: 4px; overflow: hidden;">
                  <div class="progress"
                       style="width: ${progressPercentage}%;
                              height: 100%;
                              background-color: ${this.CONSTANTS.COLORS.PRIMARY};
                              transition: width 0.3s ease;">
                  </div>
                </div>
              </td>
              <td class="py-2 px-4 text-center bloating-fourth-column disease-column-text">
                <span class="${this.CONSTANTS.CORRELATION[correlation].textColor}">${this.CONSTANTS.CORRELATION[correlation].text}</span>
              </td>
              <td class="py-2 px-4 text-center bloating-fifth-column disease-column-text">
                <div class="flex justify-center items-center">
                  ${this.generateStars(evidenceStrength, correlation)}
                </div>
              </td>
            </tr>
          `;

            // 描述行
            const descRow = this.createDescriptionRow(bacteria, status);

            table.innerHTML = `<tbody>${dataRow}${descRow}</tbody>`;
            bacteriaContainer.appendChild(table);
            fragment.appendChild(bacteriaContainer);
          });

          container.appendChild(fragment);
        },

        // 加载数据
        async loadData() {
          try {
            const response = await fetch(DATA_PATHS.DATA);
            if (!response.ok) {
              throw new Error(`Network response error: ${response.status}`);
            }
            const data = await response.json();

            // 提取腹胀相关菌数据
            const bloatingData = data["疾病相关菌"] ? data["疾病相关菌"]["腹胀"] : [];
            this.renderTable(bloatingData);
          } catch (error) {
            console.error('Error loading bloating bacteria data:', error);
            document.getElementById('bloating-data-table-body').innerHTML =
              '<div class="text-center p-4 text-red-500">数据加载失败，请稍后再试</div>';
          }
        },

        // 初始化
        init() {
          if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => this.loadData());
          } else {
            this.loadData();
          }
        }
      };

      // 初始化腹胀相关菌模块
      BloatingBacteria.init();
    </script>
  </div>

  <!-- 疾病症状相关菌 : 过敏相关菌 -->

  <h3 class="custom-title-third-level page-break">
    过敏相关菌
  </h3>

  <div class="bg-white rounded-lg p-5 mb-5 mx-auto" style="width: 100%;">
    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            <i class="fas fa-info-circle icon"></i>
            肠道菌群失衡与过敏症状密切相关。健康的肠道微生物群落对免疫系统发育和调控至关重要。
          </p>
        </div>
      </div>
    </div>

    <div class="rounded-table">
      <!-- 创建表格头部 -->
      <table class="min-w-full">
        <thead>
        <tr style="background-color: #00B2B4; color: white;">
          <th
            class="py-2 px-4 text-left allergy-first-column"
            style="font-size: 13px;"
          >
            过敏相关菌名称
          </th>
          <th
            class="py-2 px-4 text-center allergy-second-column"
            style="font-size: 13px; padding: 5px 5px;"
          >
            参考范围%
          </th>
          <th
            class="py-2 px-4 text-center allergy-third-column"
            style="font-size: 13px; padding: 5px 5px;"
          >
            检测丰度%
          </th>
          <th
            class="py-2 px-4 text-center allergy-fourth-column"
            style="font-size: 13px; padding: 5px 5px;"
          >
            相关性
          </th>
          <th
            class="py-2 px-4 text-center allergy-fifth-column"
            style="font-size: 13px; padding: 5px 5px;"
          >
            相关性强度
          </th>
        </tr>
        </thead>
      </table>

      <!-- 数据表格容器 -->
      <div id="allergy-data-table-body">
        <!-- 数据将通过 JavaScript 动态插入 -->
      </div>
    </div>

    <script>
      // 过敏相关菌数据展示模块
      const AllergyBacteria = {
        // 常量定义
        CONSTANTS: {
          COLORS: {
            RED: '#ff4d4f',
            GREEN: '#389e0d',
            YELLOW: '#faad14',
            BLUE: '#3b82f6',
            GRAY: '#808080',
            BLACK: '#000000',
            PRIMARY: '#00B2B4',
            WARNING: '#faad14',
            ORANGE: '#fa8c16'
          },
          CORRELATION: {
            "+": {
              text: "正相关",
              textColor: "text-black",
              starColor: "text-orange-500"
            },
            "-": {
              text: "负相关",
              textColor: "text-black",
              starColor: "text-blue-500"
            }
          }
        },

        // 格式化数字
        formatNumber(value) {
          if (value === "ND" || value === "-") return value;
          const num = Number(value);
          if (isNaN(num)) return value;
          return num.toFixed(3).replace(/\.?0+$/, '');
        },

        // 解析正常范围
        parseRange(rangeStr) {
          if (!rangeStr || typeof rangeStr !== 'string') {
            return { min: 0, max: 0 };
          }
          const parts = rangeStr.split('-');
          return {
            min: parseFloat(parts[0] || 0),
            max: parseFloat(parts[1] || 0)
          };
        },

        // 分离中文名和拉丁名
        separateName(fullName) {
          if (!fullName) return { chineseName: '', latinName: '' };

          // 假设格式是"中文名 拉丁名"，用空格分隔
          const parts = fullName.split(' ');

          // 如果只有一个部分，或者没有包含拉丁字符的部分
          if (parts.length === 1) {
            return { chineseName: parts[0], latinName: '' };
          }

          // 找到第一个包含拉丁字符的部分
          let latinIndex = -1;
          for (let i = 0; i < parts.length; i++) {
            if (/[a-zA-Z]/.test(parts[i])) {
              latinIndex = i;
              break;
            }
          }

          if (latinIndex === -1) {
            // 如果没有找到拉丁字符，全部作为中文名
            return { chineseName: fullName, latinName: '' };
          }

          // 分离中文名和拉丁名
          const chineseName = parts.slice(0, latinIndex).join(' ');
          const latinName = parts.slice(latinIndex).join(' ');

          return { chineseName, latinName };
        },

        // 获取状态信息
        getStatus(detected, normalRange) {
          const { min, max } = this.parseRange(normalRange);

          if (detected === "ND") {
            if (min > 0) {
              return {
                text: '缺乏',
                color: this.CONSTANTS.COLORS.RED,
                icon: '<i class="fas fa-arrow-down ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>',
                isNormal: false,
                direction: 'down',
                isGrayND: false
              };
            } else {
              return {
                text: '正常',
                color: this.CONSTANTS.COLORS.GRAY,
                icon: '',
                isNormal: true,
                direction: null,
                isGrayND: true
              };
            }
          }

          // 如果检测值不是ND，转换为数字进行比较
          const numDetected = Number(detected);

          if (numDetected < min) {
            return {
              text: '偏低',
              color: this.CONSTANTS.COLORS.RED,
              icon: '<i class="fas fa-arrow-down ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>',
              isNormal: false,
              direction: 'down',
              isGrayND: false
            };
          } else if (numDetected > max) {
            return {
              text: '超标',
              color: this.CONSTANTS.COLORS.RED,
              icon: '<i class="fas fa-arrow-up ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>',
              isNormal: false,
              direction: 'up',
              isGrayND: false
            };
          } else {
            return {
              text: '正常',
              color: this.CONSTANTS.COLORS.GREEN,
              icon: '',
              isNormal: true,
              direction: null,
              isGrayND: false
            };
          }
        },

        // 生成星星评级
        generateStars(count, correlationType) {
          const starColor = this.CONSTANTS.CORRELATION[correlationType].starColor;
          return Array(3).fill().map((_, i) =>
            `<i class="fa fa-star ${i < count ? starColor : 'text-gray-300'}" aria-hidden="true"></i>`
          ).join('');
        },

        // 计算进度条百分比
        calculateProgressWidth(value) {
          if (value === 'ND' || value === 0) return 0;

          const num = Number(value);
          if (isNaN(num)) return 0;

          if (num <= 20) {
            return Math.min(20, Math.max(5, num * 1.5));
          }
          return Math.min(100, Math.max(0, num));
        },

        // 创建描述行
        createDescriptionRow(bacteria, status) {
          let descriptionContent = '';

          // 添加常规说明
          if (bacteria.说明 && bacteria.说明.trim()) {
            descriptionContent += `
            <div class="flex items-start mb-0">
              <div class="ml-1">
                <p>
                  <i class="fas fa-info-circle" style="color: ${this.CONSTANTS.COLORS.PRIMARY};"></i>
                  ${bacteria.说明}
                </p>
              </div>
            </div>
          `;
          }

          // 如果状态不是正常，并且有改善方式，添加改善建议
          if (!status.isNormal && bacteria.改善方式 && bacteria.改善方式.trim()) {
            descriptionContent += `
            <div class="flex items-start mt-0">
              <div class="ml-1">
                <p>
                  <i class="fas fa-bell" style="color: ${this.CONSTANTS.COLORS.WARNING};"></i>
                  <strong>改善建议：</strong> ${bacteria.改善方式}
                </p>
              </div>
            </div>
          `;
          }

          // 如果有内容需要显示，返回完整的行
          if (descriptionContent.trim()) {
            return `
            <tr class="description-row">
              <td colspan="7" class="py-2 px-4 text-left">
                <div class="description-container text-gray-600" style="font-size: 11px;">
                  ${descriptionContent}
                </div>
              </td>
            </tr>
          `;
          }

          // 如果没有描述内容，返回空字符串
          return '';
        },

        // 渲染表格
        renderTable(allergyData) {
          const container = document.getElementById('allergy-data-table-body');
          if (!container) {
            console.error('Cannot find container element');
            return;
          }

          container.innerHTML = '';

          if (!allergyData || !Array.isArray(allergyData) || allergyData.length === 0) {
            container.innerHTML = '<div class="text-center p-4 text-red-500">暂无过敏相关菌数据</div>';
            return;
          }

          const fragment = document.createDocumentFragment();

          allergyData.forEach(bacteria => {
            const { chineseName, latinName } = this.separateName(bacteria.名称);
            const normalRange = bacteria.正常范围;
            const detected = bacteria["丰度%"];
            const higherThanPercentage = bacteria.超过人群百分比 || "-";
            const correlation = bacteria.问题相关性;
            const evidenceStrength = parseInt(bacteria.证据强度 || "0", 10);

            const { min, max } = this.parseRange(normalRange);
            const status = this.getStatus(detected, normalRange);
            const isPositive = correlation === "+";
            const isNegative = correlation === "-";

            // 创建容器
            const bacteriaContainer = document.createElement('div');
            bacteriaContainer.className = 'bacteria-info-container';

            // 高亮风险组合
            if ((status.text === '超标' && isPositive) ||
              ((status.text === '偏低' || status.text === '缺乏') && isNegative)) {
              // 选择合适的边框颜色
              let borderColor;
              if (isPositive) {
                borderColor = this.CONSTANTS.COLORS.RED; // 正相关+超标用红色
              } else {
                borderColor = this.CONSTANTS.COLORS.ORANGE; // 负相关+偏低/缺乏用橙色
              }

              bacteriaContainer.style.border = `1px solid ${borderColor}`;
              bacteriaContainer.style.borderRadius = '4px';
              bacteriaContainer.style.margin = '4px 0';
            } else {
              bacteriaContainer.style.border = '1px solid transparent';
            }

            // 创建表格
            const table = document.createElement('table');
            table.className = 'bacteria-table min-w-full';

            // 格式化数值
            const formattedMinRange = this.formatNumber(min, 2);
            const formattedMaxRange = this.formatNumber(max, 2);

            // 数据行
            const progressPercentage = this.calculateProgressWidth(detected);

            // 根据状态确定未检出的颜色
            const detectedText = detected === "ND"
              ? (status.isGrayND ? `<span style="color: ${this.CONSTANTS.COLORS.GRAY}">ND</span>` : 'ND')
              : this.formatNumber(detected);

            const dataRow = `
            <tr>
              <td class="py-2 px-4 text-left allergy-first-column">
                <div class="allergy-chinese-text"><strong>${chineseName || '未知'}</strong></div>
                <div class="allergy-latin-text text-gray-500">${latinName || ''}</div>
              </td>
              <td class="py-2 px-4 text-center allergy-second-column allergy-column-text">
                ${formattedMinRange}-${formattedMaxRange}
              </td>
              <td class="py-2 px-4 text-center allergy-third-column allergy-column-text">
                <span style="color: ${status.isNormal && !status.isGrayND ? 'inherit' : status.color}">
                  ${detectedText}
                  ${status.icon || ''}
                </span>
                <div class="progress-bar w-full mt-2" style="background-color: #e9ecef; height: 8px; border-radius: 4px; overflow: hidden;">
                  <div class="progress"
                       style="width: ${progressPercentage}%;
                              height: 100%;
                              background-color: ${this.CONSTANTS.COLORS.PRIMARY};
                              transition: width 0.3s ease;">
                  </div>
                </div>
              </td>

              <td class="py-2 px-4 text-center allergy-fourth-column allergy-column-text">
                <span class="${this.CONSTANTS.CORRELATION[correlation].textColor}">${this.CONSTANTS.CORRELATION[correlation].text}</span>
              </td>
              <td class="py-2 px-4 text-center allergy-fifth-column allergy-column-text">
                <div class="flex justify-center items-center">
                  ${this.generateStars(evidenceStrength, correlation)}
                </div>
              </td>
            </tr>
          `;

            // 描述行
            const descRow = this.createDescriptionRow(bacteria, status);

            table.innerHTML = `<tbody>${dataRow}${descRow}</tbody>`;
            bacteriaContainer.appendChild(table);
            fragment.appendChild(bacteriaContainer);
          });

          container.appendChild(fragment);
        },

        // 加载数据
        async loadData() {
          try {
            const response = await fetch(DATA_PATHS.DATA);
            if (!response.ok) {
              throw new Error(`Network response error: ${response.status}`);
            }
            const data = await response.json();

            // 提取过敏相关菌数据
            const allergyData = data["疾病相关菌"] ? data["疾病相关菌"]["过敏"] : [];
            this.renderTable(allergyData);
          } catch (error) {
            console.error('Error loading allergy bacteria data:', error);
            document.getElementById('allergy-data-table-body').innerHTML =
              '<div class="text-center p-4 text-red-500">数据加载失败，请稍后再试</div>';
          }
        },

        // 初始化
        init() {
          if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => this.loadData());
          } else {
            this.loadData();
          }
        }
      };

      // 初始化过敏相关菌模块
      AllergyBacteria.init();
    </script>
  </div>

  <!-- 疾病症状相关菌 : 抑郁相关菌 -->

  <h3 class="custom-title-third-level page-break">
    抑郁相关菌
  </h3>

  <div class="bg-white rounded-lg p-5 mb-5 mx-auto" style="width: 100%;">
    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            <i class="fas fa-info-circle icon"></i>
            肠道菌群失衡与过敏症状密切相关。健康的肠道微生物群落对免疫系统发育和调控至关重要，当有益菌减少时，肠道屏障功能受损，免疫耐受机制被破坏。
          </p>
        </div>
      </div>
    </div>

    <div class="rounded-table">
      <!-- 创建表格头部 -->
      <table class="min-w-full">
        <thead>
        <tr style="background-color: #00B2B4; color: white;">
          <th
            class="py-2 px-4 text-left depression-first-column"
            style="font-size: 13px;"
          >
            抑郁相关菌名称
          </th>
          <th
            class="py-2 px-4 text-center depression-second-column"
            style="font-size: 13px; padding: 5px 5px;"
          >
            参考范围%
          </th>
          <th
            class="py-2 px-4 text-center depression-third-column"
            style="font-size: 13px; padding: 5px 5px;"
          >
            检测丰度%
          </th>
          <th
            class="py-2 px-4 text-center depression-fourth-column"
            style="font-size: 13px; padding: 5px 5px;"
          >
            相关性
          </th>
          <th
            class="py-2 px-4 text-center depression-fifth-column"
            style="font-size: 13px; padding: 5px 5px;"
          >
            相关性强度
          </th>
        </tr>
        </thead>
      </table>

      <!-- 数据表格容器 -->
      <div id="depression-data-table-body">
        <!-- 数据将通过 JavaScript 动态插入 -->
      </div>
    </div>

    <script>
      // 抑郁相关菌数据展示模块
      const DepressionBacteria = {
        // 常量定义
        CONSTANTS: {
          COLORS: {
            RED: '#ff4d4f',
            GREEN: '#389e0d',
            YELLOW: '#faad14',
            BLUE: '#3b82f6',
            GRAY: '#808080',
            BLACK: '#000000',
            PRIMARY: '#00B2B4',
            WARNING: '#faad14',
            ORANGE: '#fa8c16'
          },
          CORRELATION: {
            "+": {
              text: "正相关",
              textColor: "text-black",
              starColor: "text-orange-500"
            },
            "-": {
              text: "负相关",
              textColor: "text-black",
              starColor: "text-blue-500"
            }
          }
        },

        // 格式化数字
        formatNumber(value) {
          if (value === "ND" || value === "-") return value;
          const num = Number(value);
          if (isNaN(num)) return value;
          return num.toFixed(3).replace(/\.?0+$/, '');
        },

        // 解析正常范围
        parseRange(rangeStr) {
          if (!rangeStr || typeof rangeStr !== 'string') {
            return { min: 0, max: 0 };
          }
          const parts = rangeStr.split('-');
          return {
            min: parseFloat(parts[0] || 0),
            max: parseFloat(parts[1] || 0)
          };
        },

        // 分离中文名和拉丁名
        separateName(fullName) {
          if (!fullName) return { chineseName: '', latinName: '' };

          // 假设格式是"中文名 拉丁名"，用空格分隔
          const parts = fullName.split(' ');

          // 如果只有一个部分，或者没有包含拉丁字符的部分
          if (parts.length === 1) {
            return { chineseName: parts[0], latinName: '' };
          }

          // 找到第一个包含拉丁字符的部分
          let latinIndex = -1;
          for (let i = 0; i < parts.length; i++) {
            if (/[a-zA-Z]/.test(parts[i])) {
              latinIndex = i;
              break;
            }
          }

          if (latinIndex === -1) {
            // 如果没有找到拉丁字符，全部作为中文名
            return { chineseName: fullName, latinName: '' };
          }

          // 分离中文名和拉丁名
          const chineseName = parts.slice(0, latinIndex).join(' ');
          const latinName = parts.slice(latinIndex).join(' ');

          return { chineseName, latinName };
        },

        // 获取状态信息
        getStatus(detected, normalRange) {
          const { min, max } = this.parseRange(normalRange);

          if (detected === "ND") {
            if (min > 0) {
              return {
                text: '缺乏',
                color: this.CONSTANTS.COLORS.RED,
                icon: '<i class="fas fa-arrow-down ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>',
                isNormal: false,
                direction: 'down',
                isGrayND: false
              };
            } else {
              return {
                text: '正常',
                color: this.CONSTANTS.COLORS.GRAY,
                icon: '',
                isNormal: true,
                direction: null,
                isGrayND: true
              };
            }
          }

          // 如果检测值不是ND，转换为数字进行比较
          const numDetected = Number(detected);

          if (numDetected < min) {
            return {
              text: '偏低',
              color: this.CONSTANTS.COLORS.RED,
              icon: '<i class="fas fa-arrow-down ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>',
              isNormal: false,
              direction: 'down',
              isGrayND: false
            };
          } else if (numDetected > max) {
            return {
              text: '超标',
              color: this.CONSTANTS.COLORS.RED,
              icon: '<i class="fas fa-arrow-up ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>',
              isNormal: false,
              direction: 'up',
              isGrayND: false
            };
          } else {
            return {
              text: '正常',
              color: this.CONSTANTS.COLORS.GREEN,
              icon: '',
              isNormal: true,
              direction: null,
              isGrayND: false
            };
          }
        },

        // 生成星星评级
        generateStars(count, correlationType) {
          const starColor = this.CONSTANTS.CORRELATION[correlationType].starColor;
          return Array(3).fill().map((_, i) =>
            `<i class="fa fa-star ${i < count ? starColor : 'text-gray-300'}" aria-hidden="true"></i>`
          ).join('');
        },

        // 计算进度条百分比
        calculateProgressWidth(value) {
          if (value === 'ND' || value === 0) return 0;

          const num = Number(value);
          if (isNaN(num)) return 0;

          if (num <= 20) {
            return Math.min(20, Math.max(5, num * 1.5));
          }
          return Math.min(100, Math.max(0, num));
        },

        // 创建描述行
        createDescriptionRow(bacteria, status) {
          let descriptionContent = '';

          // 添加常规说明
          if (bacteria.说明 && bacteria.说明.trim()) {
            descriptionContent += `
            <div class="flex items-start mb-0">
              <div class="ml-1">
                <p>
                  <i class="fas fa-info-circle" style="color: ${this.CONSTANTS.COLORS.PRIMARY};"></i>
                  ${bacteria.说明}
                </p>
              </div>
            </div>
          `;
          }

          // 如果状态不是正常，并且有改善方式，添加改善建议
          if (!status.isNormal && bacteria.改善方式 && bacteria.改善方式.trim()) {
            descriptionContent += `
            <div class="flex items-start mt-0">
              <div class="ml-1">
                <p>
                  <i class="fas fa-bell" style="color: ${this.CONSTANTS.COLORS.WARNING};"></i>
                  <strong>改善建议：</strong> ${bacteria.改善方式}
                </p>
              </div>
            </div>
          `;
          }

          // 如果有内容需要显示，返回完整的行
          if (descriptionContent.trim()) {
            return `
            <tr class="description-row">
              <td colspan="7" class="py-2 px-4 text-left">
                <div class="description-container text-gray-600" style="font-size: 11px;">
                  ${descriptionContent}
                </div>
              </td>
            </tr>
          `;
          }

          // 如果没有描述内容，返回空字符串
          return '';
        },

        // 渲染表格
        renderTable(depressionData) {
          const container = document.getElementById('depression-data-table-body');
          if (!container) {
            console.error('Cannot find container element');
            return;
          }

          container.innerHTML = '';

          if (!depressionData || !Array.isArray(depressionData) || depressionData.length === 0) {
            container.innerHTML = '<div class="text-center p-4 text-red-500">暂无抑郁相关菌数据</div>';
            return;
          }

          const fragment = document.createDocumentFragment();

          depressionData.forEach(bacteria => {
            const { chineseName, latinName } = this.separateName(bacteria.名称);
            const normalRange = bacteria.正常范围;
            const detected = bacteria["丰度%"];
            const higherThanPercentage = bacteria.超过人群百分比 || "-";
            const correlation = bacteria.问题相关性;
            const evidenceStrength = parseInt(bacteria.证据强度 || "0", 10);

            const { min, max } = this.parseRange(normalRange);
            const status = this.getStatus(detected, normalRange);
            const isPositive = correlation === "+";
            const isNegative = correlation === "-";

            // 创建容器
            const bacteriaContainer = document.createElement('div');
            bacteriaContainer.className = 'bacteria-info-container';

            // 高亮风险组合
            if ((status.text === '超标' && isPositive) ||
              ((status.text === '偏低' || status.text === '缺乏') && isNegative)) {
              // 选择合适的边框颜色
              let borderColor;
              if (isPositive) {
                borderColor = this.CONSTANTS.COLORS.RED; // 正相关+超标用红色
              } else {
                borderColor = this.CONSTANTS.COLORS.ORANGE; // 负相关+偏低/缺乏用橙色
              }

              bacteriaContainer.style.border = `1px solid ${borderColor}`;
              bacteriaContainer.style.borderRadius = '4px';
              bacteriaContainer.style.margin = '4px 0';
            } else {
              bacteriaContainer.style.border = '1px solid transparent';
            }

            // 创建表格
            const table = document.createElement('table');
            table.className = 'bacteria-table min-w-full';

            // 格式化数值
            const formattedMinRange = this.formatNumber(min, 2);
            const formattedMaxRange = this.formatNumber(max, 2);

            // 数据行
            const progressPercentage = this.calculateProgressWidth(detected);

            // 根据状态确定未检出的颜色
            const detectedText = detected === "ND"
              ? (status.isGrayND ? `<span style="color: ${this.CONSTANTS.COLORS.GRAY}">ND</span>` : 'ND')
              : this.formatNumber(detected);

            const dataRow = `
            <tr>
              <td class="py-2 px-4 text-left depression-first-column">
                <div class="obesity-chinese-text"><strong>${chineseName || '未知'}</strong></div>
                <div class="obesity-latin-text text-gray-500">${latinName || ''}</div>
              </td>
              <td class="py-2 px-4 text-center depression-second-column depression-column-text">
                ${formattedMinRange}-${formattedMaxRange}
              </td>
              <td class="py-2 px-4 text-center depression-third-column depression-column-text">
                <span style="color: ${status.isNormal && !status.isGrayND ? 'inherit' : status.color}">
                  ${detectedText}
                  ${status.icon || ''}
                </span>
                <div class="progress-bar w-full mt-2" style="background-color: #e9ecef; height: 8px; border-radius: 4px; overflow: hidden;">
                  <div class="progress"
                       style="width: ${progressPercentage}%;
                              height: 100%;
                              background-color: ${this.CONSTANTS.COLORS.PRIMARY};
                              transition: width 0.3s ease;">
                  </div>
                </div>
              </td>

              <td class="py-2 px-4 text-center depression-fourth-column depression-column-text">
                <span class="${this.CONSTANTS.CORRELATION[correlation].textColor}">${this.CONSTANTS.CORRELATION[correlation].text}</span>
              </td>
              <td class="py-2 px-4 text-center depression-fifth-column depression-column-text">
                <div class="flex justify-center items-center">
                  ${this.generateStars(evidenceStrength, correlation)}
                </div>
              </td>
            </tr>
          `;

            // 描述行
            const descRow = this.createDescriptionRow(bacteria, status);

            table.innerHTML = `<tbody>${dataRow}${descRow}</tbody>`;
            bacteriaContainer.appendChild(table);
            fragment.appendChild(bacteriaContainer);
          });

          container.appendChild(fragment);
        },

        // 加载数据
        async loadData() {
          try {
            const response = await fetch(DATA_PATHS.DATA);
            if (!response.ok) {
              throw new Error(`Network response error: ${response.status}`);
            }
            const data = await response.json();

            // 提取抑郁相关菌数据
            const depressionData = data["疾病相关菌"] ? data["疾病相关菌"]["抑郁"] : [];
            this.renderTable(depressionData);
          } catch (error) {
            console.error('Error loading depression bacteria data:', error);
            document.getElementById('depression-data-table-body').innerHTML =
              '<div class="text-center p-4 text-red-500">数据加载失败，请稍后再试</div>';
          }
        },

        // 初始化
        init() {
          if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => this.loadData());
          } else {
            this.loadData();
          }
        }
      };

      // 初始化抑郁相关菌模块
      DepressionBacteria.init();
    </script>
  </div>

  <!-- 疾病症状相关菌 : 失眠相关菌 -->

  <h3 class="custom-title-third-level page-break">
    失眠相关菌
  </h3>

  <div class="bg-white rounded-lg p-5 mb-5 mx-auto" style="width: 100%;">
    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            <i class="fas fa-info-circle icon"></i>
            肠道菌群失衡与失眠存在显著关联。通过肠-脑轴，肠道微生物可影响大脑功能和睡眠调节。失眠患者的肠道菌群多样性常见降低，某些有益菌群比例减少。
          </p>
        </div>
      </div>
    </div>

    <div class="rounded-table">
      <!-- 创建表格头部 -->
      <table class="min-w-full">
        <thead>
        <tr style="background-color: #00B2B4; color: white;">
          <th
            class="py-2 px-4 text-left insomnia-first-column"
            style="font-size: 13px;"
          >
            失眠相关菌名称
          </th>
          <th
            class="py-2 px-4 text-center insomnia-second-column"
            style="font-size: 13px; padding: 5px 5px;"
          >
            参考范围%
          </th>
          <th
            class="py-2 px-4 text-center insomnia-third-column"
            style="font-size: 13px; padding: 5px 5px;"
          >
            检测丰度%
          </th>
          <th
            class="py-2 px-4 text-center insomnia-fourth-column"
            style="font-size: 13px; padding: 5px 5px;"
          >
            相关性
          </th>
          <th
            class="py-2 px-4 text-center insomnia-fifth-column"
            style="font-size: 13px; padding: 5px 5px;"
          >
            相关性强度
          </th>
        </tr>
        </thead>
      </table>

      <!-- 数据表格容器 -->
      <div id="insomnia-data-table-body">
        <!-- 数据将通过 JavaScript 动态插入 -->
      </div>
    </div>

    <script>
      // 失眠相关菌数据展示模块
      const InsomniaBacteria = {
        // 常量定义
        CONSTANTS: {
          COLORS: {
            RED: '#ff4d4f',
            GREEN: '#389e0d',
            YELLOW: '#faad14',
            BLUE: '#3b82f6',
            GRAY: '#808080',
            BLACK: '#000000',
            PRIMARY: '#00B2B4',
            WARNING: '#faad14',
            ORANGE: '#fa8c16'
          },
          CORRELATION: {
            "+": {
              text: "正相关",
              textColor: "text-black",
              starColor: "text-orange-500"
            },
            "-": {
              text: "负相关",
              textColor: "text-black",
              starColor: "text-blue-500"
            }
          }
        },

        // 格式化数字
        formatNumber(value) {
          if (value === "ND" || value === "-") return value;
          const num = Number(value);
          if (isNaN(num)) return value;
          return num.toFixed(3).replace(/\.?0+$/, '');
        },

        // 解析正常范围
        parseRange(rangeStr) {
          if (!rangeStr || typeof rangeStr !== 'string') {
            return { min: 0, max: 0 };
          }
          const parts = rangeStr.split('-');
          return {
            min: parseFloat(parts[0] || 0),
            max: parseFloat(parts[1] || 0)
          };
        },

        // 分离中文名和拉丁名
        separateName(fullName) {
          if (!fullName) return { chineseName: '', latinName: '' };

          // 假设格式是"中文名 拉丁名"，用空格分隔
          const parts = fullName.split(' ');

          // 如果只有一个部分，或者没有包含拉丁字符的部分
          if (parts.length === 1) {
            return { chineseName: parts[0], latinName: '' };
          }

          // 找到第一个包含拉丁字符的部分
          let latinIndex = -1;
          for (let i = 0; i < parts.length; i++) {
            if (/[a-zA-Z]/.test(parts[i])) {
              latinIndex = i;
              break;
            }
          }

          if (latinIndex === -1) {
            // 如果没有找到拉丁字符，全部作为中文名
            return { chineseName: fullName, latinName: '' };
          }

          // 分离中文名和拉丁名
          const chineseName = parts.slice(0, latinIndex).join(' ');
          const latinName = parts.slice(latinIndex).join(' ');

          return { chineseName, latinName };
        },

        // 获取状态信息
        getStatus(detected, normalRange) {
          const { min, max } = this.parseRange(normalRange);

          if (detected === "ND") {
            if (min > 0) {
              return {
                text: '缺乏',
                color: this.CONSTANTS.COLORS.RED,
                icon: '<i class="fas fa-arrow-down ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>',
                isNormal: false,
                direction: 'down',
                isGrayND: false
              };
            } else {
              return {
                text: '正常',
                color: this.CONSTANTS.COLORS.GRAY,
                icon: '',
                isNormal: true,
                direction: null,
                isGrayND: true
              };
            }
          }

          // 如果检测值不是ND，转换为数字进行比较
          const numDetected = Number(detected);

          if (numDetected < min) {
            return {
              text: '偏低',
              color: this.CONSTANTS.COLORS.RED,
              icon: '<i class="fas fa-arrow-down ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>',
              isNormal: false,
              direction: 'down',
              isGrayND: false
            };
          } else if (numDetected > max) {
            return {
              text: '超标',
              color: this.CONSTANTS.COLORS.RED,
              icon: '<i class="fas fa-arrow-up ml-1" style="color: ' + this.CONSTANTS.COLORS.RED + ';"></i>',
              isNormal: false,
              direction: 'up',
              isGrayND: false
            };
          } else {
            return {
              text: '正常',
              color: this.CONSTANTS.COLORS.GREEN,
              icon: '',
              isNormal: true,
              direction: null,
              isGrayND: false
            };
          }
        },

        // 生成星星评级
        generateStars(count, correlationType) {
          const starColor = this.CONSTANTS.CORRELATION[correlationType].starColor;
          return Array(3).fill().map((_, i) =>
            `<i class="fa fa-star ${i < count ? starColor : 'text-gray-300'}" aria-hidden="true"></i>`
          ).join('');
        },

        // 计算进度条百分比
        calculateProgressWidth(value) {
          if (value === 'ND' || value === 0) return 0;

          const num = Number(value);
          if (isNaN(num)) return 0;

          if (num <= 20) {
            return Math.min(20, Math.max(5, num * 1.5));
          }
          return Math.min(100, Math.max(0, num));
        },

        // 创建描述行
        createDescriptionRow(bacteria, status) {
          let descriptionContent = '';

          // 添加常规说明
          if (bacteria.说明 && bacteria.说明.trim()) {
            descriptionContent += `
          <div class="flex items-start mb-0">
            <div class="ml-1">
              <p>
                <i class="fas fa-info-circle" style="color: ${this.CONSTANTS.COLORS.PRIMARY};"></i>
                ${bacteria.说明}
              </p>
            </div>
          </div>
        `;
          }

          // 如果状态不是正常，并且有改善方式，添加改善建议
          if (!status.isNormal && bacteria.改善方式 && bacteria.改善方式.trim()) {
            descriptionContent += `
          <div class="flex items-start mt-0">
            <div class="ml-1">
              <p>
                <i class="fas fa-bell" style="color: ${this.CONSTANTS.COLORS.WARNING};"></i>
                <strong>改善建议：</strong> ${bacteria.改善方式}
              </p>
            </div>
          </div>
        `;
          }

          // 如果有内容需要显示，返回完整的行
          if (descriptionContent.trim()) {
            return `
          <tr class="description-row">
            <td colspan="5" class="py-2 px-4 text-left">
              <div class="description-container text-gray-600" style="font-size: 11px;">
                ${descriptionContent}
              </div>
            </td>
          </tr>
        `;
          }

          // 如果没有描述内容，返回空字符串
          return '';
        },

        // 排序菌群数据
        sortBacteria(bacteriaData) {
          if (!bacteriaData || !Array.isArray(bacteriaData)) {
            return [];
          }

          // 排序权重计算函数
          const getSortWeight = (bacteria) => {
            const correlation = bacteria.问题相关性 || "";
            const stars = parseInt(bacteria.证据强度 || "0", 10);

            // 正相关比负相关排序靠前
            const correlationWeight = correlation === "+" ? 100 : 0;

            // 星星数量越多排序越靠前
            const starWeight = stars * 10;

            return correlationWeight + starWeight;
          };

          // 根据排序权重进行降序排序
          return [...bacteriaData].sort((a, b) => {
            const weightA = getSortWeight(a);
            const weightB = getSortWeight(b);
            return weightB - weightA; // 降序排列
          });
        },

        // 渲染表格
        renderTable(insomniaData) {
          const container = document.getElementById('insomnia-data-table-body');
          if (!container) {
            console.error('Cannot find container element');
            return;
          }

          container.innerHTML = '';

          if (!insomniaData || !Array.isArray(insomniaData) || insomniaData.length === 0) {
            container.innerHTML = '<div class="text-center p-4 text-red-500">暂无失眠相关菌数据</div>';
            return;
          }

          // 排序数据：正相关3星 > 正相关2星 > 正相关1星 > 负相关3星 > 负相关2星 > 负相关1星
          const sortedData = this.sortBacteria(insomniaData);

          const fragment = document.createDocumentFragment();

          sortedData.forEach(bacteria => {
            const { chineseName, latinName } = this.separateName(bacteria.名称);
            const normalRange = bacteria.正常范围;
            const detected = bacteria["丰度%"];
            const higherThanPercentage = bacteria.超过人群百分比 || "-";
            const correlation = bacteria.问题相关性;
            const evidenceStrength = parseInt(bacteria.证据强度 || "0", 10);

            const { min, max } = this.parseRange(normalRange);
            const status = this.getStatus(detected, normalRange);
            const isPositive = correlation === "+";
            const isNegative = correlation === "-";

            // 创建容器
            const bacteriaContainer = document.createElement('div');
            bacteriaContainer.className = 'bacteria-info-container';

            // 高亮风险组合
            if ((status.text === '超标' && isPositive) ||
              ((status.text === '偏低' || status.text === '缺乏') && isNegative)) {
              // 选择合适的边框颜色
              let borderColor;
              if (isPositive) {
                borderColor = this.CONSTANTS.COLORS.RED; // 正相关+超标用红色
              } else {
                borderColor = this.CONSTANTS.COLORS.ORANGE; // 负相关+偏低/缺乏用橙色
              }

              bacteriaContainer.style.border = `1px solid ${borderColor}`;
              bacteriaContainer.style.borderRadius = '4px';
              bacteriaContainer.style.margin = '4px 0';
            } else {
              bacteriaContainer.style.border = '1px solid transparent';
            }

            // 创建表格
            const table = document.createElement('table');
            table.className = 'bacteria-table min-w-full';

            // 格式化数值
            const formattedMinRange = this.formatNumber(min, 2);
            const formattedMaxRange = this.formatNumber(max, 2);

            // 数据行
            const progressPercentage = this.calculateProgressWidth(detected);

            // 根据状态确定未检出的颜色
            const detectedText = detected === "ND"
              ? (status.isGrayND ? `<span style="color: ${this.CONSTANTS.COLORS.GRAY}">ND</span>` : 'ND')
              : this.formatNumber(detected);

            const dataRow = `
          <tr>
            <td class="py-2 px-4 text-left insomnia-first-column">
              <div class="obesity-chinese-text"><strong>${chineseName || '未知'}</strong></div>
              <div class="obesity-latin-text text-gray-500">${latinName || ''}</div>
            </td>
            <td class="py-2 px-4 text-center insomnia-second-column obesity-column-text">
              ${formattedMinRange}-${formattedMaxRange}
            </td>
            <td class="py-2 px-4 text-center insomnia-third-column disease-column-text">
              <span style="color: ${status.isNormal && !status.isGrayND ? 'inherit' : status.color}">
                ${detectedText}
                ${status.icon || ''}
              </span>
              <div class="progress-bar w-full mt-2" style="background-color: #e9ecef; height: 8px; border-radius: 4px; overflow: hidden;">
                <div class="progress"
                     style="width: ${progressPercentage}%;
                            height: 100%;
                            background-color: ${this.CONSTANTS.COLORS.PRIMARY};
                            transition: width 0.3s ease;">
                </div>
              </div>
            </td>

            <td class="py-2 px-4 text-center insomnia-fourth-column disease-column-text">
              <span class="${this.CONSTANTS.CORRELATION[correlation].textColor}">${this.CONSTANTS.CORRELATION[correlation].text}</span>
            </td>
            <td class="py-2 px-4 text-center insomnia-fifth-column disease-column-text">
              <div class="flex justify-center items-center">
                ${this.generateStars(evidenceStrength, correlation)}
              </div>
            </td>
          </tr>
        `;

            // 描述行
            const descRow = this.createDescriptionRow(bacteria, status);

            table.innerHTML = `<tbody>${dataRow}${descRow}</tbody>`;
            bacteriaContainer.appendChild(table);
            fragment.appendChild(bacteriaContainer);
          });

          container.appendChild(fragment);
        },

        // 加载数据
        async loadData() {
          try {
            const response = await fetch(DATA_PATHS.DATA);
            if (!response.ok) {
              throw new Error(`Network response error: ${response.status}`);
            }
            const data = await response.json();

            // 提取失眠相关菌数据
            const insomniaData = data["疾病相关菌"] ? data["疾病相关菌"]["失眠"] : [];
            this.renderTable(insomniaData);
          } catch (error) {
            console.error('Error loading insomnia bacteria data:', error);
            document.getElementById('insomnia-data-table-body').innerHTML =
              '<div class="text-center p-4 text-red-500">数据加载失败，请稍后再试</div>';
          }
        },

        // 初始化
        init() {
          if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => this.loadData());
          } else {
            this.loadData();
          }
        }
      };

      // 初始化失眠相关菌模块
      InsomniaBacteria.init();
    </script>
  </div>


  <!-- 个性化饮食板块 -->
  <h1 class="custom-title-second-level page-break">个性化饮食推荐</h1>

  <div class="bg-white rounded-lg p-5 mb-5 mx-auto" style="width: 100%;">

    <!-- 信息框 -->

    <div class="info-box">
      <div class="flex items-start">
        <div class="ml-2">

          <p class="text-lg text-custom-teal">
            <i class="fas fa-info-circle icon"></i>
            我们为您提供了200多种常见食物的个性化推荐指数，评分范围从 -100 到 100，并附有每种食物的详细营养成分构成（基于每 100g 计算）。
          </p>

          <ul class="list-disc ml-5">

            <li>
              <strong>推荐原理</strong>
              <ul class="list-disc ml-5">
                <li>
                  基于您的肠道菌群构成、营养状况和疾病风险进行综合评估
                </li>
                <li>
                  计算每种食物的营养构成与您当前营养状况的匹配程度
                </li>
                <li>
                  考虑特定疾病需要避免的食物
                </li>
                <li>
                  正分值表示建议增加摄入，负分值表示建议减少摄入
                </li>
                <li>
                  对于营养缺乏的成分，含该营养较高的食物会获得更高的推荐分值
                </li>
              </ul>
            </li>

            <li>
              <strong>使用说明</strong>
              <ul class="list-disc ml-5">
                <li>
                  本推荐适用于成年人，不适合 2 岁以下婴幼儿<
                </li>
                <li>
                  母乳喂养期间，可作为母亲的膳食参考
                </li>
                <li>
                  建议2个月后重新检测更新建议，以适应健康状况变化
                </li>
              </ul>
            </li>

            <li>
              <strong>数据来源</strong>
              <ul class="list-disc ml-5">
                <li>
                  基于大规模人群营养饮食调查
                </li>
                <li>
                  参考《2017中国居民膳食指南》
                </li>
                <li>
                  采用机器学习和统计方法计算
                </li>
                <li>
                  营养成分数据参考了来自 USDA 食品成分数据库
                </li>
              </ul>
            </li>

          </ul>

        </div>

      </div>

    </div>



  </div>

    <!-- 个性化饮食板块 : 个性化饮食推荐TOP30 -->
  <h2 class="custom-title-second-level page-break">个性化饮食推荐TOP30</h2>
  <div class="bg-white rounded-lg mt-4 mx-auto" style="width: 100%;">

    <!-- 图例 -->

    <div class="food-recommendation-top-legend-container">
      <div class="bg-[#FF3B30] text-center text-white text-sm py-1">避免摄入</div>
      <div class="bg-[#FF9500] text-center text-white text-sm py-1">控制摄入</div>
      <div class="bg-[#FFCC00] text-center text-white text-sm py-1">适当摄入</div>
      <div class="bg-[#7ED321] text-center text-white text-sm py-1">建议食用</div>
      <div class="bg-[#00C35A] text-center text-white text-sm py-1">建议多食用</div>
      <div class="bg-[#00B248] text-center text-white text-sm py-1">强烈推荐</div>
    </div>

    <!-- 刻度 -->
    <div class="food-recommendation-top-scale-container mb-2">
      <span class="food-recommendation-top-scale-number" style="left: 0">-100</span>
      <span class="food-recommendation-top-scale-number" style="left: 16.67%">-60</span>
      <span class="food-recommendation-top-scale-number" style="left: 33.33%">-30</span>
      <span class="food-recommendation-top-scale-number" style="left: 50%">0</span>
      <span class="food-recommendation-top-scale-number" style="left: 66.67%">30</span>
      <span class="food-recommendation-top-scale-number" style="left: 83.33%">60</span>
      <span class="food-recommendation-top-scale-number" style="left: 100%">100</span>
    </div>

    <!-- 食品条目 -->
    <div id="food-container"></div> <!-- 用于展示食品条目的容器 -->

    <script>
      async function fetchAndRenderTopAndLowestFoods() {
        try {
          // 1. 获取数据
          const response = await fetch(DATA_PATHS.DATA);
          const data = await response.json();

          // 2. 获取食物推荐数据
          const allFoods = data["食物推荐"] || [];

          // 3. 过滤出需要的分类
          const categoriesToInclude = [
            '主食',
            '乳制品',
            '干果',
            '水产品',
            '水果',
            '肉类',
            '蔬菜'
          ];

          const filteredFoods = allFoods.filter(food =>
            categoriesToInclude.includes(food.分类)
          );

          // 4. 按推荐指数从高到低排序
          const sortedFoods = filteredFoods.sort((a, b) =>
            parseFloat(b["推荐指数"]) - parseFloat(a["推荐指数"])
          );

          const topFoods = sortedFoods.slice(0, 30); // 最高的 30 个
          const lowestFoods = sortedFoods.slice(-30); // 最低的 30 个

          // 5. 渲染到页面
          const foodContainer = document.getElementById('food-container');
          foodContainer.innerHTML = ''; // 清空容器

          // 6. 渲染最高和最低食品一一对应
          const maxRows = Math.max(topFoods.length, lowestFoods.length);
          for (let i = 0; i < maxRows; i++) {
            const topFood = topFoods[i] || {}; // 如果没有更多的项，使用空对象
            const lowestFood = lowestFoods[maxRows - i - 1] || {}; // 同上

            const getNegativeColor = (value) => {
              if (value >= -100 && value < -60) {
                return '#FF3B30'; // -100 到 -60
              } else if (value >= -60 && value < -30) {
                return '#FF9500'; // -60 到 -30
              } else if (value >= -30 && value < 0) {
                return '#FFCC00'; // -30 到 0
              }
              return 'transparent'; // 其他情况
            };

            const getPositiveColor = (value) => {
              if (value >= 0 && value < 30) {
                return '#7ED321'; // 0 到 30
              } else if (value >= 30 && value < 60) {
                return '#00C35A'; // 30 到 60
              } else if (value >= 60 && value <= 100) {
                return '#00B248'; // 60 到 100
              }
              return 'transparent'; // 其他情况
            };

            const foodRow = `
          <div class="flex items-center mt-[1px]">
              <div class="w-20 text-right pr-4">${lowestFood.名称 || '未定义'}</div>
              <div class="food-recommendation-top-score-bar-container">
                  <div class="h-3.5 bg-gray-200 rounded-full overflow-hidden food-recommendation-top-score-bar">
                      <div class="food-recommendation-top-negative-score" style="background-color: ${getNegativeColor(lowestFood["推荐指数"] || 0)}; transform: scaleX(${-(lowestFood["推荐指数"] || 0) / 100});"></div>
                      <div class="food-recommendation-top-positive-score" style="background-color: ${getPositiveColor(topFood["推荐指数"] || 0)}; transform: scaleX(${(topFood["推荐指数"] || 0) / 100})"></div>
                  </div>
              </div>
              <div class="w-20 pl-4">${topFood.名称 || '未定义'}</div>
          </div>
        `;

            foodContainer.innerHTML += foodRow; // 动态添加到 DOM 中
          }

        } catch (error) {
          console.error("Error fetching or processing data:", error);
        }
      }

      // 调用函数
      fetchAndRenderTopAndLowestFoods();
    </script>
  </div>

  <h3 class="custom-title-third-level page-break">主食类饮食推荐</h3>

  <div class="bg-white rounded-lg p-5 mb-5 mx-auto" style="width: 100%;">
    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <i class="fas fa-info-circle icon"></i>
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            主食类饮食是指以谷物、淀粉类食物为主要组成部分的饮食习惯，通常包括米饭、面条、面包、土豆、玉米等。主食是人体获取能量的主要来源，富含碳水化合物，是维持日常活动和身体功能所需的重要营养成分。
          </p>
        </div>
      </div>
    </div>

    <!-- 主食类推荐表格 -->
    <div class="rounded-table">
      <table class="min-w-full">
        <thead>
        <!-- 标题行 -->
        <tr style="background-color: #00B2B4; color: white;">
          <th class="py-2 px-4 text-left food-first-column" style="font-size: 10px;">食物名称</th>
          <th class="py-2 px-4 text-center food-second-column" style="font-size: 10px; padding: 5px 5px;">推荐指数</th>
          <th class="py-2 px-4 text-center food-third-column" style="font-size: 10px; padding: 5px 5px;">能量(KJ)</th>
          <th class="py-2 px-4 text-center food-fourth-column" style="font-size: 10px; padding: 5px 5px;">蛋白(g)</th>
          <th class="py-2 px-4 text-center food-fifth-column" style="font-size: 10px; padding: 5px 5px;">脂肪(g)</th>
          <th class="py-2 px-4 text-center food-sixth-column" style="font-size: 10px; padding: 5px 5px;">碳水化合物(g)</th>
          <th class="py-2 px-4 text-center food-seventh-column" style="font-size: 10px; padding: 5px 5px;">淀粉(g)</th>
          <th class="py-2 px-4 text-center food-eighth-column" style="font-size: 10px; padding: 5px 5px;">膳食纤维(g)</th>
          <th class="py-2 px-4 text-center food-nineth-column" style="font-size: 10px; padding: 5px 5px;">胆固醇(mg)</th>
        </tr>
        </thead>
      </table>

      <div id="staple-food-data-table-body">
        <!-- 数据将通过 JavaScript 动态插入 -->
      </div>
    </div>

    <script>
      // 创建独立的命名空间对象，避免作用域冲突
      const StapleFoodRecommendation = {
        // 常量定义
        CONSTANTS: {
          COLORS: {
            VERY_NEGATIVE: '#FF3B30', // -100 到 -60
            NEGATIVE: '#FF9500',      // -60 到 -30
            SLIGHTLY_NEGATIVE: '#FFCC00', // -30 到 0
            SLIGHTLY_POSITIVE: '#7ED321', // 0 到 30
            POSITIVE: '#00C35A',      // 30 到 60
            VERY_POSITIVE: '#00B248'  // 60 到 100
          }
        },

        // 格式化数字
        formatNumber(value) {
          if (value === undefined || value === null) return '';

          const num = Number(value);
          if (isNaN(num)) return value;

          return num.toString();
        },

        // 获取进度条颜色
        getProgressBarColor(value) {
          const numValue = parseFloat(value);
          if (isNaN(numValue)) return 'transparent';

          if (numValue >= -100 && numValue < -60) {
            return this.CONSTANTS.COLORS.VERY_NEGATIVE;
          } else if (numValue >= -60 && numValue < -30) {
            return this.CONSTANTS.COLORS.NEGATIVE;
          } else if (numValue >= -30 && numValue < 0) {
            return this.CONSTANTS.COLORS.SLIGHTLY_NEGATIVE;
          } else if (numValue >= 0 && numValue < 30) {
            return this.CONSTANTS.COLORS.SLIGHTLY_POSITIVE;
          } else if (numValue >= 30 && numValue < 60) {
            return this.CONSTANTS.COLORS.POSITIVE;
          } else if (numValue >= 60 && numValue <= 100) {
            return this.CONSTANTS.COLORS.VERY_POSITIVE;
          }
          return 'transparent';
        },

        // 渲染表格
        renderTable(stapleFoodData) {
          const container = document.getElementById('staple-food-data-table-body');
          if (!container) return;

          container.innerHTML = '';

          if (!stapleFoodData || !Array.isArray(stapleFoodData) || stapleFoodData.length === 0) {
            container.innerHTML = '<div class="text-center p-4">暂无主食类饮食推荐数据</div>';
            return;
          }

          const fragment = document.createDocumentFragment();

          stapleFoodData.forEach(food => {
            const foodContainer = document.createElement('div');
            foodContainer.className = 'food-info-container';

            const table = document.createElement('table');
            table.className = 'food-table min-w-full';

            const progressBarColor = this.getProgressBarColor(food["推荐指数"]);
            const progressBarWidth = Math.abs(parseFloat(food["推荐指数"] || 0)) + '%';

            const dataRow = `
              <tr class="food-row">
                <td class="py-2 px-4 text-left food-first-column">
                  <div class="chinese-text"><strong>${food["名称"] || ''}</strong></div>
                </td>
                <td class="py-2 px-4 text-center food-column-text food-second-column">
                  ${food["推荐指数"] || ''}
                  <div class="progress-bar w-full mt-2" style="background-color: #e9ecef; height: 8px; border-radius: 4px; overflow: hidden;">
                    <div class="progress"
                         style="width: ${progressBarWidth};
                                height: 100%;
                                background-color: ${progressBarColor};
                                transition: width 0.3s ease;">
                    </div>
                  </div>
                </td>
                <td class="py-2 px-4 text-center food-column-text food-third-column">${food["能量KJ"] || ''}</td>
                <td class="py-2 px-4 text-center food-column-text food-fourth-column">${food["蛋白g"] || ''}</td>
                <td class="py-2 px-4 text-center food-column-text food-fifth-column">${food["脂肪g"] || ''}</td>
                <td class="py-2 px-4 text-center food-column-text food-sixth-column">${food["碳水化合物g"] || ''}</td>
                <td class="py-2 px-4 text-center food-column-text food-seventh-column">${food["淀粉g"] || ''}</td>
                <td class="py-2 px-4 text-center food-column-text food-eighth-column">${food["总膳食纤维g"] || ''}</td>
                <td class="py-2 px-4 text-center food-column-text food-nineth-column">${food["胆固醇mg"] || ''}</td>
              </tr>
            `;

            table.innerHTML = `<tbody>${dataRow}</tbody>`;
            foodContainer.appendChild(table);
            fragment.appendChild(foodContainer);
          });

          container.appendChild(fragment);
        },

        // 加载数据
        async loadData() {
          try {
            const response = await fetch(DATA_PATHS.DATA);
            if (!response.ok) {
              throw new Error(`Network response error: ${response.status}`);
            }

            const data = await response.json();

            // 尝试获取食物推荐数据
            let foodRecommendations = null;

            if (data["食物推荐"] && Array.isArray(data["食物推荐"])) {
              foodRecommendations = data["食物推荐"];
            }

            if (foodRecommendations && Array.isArray(foodRecommendations) && foodRecommendations.length > 0) {
              // 过滤出分类为"主食"的食物
              const stapleFoodData = foodRecommendations.filter(food => food["分类"] === "主食");

              if (stapleFoodData.length > 0) {
                // 按推荐指数排序（从高到低）
                stapleFoodData.sort((a, b) => {
                  const scoreA = parseFloat(a["推荐指数"] || 0);
                  const scoreB = parseFloat(b["推荐指数"] || 0);
                  return scoreB - scoreA;
                });

                this.renderTable(stapleFoodData);
              } else {
                document.getElementById('staple-food-data-table-body').innerHTML =
                  '<div class="text-center p-4">暂无主食类饮食推荐数据</div>';
              }
            } else {
              document.getElementById('staple-food-data-table-body').innerHTML =
                '<div class="text-center p-4">暂无主食类饮食推荐数据</div>';
            }
          } catch (error) {
            document.getElementById('staple-food-data-table-body').innerHTML =
              '<div class="text-center p-4 text-red-500">数据加载失败，请稍后再试</div>';
          }
        },

        // 初始化
        init() {
          if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => this.loadData());
          } else {
            this.loadData();
          }
        }
      };

      // 初始化主食类饮食推荐模块
      StapleFoodRecommendation.init();
    </script>
  </div>

  <h3 class="custom-title-third-level">肉类推荐</h3>

  <div class="bg-white rounded-lg p-5 mb-5 mx-auto" style="width: 100%;">
    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <i class="fas fa-info-circle icon"></i>
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            肉类饮食是指以各种肉类为主要组成部分的饮食习惯，包括红肉（如牛肉、羊肉、猪肉）、禽肉（如鸡肉、鸭肉）和海鲜（如鱼、虾、贝类等）。
          </p>
        </div>
      </div>
    </div>

    <!-- 肉类推荐表格 -->
    <div class="rounded-table">
      <table class="min-w-full">
        <thead>
        <!-- 标题行 -->
        <tr style="background-color: #00B2B4; color: white;">
          <th class="py-2 px-4 text-left food-first-column" style="font-size: 10px;">食物名称</th>
          <th class="py-2 px-4 text-center food-second-column" style="font-size: 10px; padding: 5px 5px;">推荐指数</th>
          <th class="py-2 px-4 text-center food-third-column" style="font-size: 10px; padding: 5px 5px;">能量(KJ)</th>
          <th class="py-2 px-4 text-center food-fourth-column" style="font-size: 10px; padding: 5px 5px;">蛋白(g)</th>
          <th class="py-2 px-4 text-center food-fifth-column" style="font-size: 10px; padding: 5px 5px;">脂肪(g)</th>
          <th class="py-2 px-4 text-center food-sixth-column" style="font-size: 10px; padding: 5px 5px;">碳水化合物(g)</th>
          <th class="py-2 px-4 text-center food-seventh-column" style="font-size: 10px; padding: 5px 5px;">淀粉(g)</th>
          <th class="py-2 px-4 text-center food-eighth-column" style="font-size: 10px; padding: 5px 5px;">膳食纤维(g)</th>
          <th class="py-2 px-4 text-center food-nineth-column" style="font-size: 10px; padding: 5px 5px;">胆固醇(mg)</th>
        </tr>
        </thead>
      </table>

      <div id="meat-data-table-body">
        <!-- 数据将通过 JavaScript 动态插入 -->
      </div>
    </div>

    <script>
      // 创建独立的命名空间对象，避免作用域冲突
      const MeatRecommendation = {
        // 常量定义
        CONSTANTS: {
          COLORS: {
            VERY_NEGATIVE: '#FF3B30', // -100 到 -60
            NEGATIVE: '#FF9500',      // -60 到 -30
            SLIGHTLY_NEGATIVE: '#FFCC00', // -30 到 0
            SLIGHTLY_POSITIVE: '#7ED321', // 0 到 30
            POSITIVE: '#00C35A',      // 30 到 60
            VERY_POSITIVE: '#00B248'  // 60 到 100
          }
        },

        // 格式化数字
        formatNumber(value) {
          if (value === undefined || value === null) return '';

          const num = Number(value);
          if (isNaN(num)) return value;

          return num.toString();
        },

        // 获取进度条颜色
        getProgressBarColor(value) {
          const numValue = parseFloat(value);
          if (isNaN(numValue)) return 'transparent';

          if (numValue >= -100 && numValue < -60) {
            return this.CONSTANTS.COLORS.VERY_NEGATIVE;
          } else if (numValue >= -60 && numValue < -30) {
            return this.CONSTANTS.COLORS.NEGATIVE;
          } else if (numValue >= -30 && numValue < 0) {
            return this.CONSTANTS.COLORS.SLIGHTLY_NEGATIVE;
          } else if (numValue >= 0 && numValue < 30) {
            return this.CONSTANTS.COLORS.SLIGHTLY_POSITIVE;
          } else if (numValue >= 30 && numValue < 60) {
            return this.CONSTANTS.COLORS.POSITIVE;
          } else if (numValue >= 60 && numValue <= 100) {
            return this.CONSTANTS.COLORS.VERY_POSITIVE;
          }
          return 'transparent';
        },

        // 渲染表格
        renderTable(meatData) {
          const container = document.getElementById('meat-data-table-body');
          if (!container) return;

          container.innerHTML = '';

          if (!meatData || !Array.isArray(meatData) || meatData.length === 0) {
            container.innerHTML = '<div class="text-center p-4">暂无肉类饮食推荐数据</div>';
            return;
          }

          const fragment = document.createDocumentFragment();

          meatData.forEach(food => {
            const foodContainer = document.createElement('div');
            foodContainer.className = 'food-info-container';

            const table = document.createElement('table');
            table.className = 'food-table min-w-full';

            const progressBarColor = this.getProgressBarColor(food["推荐指数"]);
            const progressBarWidth = Math.abs(parseFloat(food["推荐指数"] || 0)) + '%';

            const dataRow = `
              <tr class="food-row">
                <td class="py-2 px-4 text-left food-first-column">
                  <div class="chinese-text"><strong>${food["名称"] || ''}</strong></div>
                </td>
                <td class="py-2 px-4 text-center food-column-text food-second-column">
                  ${food["推荐指数"] || ''}
                  <div class="progress-bar w-full mt-2" style="background-color: #e9ecef; height: 8px; border-radius: 4px; overflow: hidden;">
                    <div class="progress"
                         style="width: ${progressBarWidth};
                                height: 100%;
                                background-color: ${progressBarColor};
                                transition: width 0.3s ease;">
                    </div>
                  </div>
                </td>
                <td class="py-2 px-4 text-center food-column-text food-third-column">${food["能量KJ"] || ''}</td>
                <td class="py-2 px-4 text-center food-column-text food-fourth-column">${food["蛋白g"] || ''}</td>
                <td class="py-2 px-4 text-center food-column-text food-fifth-column">${food["脂肪g"] || ''}</td>
                <td class="py-2 px-4 text-center food-column-text food-sixth-column">${food["碳水化合物g"] || ''}</td>
                <td class="py-2 px-4 text-center food-column-text food-seventh-column">${food["淀粉g"] || ''}</td>
                <td class="py-2 px-4 text-center food-column-text food-eighth-column">${food["总膳食纤维g"] || ''}</td>
                <td class="py-2 px-4 text-center food-column-text food-nineth-column">${food["胆固醇mg"] || ''}</td>
              </tr>
            `;

            table.innerHTML = `<tbody>${dataRow}</tbody>`;
            foodContainer.appendChild(table);
            fragment.appendChild(foodContainer);
          });

          container.appendChild(fragment);
        },

        // 加载数据
        async loadData() {
          try {
            const response = await fetch(DATA_PATHS.DATA);
            if (!response.ok) {
              throw new Error(`Network response error: ${response.status}`);
            }

            const data = await response.json();

            // 尝试获取食物推荐数据
            let foodRecommendations = null;

            if (data["食物推荐"] && Array.isArray(data["食物推荐"])) {
              foodRecommendations = data["食物推荐"];
            }

            if (foodRecommendations && Array.isArray(foodRecommendations) && foodRecommendations.length > 0) {
              // 过滤出分类为"肉类"的食物
              const meatData = foodRecommendations.filter(food => food["分类"] === "肉类");

              if (meatData.length > 0) {
                // 按推荐指数排序（从高到低）
                meatData.sort((a, b) => {
                  const scoreA = parseFloat(a["推荐指数"] || 0);
                  const scoreB = parseFloat(b["推荐指数"] || 0);
                  return scoreB - scoreA;
                });

                this.renderTable(meatData);
              } else {
                document.getElementById('meat-data-table-body').innerHTML =
                  '<div class="text-center p-4">暂无肉类饮食推荐数据</div>';
              }
            } else {
              document.getElementById('meat-data-table-body').innerHTML =
                '<div class="text-center p-4">暂无肉类饮食推荐数据</div>';
            }
          } catch (error) {
            document.getElementById('meat-data-table-body').innerHTML =
              '<div class="text-center p-4 text-red-500">数据加载失败，请稍后再试</div>';
          }
        },

        // 初始化
        init() {
          if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => this.loadData());
          } else {
            this.loadData();
          }
        }
      };

      // 初始化肉类饮食推荐模块
      MeatRecommendation.init();
    </script>
  </div>

  <h3 class="custom-title-third-level">水产品推荐</h3>

  <div class="bg-white rounded-lg p-5 mb-5 mx-auto" style="width: 100%;">
    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <i class="fas fa-info-circle icon"></i>
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            水产品饮食是指以鱼类、贝类、甲壳类等水生动物为主要食材的饮食习惯。这类食品常见于地中海饮食和亚洲饮食中，因其营养丰富而备受推崇。
          </p>
        </div>
      </div>
    </div>

    <!-- 水产品推荐表格 -->
    <div class="rounded-table">
      <table class="min-w-full">
        <thead>
        <!-- 标题行 -->
        <tr style="background-color: #00B2B4; color: white;">
          <th class="py-2 px-4 text-left food-first-column" style="font-size: 10px;">食物名称</th>
          <th class="py-2 px-4 text-center food-second-column" style="font-size: 10px; padding: 5px 5px;">推荐指数</th>
          <th class="py-2 px-4 text-center food-third-column" style="font-size: 10px; padding: 5px 5px;">能量(KJ)</th>
          <th class="py-2 px-4 text-center food-fourth-column" style="font-size: 10px; padding: 5px 5px;">蛋白(g)</th>
          <th class="py-2 px-4 text-center food-fifth-column" style="font-size: 10px; padding: 5px 5px;">脂肪(g)</th>
          <th class="py-2 px-4 text-center food-sixth-column" style="font-size: 10px; padding: 5px 5px;">碳水化合物(g)</th>
          <th class="py-2 px-4 text-center food-seventh-column" style="font-size: 10px; padding: 5px 5px;">淀粉(g)</th>
          <th class="py-2 px-4 text-center food-eighth-column" style="font-size: 10px; padding: 5px 5px;">膳食纤维(g)</th>
          <th class="py-2 px-4 text-center food-nineth-column" style="font-size: 10px; padding: 5px 5px;">胆固醇(mg)</th>
        </tr>
        </thead>
      </table>

      <div id="aquatic-products-data-table-body">
        <!-- 数据将通过 JavaScript 动态插入 -->
      </div>
    </div>

    <script>
      // 创建独立的命名空间对象，避免作用域冲突
      const AquaticProductsRecommendation = {
        // 常量定义
        CONSTANTS: {
          COLORS: {
            VERY_NEGATIVE: '#FF3B30', // -100 到 -60
            NEGATIVE: '#FF9500',      // -60 到 -30
            SLIGHTLY_NEGATIVE: '#FFCC00', // -30 到 0
            SLIGHTLY_POSITIVE: '#7ED321', // 0 到 30
            POSITIVE: '#00C35A',      // 30 到 60
            VERY_POSITIVE: '#00B248'  // 60 到 100
          }
        },

        // 格式化数字
        formatNumber(value) {
          if (value === undefined || value === null) return '';

          const num = Number(value);
          if (isNaN(num)) return value;

          return num.toString();
        },

        // 获取进度条颜色
        getProgressBarColor(value) {
          const numValue = parseFloat(value);
          if (isNaN(numValue)) return 'transparent';

          if (numValue >= -100 && numValue < -60) {
            return this.CONSTANTS.COLORS.VERY_NEGATIVE;
          } else if (numValue >= -60 && numValue < -30) {
            return this.CONSTANTS.COLORS.NEGATIVE;
          } else if (numValue >= -30 && numValue < 0) {
            return this.CONSTANTS.COLORS.SLIGHTLY_NEGATIVE;
          } else if (numValue >= 0 && numValue < 30) {
            return this.CONSTANTS.COLORS.SLIGHTLY_POSITIVE;
          } else if (numValue >= 30 && numValue < 60) {
            return this.CONSTANTS.COLORS.POSITIVE;
          } else if (numValue >= 60 && numValue <= 100) {
            return this.CONSTANTS.COLORS.VERY_POSITIVE;
          }
          return 'transparent';
        },

        // 渲染表格
        renderTable(aquaticData) {
          const container = document.getElementById('aquatic-products-data-table-body');
          if (!container) return;

          container.innerHTML = '';

          if (!aquaticData || !Array.isArray(aquaticData) || aquaticData.length === 0) {
            container.innerHTML = '<div class="text-center p-4">暂无水产品推荐数据</div>';
            return;
          }

          const fragment = document.createDocumentFragment();

          aquaticData.forEach(food => {
            const foodContainer = document.createElement('div');
            foodContainer.className = 'food-info-container';

            const table = document.createElement('table');
            table.className = 'food-table min-w-full';

            const progressBarColor = this.getProgressBarColor(food["推荐指数"]);
            const progressBarWidth = Math.abs(parseFloat(food["推荐指数"] || 0)) + '%';

            const dataRow = `
              <tr class="food-row">
                <td class="py-2 px-4 text-left food-first-column">
                  <div class="chinese-text"><strong>${food["名称"] || ''}</strong></div>
                </td>
                <td class="py-2 px-4 text-center food-column-text food-second-column">
                  ${food["推荐指数"] || ''}
                  <div class="progress-bar w-full mt-2" style="background-color: #e9ecef; height: 8px; border-radius: 4px; overflow: hidden;">
                    <div class="progress"
                         style="width: ${progressBarWidth};
                                height: 100%;
                                background-color: ${progressBarColor};
                                transition: width 0.3s ease;">
                    </div>
                  </div>
                </td>
                <td class="py-2 px-4 text-center food-column-text food-third-column">${food["能量KJ"] || ''}</td>
                <td class="py-2 px-4 text-center food-column-text food-fourth-column">${food["蛋白g"] || ''}</td>
                <td class="py-2 px-4 text-center food-column-text food-fifth-column">${food["脂肪g"] || ''}</td>
                <td class="py-2 px-4 text-center food-column-text food-sixth-column">${food["碳水化合物g"] || ''}</td>
                <td class="py-2 px-4 text-center food-column-text food-seventh-column">${food["淀粉g"] || ''}</td>
                <td class="py-2 px-4 text-center food-column-text food-eighth-column">${food["总膳食纤维g"] || ''}</td>
                <td class="py-2 px-4 text-center food-column-text food-nineth-column">${food["胆固醇mg"] || ''}</td>
              </tr>
            `;

            table.innerHTML = `<tbody>${dataRow}</tbody>`;
            foodContainer.appendChild(table);
            fragment.appendChild(foodContainer);
          });

          container.appendChild(fragment);
        },

        // 加载数据
        async loadData() {
          try {
            const response = await fetch(DATA_PATHS.DATA);
            if (!response.ok) {
              throw new Error(`Network response error: ${response.status}`);
            }

            const data = await response.json();

            // 尝试获取食物推荐数据
            let foodRecommendations = null;

            if (data["食物推荐"] && Array.isArray(data["食物推荐"])) {
              foodRecommendations = data["食物推荐"];
            }

            if (foodRecommendations && Array.isArray(foodRecommendations) && foodRecommendations.length > 0) {
              // 过滤出分类为"水产"的食物
              const aquaticData = foodRecommendations.filter(food => food["分类"] === "水产品");

              if (aquaticData.length > 0) {
                // 按推荐指数排序（从高到低）
                aquaticData.sort((a, b) => {
                  const scoreA = parseFloat(a["推荐指数"] || 0);
                  const scoreB = parseFloat(b["推荐指数"] || 0);
                  return scoreB - scoreA;
                });

                this.renderTable(aquaticData);
              } else {
                document.getElementById('aquatic-products-data-table-body').innerHTML =
                  '<div class="text-center p-4">暂无水产品推荐数据</div>';
              }
            } else {
              document.getElementById('aquatic-products-data-table-body').innerHTML =
                '<div class="text-center p-4">暂无水产品推荐数据</div>';
            }
          } catch (error) {
            document.getElementById('aquatic-products-data-table-body').innerHTML =
              '<div class="text-center p-4 text-red-500">数据加载失败，请稍后再试</div>';
          }
        },

        // 初始化
        init() {
          if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => this.loadData());
          } else {
            this.loadData();
          }
        }
      };

      // 初始化水产品推荐模块
      AquaticProductsRecommendation.init();
    </script>
  </div>

  <h3 class="custom-title-third-level">乳制品推荐</h3>

  <div class="bg-white rounded-lg p-5 mb-5 mx-auto" style="width: 100%;">
    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <i class="fas fa-info-circle icon"></i>
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            乳制品饮食是指以牛奶及其衍生产品（如酸奶、奶酪、黄油等）为主要组成部分的饮食习惯。乳制品是重要的营养来源，富含蛋白质、钙、维生素D和多种微量元素。
          </p>
        </div>
      </div>
    </div>

    <!-- 乳制品推荐表格 -->
    <div class="rounded-table">
      <table class="min-w-full">
        <thead>
        <!-- 标题行 -->
        <tr style="background-color: #00B2B4; color: white;">
          <th class="py-2 px-4 text-left food-first-column" style="font-size: 10px;">食物名称</th>
          <th class="py-2 px-4 text-center food-second-column" style="font-size: 10px; padding: 5px 5px;">推荐指数</th>
          <th class="py-2 px-4 text-center food-third-column" style="font-size: 10px; padding: 5px 5px;">能量(KJ)</th>
          <th class="py-2 px-4 text-center food-fourth-column" style="font-size: 10px; padding: 5px 5px;">蛋白(g)</th>
          <th class="py-2 px-4 text-center food-fifth-column" style="font-size: 10px; padding: 5px 5px;">脂肪(g)</th>
          <th class="py-2 px-4 text-center food-sixth-column" style="font-size: 10px; padding: 5px 5px;">碳水化合物(g)</th>
          <th class="py-2 px-4 text-center food-seventh-column" style="font-size: 10px; padding: 5px 5px;">淀粉(g)</th>
          <th class="py-2 px-4 text-center food-eighth-column" style="font-size: 10px; padding: 5px 5px;">膳食纤维(g)</th>
          <th class="py-2 px-4 text-center food-nineth-column" style="font-size: 10px; padding: 5px 5px;">胆固醇(mg)</th>
        </tr>
        </thead>
      </table>

      <div id="dairy-products-data-table-body">
        <!-- 数据将通过 JavaScript 动态插入 -->
      </div>
    </div>

    <script>
      // 创建独立的命名空间对象，避免作用域冲突
      const DairyProductsRecommendation = {
        // 常量定义
        CONSTANTS: {
          COLORS: {
            VERY_NEGATIVE: '#FF3B30', // -100 到 -60
            NEGATIVE: '#FF9500',      // -60 到 -30
            SLIGHTLY_NEGATIVE: '#FFCC00', // -30 到 0
            SLIGHTLY_POSITIVE: '#7ED321', // 0 到 30
            POSITIVE: '#00C35A',      // 30 到 60
            VERY_POSITIVE: '#00B248'  // 60 到 100
          }
        },

        // 格式化数字
        formatNumber(value) {
          if (value === undefined || value === null) return '';

          const num = Number(value);
          if (isNaN(num)) return value;

          return num.toString();
        },

        // 获取进度条颜色
        getProgressBarColor(value) {
          const numValue = parseFloat(value);
          if (isNaN(numValue)) return 'transparent';

          if (numValue >= -100 && numValue < -60) {
            return this.CONSTANTS.COLORS.VERY_NEGATIVE;
          } else if (numValue >= -60 && numValue < -30) {
            return this.CONSTANTS.COLORS.NEGATIVE;
          } else if (numValue >= -30 && numValue < 0) {
            return this.CONSTANTS.COLORS.SLIGHTLY_NEGATIVE;
          } else if (numValue >= 0 && numValue < 30) {
            return this.CONSTANTS.COLORS.SLIGHTLY_POSITIVE;
          } else if (numValue >= 30 && numValue < 60) {
            return this.CONSTANTS.COLORS.POSITIVE;
          } else if (numValue >= 60 && numValue <= 100) {
            return this.CONSTANTS.COLORS.VERY_POSITIVE;
          }
          return 'transparent';
        },

        // 渲染表格
        renderTable(dairyData) {
          const container = document.getElementById('dairy-products-data-table-body');
          if (!container) return;

          container.innerHTML = '';

          if (!dairyData || !Array.isArray(dairyData) || dairyData.length === 0) {
            container.innerHTML = '<div class="text-center p-4">暂无乳制品推荐数据</div>';
            return;
          }

          const fragment = document.createDocumentFragment();

          dairyData.forEach(food => {
            const foodContainer = document.createElement('div');
            foodContainer.className = 'food-info-container';

            const table = document.createElement('table');
            table.className = 'food-table min-w-full';

            const progressBarColor = this.getProgressBarColor(food["推荐指数"]);
            const progressBarWidth = Math.abs(parseFloat(food["推荐指数"] || 0)) + '%';

            const dataRow = `
              <tr class="food-row">
                <td class="py-2 px-4 text-left food-first-column">
                  <div class="chinese-text"><strong>${food["名称"] || ''}</strong></div>
                </td>
                <td class="py-2 px-4 text-center food-column-text food-second-column">
                  ${food["推荐指数"] || ''}
                  <div class="progress-bar w-full mt-2" style="background-color: #e9ecef; height: 8px; border-radius: 4px; overflow: hidden;">
                    <div class="progress"
                         style="width: ${progressBarWidth};
                                height: 100%;
                                background-color: ${progressBarColor};
                                transition: width 0.3s ease;">
                    </div>
                  </div>
                </td>
                <td class="py-2 px-4 text-center food-column-text food-third-column">${food["能量KJ"] || ''}</td>
                <td class="py-2 px-4 text-center food-column-text food-fourth-column">${food["蛋白g"] || ''}</td>
                <td class="py-2 px-4 text-center food-column-text food-fifth-column">${food["脂肪g"] || ''}</td>
                <td class="py-2 px-4 text-center food-column-text food-sixth-column">${food["碳水化合物g"] || ''}</td>
                <td class="py-2 px-4 text-center food-column-text food-seventh-column">${food["淀粉g"] || ''}</td>
                <td class="py-2 px-4 text-center food-column-text food-eighth-column">${food["总膳食纤维g"] || ''}</td>
                <td class="py-2 px-4 text-center food-column-text food-nineth-column">${food["胆固醇mg"] || ''}</td>
              </tr>
            `;

            table.innerHTML = `<tbody>${dataRow}</tbody>`;
            foodContainer.appendChild(table);
            fragment.appendChild(foodContainer);
          });

          container.appendChild(fragment);
        },

        // 加载数据
        async loadData() {
          try {
            const response = await fetch(DATA_PATHS.DATA);
            if (!response.ok) {
              throw new Error(`Network response error: ${response.status}`);
            }

            const data = await response.json();

            // 尝试获取食物推荐数据
            let foodRecommendations = null;

            if (data["食物推荐"] && Array.isArray(data["食物推荐"])) {
              foodRecommendations = data["食物推荐"];
            }

            if (foodRecommendations && Array.isArray(foodRecommendations) && foodRecommendations.length > 0) {
              // 过滤出分类为"乳制品"的食物
              const dairyData = foodRecommendations.filter(food => food["分类"] === "乳制品");

              if (dairyData.length > 0) {
                // 按推荐指数排序（从高到低）
                dairyData.sort((a, b) => {
                  const scoreA = parseFloat(a["推荐指数"] || 0);
                  const scoreB = parseFloat(b["推荐指数"] || 0);
                  return scoreB - scoreA;
                });

                this.renderTable(dairyData);
              } else {
                document.getElementById('dairy-products-data-table-body').innerHTML =
                  '<div class="text-center p-4">暂无乳制品推荐数据</div>';
              }
            } else {
              document.getElementById('dairy-products-data-table-body').innerHTML =
                '<div class="text-center p-4">暂无乳制品推荐数据</div>';
            }
          } catch (error) {
            document.getElementById('dairy-products-data-table-body').innerHTML =
              '<div class="text-center p-4 text-red-500">数据加载失败，请稍后再试</div>';
          }
        },

        // 初始化
        init() {
          if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => this.loadData());
          } else {
            this.loadData();
          }
        }
      };

      // 初始化乳制品推荐模块
      DairyProductsRecommendation.init();
    </script>
  </div>

<!--  <h3 class="custom-title-third-level page-break">汤推荐</h3>-->

<!--  <div class="bg-white rounded-lg p-5 mb-5 mx-auto" style="width: 100%;">-->
<!--    &lt;!&ndash; 信息框 &ndash;&gt;-->
<!--    <div class="info-box">-->
<!--      <div class="flex items-start">-->
<!--        <i class="fas fa-info-circle icon"></i>-->
<!--        <div class="ml-2">-->
<!--          <p class="text-lg text-custom-teal">-->
<!--            汤类饮食是指以汤品为主要组成部分的饮食习惯。汤可以用多种食材制作，包括肉类、蔬菜、豆类和谷物等，具有多样性和灵活性。-->
<!--          </p>-->
<!--        </div>-->
<!--      </div>-->
<!--    </div>-->

<!--    &lt;!&ndash; 汤推荐表格 &ndash;&gt;-->
<!--    <div class="rounded-table">-->
<!--      <table class="min-w-full">-->
<!--        <thead>-->
<!--        &lt;!&ndash; 标题行 &ndash;&gt;-->
<!--        <tr style="background-color: #00B2B4; color: white;">-->
<!--          <th class="py-2 px-4 text-left food-first-column" style="font-size: 10px;">食物名称</th>-->
<!--          <th class="py-2 px-4 text-center food-second-column" style="font-size: 10px; padding: 5px 5px;">推荐指数</th>-->
<!--          <th class="py-2 px-4 text-center food-third-column" style="font-size: 10px; padding: 5px 5px;">能量(KJ)</th>-->
<!--          <th class="py-2 px-4 text-center food-fourth-column" style="font-size: 10px; padding: 5px 5px;">蛋白(g)</th>-->
<!--          <th class="py-2 px-4 text-center food-fifth-column" style="font-size: 10px; padding: 5px 5px;">脂肪(g)</th>-->
<!--          <th class="py-2 px-4 text-center food-sixth-column" style="font-size: 10px; padding: 5px 5px;">碳水化合物(g)</th>-->
<!--          <th class="py-2 px-4 text-center food-seventh-column" style="font-size: 10px; padding: 5px 5px;">淀粉(g)</th>-->
<!--          <th class="py-2 px-4 text-center food-eighth-column" style="font-size: 10px; padding: 5px 5px;">膳食纤维(g)</th>-->
<!--          <th class="py-2 px-4 text-center food-nineth-column" style="font-size: 10px; padding: 5px 5px;">胆固醇(mg)</th>-->
<!--        </tr>-->
<!--        </thead>-->
<!--      </table>-->

<!--      <div id="soup-data-table-body">-->
<!--        &lt;!&ndash; 数据将通过 JavaScript 动态插入 &ndash;&gt;-->
<!--      </div>-->
<!--    </div>-->

<!--    <script>-->
<!--      // 创建独立的命名空间对象，避免作用域冲突-->
<!--      const SoupRecommendation = {-->
<!--        // 常量定义-->
<!--        CONSTANTS: {-->
<!--          COLORS: {-->
<!--            VERY_NEGATIVE: '#FF3B30', // -100 到 -60-->
<!--            NEGATIVE: '#FF9500',      // -60 到 -30-->
<!--            SLIGHTLY_NEGATIVE: '#FFCC00', // -30 到 0-->
<!--            SLIGHTLY_POSITIVE: '#7ED321', // 0 到 30-->
<!--            POSITIVE: '#00C35A',      // 30 到 60-->
<!--            VERY_POSITIVE: '#00B248'  // 60 到 100-->
<!--          }-->
<!--        },-->

<!--        // 格式化数字-->
<!--        formatNumber(value) {-->
<!--          if (value === undefined || value === null) return '';-->

<!--          const num = Number(value);-->
<!--          if (isNaN(num)) return value;-->

<!--          return num.toString();-->
<!--        },-->

<!--        // 获取进度条颜色-->
<!--        getProgressBarColor(value) {-->
<!--          const numValue = parseFloat(value);-->
<!--          if (isNaN(numValue)) return 'transparent';-->

<!--          if (numValue >= -100 && numValue < -60) {-->
<!--            return this.CONSTANTS.COLORS.VERY_NEGATIVE;-->
<!--          } else if (numValue >= -60 && numValue < -30) {-->
<!--            return this.CONSTANTS.COLORS.NEGATIVE;-->
<!--          } else if (numValue >= -30 && numValue < 0) {-->
<!--            return this.CONSTANTS.COLORS.SLIGHTLY_NEGATIVE;-->
<!--          } else if (numValue >= 0 && numValue < 30) {-->
<!--            return this.CONSTANTS.COLORS.SLIGHTLY_POSITIVE;-->
<!--          } else if (numValue >= 30 && numValue < 60) {-->
<!--            return this.CONSTANTS.COLORS.POSITIVE;-->
<!--          } else if (numValue >= 60 && numValue <= 100) {-->
<!--            return this.CONSTANTS.COLORS.VERY_POSITIVE;-->
<!--          }-->
<!--          return 'transparent';-->
<!--        },-->

<!--        // 渲染表格-->
<!--        renderTable(soupData) {-->
<!--          const container = document.getElementById('soup-data-table-body');-->
<!--          if (!container) return;-->

<!--          container.innerHTML = '';-->

<!--          if (!soupData || !Array.isArray(soupData) || soupData.length === 0) {-->
<!--            container.innerHTML = '<div class="text-center p-4">暂无汤类推荐数据</div>';-->
<!--            return;-->
<!--          }-->

<!--          const fragment = document.createDocumentFragment();-->

<!--          soupData.forEach(food => {-->
<!--            const foodContainer = document.createElement('div');-->
<!--            foodContainer.className = 'food-info-container';-->

<!--            const table = document.createElement('table');-->
<!--            table.className = 'food-table min-w-full';-->

<!--            const progressBarColor = this.getProgressBarColor(food["推荐指数"]);-->
<!--            const progressBarWidth = Math.abs(parseFloat(food["推荐指数"] || 0)) + '%';-->

<!--            const dataRow = `-->
<!--              <tr class="food-row">-->
<!--                <td class="py-2 px-4 text-left food-first-column">-->
<!--                  <div class="chinese-text"><strong>${food["名称"] || ''}</strong></div>-->
<!--                </td>-->
<!--                <td class="py-2 px-4 text-center food-column-text food-second-column">-->
<!--                  ${food["推荐指数"] || ''}-->
<!--                  <div class="progress-bar w-full mt-2" style="background-color: #e9ecef; height: 8px; border-radius: 4px; overflow: hidden;">-->
<!--                    <div class="progress"-->
<!--                         style="width: ${progressBarWidth};-->
<!--                                height: 100%;-->
<!--                                background-color: ${progressBarColor};-->
<!--                                transition: width 0.3s ease;">-->
<!--                    </div>-->
<!--                  </div>-->
<!--                </td>-->
<!--                <td class="py-2 px-4 text-center food-column-text food-third-column">${food["能量KJ"] || ''}</td>-->
<!--                <td class="py-2 px-4 text-center food-column-text food-fourth-column">${food["蛋白g"] || ''}</td>-->
<!--                <td class="py-2 px-4 text-center food-column-text food-fifth-column">${food["脂肪g"] || ''}</td>-->
<!--                <td class="py-2 px-4 text-center food-column-text food-sixth-column">${food["碳水化合物g"] || ''}</td>-->
<!--                <td class="py-2 px-4 text-center food-column-text food-seventh-column">${food["淀粉g"] || ''}</td>-->
<!--                <td class="py-2 px-4 text-center food-column-text food-eighth-column">${food["总膳食纤维g"] || ''}</td>-->
<!--                <td class="py-2 px-4 text-center food-column-text food-nineth-column">${food["胆固醇mg"] || ''}</td>-->
<!--              </tr>-->
<!--            `;-->

<!--            table.innerHTML = `<tbody>${dataRow}</tbody>`;-->
<!--            foodContainer.appendChild(table);-->
<!--            fragment.appendChild(foodContainer);-->
<!--          });-->

<!--          container.appendChild(fragment);-->
<!--        },-->

<!--        // 加载数据-->
<!--        async loadData() {-->
<!--          try {-->
<!--            const response = await fetch(DATA_PATHS.DATA);-->
<!--            if (!response.ok) {-->
<!--              throw new Error(`Network response error: ${response.status}`);-->
<!--            }-->

<!--            const data = await response.json();-->

<!--            // 尝试获取食物推荐数据-->
<!--            let foodRecommendations = null;-->

<!--            if (data["食物推荐"] && Array.isArray(data["食物推荐"])) {-->
<!--              foodRecommendations = data["食物推荐"];-->
<!--            }-->

<!--            if (foodRecommendations && Array.isArray(foodRecommendations) && foodRecommendations.length > 0) {-->
<!--              // 过滤出分类为"汤"的食物-->
<!--              const soupData = foodRecommendations.filter(food => food["分类"] === "汤");-->

<!--              if (soupData.length > 0) {-->
<!--                // 按推荐指数排序（从高到低）-->
<!--                soupData.sort((a, b) => {-->
<!--                  const scoreA = parseFloat(a["推荐指数"] || 0);-->
<!--                  const scoreB = parseFloat(b["推荐指数"] || 0);-->
<!--                  return scoreB - scoreA;-->
<!--                });-->

<!--                this.renderTable(soupData);-->
<!--              } else {-->
<!--                document.getElementById('soup-data-table-body').innerHTML =-->
<!--                  '<div class="text-center p-4">暂无汤类推荐数据</div>';-->
<!--              }-->
<!--            } else {-->
<!--              document.getElementById('soup-data-table-body').innerHTML =-->
<!--                '<div class="text-center p-4">暂无汤类推荐数据</div>';-->
<!--            }-->
<!--          } catch (error) {-->
<!--            document.getElementById('soup-data-table-body').innerHTML =-->
<!--              '<div class="text-center p-4 text-red-500">数据加载失败，请稍后再试</div>';-->
<!--          }-->
<!--        },-->

<!--        // 初始化-->
<!--        init() {-->
<!--          if (document.readyState === 'loading') {-->
<!--            document.addEventListener('DOMContentLoaded', () => this.loadData());-->
<!--          } else {-->
<!--            this.loadData();-->
<!--          }-->
<!--        }-->
<!--      };-->

<!--      // 初始化汤推荐模块-->
<!--      SoupRecommendation.init();-->
<!--    </script>-->
<!--  </div>-->

  <h3 class="custom-title-third-level">蔬菜推荐</h3>

  <div class="bg-white rounded-lg p-5 mb-5 mx-auto" style="width: 100%;">
    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <i class="fas fa-info-circle icon"></i>
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            蔬菜类饮食是指以各种蔬菜为主要组成部分的饮食习惯。蔬菜富含维生素、矿物质、纤维和抗氧化物质，对维护健康和预防疾病有重要作用。
          </p>
        </div>
      </div>
    </div>

    <!-- 蔬菜推荐表格 -->
    <div class="rounded-table">
      <table class="min-w-full">
        <thead>
        <!-- 标题行 -->
        <tr style="background-color: #00B2B4; color: white;">
          <th class="py-2 px-4 text-left food-first-column" style="font-size: 10px;">食物名称</th>
          <th class="py-2 px-4 text-center food-second-column" style="font-size: 10px; padding: 5px 5px;">推荐指数</th>
          <th class="py-2 px-4 text-center food-third-column" style="font-size: 10px; padding: 5px 5px;">能量(KJ)</th>
          <th class="py-2 px-4 text-center food-fourth-column" style="font-size: 10px; padding: 5px 5px;">蛋白(g)</th>
          <th class="py-2 px-4 text-center food-fifth-column" style="font-size: 10px; padding: 5px 5px;">脂肪(g)</th>
          <th class="py-2 px-4 text-center food-sixth-column" style="font-size: 10px; padding: 5px 5px;">碳水化合物(g)</th>
          <th class="py-2 px-4 text-center food-seventh-column" style="font-size: 10px; padding: 5px 5px;">淀粉(g)</th>
          <th class="py-2 px-4 text-center food-eighth-column" style="font-size: 10px; padding: 5px 5px;">膳食纤维(g)</th>
          <th class="py-2 px-4 text-center food-nineth-column" style="font-size: 10px; padding: 5px 5px;">胆固醇(mg)</th>
        </tr>
        </thead>
      </table>

      <div id="vegetables-data-table-body">
        <!-- 数据将通过 JavaScript 动态插入 -->
      </div>
    </div>

    <script>
      // 创建独立的命名空间对象，避免作用域冲突
      const VegetablesRecommendation = {
        // 常量定义
        CONSTANTS: {
          COLORS: {
            VERY_NEGATIVE: '#FF3B30', // -100 到 -60
            NEGATIVE: '#FF9500',      // -60 到 -30
            SLIGHTLY_NEGATIVE: '#FFCC00', // -30 到 0
            SLIGHTLY_POSITIVE: '#7ED321', // 0 到 30
            POSITIVE: '#00C35A',      // 30 到 60
            VERY_POSITIVE: '#00B248'  // 60 到 100
          }
        },

        // 格式化数字
        formatNumber(value) {
          if (value === undefined || value === null) return '';

          const num = Number(value);
          if (isNaN(num)) return value;

          return num.toString();
        },

        // 获取进度条颜色
        getProgressBarColor(value) {
          const numValue = parseFloat(value);
          if (isNaN(numValue)) return 'transparent';

          if (numValue >= -100 && numValue < -60) {
            return this.CONSTANTS.COLORS.VERY_NEGATIVE;
          } else if (numValue >= -60 && numValue < -30) {
            return this.CONSTANTS.COLORS.NEGATIVE;
          } else if (numValue >= -30 && numValue < 0) {
            return this.CONSTANTS.COLORS.SLIGHTLY_NEGATIVE;
          } else if (numValue >= 0 && numValue < 30) {
            return this.CONSTANTS.COLORS.SLIGHTLY_POSITIVE;
          } else if (numValue >= 30 && numValue < 60) {
            return this.CONSTANTS.COLORS.POSITIVE;
          } else if (numValue >= 60 && numValue <= 100) {
            return this.CONSTANTS.COLORS.VERY_POSITIVE;
          }
          return 'transparent';
        },

        // 渲染表格
        renderTable(vegetablesData) {
          const container = document.getElementById('vegetables-data-table-body');
          if (!container) return;

          container.innerHTML = '';

          if (!vegetablesData || !Array.isArray(vegetablesData) || vegetablesData.length === 0) {
            container.innerHTML = '<div class="text-center p-4">暂无蔬菜推荐数据</div>';
            return;
          }

          const fragment = document.createDocumentFragment();

          vegetablesData.forEach(food => {
            const foodContainer = document.createElement('div');
            foodContainer.className = 'food-info-container';

            const table = document.createElement('table');
            table.className = 'food-table min-w-full';

            const progressBarColor = this.getProgressBarColor(food["推荐指数"]);
            const progressBarWidth = Math.abs(parseFloat(food["推荐指数"] || 0)) + '%';

            const dataRow = `
              <tr class="food-row">
                <td class="py-2 px-4 text-left food-first-column">
                  <div class="chinese-text"><strong>${food["名称"] || ''}</strong></div>
                </td>
                <td class="py-2 px-4 text-center food-column-text food-second-column">
                  ${food["推荐指数"] || ''}
                  <div class="progress-bar w-full mt-2" style="background-color: #e9ecef; height: 8px; border-radius: 4px; overflow: hidden;">
                    <div class="progress"
                         style="width: ${progressBarWidth};
                                height: 100%;
                                background-color: ${progressBarColor};
                                transition: width 0.3s ease;">
                    </div>
                  </div>
                </td>
                <td class="py-2 px-4 text-center food-column-text food-third-column">${food["能量KJ"] || ''}</td>
                <td class="py-2 px-4 text-center food-column-text food-fourth-column">${food["蛋白g"] || ''}</td>
                <td class="py-2 px-4 text-center food-column-text food-fifth-column">${food["脂肪g"] || ''}</td>
                <td class="py-2 px-4 text-center food-column-text food-sixth-column">${food["碳水化合物g"] || ''}</td>
                <td class="py-2 px-4 text-center food-column-text food-seventh-column">${food["淀粉g"] || ''}</td>
                <td class="py-2 px-4 text-center food-column-text food-eighth-column">${food["总膳食纤维g"] || ''}</td>
                <td class="py-2 px-4 text-center food-column-text food-nineth-column">${food["胆固醇mg"] || ''}</td>
              </tr>
            `;

            table.innerHTML = `<tbody>${dataRow}</tbody>`;
            foodContainer.appendChild(table);
            fragment.appendChild(foodContainer);
          });

          container.appendChild(fragment);
        },

        // 加载数据
        async loadData() {
          try {
            const response = await fetch(DATA_PATHS.DATA);
            if (!response.ok) {
              throw new Error(`Network response error: ${response.status}`);
            }

            const data = await response.json();

            // 尝试获取食物推荐数据
            let foodRecommendations = null;

            if (data["食物推荐"] && Array.isArray(data["食物推荐"])) {
              foodRecommendations = data["食物推荐"];
            }

            if (foodRecommendations && Array.isArray(foodRecommendations) && foodRecommendations.length > 0) {
              // 过滤出分类为"蔬菜"的食物
              const vegetablesData = foodRecommendations.filter(food => food["分类"] === "蔬菜");

              if (vegetablesData.length > 0) {
                // 按推荐指数排序（从高到低）
                vegetablesData.sort((a, b) => {
                  const scoreA = parseFloat(a["推荐指数"] || 0);
                  const scoreB = parseFloat(b["推荐指数"] || 0);
                  return scoreB - scoreA;
                });

                this.renderTable(vegetablesData);
              } else {
                document.getElementById('vegetables-data-table-body').innerHTML =
                  '<div class="text-center p-4">暂无蔬菜推荐数据</div>';
              }
            } else {
              document.getElementById('vegetables-data-table-body').innerHTML =
                '<div class="text-center p-4">暂无蔬菜推荐数据</div>';
            }
          } catch (error) {
            document.getElementById('vegetables-data-table-body').innerHTML =
              '<div class="text-center p-4 text-red-500">数据加载失败，请稍后再试</div>';
          }
        },

        // 初始化
        init() {
          if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => this.loadData());
          } else {
            this.loadData();
          }
        }
      };

      // 初始化蔬菜推荐模块
      VegetablesRecommendation.init();
    </script>
  </div>



<!--  <h2 class="custom-title-third-level page-break">快餐推荐</h2>-->

<!--  <div class="bg-white rounded-lg p-5 mb-5 mx-auto" style="width: 100%;">-->
<!--    &lt;!&ndash; 信息框 &ndash;&gt;-->
<!--    <div class="info-box">-->
<!--      <div class="flex items-start">-->
<!--        <i class="fas fa-info-circle icon"></i>-->
<!--        <div class="ml-2">-->
<!--          <p class="text-lg text-custom-teal">-->
<!--            快餐类饮食是指以快速提供和方便食用为特点的食品，通常包括汉堡、炸鸡、薯条、披萨、寿司、热狗等。快餐因其快捷性和便捷性而广受欢迎，尤其是在忙碌的现代生活中。-->
<!--          </p>-->
<!--        </div>-->
<!--      </div>-->
<!--    </div>-->

<!--    &lt;!&ndash; 快餐推荐表格 &ndash;&gt;-->
<!--    <div class="rounded-table">-->
<!--      <table class="min-w-full">-->
<!--        <thead>-->
<!--        &lt;!&ndash; 标题行 &ndash;&gt;-->
<!--        <tr style="background-color: #00B2B4; color: white;">-->
<!--          <th class="py-2 px-4 text-left food-first-column" style="font-size: 10px;">食物名称</th>-->
<!--          <th class="py-2 px-4 text-center food-second-column" style="font-size: 10px; padding: 5px 5px;">推荐指数</th>-->
<!--          <th class="py-2 px-4 text-center food-third-column" style="font-size: 10px; padding: 5px 5px;">能量(KJ)</th>-->
<!--          <th class="py-2 px-4 text-center food-fourth-column" style="font-size: 10px; padding: 5px 5px;">蛋白(g)</th>-->
<!--          <th class="py-2 px-4 text-center food-fifth-column" style="font-size: 10px; padding: 5px 5px;">脂肪(g)</th>-->
<!--          <th class="py-2 px-4 text-center food-sixth-column" style="font-size: 10px; padding: 5px 5px;">碳水化合物(g)</th>-->
<!--          <th class="py-2 px-4 text-center food-seventh-column" style="font-size: 10px; padding: 5px 5px;">淀粉(g)</th>-->
<!--          <th class="py-2 px-4 text-center food-eighth-column" style="font-size: 10px; padding: 5px 5px;">膳食纤维(g)</th>-->
<!--          <th class="py-2 px-4 text-center food-nineth-column" style="font-size: 10px; padding: 5px 5px;">胆固醇(mg)</th>-->
<!--        </tr>-->
<!--        </thead>-->
<!--        <tbody id="fast-food-data-table-body">-->

<!--        </tbody>-->
<!--      </table>-->

<!--      <script>-->
<!--        async function loadFastFoodData() {-->
<!--          try {-->
<!--            const response = await fetch(DATA_PATHS.DATA);-->
<!--            const data = await response.json();-->
<!--            // 对 aquatic_products_data 按照 evaluation_value 从大到小（从正到负）排序-->
<!--            data.fast_food_data.sort((a, b) => b.evaluation_value - a.evaluation_value);-->
<!--            renderFastFoodTable(data.fast_food_data);-->
<!--          } catch (error) {-->
<!--            console.error('Error loading fast food data:', error);-->
<!--          }-->
<!--        }-->

<!--        function renderFastFoodTable(fastfoodData) {-->
<!--          const tableBody = document.getElementById('fast-food-data-table-body');-->
<!--          if (!tableBody) {-->
<!--            console.error('Fast food data table body not found');-->
<!--            return;-->
<!--          }-->

<!--          tableBody.innerHTML = '';-->

<!--          fastfoodData.forEach(food => {-->
<!--            // 创建数据行-->
<!--            const dataRow = document.createElement('tr');-->
<!--            dataRow.classList.add('fast-food-data-row');-->
<!--            const getProgressBarColor = (value) => {-->
<!--              if (value >= -100 && value < -60) {-->
<!--                return '#FF3B30'; // -100 到 -60-->
<!--              } else if (value >= -60 && value < -30) {-->
<!--                return '#FF9500'; // -60 到 -30-->
<!--              } else if (value >= -30 && value < 0) {-->
<!--                return '#FFCC00'; // -30 到 0-->
<!--              } else if (value >= 0 && value < 30) {-->
<!--                return '#7ED321'; // 0 到 30-->
<!--              } else if (value >= 30 && value < 60) {-->
<!--                return '#00C35A'; // 30 到 60-->
<!--              } else if (value >= 60 && value <= 100) {-->
<!--                return '#00B248'; // 60 到 100-->
<!--              }-->
<!--              return 'transparent'; // 其他情况-->
<!--            };-->

<!--            const progressBarColor = getProgressBarColor(food.evaluation_value);-->

<!--            dataRow.innerHTML = `-->
<!--              <td class="py-2 px-4 text-left">-->
<!--                  <div class="chinese-text">${food.chinese_name}</div>-->
<!--                  <div class="latin-text">${food.english_name}</div>-->
<!--              </td>-->
<!--              <td class="py-2 px-4 text-center food-column-text">-->
<!--                  ${food.evaluation_value}-->
<!--                  <div class="progress-bar w-full mt-1">-->
<!--                      <div class="progress" style="background-color: ${progressBarColor}; width: ${Math.abs(food.evaluation_value)}%;"></div>-->
<!--                  </div>-->
<!--              </td>-->
<!--              <td class="py-2 px-4 text-center food-column-text">${food.calories}</td>-->
<!--              <td class="py-2 px-4 text-center food-column-text">${food.protein}</td>-->
<!--              <td class="py-2 px-4 text-center food-column-text">${food.fat}</td>-->
<!--              <td class="py-2 px-4 text-center food-column-text">${food.carbohydrates}</td>-->
<!--              <td class="py-2 px-4 text-center food-column-text">${food.starch}</td>-->
<!--              <td class="py-2 px-4 text-center food-column-text">${food.fiber}</td>-->
<!--              <td class="py-2 px-4 text-center food-column-text">${food.cholesterol}</td>-->
<!--          `;-->


<!--            // 添加到表格-->
<!--            tableBody.appendChild(dataRow);-->
<!--          });-->
<!--        }-->

<!--        // 页面加载时加载致病菌数据-->
<!--        document.addEventListener('DOMContentLoaded', loadFastFoodData);-->
<!--      </script>-->

<!--    </div>-->

<!--  </div>-->

  <h2 class="custom-title-third-level">水果推荐</h2>

  <div class="bg-white rounded-lg p-5 mb-5 mx-auto" style="width: 100%;">
    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <i class="fas fa-info-circle icon"></i>
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            水果类饮食是指以新鲜水果为主要组成部分的饮食习惯。水果不仅美味可口，而且富含维生素、矿物质、抗氧化物和膳食纤维，对健康有诸多益处。
          </p>
        </div>
      </div>
    </div>

    <!-- 水果推荐表格 -->
    <div class="rounded-table">
      <table class="min-w-full">
        <thead>
        <!-- 标题行 -->
        <tr style="background-color: #00B2B4; color: white;">
          <th class="py-2 px-4 text-left food-first-column" style="font-size: 10px;">食物名称</th>
          <th class="py-2 px-4 text-center food-second-column" style="font-size: 10px; padding: 5px 5px;">推荐指数</th>
          <th class="py-2 px-4 text-center food-third-column" style="font-size: 10px; padding: 5px 5px;">能量(KJ)</th>
          <th class="py-2 px-4 text-center food-fourth-column" style="font-size: 10px; padding: 5px 5px;">蛋白(g)</th>
          <th class="py-2 px-4 text-center food-fifth-column" style="font-size: 10px; padding: 5px 5px;">脂肪(g)</th>
          <th class="py-2 px-4 text-center food-sixth-column" style="font-size: 10px; padding: 5px 5px;">碳水化合物(g)</th>
          <th class="py-2 px-4 text-center food-seventh-column" style="font-size: 10px; padding: 5px 5px;">淀粉(g)</th>
          <th class="py-2 px-4 text-center food-eighth-column" style="font-size: 10px; padding: 5px 5px;">膳食纤维(g)</th>
          <th class="py-2 px-4 text-center food-nineth-column" style="font-size: 10px; padding: 5px 5px;">胆固醇(mg)</th>
        </tr>
        </thead>
      </table>

      <div id="fruit-data-table-body">
        <!-- 数据将通过 JavaScript 动态插入 -->
      </div>
    </div>

    <script>
      // 创建独立的命名空间对象，避免作用域冲突
      const FruitRecommendation = {
        // 常量定义
        CONSTANTS: {
          COLORS: {
            VERY_NEGATIVE: '#FF3B30', // -100 到 -60
            NEGATIVE: '#FF9500',      // -60 到 -30
            SLIGHTLY_NEGATIVE: '#FFCC00', // -30 到 0
            SLIGHTLY_POSITIVE: '#7ED321', // 0 到 30
            POSITIVE: '#00C35A',      // 30 到 60
            VERY_POSITIVE: '#00B248'  // 60 到 100
          }
        },

        // 格式化数字
        formatNumber(value) {
          if (value === undefined || value === null) return '';

          const num = Number(value);
          if (isNaN(num)) return value;

          return num.toString();
        },

        // 获取进度条颜色
        getProgressBarColor(value) {
          const numValue = parseFloat(value);
          if (isNaN(numValue)) return 'transparent';

          if (numValue >= -100 && numValue < -60) {
            return this.CONSTANTS.COLORS.VERY_NEGATIVE;
          } else if (numValue >= -60 && numValue < -30) {
            return this.CONSTANTS.COLORS.NEGATIVE;
          } else if (numValue >= -30 && numValue < 0) {
            return this.CONSTANTS.COLORS.SLIGHTLY_NEGATIVE;
          } else if (numValue >= 0 && numValue < 30) {
            return this.CONSTANTS.COLORS.SLIGHTLY_POSITIVE;
          } else if (numValue >= 30 && numValue < 60) {
            return this.CONSTANTS.COLORS.POSITIVE;
          } else if (numValue >= 60 && numValue <= 100) {
            return this.CONSTANTS.COLORS.VERY_POSITIVE;
          }
          return 'transparent';
        },

        // 渲染表格
        renderTable(fruitData) {
          const container = document.getElementById('fruit-data-table-body');
          if (!container) return;

          container.innerHTML = '';

          if (!fruitData || !Array.isArray(fruitData) || fruitData.length === 0) {
            container.innerHTML = '<div class="text-center p-4">暂无水果推荐数据</div>';
            return;
          }

          const fragment = document.createDocumentFragment();

          fruitData.forEach(food => {
            const foodContainer = document.createElement('div');
            foodContainer.className = 'food-info-container';

            const table = document.createElement('table');
            table.className = 'food-table min-w-full';

            const progressBarColor = this.getProgressBarColor(food["推荐指数"]);
            const progressBarWidth = Math.abs(parseFloat(food["推荐指数"] || 0)) + '%';

            const dataRow = `
              <tr class="food-row">
                <td class="py-2 px-4 text-left food-first-column">
                  <div class="chinese-text"><strong>${food["名称"] || ''}</strong></div>
                </td>
                <td class="py-2 px-4 text-center food-column-text food-second-column">
                  ${food["推荐指数"] || ''}
                  <div class="progress-bar w-full mt-2" style="background-color: #e9ecef; height: 8px; border-radius: 4px; overflow: hidden;">
                    <div class="progress"
                         style="width: ${progressBarWidth};
                                height: 100%;
                                background-color: ${progressBarColor};
                                transition: width 0.3s ease;">
                    </div>
                  </div>
                </td>
                <td class="py-2 px-4 text-center food-column-text food-third-column">${food["能量KJ"] || ''}</td>
                <td class="py-2 px-4 text-center food-column-text food-fourth-column">${food["蛋白g"] || ''}</td>
                <td class="py-2 px-4 text-center food-column-text food-fifth-column">${food["脂肪g"] || ''}</td>
                <td class="py-2 px-4 text-center food-column-text food-sixth-column">${food["碳水化合物g"] || ''}</td>
                <td class="py-2 px-4 text-center food-column-text food-seventh-column">${food["淀粉g"] || ''}</td>
                <td class="py-2 px-4 text-center food-column-text food-eighth-column">${food["总膳食纤维g"] || ''}</td>
                <td class="py-2 px-4 text-center food-column-text food-nineth-column">${food["胆固醇mg"] || ''}</td>
              </tr>
            `;

            table.innerHTML = `<tbody>${dataRow}</tbody>`;
            foodContainer.appendChild(table);
            fragment.appendChild(foodContainer);
          });

          container.appendChild(fragment);
        },

        // 加载数据
        async loadData() {
          try {
            const response = await fetch(DATA_PATHS.DATA);
            if (!response.ok) {
              throw new Error(`Network response error: ${response.status}`);
            }

            const data = await response.json();

            // 尝试获取食物推荐数据
            let foodRecommendations = null;

            if (data["食物推荐"] && Array.isArray(data["食物推荐"])) {
              foodRecommendations = data["食物推荐"];
            }

            if (foodRecommendations && Array.isArray(foodRecommendations) && foodRecommendations.length > 0) {
              // 过滤出分类为"水果"的食物
              const fruitData = foodRecommendations.filter(food => food["分类"] === "水果");

              if (fruitData.length > 0) {
                // 按推荐指数排序（从高到低）
                fruitData.sort((a, b) => {
                  const scoreA = parseFloat(a["推荐指数"] || 0);
                  const scoreB = parseFloat(b["推荐指数"] || 0);
                  return scoreB - scoreA;
                });

                this.renderTable(fruitData);
              } else {
                document.getElementById('fruit-data-table-body').innerHTML =
                  '<div class="text-center p-4">暂无水果推荐数据</div>';
              }
            } else {
              document.getElementById('fruit-data-table-body').innerHTML =
                '<div class="text-center p-4">暂无水果推荐数据</div>';
            }
          } catch (error) {
            document.getElementById('fruit-data-table-body').innerHTML =
              '<div class="text-center p-4 text-red-500">数据加载失败，请稍后再试</div>';
          }
        },

        // 初始化
        init() {
          if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => this.loadData());
          } else {
            this.loadData();
          }
        }
      };

      // 初始化水果推荐模块
      FruitRecommendation.init();
    </script>
  </div>

  <h2 class="custom-title-third-level">干果推荐</h2>

  <div class="bg-white rounded-lg p-5 mb-5 mx-auto" style="width: 100%;">
    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <i class="fas fa-info-circle icon"></i>
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            干果类饮食是指以坚果和干果为主要组成部分的饮食习惯。干果包括核桃、杏仁、腰果、榛子、桂圆、葡萄干等，经常被视为健康零食，富含营养成分。
          </p>
        </div>
      </div>
    </div>

    <!-- 干果推荐表格 -->
    <div class="rounded-table">
      <table class="min-w-full">
        <thead>
        <!-- 标题行 -->
        <tr style="background-color: #00B2B4; color: white;">
          <th class="py-2 px-4 text-left food-first-column" style="font-size: 10px;">食物名称</th>
          <th class="py-2 px-4 text-center food-second-column" style="font-size: 10px; padding: 5px 5px;">推荐指数</th>
          <th class="py-2 px-4 text-center food-third-column" style="font-size: 10px; padding: 5px 5px;">能量(KJ)</th>
          <th class="py-2 px-4 text-center food-fourth-column" style="font-size: 10px; padding: 5px 5px;">蛋白(g)</th>
          <th class="py-2 px-4 text-center food-fifth-column" style="font-size: 10px; padding: 5px 5px;">脂肪(g)</th>
          <th class="py-2 px-4 text-center food-sixth-column" style="font-size: 10px; padding: 5px 5px;">碳水化合物(g)</th>
          <th class="py-2 px-4 text-center food-seventh-column" style="font-size: 10px; padding: 5px 5px;">淀粉(g)</th>
          <th class="py-2 px-4 text-center food-eighth-column" style="font-size: 10px; padding: 5px 5px;">膳食纤维(g)</th>
          <th class="py-2 px-4 text-center food-nineth-column" style="font-size: 10px; padding: 5px 5px;">胆固醇(mg)</th>
        </tr>
        </thead>
      </table>

      <div id="dried-fruits-data-table-body">
        <!-- 数据将通过 JavaScript 动态插入 -->
      </div>
    </div>

    <script>
      // 创建独立的命名空间对象，避免作用域冲突
      const DriedFruitsRecommendation = {
        // 常量定义
        CONSTANTS: {
          COLORS: {
            VERY_NEGATIVE: '#FF3B30', // -100 到 -60
            NEGATIVE: '#FF9500',      // -60 到 -30
            SLIGHTLY_NEGATIVE: '#FFCC00', // -30 到 0
            SLIGHTLY_POSITIVE: '#7ED321', // 0 到 30
            POSITIVE: '#00C35A',      // 30 到 60
            VERY_POSITIVE: '#00B248'  // 60 到 100
          }
        },

        // 格式化数字
        formatNumber(value) {
          if (value === undefined || value === null) return '';

          const num = Number(value);
          if (isNaN(num)) return value;

          return num.toString();
        },

        // 获取进度条颜色
        getProgressBarColor(value) {
          const numValue = parseFloat(value);
          if (isNaN(numValue)) return 'transparent';

          if (numValue >= -100 && numValue < -60) {
            return this.CONSTANTS.COLORS.VERY_NEGATIVE;
          } else if (numValue >= -60 && numValue < -30) {
            return this.CONSTANTS.COLORS.NEGATIVE;
          } else if (numValue >= -30 && numValue < 0) {
            return this.CONSTANTS.COLORS.SLIGHTLY_NEGATIVE;
          } else if (numValue >= 0 && numValue < 30) {
            return this.CONSTANTS.COLORS.SLIGHTLY_POSITIVE;
          } else if (numValue >= 30 && numValue < 60) {
            return this.CONSTANTS.COLORS.POSITIVE;
          } else if (numValue >= 60 && numValue <= 100) {
            return this.CONSTANTS.COLORS.VERY_POSITIVE;
          }
          return 'transparent';
        },

        // 渲染表格
        renderTable(driedFruitsData) {
          const container = document.getElementById('dried-fruits-data-table-body');
          if (!container) return;

          container.innerHTML = '';

          if (!driedFruitsData || !Array.isArray(driedFruitsData) || driedFruitsData.length === 0) {
            container.innerHTML = '<div class="text-center p-4">暂无干果推荐数据</div>';
            return;
          }

          const fragment = document.createDocumentFragment();

          driedFruitsData.forEach(food => {
            const foodContainer = document.createElement('div');
            foodContainer.className = 'food-info-container';

            const table = document.createElement('table');
            table.className = 'food-table min-w-full';

            const progressBarColor = this.getProgressBarColor(food["推荐指数"]);
            const progressBarWidth = Math.abs(parseFloat(food["推荐指数"] || 0)) + '%';

            const dataRow = `
              <tr class="food-row">
                <td class="py-2 px-4 text-left food-first-column">
                  <div class="chinese-text"><strong>${food["名称"] || ''}</strong></div>
                </td>
                <td class="py-2 px-4 text-center food-column-text food-second-column">
                  ${food["推荐指数"] || ''}
                  <div class="progress-bar w-full mt-2" style="background-color: #e9ecef; height: 8px; border-radius: 4px; overflow: hidden;">
                    <div class="progress"
                         style="width: ${progressBarWidth};
                                height: 100%;
                                background-color: ${progressBarColor};
                                transition: width 0.3s ease;">
                    </div>
                  </div>
                </td>
                <td class="py-2 px-4 text-center food-column-text food-third-column">${food["能量KJ"] || ''}</td>
                <td class="py-2 px-4 text-center food-column-text food-fourth-column">${food["蛋白g"] || ''}</td>
                <td class="py-2 px-4 text-center food-column-text food-fifth-column">${food["脂肪g"] || ''}</td>
                <td class="py-2 px-4 text-center food-column-text food-sixth-column">${food["碳水化合物g"] || ''}</td>
                <td class="py-2 px-4 text-center food-column-text food-seventh-column">${food["淀粉g"] || ''}</td>
                <td class="py-2 px-4 text-center food-column-text food-eighth-column">${food["总膳食纤维g"] || ''}</td>
                <td class="py-2 px-4 text-center food-column-text food-nineth-column">${food["胆固醇mg"] || ''}</td>
              </tr>
            `;

            table.innerHTML = `<tbody>${dataRow}</tbody>`;
            foodContainer.appendChild(table);
            fragment.appendChild(foodContainer);
          });

          container.appendChild(fragment);
        },

        // 加载数据
        async loadData() {
          try {
            const response = await fetch(DATA_PATHS.DATA);
            if (!response.ok) {
              throw new Error(`Network response error: ${response.status}`);
            }

            const data = await response.json();

            // 尝试获取食物推荐数据
            let foodRecommendations = null;

            if (data["食物推荐"] && Array.isArray(data["食物推荐"])) {
              foodRecommendations = data["食物推荐"];
            }

            if (foodRecommendations && Array.isArray(foodRecommendations) && foodRecommendations.length > 0) {
              // 过滤出分类为"干果"的食物
              const driedFruitsData = foodRecommendations.filter(food => food["分类"] === "干果");

              if (driedFruitsData.length > 0) {
                // 按推荐指数排序（从高到低）
                driedFruitsData.sort((a, b) => {
                  const scoreA = parseFloat(a["推荐指数"] || 0);
                  const scoreB = parseFloat(b["推荐指数"] || 0);
                  return scoreB - scoreA;
                });

                this.renderTable(driedFruitsData);
              } else {
                document.getElementById('dried-fruits-data-table-body').innerHTML =
                  '<div class="text-center p-4">暂无干果推荐数据</div>';
              }
            } else {
              document.getElementById('dried-fruits-data-table-body').innerHTML =
                '<div class="text-center p-4">暂无干果推荐数据</div>';
            }
          } catch (error) {
            document.getElementById('dried-fruits-data-table-body').innerHTML =
              '<div class="text-center p-4 text-red-500">数据加载失败，请稍后再试</div>';
          }
        },

        // 初始化
        init() {
          if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => this.loadData());
          } else {
            this.loadData();
          }
        }
      };

      // 初始化干果推荐模块
      DriedFruitsRecommendation.init();
    </script>
  </div>


  <!-- 实际检出肠道菌群板块 -->

<!--  <h1 class="custom-title-1 page-break">检出肠道微生物</h1>-->

<!--  <div class="bg-white rounded-lg p-5 mb-5 mx-auto" style="width: 100%;">-->



<!--  </div>-->


  <!-- 实际检出肠道菌群板块 : 检出细菌 -->
  <h2 class="custom-title-1 page-break">检出肠道细菌</h2>

  <div class="bg-white rounded-lg p-5 mb-5 mx-auto" style="width: 100%;">

    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            <i class="fas fa-info-circle icon"></i>
            下列表格展示了您肠道中实际检出的细菌。如果检测到的细菌超过35种，则仅列出丰度最高的前35种。
          </p>
        </div>
      </div>
    </div>

    <div class="rounded-table">
      <table class="min-w-full">
        <thead>
        <tr style="background-color: #00B2B4; color: white;">
          <th class="py-2 px-4 text-left detected-gut-microbiota-first-column" style="font-size: 10px;">
            细菌拉丁名
          </th>
          <th class="py-2 px-4 text-left detected-gut-microbiota-second-column" style="font-size: 10px;">
            细菌中文名
          </th>
          <th class="py-2 px-4 text-right detected-gut-microbiota-third-column" style="font-size: 10px; padding: 5px 5px;">
            参考范围%
          </th>
          <th class="py-2 px-4 text-right detected-gut-microbiota-fourth-column" style="font-size: 10px;">
            检出丰度%
          </th>
        </tr>
        </thead>
      </table>

      <div id="detected-gut-bacteria-data-table-body">
        <!-- 数据将通过 JavaScript 动态插入 -->
      </div>
    </div>

    <script>
      // 创建独立的命名空间对象，避免作用域冲突
      const DetectedGutBacteria = {
        // 常量定义
        CONSTANTS: {
          COLORS: {
            RED: '#ff4d4f',
            GREEN: '#00B2B4',  // 使用与真菌表格一致的青色
            GRAY: '#808080',
            LIGHT_GRAY: '#f9f9f9'  // 用于隔行变色
          },
          FONT_SIZE: '10px'  // 与真菌表格一致的字体大小
        },

        // 格式化数字
        formatNumber(value) {
          if (typeof value === "string" && (value === "未检出" || value === "ND")) {
            return "ND";
          }

          const num = Number(value);
          if (isNaN(num)) return value;

          if (num >= 1) {
            const integerDigits = Math.floor(Math.log10(num)) + 1;
            const decimalPlaces = 3;
            return num.toFixed(decimalPlaces);
          } else {
            const str = num.toFixed(3);
            return str.replace(/\.?0+$/, '');
          }
        },

        // 解析正常范围
        parseRange(rangeStr) {
          if (!rangeStr || typeof rangeStr !== 'string') {
            return { min: 0, max: 0 };
          }
          const parts = rangeStr.split('-');
          return {
            min: parseFloat(parts[0] || 0),
            max: parseFloat(parts[1] || 0)
          };
        },

        // 获取状态信息
        getStatus(detected, minRange, maxRange) {
          let status = {
            color: this.CONSTANTS.COLORS.GREEN,
            text: '正常',
            isNormal: true
          };

          if (detected === "ND" || detected === "未检出") {
            if (minRange > 0) {
              status.color = this.CONSTANTS.COLORS.RED;
              status.text = '偏低';
              status.isNormal = false;
            }
          } else {
            const numDetected = parseFloat(detected);
            if (numDetected < minRange) {
              status.color = this.CONSTANTS.COLORS.RED;
              status.text = '偏低';
              status.isNormal = false;
            } else if (numDetected > maxRange) {
              status.color = this.CONSTANTS.COLORS.RED;
              status.text = '超标';
              status.isNormal = false;
            }
          }

          return status;
        },

        // 渲染表格
        renderTable(bacteriaData) {
          const container = document.getElementById('detected-gut-bacteria-data-table-body');
          if (!container) return;

          container.innerHTML = '';

          if (!bacteriaData || !Array.isArray(bacteriaData) || bacteriaData.length === 0) {
            container.innerHTML = '<div class="text-center p-4">暂无检出细菌数据</div>';
            return;
          }

          const fragment = document.createDocumentFragment();
          const mainTable = document.createElement('table');
          mainTable.className = 'min-w-full';
          const tbody = document.createElement('tbody');

          bacteriaData.forEach((bacteria, index) => {
            const detected = bacteria["丰度%"];
            const { min: minRange, max: maxRange } = this.parseRange(bacteria["正常范围"]);

            const formattedDetectedValue = this.formatNumber(detected);
            const formattedMinRange = this.formatNumber(minRange);
            const formattedMaxRange = this.formatNumber(maxRange);

            // 获取状态信息
            this.getStatus(detected, minRange, maxRange);

            // 获取拉丁名和中文名
            const latinName = bacteria["名称"] || "";
            const chineseName = bacteria["中文名"] || "";

            // 确定第二列显示内容 - 如果中文名为空，则显示拉丁名
            const secondColumnContent = chineseName.trim() !== "" ? chineseName : latinName;

            // 创建行元素
            const tr = document.createElement('tr');
            tr.className = 'bacteria-row';

            // 隔行灰色背景
            if (index % 2 === 1) {
              tr.style.backgroundColor = this.CONSTANTS.COLORS.LIGHT_GRAY;
            }

            // 设置行内容 - 为所有单元格应用10px的字体大小
            tr.innerHTML = `
            <td class="py-2 px-4 text-left detected-gut-microbiota-first-column" style="font-size: ${this.CONSTANTS.FONT_SIZE};">
              <div style="font-style: italic;">
                ${latinName}
              </div>
            </td>
            <td class="py-2 px-4 text-left detected-gut-microbiota-second-column" style="font-size: ${this.CONSTANTS.FONT_SIZE};">
              <div>${secondColumnContent}</div>
            </td>
            <td class="py-2 px-4 text-right detected-gut-microbiota-third-column" style="font-size: ${this.CONSTANTS.FONT_SIZE};">
              ${formattedMinRange}-${formattedMaxRange}
            </td>
            <td class="py-2 px-4 text-right detected-gut-microbiota-fourth-column" style="font-size: ${this.CONSTANTS.FONT_SIZE};">
              <span style="font-weight: bold;">
                ${formattedDetectedValue}
              </span>
            </td>
          `;

            tbody.appendChild(tr);
          });

          mainTable.appendChild(tbody);
          fragment.appendChild(mainTable);
          container.appendChild(fragment);
        },

        // 加载数据
        async loadData() {
          try {
            const response = await fetch(DATA_PATHS.DATA);
            if (!response.ok) {
              throw new Error(`Network response error: ${response.status}`);
            }

            const data = await response.json();

            // 尝试获取细菌数据
            let bacteriaData = null;

            if (data["检出菌"] && data["检出菌"]["Bacteria"] && Array.isArray(data["检出菌"]["Bacteria"])) {
              bacteriaData = data["检出菌"]["Bacteria"];
            }

            if (bacteriaData && Array.isArray(bacteriaData) && bacteriaData.length > 0) {
              // 按丰度递减排序
              bacteriaData.sort((a, b) => {
                const abundanceA = parseFloat(a["丰度%"]) || 0;
                const abundanceB = parseFloat(b["丰度%"]) || 0;
                return abundanceB - abundanceA;
              });

              // 限制显示前35个
              if (bacteriaData.length > 35) {
                bacteriaData = bacteriaData.slice(0, 35);
              }

              this.renderTable(bacteriaData);
            } else {
              document.getElementById('detected-gut-bacteria-data-table-body').innerHTML =
                '<div class="text-center p-4">暂无检出细菌数据</div>';
            }
          } catch (error) {
            document.getElementById('detected-gut-bacteria-data-table-body').innerHTML =
              '<div class="text-center p-4 text-red-500">数据加载失败，请稍后再试</div>';
          }
        },

        // 初始化
        init() {
          if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => this.loadData());
          } else {
            this.loadData();
          }
        }
      };

      // 初始化检出细菌模块
      DetectedGutBacteria.init();
    </script>
  </div>

  <!-- 实际检出肠道菌群板块 : 检出真菌 -->

  <h2
    class="custom-title-1 page-break">
    检出肠道真菌
  </h2>

  <div
    class="bg-white rounded-lg p-5 mb-5 mx-auto"
    style="width: 100%;">

    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            <i class="fas fa-info-circle icon"></i>
            下列表格展示了您肠道中实际检出的真菌。如果检测到的真菌超过35种，则仅列出丰度最高的前35种。
          </p>
        </div>
      </div>
    </div>

    <div class="rounded-table">

      <table class="min-w-full">
        <thead>
        <tr style="background-color: #00B2B4; color: white;">
          <th
            class="py-2 px-4 text-left detected-gut-fungi-first-column"
            style="font-size: 10px;">
            真菌拉丁名
          </th>
          <th
            class="py-2 px-4 text-left detected-gut-fungi-second-column"
            style="font-size: 10px;">
            真菌中文名
          </th>
          <th
            class="py-2 px-4 text-right detected-gut-fungi-third-column"
            style="font-size: 10px; padding: 5px 5px;">
            参考范围%
          </th>
          <th
            class="py-2 px-4 text-right detected-gut-fungi-fourth-column"
            style="font-size: 10px;">
            检出丰度%
          </th>
        </tr>
        </thead>
      </table>

      <div id="detected-gut-fungi-data-table-body">
        <!-- 数据将通过 JavaScript 动态插入 -->
      </div>

    </div>

    <script>
      // 创建独立的命名空间对象，避免作用域冲突
      const DetectedGutFungi = {
        // 常量定义
        CONSTANTS: {
          COLORS: {
            RED: '#ff4d4f',
            GREEN: '#00B2B4',  // 使用与细菌表格一致的青色
            GRAY: '#808080',
            LIGHT_GRAY: '#f9f9f9'  // 用于隔行变色
          },
          FONT_SIZE: '10px'  // 与细菌表格一致的字体大小
        },

        // 格式化数字
        formatNumber(value) {
          if (typeof value === "string" && (value === "未检出" || value === "ND")) {
            return "ND";
          }

          const num = Number(value);
          if (isNaN(num)) return value;

          if (num >= 1) {
            const integerDigits = Math.floor(Math.log10(num)) + 1;
            const decimalPlaces = Math.max(0, 4 - integerDigits);
            return num.toFixed(decimalPlaces);
          } else {
            const str = num.toPrecision(4);
            return str.replace(/\.?0+$/, '');
          }
        },

        // 解析正常范围
        parseRange(rangeStr) {
          if (!rangeStr || typeof rangeStr !== 'string') {
            return { min: 0, max: 0 };
          }
          const parts = rangeStr.split('-');
          return {
            min: parseFloat(parts[0] || 0),
            max: parseFloat(parts[1] || 0)
          };
        },

        // 获取状态信息
        getStatus(detected, minRange, maxRange) {
          let status = {
            color: this.CONSTANTS.COLORS.GREEN,
            text: '正常',
            isNormal: true
          };

          if (detected === "ND" || detected === "未检出") {
            if (minRange > 0) {
              status.color = this.CONSTANTS.COLORS.RED;
              status.text = '偏低';
              status.isNormal = false;
            }
          } else {
            const numDetected = parseFloat(detected);
            if (numDetected < minRange) {
              status.color = this.CONSTANTS.COLORS.RED;
              status.text = '偏低';
              status.isNormal = false;
            } else if (numDetected > maxRange) {
              status.color = this.CONSTANTS.COLORS.RED;
              status.text = '超标';
              status.isNormal = false;
            }
          }

          return status;
        },

        // 渲染表格
        renderTable(fungiData) {
          const container = document.getElementById('detected-gut-fungi-data-table-body');
          if (!container) return;

          container.innerHTML = '';

          if (!fungiData || !Array.isArray(fungiData) || fungiData.length === 0) {
            container.innerHTML = '<div class="text-center p-4">暂无检出真菌数据</div>';
            return;
          }

          const fragment = document.createDocumentFragment();
          const mainTable = document.createElement('table');
          mainTable.className = 'min-w-full';
          const tbody = document.createElement('tbody');

          fungiData.forEach((fungi, index) => {
            const detected = fungi["丰度%"];
            const { min: minRange, max: maxRange } = this.parseRange(fungi["正常范围"]);

            const formattedDetectedValue = this.formatNumber(detected);
            const formattedMinRange = this.formatNumber(minRange);
            const formattedMaxRange = this.formatNumber(maxRange);

            // 获取状态信息
            this.getStatus(detected, minRange, maxRange);

            // 获取拉丁名和中文名
            const latinName = fungi["名称"] || "";
            const chineseName = fungi["中文名"] || "";

            // 确定第二列显示内容 - 如果中文名为空，则显示拉丁名
            const secondColumnContent = chineseName.trim() !== "" ? chineseName : latinName;

            // 创建行元素
            const tr = document.createElement('tr');
            tr.className = 'fungi-row';

            // 隔行灰色背景
            if (index % 2 === 1) {
              tr.style.backgroundColor = this.CONSTANTS.COLORS.LIGHT_GRAY;
            }

            // 设置行内容 - 为所有单元格应用10px的字体大小
            tr.innerHTML = `
            <td class="py-2 px-4 text-left detected-gut-fungi-first-column" style="font-size: ${this.CONSTANTS.FONT_SIZE};">
              <div style="font-style: italic;">
                ${latinName}
              </div>
            </td>
            <td class="py-2 px-4 text-left detected-gut-fungi-second-column" style="font-size: ${this.CONSTANTS.FONT_SIZE};">
              <div>${secondColumnContent}</div>
            </td>
            <td class="py-2 px-4 text-right detected-gut-fungi-third-column" style="font-size: ${this.CONSTANTS.FONT_SIZE};">
              ${formattedMinRange}-${formattedMaxRange}
            </td>
            <td class="py-2 px-4 text-right detected-gut-fungi-fourth-column" style="font-size: ${this.CONSTANTS.FONT_SIZE};">
              <span style="font-weight: bold;">
                ${formattedDetectedValue}
              </span>
            </td>
          `;

            tbody.appendChild(tr);
          });

          mainTable.appendChild(tbody);
          fragment.appendChild(mainTable);
          container.appendChild(fragment);
        },

        // 加载数据
        async loadData() {
          try {
            const response = await fetch(DATA_PATHS.DATA);
            if (!response.ok) {
              throw new Error(`Network response error: ${response.status}`);
            }

            const data = await response.json();

            // 尝试获取真菌数据，检查各种可能的位置
            let fungiData = null;

            if (data["检出菌"] && data["检出菌"]["Fungi"] && Array.isArray(data["检出菌"]["Fungi"])) {
              fungiData = data["检出菌"]["Fungi"];
            }

            if (fungiData && Array.isArray(fungiData) && fungiData.length > 0) {
              // 按丰度递减排序
              fungiData.sort((a, b) => {
                const abundanceA = parseFloat(a["丰度%"]) || 0;
                const abundanceB = parseFloat(b["丰度%"]) || 0;
                return abundanceB - abundanceA;
              });

              // 限制显示前35个
              if (fungiData.length > 35) {
                fungiData = fungiData.slice(0, 35);
              }

              this.renderTable(fungiData);
            } else {
              document.getElementById('detected-gut-fungi-data-table-body').innerHTML =
                '<div class="text-center p-4">暂无检出真菌数据</div>';
            }
          } catch (error) {
            document.getElementById('detected-gut-fungi-data-table-body').innerHTML =
              '<div class="text-center p-4 text-red-500">数据加载失败，请稍后再试</div>';
          }
        },

        // 初始化
        init() {
          if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => this.loadData());
          } else {
            this.loadData();
          }
        }
      };

      // 初始化检出真菌模块
      DetectedGutFungi.init();
    </script>
  </div>

  <!-- 实际检出肠道菌群板块 : 检出真核生物 -->

  <h2 class="custom-title-1 page-break">检出肠道真核生物</h2>

  <div class="bg-white rounded-lg p-5 mb-5 mx-auto" style="width: 100%;">

    <!-- 信息框 -->
    <div class="info-box">
      <div class="flex items-start">
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            <i class="fas fa-info-circle icon"></i>
            下列表格展示了您肠道中实际检出的真核生物。如果检测到的真核生物超过35种，则仅列出丰度最高的前35种。
          </p>
        </div>
      </div>
    </div>

    <div class="rounded-table">
      <table class="min-w-full">
        <thead>
        <tr style="background-color: #00B2B4; color: white;">
          <th
            class="py-2 px-4 text-left detected-gut-eukaryotes-first-column"
            style="font-size: 10px;">
            真核生物拉丁名
          </th>
          <th
            class="py-2 px-4 text-left detected-gut-eukaryotes-second-column"
            style="font-size: 10px;">
            真核生物中文名
          </th>
          <th
            class="py-2 px-4 text-right detected-gut-eukaryotes-third-column"
            style="font-size: 10px; padding: 5px 5px;">
            参考范围%
          </th>
          <th
            class="py-2 px-4 text-right detected-gut-eukaryotes-fourth-column"
            style="font-size: 10px;">
            检出丰度%
          </th>
        </tr>
        </thead>
      </table>

      <div id="detected-gut-eukaryotes-data-table-body">
        <!-- 数据将通过 JavaScript 动态插入 -->
      </div>
    </div>

    <script>
      // 创建独立的命名空间对象，避免作用域冲突
      const DetectedGutEukaryotes = {
        // 常量定义
        CONSTANTS: {
          COLORS: {
            RED: '#ff4d4f',
            GREEN: '#00B2B4',  // 使用原来的青色作为正常值颜色
            GRAY: '#808080',
            LIGHT_GRAY: '#f9f9f9'  // 用于隔行变色
          },
          FONT_SIZE: '10px'  // 调整字体大小为10px
        },

        // 格式化数字
        formatNumber(value) {
          if (typeof value === "string" && (value === "未检出" || value === "ND")) {
            return "ND";
          }

          const num = Number(value);
          if (isNaN(num)) return value;

          if (num >= 1) {
            const integerDigits = Math.floor(Math.log10(num)) + 1;
            const decimalPlaces = Math.max(0, 4 - integerDigits);
            return num.toFixed(decimalPlaces);
          } else {
            const str = num.toPrecision(4);
            return str.replace(/\.?0+$/, '');
          }
        },

        // 专门用于格式化范围数字 - 保留3位小数并去除多余的0
        formatRangeNumber(value) {
          if (typeof value === "string" && (value === "未检出" || value === "ND")) {
            return "ND";
          }

          const num = Number(value);
          if (isNaN(num)) return value;

          // 固定保留3位小数
          let formatted = num.toFixed(3);
          // 去除尾部多余的0和可能的小数点
          formatted = formatted.replace(/\.?0+$/, '');

          return formatted;
        },

        // 解析正常范围 (适应 "-0.05" 这种格式)
        parseRange(rangeStr) {
          if (!rangeStr || typeof rangeStr !== 'string') {
            return { min: 0, max: 0 };
          }

          // 检查是否为范围格式 (例如 "0.01-0.05")
          if (rangeStr.includes('-')) {
            const parts = rangeStr.split('-');
            return {
              min: parseFloat(parts[0] || 0),
              max: parseFloat(parts[1] || 0)
            };
          }
          // 单值格式 (例如 "-0.05")，表示最大值
          else {
            return {
              min: 0,
              max: parseFloat(rangeStr.replace('-', '')) || 0
            };
          }
        },

        // 获取状态信息
        getStatus(detected, minRange, maxRange) {
          let status = {
            color: this.CONSTANTS.COLORS.GREEN,
            text: '正常',
            isNormal: true
          };

          if (detected === "ND" || detected === "未检出") {
            if (minRange > 0) {
              status.color = this.CONSTANTS.COLORS.RED;
              status.text = '偏低';
              status.isNormal = false;
            }
          } else {
            const numDetected = parseFloat(detected);
            if (numDetected < minRange) {
              status.color = this.CONSTANTS.COLORS.RED;
              status.text = '偏低';
              status.isNormal = false;
            } else if (numDetected > maxRange) {
              status.color = this.CONSTANTS.COLORS.RED;
              status.text = '超标';
              status.isNormal = false;
            }
          }

          return status;
        },

        // 渲染表格
        renderTable(eukaryotesData) {
          const container = document.getElementById('detected-gut-eukaryotes-data-table-body');
          if (!container) return;

          container.innerHTML = '';

          if (!eukaryotesData || !Array.isArray(eukaryotesData) || eukaryotesData.length === 0) {
            container.innerHTML = '<div class="text-center p-4">暂无检出真核生物数据</div>';
            return;
          }

          const fragment = document.createDocumentFragment();
          const mainTable = document.createElement('table');
          mainTable.className = 'min-w-full';
          const tbody = document.createElement('tbody');

          eukaryotesData.forEach((eukaryote, index) => {
            const detected = eukaryote["丰度%"];
            const { min: minRange, max: maxRange } = this.parseRange(eukaryote["正常范围"]);

            const formattedDetectedValue = this.formatNumber(detected);
            // 使用新的格式化函数处理范围值
            const formattedMinRange = this.formatRangeNumber(minRange);
            const formattedMaxRange = this.formatRangeNumber(maxRange);

            // 获取拉丁名和中文名
            const latinName = eukaryote["名称"] || "";
            const chineseName = eukaryote["中文名"] || "";

            // 确定第二列显示内容 - 如果中文名为空，则显示拉丁名
            const secondColumnContent = chineseName.trim() !== "" ? chineseName : latinName;

            // 创建行元素
            const tr = document.createElement('tr');
            tr.className = 'eukaryote-row';

            // 隔行灰色背景
            if (index % 2 === 1) {
              tr.style.backgroundColor = this.CONSTANTS.COLORS.LIGHT_GRAY;
            }

            // 设置行内容 - 为所有单元格应用10px的字体大小
            tr.innerHTML = `
              <td class="py-2 px-4 text-left detected-gut-eukaryotes-first-column" style="font-size: ${this.CONSTANTS.FONT_SIZE};">
                <div style="font-style: italic;">
                  ${latinName}
                </div>
              </td>
              <td class="py-2 px-4 text-left detected-gut-eukaryotes-second-column" style="font-size: ${this.CONSTANTS.FONT_SIZE};">
                <div>${secondColumnContent}</div>
              </td>
              <td class="py-2 px-4 text-right detected-gut-eukaryotes-third-column" style="font-size: ${this.CONSTANTS.FONT_SIZE};">
                ${formattedMinRange}-${formattedMaxRange}
              </td>
              <td class="py-2 px-4 text-right detected-gut-eukaryotes-fourth-column" style="font-size: ${this.CONSTANTS.FONT_SIZE};">
                <span style="font-weight: bold;">
                  ${formattedDetectedValue}
                </span>
              </td>
            `;

            tbody.appendChild(tr);
          });

          mainTable.appendChild(tbody);
          fragment.appendChild(mainTable);
          container.appendChild(fragment);
        },

        // 加载数据
        async loadData() {
          try {
            const response = await fetch(DATA_PATHS.DATA);
            if (!response.ok) {
              throw new Error(`Network response error: ${response.status}`);
            }

            const data = await response.json();

            // 尝试获取真核生物数据，检查各种可能的位置
            let eukaryotesData = null;

            if (data["检出菌"] && data["检出菌"]["Eukaryota"] && Array.isArray(data["检出菌"]["Eukaryota"])) {
              eukaryotesData = data["检出菌"]["Eukaryota"];
            }
            else if (data["检出菌"] && data["检出菌"]["eukaryotes"] && Array.isArray(data["检出菌"]["eukaryotes"])) {
              eukaryotesData = data["检出菌"]["eukaryotes"];
            }
            else if (data["检出菌"] && data["检出菌"]["真核生物"] && Array.isArray(data["检出菌"]["真核生物"])) {
              eukaryotesData = data["检出菌"]["真核生物"];
            }
            else if (data["Eukaryota"] && Array.isArray(data["Eukaryota"])) {
              eukaryotesData = data["Eukaryota"];
            }
            else if (data["eukaryotes"] && Array.isArray(data["eukaryotes"])) {
              eukaryotesData = data["eukaryotes"];
            }
            else if (data["真核生物"] && Array.isArray(data["真核生物"])) {
              eukaryotesData = data["真核生物"];
            }

            if (eukaryotesData && Array.isArray(eukaryotesData) && eukaryotesData.length > 0) {
              // 按丰度递减排序
              eukaryotesData.sort((a, b) => {
                const abundanceA = parseFloat(a["丰度%"]) || 0;
                const abundanceB = parseFloat(b["丰度%"]) || 0;
                return abundanceB - abundanceA;
              });

              // 限制显示前35个
              if (eukaryotesData.length > 35) {
                eukaryotesData = eukaryotesData.slice(0, 35);
              }

              this.renderTable(eukaryotesData);
            } else {
              document.getElementById('detected-gut-eukaryotes-data-table-body').innerHTML =
                '<div class="text-center p-4">暂无检出真核生物数据</div>';
            }
          } catch (error) {
            document.getElementById('detected-gut-eukaryotes-data-table-body').innerHTML =
              '<div class="text-center p-4 text-red-500">数据加载失败，请稍后再试</div>';
          }
        },

        // 初始化
        init() {
          if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => this.loadData());
          } else {
            this.loadData();
          }
        }
      };

      // 初始化检出真核生物模块
      DetectedGutEukaryotes.init();
    </script>
  </div>

  <!-- 参考文献板块 -->
  <h1 class="custom-title-1 page-break">参考文献</h1>

  <div class="bg-white rounded-lg p-5 mb-5 mx-auto" style="width: 100%;">

    <!-- 参考文献板块 : 信息说明卡片 -->

    <div class="info-box">
      <div class="flex items-start">
        <div class="ml-2">
          <p class="text-lg text-custom-teal">
            <i class="fas fa-info-circle icon"></i>
            下列是本宏基因组报告作参考的文献资料。
          </p>
        </div>
      </div>
    </div>

    <!-- 参考文献板块 : 参考文献卡片展示 -->

    <div id="references" class="space-y-1"></div>

    <script>
      async function loadReferences() {
        try {
          // 使用 fetch API 获取数据
          const response = await fetch(DATA_PATHS.DATA);
          const data = await response.json();

          // 确保获取到的 data 具有 reference_data 属性
          const referencesContainer = document.getElementById('references');

          // 遍历从 JSON 获取的数据并生成 HTML
          data.reference_data.forEach(reference => {
            const referenceCard = `
              <div class="bg-white rounded-lg py-2 px-3 border border-gray-200 w-full reference-card-no-break">
                <div class="mb-1">
                  <h3 class="text-[12px] font-semibold text-gray-800">${reference.title}</h3>
                </div>
                <div class="flex flex-wrap gap-2 items-center">
                  <div class="flex items-center gap-2">
                    <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                    </svg>
                    <span class="text-[10px] text-gray-600">${reference.author}</span>
                  </div>
                  <span class="text-gray-300">•</span>
                  <div class="flex items-center gap-2">
                    <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                    </svg>
                    <span class="text-[10px] text-gray-600">${reference.journal}</span>
                  </div>
                  <span class="text-gray-300">•</span>
                  <div class="flex items-center gap-2">
                    <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    <span class="text-[10px] text-gray-600">${reference.date}</span>
                  </div>
                </div>
              </div>
            `;

            referencesContainer.innerHTML += referenceCard; //将 HTML 卡片添加到容器中
          });
        } catch (error) {
          console.error("Error fetching data:", error);
        }
      }

      // 调用加载函数
      loadReferences();
    </script>


  </div>

</body>
</html>

